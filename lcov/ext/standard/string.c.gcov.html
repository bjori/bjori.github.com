<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <title>LCOV - PHP Code Coverage - ext/standard/string.c</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
        <tr>
          <td width="5%"></td>
          <td width="10%" class="headerItem">Current view:</td>
          <td width="35%" class="headerValue"><a href="../../index.html">directory</a> - <a href="index.html">ext/standard</a> - string.c (source / <a href="string.c.func.html">functions</a>)</td>
          <td width="10%"></td>
          <td width="10%" class="headerCovTableHead">Found</td>
          <td width="10%" class="headerCovTableHead">Hit</td>
          <td width="15%" class="headerCovTableHead">Coverage</td>
          <td width="5%"></td>
        </tr>
        <tr>
          <td></td>
          <td class="headerItem">Test:</td>
          <td class="headerValue">PHP Code Coverage</td>
          <td class="headerItem">Lines:</td>
          <td class="headerCovTableEntry">2442</td>
          <td class="headerCovTableEntry">403</td>
          <td class="headerCovTableEntryMed">16.5 %</td>
        </tr>
        <tr>
          <td></td>
          <td class="headerItem">Date:</td>
          <td class="headerValue">2012-06-19</td>
          <td class="headerItem">Functions:</td>
          <td class="headerCovTableEntry">111</td>
          <td class="headerCovTableEntry">25</td>
          <td class="headerCovTableEntryLo">22.5 %</td>
        </tr>
        <tr>
          <td></td>
          <td class="headerItem">Colors:</td>
          <td class="headerValueLeg" colspan=5>
            <span class="coverLegendNoCov">not hit</span>
            <span class="coverLegendCov">hit</span>
          </td>
        </tr>
                <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td><pre class="source">
<a name="1"><span class="lineNum">       1 </span>                : /*</a>
<span class="lineNum">       2 </span>                :    +----------------------------------------------------------------------+
<span class="lineNum">       3 </span>                :    | PHP Version 5                                                        |
<span class="lineNum">       4 </span>                :    +----------------------------------------------------------------------+
<span class="lineNum">       5 </span>                :    | Copyright (c) 1997-2012 The PHP Group                                |
<span class="lineNum">       6 </span>                :    +----------------------------------------------------------------------+
<span class="lineNum">       7 </span>                :    | This source file is subject to version 3.01 of the PHP license,      |
<span class="lineNum">       8 </span>                :    | that is bundled with this package in the file LICENSE, and is        |
<span class="lineNum">       9 </span>                :    | available through the world-wide-web at the following url:           |
<span class="lineNum">      10 </span>                :    | http://www.php.net/license/3_01.txt                                  |
<span class="lineNum">      11 </span>                :    | If you did not receive a copy of the PHP license and are unable to   |
<span class="lineNum">      12 </span>                :    | obtain it through the world-wide-web, please send a note to          |
<span class="lineNum">      13 </span>                :    | license@php.net so we can mail you a copy immediately.               |
<span class="lineNum">      14 </span>                :    +----------------------------------------------------------------------+
<span class="lineNum">      15 </span>                :    | Authors: Rasmus Lerdorf &lt;rasmus@php.net&gt;                             |
<span class="lineNum">      16 </span>                :    |          Stig Sæther Bakken &lt;ssb@php.net&gt;                            |
<span class="lineNum">      17 </span>                :    |          Zeev Suraski &lt;zeev@zend.com&gt;                                |
<span class="lineNum">      18 </span>                :    +----------------------------------------------------------------------+
<span class="lineNum">      19 </span>                :  */
<span class="lineNum">      20 </span>                : 
<span class="lineNum">      21 </span>                : /* $Id$ */
<span class="lineNum">      22 </span>                : 
<span class="lineNum">      23 </span>                : /* Synced with php 3.0 revision 1.193 1999-06-16 [ssb] */
<span class="lineNum">      24 </span>                : 
<span class="lineNum">      25 </span>                : #include &lt;stdio.h&gt;
<span class="lineNum">      26 </span>                : #include &quot;php.h&quot;
<span class="lineNum">      27 </span>                : #include &quot;php_rand.h&quot;
<span class="lineNum">      28 </span>                : #include &quot;php_string.h&quot;
<span class="lineNum">      29 </span>                : #include &quot;php_variables.h&quot;
<span class="lineNum">      30 </span>                : #ifdef HAVE_LOCALE_H
<span class="lineNum">      31 </span>                : # include &lt;locale.h&gt;
<span class="lineNum">      32 </span>                : #endif
<span class="lineNum">      33 </span>                : #ifdef HAVE_LANGINFO_H
<span class="lineNum">      34 </span>                : # include &lt;langinfo.h&gt;
<span class="lineNum">      35 </span>                : #endif
<span class="lineNum">      36 </span>                : #ifdef HAVE_MONETARY_H
<span class="lineNum">      37 </span>                : # include &lt;monetary.h&gt;
<span class="lineNum">      38 </span>                : #endif
<span class="lineNum">      39 </span>                : /*
<span class="lineNum">      40 </span>                :  * This define is here because some versions of libintl redefine setlocale
<span class="lineNum">      41 </span>                :  * to point to libintl_setlocale.  That's a ridiculous thing to do as far
<span class="lineNum">      42 </span>                :  * as I am concerned, but with this define and the subsequent undef we
<span class="lineNum">      43 </span>                :  * limit the damage to just the actual setlocale() call in this file
<span class="lineNum">      44 </span>                :  * without turning zif_setlocale into zif_libintl_setlocale.  -Rasmus
<span class="lineNum">      45 </span>                :  */
<span class="lineNum">      46 </span>                : #define php_my_setlocale setlocale
<span class="lineNum">      47 </span>                : #ifdef HAVE_LIBINTL
<span class="lineNum">      48 </span>                : # include &lt;libintl.h&gt; /* For LC_MESSAGES */
<span class="lineNum">      49 </span>                :  #ifdef setlocale
<span class="lineNum">      50 </span>                :  # undef setlocale
<span class="lineNum">      51 </span>                :  #endif
<span class="lineNum">      52 </span>                : #endif
<span class="lineNum">      53 </span>                : 
<span class="lineNum">      54 </span>                : #include &quot;scanf.h&quot;
<span class="lineNum">      55 </span>                : #include &quot;zend_API.h&quot;
<span class="lineNum">      56 </span>                : #include &quot;zend_execute.h&quot;
<span class="lineNum">      57 </span>                : #include &quot;php_globals.h&quot;
<span class="lineNum">      58 </span>                : #include &quot;basic_functions.h&quot;
<span class="lineNum">      59 </span>                : #include &quot;php_smart_str.h&quot;
<span class="lineNum">      60 </span>                : #ifdef ZTS
<span class="lineNum">      61 </span>                : #include &quot;TSRM.h&quot;
<span class="lineNum">      62 </span>                : #endif
<span class="lineNum">      63 </span>                : 
<span class="lineNum">      64 </span>                : /* For str_getcsv() support */
<span class="lineNum">      65 </span>                : #include &quot;ext/standard/file.h&quot;
<span class="lineNum">      66 </span>                : 
<span class="lineNum">      67 </span>                : #define STR_PAD_LEFT                    0
<span class="lineNum">      68 </span>                : #define STR_PAD_RIGHT                   1
<span class="lineNum">      69 </span>                : #define STR_PAD_BOTH                    2
<span class="lineNum">      70 </span>                : #define PHP_PATHINFO_DIRNAME    1
<span class="lineNum">      71 </span>                : #define PHP_PATHINFO_BASENAME   2
<span class="lineNum">      72 </span>                : #define PHP_PATHINFO_EXTENSION  4
<span class="lineNum">      73 </span>                : #define PHP_PATHINFO_FILENAME   8
<span class="lineNum">      74 </span>                : #define PHP_PATHINFO_ALL        (PHP_PATHINFO_DIRNAME | PHP_PATHINFO_BASENAME | PHP_PATHINFO_EXTENSION | PHP_PATHINFO_FILENAME)
<span class="lineNum">      75 </span>                : 
<span class="lineNum">      76 </span>                : #define STR_STRSPN                              0
<span class="lineNum">      77 </span>                : #define STR_STRCSPN                             1
<span class="lineNum">      78 </span>                : 
<a name="79"><span class="lineNum">      79 </span>                : /* {{{ register_string_constants</a>
<span class="lineNum">      80 </span>                :  */
<span class="lineNum">      81 </span><span class="lineCov">             48 : void register_string_constants(INIT_FUNC_ARGS)</span>
<span class="lineNum">      82 </span>                : {
<span class="lineNum">      83 </span><span class="lineCov">             48 :         REGISTER_LONG_CONSTANT(&quot;STR_PAD_LEFT&quot;, STR_PAD_LEFT, CONST_CS | CONST_PERSISTENT);</span>
<span class="lineNum">      84 </span><span class="lineCov">             48 :         REGISTER_LONG_CONSTANT(&quot;STR_PAD_RIGHT&quot;, STR_PAD_RIGHT, CONST_CS | CONST_PERSISTENT);</span>
<span class="lineNum">      85 </span><span class="lineCov">             48 :         REGISTER_LONG_CONSTANT(&quot;STR_PAD_BOTH&quot;, STR_PAD_BOTH, CONST_CS | CONST_PERSISTENT);</span>
<span class="lineNum">      86 </span><span class="lineCov">             48 :         REGISTER_LONG_CONSTANT(&quot;PATHINFO_DIRNAME&quot;, PHP_PATHINFO_DIRNAME, CONST_CS | CONST_PERSISTENT);</span>
<span class="lineNum">      87 </span><span class="lineCov">             48 :         REGISTER_LONG_CONSTANT(&quot;PATHINFO_BASENAME&quot;, PHP_PATHINFO_BASENAME, CONST_CS | CONST_PERSISTENT);</span>
<span class="lineNum">      88 </span><span class="lineCov">             48 :         REGISTER_LONG_CONSTANT(&quot;PATHINFO_EXTENSION&quot;, PHP_PATHINFO_EXTENSION, CONST_CS | CONST_PERSISTENT);</span>
<span class="lineNum">      89 </span><span class="lineCov">             48 :         REGISTER_LONG_CONSTANT(&quot;PATHINFO_FILENAME&quot;, PHP_PATHINFO_FILENAME, CONST_CS | CONST_PERSISTENT);</span>
<span class="lineNum">      90 </span>                : 
<span class="lineNum">      91 </span>                : #ifdef HAVE_LOCALECONV
<span class="lineNum">      92 </span>                :         /* If last members of struct lconv equal CHAR_MAX, no grouping is done */
<span class="lineNum">      93 </span>                : 
<span class="lineNum">      94 </span>                : /* This is bad, but since we are going to be hardcoding in the POSIX stuff anyway... */
<span class="lineNum">      95 </span>                : # ifndef HAVE_LIMITS_H
<span class="lineNum">      96 </span>                : # define CHAR_MAX 127
<span class="lineNum">      97 </span>                : # endif
<span class="lineNum">      98 </span>                : 
<span class="lineNum">      99 </span><span class="lineCov">             48 :         REGISTER_LONG_CONSTANT(&quot;CHAR_MAX&quot;, CHAR_MAX, CONST_CS | CONST_PERSISTENT);</span>
<span class="lineNum">     100 </span>                : #endif
<span class="lineNum">     101 </span>                : 
<span class="lineNum">     102 </span>                : #ifdef HAVE_LOCALE_H
<span class="lineNum">     103 </span><span class="lineCov">             48 :         REGISTER_LONG_CONSTANT(&quot;LC_CTYPE&quot;, LC_CTYPE, CONST_CS | CONST_PERSISTENT);</span>
<span class="lineNum">     104 </span><span class="lineCov">             48 :         REGISTER_LONG_CONSTANT(&quot;LC_NUMERIC&quot;, LC_NUMERIC, CONST_CS | CONST_PERSISTENT);</span>
<span class="lineNum">     105 </span><span class="lineCov">             48 :         REGISTER_LONG_CONSTANT(&quot;LC_TIME&quot;, LC_TIME, CONST_CS | CONST_PERSISTENT);</span>
<span class="lineNum">     106 </span><span class="lineCov">             48 :         REGISTER_LONG_CONSTANT(&quot;LC_COLLATE&quot;, LC_COLLATE, CONST_CS | CONST_PERSISTENT);</span>
<span class="lineNum">     107 </span><span class="lineCov">             48 :         REGISTER_LONG_CONSTANT(&quot;LC_MONETARY&quot;, LC_MONETARY, CONST_CS | CONST_PERSISTENT);</span>
<span class="lineNum">     108 </span><span class="lineCov">             48 :         REGISTER_LONG_CONSTANT(&quot;LC_ALL&quot;, LC_ALL, CONST_CS | CONST_PERSISTENT);</span>
<span class="lineNum">     109 </span>                : # ifdef LC_MESSAGES
<span class="lineNum">     110 </span><span class="lineCov">             48 :         REGISTER_LONG_CONSTANT(&quot;LC_MESSAGES&quot;, LC_MESSAGES, CONST_CS | CONST_PERSISTENT);</span>
<span class="lineNum">     111 </span>                : # endif
<span class="lineNum">     112 </span>                : #endif
<span class="lineNum">     113 </span>                : 
<span class="lineNum">     114 </span><span class="lineCov">             48 : }</span>
<span class="lineNum">     115 </span>                : /* }}} */
<span class="lineNum">     116 </span>                : 
<span class="lineNum">     117 </span>                : int php_tag_find(char *tag, int len, char *set);
<span class="lineNum">     118 </span>                : 
<span class="lineNum">     119 </span>                : /* this is read-only, so it's ok */
<span class="lineNum">     120 </span>                : static char hexconvtab[] = &quot;0123456789abcdef&quot;;
<span class="lineNum">     121 </span>                : 
<span class="lineNum">     122 </span>                : /* localeconv mutex */
<span class="lineNum">     123 </span>                : #ifdef ZTS
<span class="lineNum">     124 </span>                : static MUTEX_T locale_mutex = NULL;
<span class="lineNum">     125 </span>                : #endif
<span class="lineNum">     126 </span>                : 
<a name="127"><span class="lineNum">     127 </span>                : /* {{{ php_bin2hex</a>
<span class="lineNum">     128 </span>                :  */
<span class="lineNum">     129 </span><span class="lineNoCov">              0 : static char *php_bin2hex(const unsigned char *old, const size_t oldlen, size_t *newlen)</span>
<span class="lineNum">     130 </span>                : {
<span class="lineNum">     131 </span><span class="lineNoCov">              0 :         register unsigned char *result = NULL;</span>
<span class="lineNum">     132 </span>                :         size_t i, j;
<span class="lineNum">     133 </span>                : 
<span class="lineNum">     134 </span><span class="lineNoCov">              0 :         result = (unsigned char *) safe_emalloc(oldlen * 2, sizeof(char), 1);</span>
<span class="lineNum">     135 </span>                : 
<span class="lineNum">     136 </span><span class="lineNoCov">              0 :         for (i = j = 0; i &lt; oldlen; i++) {</span>
<span class="lineNum">     137 </span><span class="lineNoCov">              0 :                 result[j++] = hexconvtab[old[i] &gt;&gt; 4];</span>
<span class="lineNum">     138 </span><span class="lineNoCov">              0 :                 result[j++] = hexconvtab[old[i] &amp; 15];</span>
<span class="lineNum">     139 </span>                :         }
<span class="lineNum">     140 </span><span class="lineNoCov">              0 :         result[j] = '\0';</span>
<span class="lineNum">     141 </span>                : 
<span class="lineNum">     142 </span><span class="lineNoCov">              0 :         if (newlen)</span>
<span class="lineNum">     143 </span><span class="lineNoCov">              0 :                 *newlen = oldlen * 2 * sizeof(char);</span>
<span class="lineNum">     144 </span>                : 
<span class="lineNum">     145 </span><span class="lineNoCov">              0 :         return (char *)result;</span>
<span class="lineNum">     146 </span>                : }
<span class="lineNum">     147 </span>                : /* }}} */
<span class="lineNum">     148 </span>                : 
<a name="149"><span class="lineNum">     149 </span>                : /* {{{ php_hex2bin</a>
<span class="lineNum">     150 </span>                :  */
<span class="lineNum">     151 </span><span class="lineNoCov">              0 : static char *php_hex2bin(const unsigned char *old, const size_t oldlen, size_t *newlen)</span>
<span class="lineNum">     152 </span>                : {
<span class="lineNum">     153 </span><span class="lineNoCov">              0 :         size_t target_length = oldlen &gt;&gt; 1;</span>
<span class="lineNum">     154 </span><span class="lineNoCov">              0 :         register unsigned char *str = (unsigned char *)safe_emalloc(target_length, sizeof(char), 1);</span>
<span class="lineNum">     155 </span>                :         size_t i, j;
<span class="lineNum">     156 </span><span class="lineNoCov">              0 :         for (i = j = 0; i &lt; target_length; i++) {</span>
<span class="lineNum">     157 </span><span class="lineNoCov">              0 :                 char c = old[j++];</span>
<span class="lineNum">     158 </span><span class="lineNoCov">              0 :                 if (c &gt;= '0' &amp;&amp; c &lt;= '9') {</span>
<span class="lineNum">     159 </span><span class="lineNoCov">              0 :                         str[i] = (c - '0') &lt;&lt; 4;</span>
<span class="lineNum">     160 </span><span class="lineNoCov">              0 :                 } else if (c &gt;= 'a' &amp;&amp; c &lt;= 'f') {</span>
<span class="lineNum">     161 </span><span class="lineNoCov">              0 :                         str[i] = (c - 'a' + 10) &lt;&lt; 4;</span>
<span class="lineNum">     162 </span><span class="lineNoCov">              0 :                 } else if (c &gt;= 'A' &amp;&amp; c &lt;= 'F') {</span>
<span class="lineNum">     163 </span><span class="lineNoCov">              0 :                         str[i] = (c - 'A' + 10) &lt;&lt; 4;</span>
<span class="lineNum">     164 </span>                :                 } else {
<span class="lineNum">     165 </span><span class="lineNoCov">              0 :                         efree(str);</span>
<span class="lineNum">     166 </span><span class="lineNoCov">              0 :                         return NULL;</span>
<span class="lineNum">     167 </span>                :                 }
<span class="lineNum">     168 </span><span class="lineNoCov">              0 :                 c = old[j++];</span>
<span class="lineNum">     169 </span><span class="lineNoCov">              0 :                 if (c &gt;= '0' &amp;&amp; c &lt;= '9') {</span>
<span class="lineNum">     170 </span><span class="lineNoCov">              0 :                         str[i] |= c - '0';</span>
<span class="lineNum">     171 </span><span class="lineNoCov">              0 :                 } else if (c &gt;= 'a' &amp;&amp; c &lt;= 'f') {</span>
<span class="lineNum">     172 </span><span class="lineNoCov">              0 :                         str[i] |= c - 'a' + 10;</span>
<span class="lineNum">     173 </span><span class="lineNoCov">              0 :                 } else if (c &gt;= 'A' &amp;&amp; c &lt;= 'F') {</span>
<span class="lineNum">     174 </span><span class="lineNoCov">              0 :                         str[i] |= c - 'A' + 10;</span>
<span class="lineNum">     175 </span>                :                 } else {
<span class="lineNum">     176 </span><span class="lineNoCov">              0 :                         efree(str);</span>
<span class="lineNum">     177 </span><span class="lineNoCov">              0 :                         return NULL;</span>
<span class="lineNum">     178 </span>                :                 }
<span class="lineNum">     179 </span>                :         }
<span class="lineNum">     180 </span><span class="lineNoCov">              0 :         str[target_length] = '\0';</span>
<span class="lineNum">     181 </span>                : 
<span class="lineNum">     182 </span><span class="lineNoCov">              0 :         if (newlen)</span>
<span class="lineNum">     183 </span><span class="lineNoCov">              0 :                 *newlen = target_length;</span>
<span class="lineNum">     184 </span>                : 
<span class="lineNum">     185 </span><span class="lineNoCov">              0 :         return (char *)str;</span>
<span class="lineNum">     186 </span>                : }
<span class="lineNum">     187 </span>                : /* }}} */
<span class="lineNum">     188 </span>                : 
<span class="lineNum">     189 </span>                : #ifdef HAVE_LOCALECONV
<a name="190"><span class="lineNum">     190 </span>                : /* {{{ localeconv_r</a>
<span class="lineNum">     191 </span>                :  * glibc's localeconv is not reentrant, so lets make it so ... sorta */
<span class="lineNum">     192 </span><span class="lineNoCov">              0 : PHPAPI struct lconv *localeconv_r(struct lconv *out)</span>
<span class="lineNum">     193 </span>                : {
<span class="lineNum">     194 </span>                :         struct lconv *res;
<span class="lineNum">     195 </span>                : 
<span class="lineNum">     196 </span>                : # ifdef ZTS
<span class="lineNum">     197 </span>                :         tsrm_mutex_lock( locale_mutex );
<span class="lineNum">     198 </span>                : # endif
<span class="lineNum">     199 </span>                : 
<span class="lineNum">     200 </span>                :         /* localeconv doesn't return an error condition */
<span class="lineNum">     201 </span><span class="lineNoCov">              0 :         res = localeconv();</span>
<span class="lineNum">     202 </span>                : 
<span class="lineNum">     203 </span><span class="lineNoCov">              0 :         *out = *res;</span>
<span class="lineNum">     204 </span>                : 
<span class="lineNum">     205 </span>                : # ifdef ZTS
<span class="lineNum">     206 </span>                :         tsrm_mutex_unlock( locale_mutex );
<span class="lineNum">     207 </span>                : # endif
<span class="lineNum">     208 </span>                : 
<span class="lineNum">     209 </span><span class="lineNoCov">              0 :         return out;</span>
<span class="lineNum">     210 </span>                : }
<span class="lineNum">     211 </span>                : /* }}} */
<span class="lineNum">     212 </span>                : 
<span class="lineNum">     213 </span>                : # ifdef ZTS
<span class="lineNum">     214 </span>                : /* {{{ PHP_MINIT_FUNCTION
<span class="lineNum">     215 </span>                :  */
<span class="lineNum">     216 </span>                : PHP_MINIT_FUNCTION(localeconv)
<span class="lineNum">     217 </span>                : {
<span class="lineNum">     218 </span>                :         locale_mutex = tsrm_mutex_alloc();
<span class="lineNum">     219 </span>                :         return SUCCESS;
<span class="lineNum">     220 </span>                : }
<span class="lineNum">     221 </span>                : /* }}} */
<span class="lineNum">     222 </span>                : 
<span class="lineNum">     223 </span>                : /* {{{ PHP_MSHUTDOWN_FUNCTION
<span class="lineNum">     224 </span>                :  */
<span class="lineNum">     225 </span>                : PHP_MSHUTDOWN_FUNCTION(localeconv)
<span class="lineNum">     226 </span>                : {
<span class="lineNum">     227 </span>                :         tsrm_mutex_free( locale_mutex );
<span class="lineNum">     228 </span>                :         locale_mutex = NULL;
<span class="lineNum">     229 </span>                :         return SUCCESS;
<span class="lineNum">     230 </span>                : }
<span class="lineNum">     231 </span>                : /* }}} */
<span class="lineNum">     232 </span>                : # endif
<span class="lineNum">     233 </span>                : #endif
<span class="lineNum">     234 </span>                : 
<a name="235"><span class="lineNum">     235 </span>                : /* {{{ proto string bin2hex(string data)</a>
<span class="lineNum">     236 </span>                :    Converts the binary representation of data to hex */
<span class="lineNum">     237 </span><span class="lineNoCov">              0 : PHP_FUNCTION(bin2hex)</span>
<span class="lineNum">     238 </span>                : {
<span class="lineNum">     239 </span>                :         char *result, *data;
<span class="lineNum">     240 </span>                :         size_t newlen;
<span class="lineNum">     241 </span>                :         int datalen;
<span class="lineNum">     242 </span>                : 
<span class="lineNum">     243 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s&quot;, &amp;data, &amp;datalen) == FAILURE) {</span>
<span class="lineNum">     244 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">     245 </span>                :         }
<span class="lineNum">     246 </span>                : 
<span class="lineNum">     247 </span><span class="lineNoCov">              0 :         result = php_bin2hex((unsigned char *)data, datalen, &amp;newlen);</span>
<span class="lineNum">     248 </span>                : 
<span class="lineNum">     249 </span><span class="lineNoCov">              0 :         if (!result) {</span>
<span class="lineNum">     250 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">     251 </span>                :         }
<span class="lineNum">     252 </span>                : 
<span class="lineNum">     253 </span><span class="lineNoCov">              0 :         RETURN_STRINGL(result, newlen, 0);</span>
<span class="lineNum">     254 </span>                : }
<span class="lineNum">     255 </span>                : /* }}} */
<span class="lineNum">     256 </span>                : 
<a name="257"><span class="lineNum">     257 </span>                : /* {{{ proto string hex2bin(string data)</a>
<span class="lineNum">     258 </span>                :    Converts the hex representation of data to binary */
<span class="lineNum">     259 </span><span class="lineNoCov">              0 : PHP_FUNCTION(hex2bin)</span>
<span class="lineNum">     260 </span>                : {
<span class="lineNum">     261 </span>                :         char *result, *data;
<span class="lineNum">     262 </span>                :         size_t newlen;
<span class="lineNum">     263 </span>                :         int datalen;
<span class="lineNum">     264 </span>                : 
<span class="lineNum">     265 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s&quot;, &amp;data, &amp;datalen) == FAILURE) {</span>
<span class="lineNum">     266 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">     267 </span>                :         }
<span class="lineNum">     268 </span>                : 
<span class="lineNum">     269 </span><span class="lineNoCov">              0 :         if (datalen % 2 != 0) {</span>
<span class="lineNum">     270 </span><span class="lineNoCov">              0 :                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Hexadecimal input string must have an even length&quot;);</span>
<span class="lineNum">     271 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">     272 </span>                :         }
<span class="lineNum">     273 </span>                : 
<span class="lineNum">     274 </span><span class="lineNoCov">              0 :         result = php_hex2bin((unsigned char *)data, datalen, &amp;newlen);</span>
<span class="lineNum">     275 </span>                : 
<span class="lineNum">     276 </span><span class="lineNoCov">              0 :         if (!result) {</span>
<span class="lineNum">     277 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">     278 </span>                :         }
<span class="lineNum">     279 </span>                : 
<span class="lineNum">     280 </span><span class="lineNoCov">              0 :         RETURN_STRINGL(result, newlen, 0);</span>
<span class="lineNum">     281 </span>                : }
<a name="282"><span class="lineNum">     282 </span>                : /* }}} */</a>
<span class="lineNum">     283 </span>                : 
<span class="lineNum">     284 </span><span class="lineNoCov">              0 : static void php_spn_common_handler(INTERNAL_FUNCTION_PARAMETERS, int behavior) /* {{{ */</span>
<span class="lineNum">     285 </span>                : {
<span class="lineNum">     286 </span>                :         char *s11, *s22;
<span class="lineNum">     287 </span>                :         int len1, len2;
<span class="lineNum">     288 </span><span class="lineNoCov">              0 :         long start = 0, len = 0;</span>
<span class="lineNum">     289 </span>                : 
<span class="lineNum">     290 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;ss|ll&quot;, &amp;s11, &amp;len1,</span>
<span class="lineNum">     291 </span>                :                                 &amp;s22, &amp;len2, &amp;start, &amp;len) == FAILURE) {
<span class="lineNum">     292 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">     293 </span>                :         }
<span class="lineNum">     294 </span>                : 
<span class="lineNum">     295 </span><span class="lineNoCov">              0 :         if (ZEND_NUM_ARGS() &lt; 4) {</span>
<span class="lineNum">     296 </span><span class="lineNoCov">              0 :                 len = len1;</span>
<span class="lineNum">     297 </span>                :         }
<span class="lineNum">     298 </span>                : 
<span class="lineNum">     299 </span>                :         /* look at substr() function for more information */
<span class="lineNum">     300 </span>                : 
<span class="lineNum">     301 </span><span class="lineNoCov">              0 :         if (start &lt; 0) {</span>
<span class="lineNum">     302 </span><span class="lineNoCov">              0 :                 start += len1;</span>
<span class="lineNum">     303 </span><span class="lineNoCov">              0 :                 if (start &lt; 0) {</span>
<span class="lineNum">     304 </span><span class="lineNoCov">              0 :                         start = 0;</span>
<span class="lineNum">     305 </span>                :                 }
<span class="lineNum">     306 </span><span class="lineNoCov">              0 :         } else if (start &gt; len1) {</span>
<span class="lineNum">     307 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">     308 </span>                :         }
<span class="lineNum">     309 </span>                : 
<span class="lineNum">     310 </span><span class="lineNoCov">              0 :         if (len &lt; 0) {</span>
<span class="lineNum">     311 </span><span class="lineNoCov">              0 :                 len += (len1 - start);</span>
<span class="lineNum">     312 </span><span class="lineNoCov">              0 :                 if (len &lt; 0) {</span>
<span class="lineNum">     313 </span><span class="lineNoCov">              0 :                         len = 0;</span>
<span class="lineNum">     314 </span>                :                 }
<span class="lineNum">     315 </span>                :         }
<span class="lineNum">     316 </span>                : 
<span class="lineNum">     317 </span><span class="lineNoCov">              0 :         if (len &gt; len1 - start) {</span>
<span class="lineNum">     318 </span><span class="lineNoCov">              0 :                 len = len1 - start;</span>
<span class="lineNum">     319 </span>                :         }
<span class="lineNum">     320 </span>                : 
<span class="lineNum">     321 </span><span class="lineNoCov">              0 :         if(len == 0) {</span>
<span class="lineNum">     322 </span><span class="lineNoCov">              0 :                 RETURN_LONG(0);</span>
<span class="lineNum">     323 </span>                :         }
<span class="lineNum">     324 </span>                : 
<span class="lineNum">     325 </span><span class="lineNoCov">              0 :         if (behavior == STR_STRSPN) {</span>
<span class="lineNum">     326 </span><span class="lineNoCov">              0 :                 RETURN_LONG(php_strspn(s11 + start /*str1_start*/,</span>
<span class="lineNum">     327 </span>                :                                                 s22 /*str2_start*/,
<span class="lineNum">     328 </span>                :                                                 s11 + start + len /*str1_end*/,
<span class="lineNum">     329 </span>                :                                                 s22 + len2 /*str2_end*/));
<span class="lineNum">     330 </span><span class="lineNoCov">              0 :         } else if (behavior == STR_STRCSPN) {</span>
<span class="lineNum">     331 </span><span class="lineNoCov">              0 :                 RETURN_LONG(php_strcspn(s11 + start /*str1_start*/,</span>
<span class="lineNum">     332 </span>                :                                                 s22 /*str2_start*/,
<span class="lineNum">     333 </span>                :                                                 s11 + start + len /*str1_end*/,
<span class="lineNum">     334 </span>                :                                                 s22 + len2 /*str2_end*/));
<span class="lineNum">     335 </span>                :         }
<span class="lineNum">     336 </span>                : 
<span class="lineNum">     337 </span>                : }
<span class="lineNum">     338 </span>                : /* }}} */
<span class="lineNum">     339 </span>                : 
<a name="340"><span class="lineNum">     340 </span>                : /* {{{ proto int strspn(string str, string mask [, start [, len]])</a>
<span class="lineNum">     341 </span>                :    Finds length of initial segment consisting entirely of characters found in mask. If start or/and length is provided works like strspn(substr($s,$start,$len),$good_chars) */
<span class="lineNum">     342 </span><span class="lineNoCov">              0 : PHP_FUNCTION(strspn)</span>
<span class="lineNum">     343 </span>                : {
<span class="lineNum">     344 </span><span class="lineNoCov">              0 :         php_spn_common_handler(INTERNAL_FUNCTION_PARAM_PASSTHRU, STR_STRSPN);</span>
<span class="lineNum">     345 </span><span class="lineNoCov">              0 : }</span>
<span class="lineNum">     346 </span>                : /* }}} */
<span class="lineNum">     347 </span>                : 
<a name="348"><span class="lineNum">     348 </span>                : /* {{{ proto int strcspn(string str, string mask [, start [, len]])</a>
<span class="lineNum">     349 </span>                :    Finds length of initial segment consisting entirely of characters not found in mask. If start or/and length is provide works like strcspn(substr($s,$start,$len),$bad_chars) */
<span class="lineNum">     350 </span><span class="lineNoCov">              0 : PHP_FUNCTION(strcspn)</span>
<span class="lineNum">     351 </span>                : {
<span class="lineNum">     352 </span><span class="lineNoCov">              0 :         php_spn_common_handler(INTERNAL_FUNCTION_PARAM_PASSTHRU, STR_STRCSPN);</span>
<span class="lineNum">     353 </span><span class="lineNoCov">              0 : }</span>
<span class="lineNum">     354 </span>                : /* }}} */
<span class="lineNum">     355 </span>                : 
<a name="356"><span class="lineNum">     356 </span>                : /* {{{ PHP_MINIT_FUNCTION(nl_langinfo) */</a>
<span class="lineNum">     357 </span>                : #if HAVE_NL_LANGINFO
<span class="lineNum">     358 </span><span class="lineCov">             48 : PHP_MINIT_FUNCTION(nl_langinfo)</span>
<span class="lineNum">     359 </span>                : {
<span class="lineNum">     360 </span>                : #define REGISTER_NL_LANGINFO_CONSTANT(x)        REGISTER_LONG_CONSTANT(#x, x, CONST_CS | CONST_PERSISTENT)
<span class="lineNum">     361 </span>                : #ifdef ABDAY_1
<span class="lineNum">     362 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ABDAY_1);</span>
<span class="lineNum">     363 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ABDAY_2);</span>
<span class="lineNum">     364 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ABDAY_3);</span>
<span class="lineNum">     365 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ABDAY_4);</span>
<span class="lineNum">     366 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ABDAY_5);</span>
<span class="lineNum">     367 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ABDAY_6);</span>
<span class="lineNum">     368 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ABDAY_7);</span>
<span class="lineNum">     369 </span>                : #endif
<span class="lineNum">     370 </span>                : #ifdef DAY_1
<span class="lineNum">     371 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(DAY_1);</span>
<span class="lineNum">     372 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(DAY_2);</span>
<span class="lineNum">     373 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(DAY_3);</span>
<span class="lineNum">     374 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(DAY_4);</span>
<span class="lineNum">     375 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(DAY_5);</span>
<span class="lineNum">     376 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(DAY_6);</span>
<span class="lineNum">     377 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(DAY_7);</span>
<span class="lineNum">     378 </span>                : #endif
<span class="lineNum">     379 </span>                : #ifdef ABMON_1
<span class="lineNum">     380 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ABMON_1);</span>
<span class="lineNum">     381 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ABMON_2);</span>
<span class="lineNum">     382 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ABMON_3);</span>
<span class="lineNum">     383 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ABMON_4);</span>
<span class="lineNum">     384 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ABMON_5);</span>
<span class="lineNum">     385 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ABMON_6);</span>
<span class="lineNum">     386 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ABMON_7);</span>
<span class="lineNum">     387 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ABMON_8);</span>
<span class="lineNum">     388 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ABMON_9);</span>
<span class="lineNum">     389 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ABMON_10);</span>
<span class="lineNum">     390 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ABMON_11);</span>
<span class="lineNum">     391 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ABMON_12);</span>
<span class="lineNum">     392 </span>                : #endif
<span class="lineNum">     393 </span>                : #ifdef MON_1
<span class="lineNum">     394 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(MON_1);</span>
<span class="lineNum">     395 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(MON_2);</span>
<span class="lineNum">     396 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(MON_3);</span>
<span class="lineNum">     397 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(MON_4);</span>
<span class="lineNum">     398 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(MON_5);</span>
<span class="lineNum">     399 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(MON_6);</span>
<span class="lineNum">     400 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(MON_7);</span>
<span class="lineNum">     401 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(MON_8);</span>
<span class="lineNum">     402 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(MON_9);</span>
<span class="lineNum">     403 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(MON_10);</span>
<span class="lineNum">     404 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(MON_11);</span>
<span class="lineNum">     405 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(MON_12);</span>
<span class="lineNum">     406 </span>                : #endif
<span class="lineNum">     407 </span>                : #ifdef AM_STR
<span class="lineNum">     408 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(AM_STR);</span>
<span class="lineNum">     409 </span>                : #endif
<span class="lineNum">     410 </span>                : #ifdef PM_STR
<span class="lineNum">     411 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(PM_STR);</span>
<span class="lineNum">     412 </span>                : #endif
<span class="lineNum">     413 </span>                : #ifdef D_T_FMT
<span class="lineNum">     414 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(D_T_FMT);</span>
<span class="lineNum">     415 </span>                : #endif
<span class="lineNum">     416 </span>                : #ifdef D_FMT
<span class="lineNum">     417 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(D_FMT);</span>
<span class="lineNum">     418 </span>                : #endif
<span class="lineNum">     419 </span>                : #ifdef T_FMT
<span class="lineNum">     420 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(T_FMT);</span>
<span class="lineNum">     421 </span>                : #endif
<span class="lineNum">     422 </span>                : #ifdef T_FMT_AMPM
<span class="lineNum">     423 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(T_FMT_AMPM);</span>
<span class="lineNum">     424 </span>                : #endif
<span class="lineNum">     425 </span>                : #ifdef ERA
<span class="lineNum">     426 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ERA);</span>
<span class="lineNum">     427 </span>                : #endif
<span class="lineNum">     428 </span>                : #ifdef ERA_YEAR
<span class="lineNum">     429 </span>                :         REGISTER_NL_LANGINFO_CONSTANT(ERA_YEAR);
<span class="lineNum">     430 </span>                : #endif
<span class="lineNum">     431 </span>                : #ifdef ERA_D_T_FMT
<span class="lineNum">     432 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ERA_D_T_FMT);</span>
<span class="lineNum">     433 </span>                : #endif
<span class="lineNum">     434 </span>                : #ifdef ERA_D_FMT
<span class="lineNum">     435 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ERA_D_FMT);</span>
<span class="lineNum">     436 </span>                : #endif
<span class="lineNum">     437 </span>                : #ifdef ERA_T_FMT
<span class="lineNum">     438 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ERA_T_FMT);</span>
<span class="lineNum">     439 </span>                : #endif
<span class="lineNum">     440 </span>                : #ifdef ALT_DIGITS
<span class="lineNum">     441 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(ALT_DIGITS);</span>
<span class="lineNum">     442 </span>                : #endif
<span class="lineNum">     443 </span>                : #ifdef INT_CURR_SYMBOL
<span class="lineNum">     444 </span>                :         REGISTER_NL_LANGINFO_CONSTANT(INT_CURR_SYMBOL);
<span class="lineNum">     445 </span>                : #endif
<span class="lineNum">     446 </span>                : #ifdef CURRENCY_SYMBOL
<span class="lineNum">     447 </span>                :         REGISTER_NL_LANGINFO_CONSTANT(CURRENCY_SYMBOL);
<span class="lineNum">     448 </span>                : #endif
<span class="lineNum">     449 </span>                : #ifdef CRNCYSTR
<span class="lineNum">     450 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(CRNCYSTR);</span>
<span class="lineNum">     451 </span>                : #endif
<span class="lineNum">     452 </span>                : #ifdef MON_DECIMAL_POINT
<span class="lineNum">     453 </span>                :         REGISTER_NL_LANGINFO_CONSTANT(MON_DECIMAL_POINT);
<span class="lineNum">     454 </span>                : #endif
<span class="lineNum">     455 </span>                : #ifdef MON_THOUSANDS_SEP
<span class="lineNum">     456 </span>                :         REGISTER_NL_LANGINFO_CONSTANT(MON_THOUSANDS_SEP);
<span class="lineNum">     457 </span>                : #endif
<span class="lineNum">     458 </span>                : #ifdef MON_GROUPING
<span class="lineNum">     459 </span>                :         REGISTER_NL_LANGINFO_CONSTANT(MON_GROUPING);
<span class="lineNum">     460 </span>                : #endif
<span class="lineNum">     461 </span>                : #ifdef POSITIVE_SIGN
<span class="lineNum">     462 </span>                :         REGISTER_NL_LANGINFO_CONSTANT(POSITIVE_SIGN);
<span class="lineNum">     463 </span>                : #endif
<span class="lineNum">     464 </span>                : #ifdef NEGATIVE_SIGN
<span class="lineNum">     465 </span>                :         REGISTER_NL_LANGINFO_CONSTANT(NEGATIVE_SIGN);
<span class="lineNum">     466 </span>                : #endif
<span class="lineNum">     467 </span>                : #ifdef INT_FRAC_DIGITS
<span class="lineNum">     468 </span>                :         REGISTER_NL_LANGINFO_CONSTANT(INT_FRAC_DIGITS);
<span class="lineNum">     469 </span>                : #endif
<span class="lineNum">     470 </span>                : #ifdef FRAC_DIGITS
<span class="lineNum">     471 </span>                :         REGISTER_NL_LANGINFO_CONSTANT(FRAC_DIGITS);
<span class="lineNum">     472 </span>                : #endif
<span class="lineNum">     473 </span>                : #ifdef P_CS_PRECEDES
<span class="lineNum">     474 </span>                :         REGISTER_NL_LANGINFO_CONSTANT(P_CS_PRECEDES);
<span class="lineNum">     475 </span>                : #endif
<span class="lineNum">     476 </span>                : #ifdef P_SEP_BY_SPACE
<span class="lineNum">     477 </span>                :         REGISTER_NL_LANGINFO_CONSTANT(P_SEP_BY_SPACE);
<span class="lineNum">     478 </span>                : #endif
<span class="lineNum">     479 </span>                : #ifdef N_CS_PRECEDES
<span class="lineNum">     480 </span>                :         REGISTER_NL_LANGINFO_CONSTANT(N_CS_PRECEDES);
<span class="lineNum">     481 </span>                : #endif
<span class="lineNum">     482 </span>                : #ifdef N_SEP_BY_SPACE
<span class="lineNum">     483 </span>                :         REGISTER_NL_LANGINFO_CONSTANT(N_SEP_BY_SPACE);
<span class="lineNum">     484 </span>                : #endif
<span class="lineNum">     485 </span>                : #ifdef P_SIGN_POSN
<span class="lineNum">     486 </span>                :         REGISTER_NL_LANGINFO_CONSTANT(P_SIGN_POSN);
<span class="lineNum">     487 </span>                : #endif
<span class="lineNum">     488 </span>                : #ifdef N_SIGN_POSN
<span class="lineNum">     489 </span>                :         REGISTER_NL_LANGINFO_CONSTANT(N_SIGN_POSN);
<span class="lineNum">     490 </span>                : #endif
<span class="lineNum">     491 </span>                : #ifdef DECIMAL_POINT
<span class="lineNum">     492 </span>                :         REGISTER_NL_LANGINFO_CONSTANT(DECIMAL_POINT);
<span class="lineNum">     493 </span>                : #endif
<span class="lineNum">     494 </span>                : #ifdef RADIXCHAR
<span class="lineNum">     495 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(RADIXCHAR);</span>
<span class="lineNum">     496 </span>                : #endif
<span class="lineNum">     497 </span>                : #ifdef THOUSANDS_SEP
<span class="lineNum">     498 </span>                :         REGISTER_NL_LANGINFO_CONSTANT(THOUSANDS_SEP);
<span class="lineNum">     499 </span>                : #endif
<span class="lineNum">     500 </span>                : #ifdef THOUSEP
<span class="lineNum">     501 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(THOUSEP);</span>
<span class="lineNum">     502 </span>                : #endif
<span class="lineNum">     503 </span>                : #ifdef GROUPING
<span class="lineNum">     504 </span>                :         REGISTER_NL_LANGINFO_CONSTANT(GROUPING);
<span class="lineNum">     505 </span>                : #endif
<span class="lineNum">     506 </span>                : #ifdef YESEXPR
<span class="lineNum">     507 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(YESEXPR);</span>
<span class="lineNum">     508 </span>                : #endif
<span class="lineNum">     509 </span>                : #ifdef NOEXPR
<span class="lineNum">     510 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(NOEXPR);</span>
<span class="lineNum">     511 </span>                : #endif
<span class="lineNum">     512 </span>                : #ifdef YESSTR
<span class="lineNum">     513 </span>                :         REGISTER_NL_LANGINFO_CONSTANT(YESSTR);
<span class="lineNum">     514 </span>                : #endif
<span class="lineNum">     515 </span>                : #ifdef NOSTR
<span class="lineNum">     516 </span>                :         REGISTER_NL_LANGINFO_CONSTANT(NOSTR);
<span class="lineNum">     517 </span>                : #endif
<span class="lineNum">     518 </span>                : #ifdef CODESET
<span class="lineNum">     519 </span><span class="lineCov">             48 :         REGISTER_NL_LANGINFO_CONSTANT(CODESET);</span>
<span class="lineNum">     520 </span>                : #endif
<span class="lineNum">     521 </span>                : #undef REGISTER_NL_LANGINFO_CONSTANT
<span class="lineNum">     522 </span><span class="lineCov">             48 :         return SUCCESS;</span>
<span class="lineNum">     523 </span>                : }
<span class="lineNum">     524 </span>                : /* }}} */
<span class="lineNum">     525 </span>                : 
<a name="526"><span class="lineNum">     526 </span>                : /* {{{ proto string nl_langinfo(int item)</a>
<span class="lineNum">     527 </span>                :    Query language and locale information */
<span class="lineNum">     528 </span><span class="lineNoCov">              0 : PHP_FUNCTION(nl_langinfo)</span>
<span class="lineNum">     529 </span>                : {
<span class="lineNum">     530 </span>                :         long item;
<span class="lineNum">     531 </span>                :         char *value;
<span class="lineNum">     532 </span>                : 
<span class="lineNum">     533 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;l&quot;, &amp;item) == FAILURE) {</span>
<span class="lineNum">     534 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">     535 </span>                :         }
<span class="lineNum">     536 </span>                : 
<span class="lineNum">     537 </span><span class="lineNoCov">              0 :         switch(item) { /* {{{ */</span>
<span class="lineNum">     538 </span>                : #ifdef ABDAY_1
<span class="lineNum">     539 </span>                :                 case ABDAY_1:
<span class="lineNum">     540 </span>                :                 case ABDAY_2:
<span class="lineNum">     541 </span>                :                 case ABDAY_3:
<span class="lineNum">     542 </span>                :                 case ABDAY_4:
<span class="lineNum">     543 </span>                :                 case ABDAY_5:
<span class="lineNum">     544 </span>                :                 case ABDAY_6:
<span class="lineNum">     545 </span>                :                 case ABDAY_7:
<span class="lineNum">     546 </span>                : #endif
<span class="lineNum">     547 </span>                : #ifdef DAY_1
<span class="lineNum">     548 </span>                :                 case DAY_1:
<span class="lineNum">     549 </span>                :                 case DAY_2:
<span class="lineNum">     550 </span>                :                 case DAY_3:
<span class="lineNum">     551 </span>                :                 case DAY_4:
<span class="lineNum">     552 </span>                :                 case DAY_5:
<span class="lineNum">     553 </span>                :                 case DAY_6:
<span class="lineNum">     554 </span>                :                 case DAY_7:
<span class="lineNum">     555 </span>                : #endif
<span class="lineNum">     556 </span>                : #ifdef ABMON_1
<span class="lineNum">     557 </span>                :                 case ABMON_1:
<span class="lineNum">     558 </span>                :                 case ABMON_2:
<span class="lineNum">     559 </span>                :                 case ABMON_3:
<span class="lineNum">     560 </span>                :                 case ABMON_4:
<span class="lineNum">     561 </span>                :                 case ABMON_5:
<span class="lineNum">     562 </span>                :                 case ABMON_6:
<span class="lineNum">     563 </span>                :                 case ABMON_7:
<span class="lineNum">     564 </span>                :                 case ABMON_8:
<span class="lineNum">     565 </span>                :                 case ABMON_9:
<span class="lineNum">     566 </span>                :                 case ABMON_10:
<span class="lineNum">     567 </span>                :                 case ABMON_11:
<span class="lineNum">     568 </span>                :                 case ABMON_12:
<span class="lineNum">     569 </span>                : #endif
<span class="lineNum">     570 </span>                : #ifdef MON_1
<span class="lineNum">     571 </span>                :                 case MON_1:
<span class="lineNum">     572 </span>                :                 case MON_2:
<span class="lineNum">     573 </span>                :                 case MON_3:
<span class="lineNum">     574 </span>                :                 case MON_4:
<span class="lineNum">     575 </span>                :                 case MON_5:
<span class="lineNum">     576 </span>                :                 case MON_6:
<span class="lineNum">     577 </span>                :                 case MON_7:
<span class="lineNum">     578 </span>                :                 case MON_8:
<span class="lineNum">     579 </span>                :                 case MON_9:
<span class="lineNum">     580 </span>                :                 case MON_10:
<span class="lineNum">     581 </span>                :                 case MON_11:
<span class="lineNum">     582 </span>                :                 case MON_12:
<span class="lineNum">     583 </span>                : #endif
<span class="lineNum">     584 </span>                : #ifdef AM_STR
<span class="lineNum">     585 </span>                :                 case AM_STR:
<span class="lineNum">     586 </span>                : #endif
<span class="lineNum">     587 </span>                : #ifdef PM_STR
<span class="lineNum">     588 </span>                :                 case PM_STR:
<span class="lineNum">     589 </span>                : #endif
<span class="lineNum">     590 </span>                : #ifdef D_T_FMT
<span class="lineNum">     591 </span>                :                 case D_T_FMT:
<span class="lineNum">     592 </span>                : #endif
<span class="lineNum">     593 </span>                : #ifdef D_FMT
<span class="lineNum">     594 </span>                :                 case D_FMT:
<span class="lineNum">     595 </span>                : #endif
<span class="lineNum">     596 </span>                : #ifdef T_FMT
<span class="lineNum">     597 </span>                :                 case T_FMT:
<span class="lineNum">     598 </span>                : #endif
<span class="lineNum">     599 </span>                : #ifdef T_FMT_AMPM
<span class="lineNum">     600 </span>                :                 case T_FMT_AMPM:
<span class="lineNum">     601 </span>                : #endif
<span class="lineNum">     602 </span>                : #ifdef ERA
<span class="lineNum">     603 </span>                :                 case ERA:
<span class="lineNum">     604 </span>                : #endif
<span class="lineNum">     605 </span>                : #ifdef ERA_YEAR
<span class="lineNum">     606 </span>                :                 case ERA_YEAR:
<span class="lineNum">     607 </span>                : #endif
<span class="lineNum">     608 </span>                : #ifdef ERA_D_T_FMT
<span class="lineNum">     609 </span>                :                 case ERA_D_T_FMT:
<span class="lineNum">     610 </span>                : #endif
<span class="lineNum">     611 </span>                : #ifdef ERA_D_FMT
<span class="lineNum">     612 </span>                :                 case ERA_D_FMT:
<span class="lineNum">     613 </span>                : #endif
<span class="lineNum">     614 </span>                : #ifdef ERA_T_FMT
<span class="lineNum">     615 </span>                :                 case ERA_T_FMT:
<span class="lineNum">     616 </span>                : #endif
<span class="lineNum">     617 </span>                : #ifdef ALT_DIGITS
<span class="lineNum">     618 </span>                :                 case ALT_DIGITS:
<span class="lineNum">     619 </span>                : #endif
<span class="lineNum">     620 </span>                : #ifdef INT_CURR_SYMBOL
<span class="lineNum">     621 </span>                :                 case INT_CURR_SYMBOL:
<span class="lineNum">     622 </span>                : #endif
<span class="lineNum">     623 </span>                : #ifdef CURRENCY_SYMBOL
<span class="lineNum">     624 </span>                :                 case CURRENCY_SYMBOL:
<span class="lineNum">     625 </span>                : #endif
<span class="lineNum">     626 </span>                : #ifdef CRNCYSTR
<span class="lineNum">     627 </span>                :                 case CRNCYSTR:
<span class="lineNum">     628 </span>                : #endif
<span class="lineNum">     629 </span>                : #ifdef MON_DECIMAL_POINT
<span class="lineNum">     630 </span>                :                 case MON_DECIMAL_POINT:
<span class="lineNum">     631 </span>                : #endif
<span class="lineNum">     632 </span>                : #ifdef MON_THOUSANDS_SEP
<span class="lineNum">     633 </span>                :                 case MON_THOUSANDS_SEP:
<span class="lineNum">     634 </span>                : #endif
<span class="lineNum">     635 </span>                : #ifdef MON_GROUPING
<span class="lineNum">     636 </span>                :                 case MON_GROUPING:
<span class="lineNum">     637 </span>                : #endif
<span class="lineNum">     638 </span>                : #ifdef POSITIVE_SIGN
<span class="lineNum">     639 </span>                :                 case POSITIVE_SIGN:
<span class="lineNum">     640 </span>                : #endif
<span class="lineNum">     641 </span>                : #ifdef NEGATIVE_SIGN
<span class="lineNum">     642 </span>                :                 case NEGATIVE_SIGN:
<span class="lineNum">     643 </span>                : #endif
<span class="lineNum">     644 </span>                : #ifdef INT_FRAC_DIGITS
<span class="lineNum">     645 </span>                :                 case INT_FRAC_DIGITS:
<span class="lineNum">     646 </span>                : #endif
<span class="lineNum">     647 </span>                : #ifdef FRAC_DIGITS
<span class="lineNum">     648 </span>                :                 case FRAC_DIGITS:
<span class="lineNum">     649 </span>                : #endif
<span class="lineNum">     650 </span>                : #ifdef P_CS_PRECEDES
<span class="lineNum">     651 </span>                :                 case P_CS_PRECEDES:
<span class="lineNum">     652 </span>                : #endif
<span class="lineNum">     653 </span>                : #ifdef P_SEP_BY_SPACE
<span class="lineNum">     654 </span>                :                 case P_SEP_BY_SPACE:
<span class="lineNum">     655 </span>                : #endif
<span class="lineNum">     656 </span>                : #ifdef N_CS_PRECEDES
<span class="lineNum">     657 </span>                :                 case N_CS_PRECEDES:
<span class="lineNum">     658 </span>                : #endif
<span class="lineNum">     659 </span>                : #ifdef N_SEP_BY_SPACE
<span class="lineNum">     660 </span>                :                 case N_SEP_BY_SPACE:
<span class="lineNum">     661 </span>                : #endif
<span class="lineNum">     662 </span>                : #ifdef P_SIGN_POSN
<span class="lineNum">     663 </span>                :                 case P_SIGN_POSN:
<span class="lineNum">     664 </span>                : #endif
<span class="lineNum">     665 </span>                : #ifdef N_SIGN_POSN
<span class="lineNum">     666 </span>                :                 case N_SIGN_POSN:
<span class="lineNum">     667 </span>                : #endif
<span class="lineNum">     668 </span>                : #ifdef DECIMAL_POINT
<span class="lineNum">     669 </span>                :                 case DECIMAL_POINT:
<span class="lineNum">     670 </span>                : #elif defined(RADIXCHAR)
<span class="lineNum">     671 </span>                :                 case RADIXCHAR:
<span class="lineNum">     672 </span>                : #endif
<span class="lineNum">     673 </span>                : #ifdef THOUSANDS_SEP
<span class="lineNum">     674 </span>                :                 case THOUSANDS_SEP:
<span class="lineNum">     675 </span>                : #elif defined(THOUSEP)
<span class="lineNum">     676 </span>                :                 case THOUSEP:
<span class="lineNum">     677 </span>                : #endif
<span class="lineNum">     678 </span>                : #ifdef GROUPING
<span class="lineNum">     679 </span>                :                 case GROUPING:
<span class="lineNum">     680 </span>                : #endif
<span class="lineNum">     681 </span>                : #ifdef YESEXPR
<span class="lineNum">     682 </span>                :                 case YESEXPR:
<span class="lineNum">     683 </span>                : #endif
<span class="lineNum">     684 </span>                : #ifdef NOEXPR
<span class="lineNum">     685 </span>                :                 case NOEXPR:
<span class="lineNum">     686 </span>                : #endif
<span class="lineNum">     687 </span>                : #ifdef YESSTR
<span class="lineNum">     688 </span>                :                 case YESSTR:
<span class="lineNum">     689 </span>                : #endif
<span class="lineNum">     690 </span>                : #ifdef NOSTR
<span class="lineNum">     691 </span>                :                 case NOSTR:
<span class="lineNum">     692 </span>                : #endif
<span class="lineNum">     693 </span>                : #ifdef CODESET
<span class="lineNum">     694 </span>                :                 case CODESET:
<span class="lineNum">     695 </span>                : #endif
<span class="lineNum">     696 </span>                :                         break;
<span class="lineNum">     697 </span>                :                 default:
<span class="lineNum">     698 </span><span class="lineNoCov">              0 :                         php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Item '%ld' is not valid&quot;, item);</span>
<span class="lineNum">     699 </span><span class="lineNoCov">              0 :                         RETURN_FALSE;</span>
<span class="lineNum">     700 </span>                :         }
<span class="lineNum">     701 </span>                :         /* }}} */
<span class="lineNum">     702 </span>                : 
<span class="lineNum">     703 </span><span class="lineNoCov">              0 :         value = nl_langinfo(item);</span>
<span class="lineNum">     704 </span><span class="lineNoCov">              0 :         if (value == NULL) {</span>
<span class="lineNum">     705 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">     706 </span>                :         } else {
<span class="lineNum">     707 </span><span class="lineNoCov">              0 :                 RETURN_STRING(value, 1);</span>
<span class="lineNum">     708 </span>                :         }
<span class="lineNum">     709 </span>                : }
<span class="lineNum">     710 </span>                : #endif
<span class="lineNum">     711 </span>                : /* }}} */
<span class="lineNum">     712 </span>                : 
<span class="lineNum">     713 </span>                : #ifdef HAVE_STRCOLL
<a name="714"><span class="lineNum">     714 </span>                : /* {{{ proto int strcoll(string str1, string str2)</a>
<span class="lineNum">     715 </span>                :    Compares two strings using the current locale */
<span class="lineNum">     716 </span><span class="lineNoCov">              0 : PHP_FUNCTION(strcoll)</span>
<span class="lineNum">     717 </span>                : {
<span class="lineNum">     718 </span>                :         char *s1, *s2;
<span class="lineNum">     719 </span>                :         int s1len, s2len;
<span class="lineNum">     720 </span>                : 
<span class="lineNum">     721 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;ss&quot;, &amp;s1, &amp;s1len, &amp;s2, &amp;s2len) == FAILURE) {</span>
<span class="lineNum">     722 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">     723 </span>                :         }
<span class="lineNum">     724 </span>                : 
<span class="lineNum">     725 </span><span class="lineNoCov">              0 :         RETURN_LONG(strcoll((const char *) s1,</span>
<span class="lineNum">     726 </span>                :                             (const char *) s2));
<span class="lineNum">     727 </span>                : }
<span class="lineNum">     728 </span>                : /* }}} */
<span class="lineNum">     729 </span>                : #endif
<span class="lineNum">     730 </span>                : 
<span class="lineNum">     731 </span>                : /* {{{ php_charmask
<span class="lineNum">     732 </span>                :  * Fills a 256-byte bytemask with input. You can specify a range like 'a..z',
<span class="lineNum">     733 </span>                :  * it needs to be incrementing.
<a name="734"><span class="lineNum">     734 </span>                :  * Returns: FAILURE/SUCCESS whether the input was correct (i.e. no range errors)</a>
<span class="lineNum">     735 </span>                :  */
<span class="lineNum">     736 </span><span class="lineCov">           2195 : static inline int php_charmask(unsigned char *input, int len, char *mask TSRMLS_DC)</span>
<span class="lineNum">     737 </span>                : {
<span class="lineNum">     738 </span>                :         unsigned char *end;
<span class="lineNum">     739 </span>                :         unsigned char c;
<span class="lineNum">     740 </span><span class="lineCov">           2195 :         int result = SUCCESS;</span>
<span class="lineNum">     741 </span>                : 
<span class="lineNum">     742 </span><span class="lineCov">           2195 :         memset(mask, 0, 256);</span>
<span class="lineNum">     743 </span><span class="lineCov">          15357 :         for (end = input+len; input &lt; end; input++) {</span>
<span class="lineNum">     744 </span><span class="lineCov">          13162 :                 c=*input;</span>
<span class="lineNum">     745 </span><span class="lineCov">          13162 :                 if ((input+3 &lt; end) &amp;&amp; input[1] == '.' &amp;&amp; input[2] == '.'</span>
<span class="lineNum">     746 </span><span class="lineNoCov">              0 :                                 &amp;&amp; input[3] &gt;= c) {</span>
<span class="lineNum">     747 </span><span class="lineNoCov">              0 :                         memset(mask+c, 1, input[3] - c + 1);</span>
<span class="lineNum">     748 </span><span class="lineNoCov">              0 :                         input+=3;</span>
<span class="lineNum">     749 </span><span class="lineCov">          13162 :                 } else if ((input+1 &lt; end) &amp;&amp; input[0] == '.' &amp;&amp; input[1] == '.') {</span>
<span class="lineNum">     750 </span>                :                         /* Error, try to be as helpful as possible:
<span class="lineNum">     751 </span>                :                            (a range ending/starting with '.' won't be captured here) */
<span class="lineNum">     752 </span><span class="lineNoCov">              0 :                         if (end-len &gt;= input) { /* there was no 'left' char */</span>
<span class="lineNum">     753 </span><span class="lineNoCov">              0 :                                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Invalid '..'-range, no character to the left of '..'&quot;);</span>
<span class="lineNum">     754 </span><span class="lineNoCov">              0 :                                 result = FAILURE;</span>
<span class="lineNum">     755 </span><span class="lineNoCov">              0 :                                 continue;</span>
<span class="lineNum">     756 </span>                :                         }
<span class="lineNum">     757 </span><span class="lineNoCov">              0 :                         if (input+2 &gt;= end) { /* there is no 'right' char */</span>
<span class="lineNum">     758 </span><span class="lineNoCov">              0 :                                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Invalid '..'-range, no character to the right of '..'&quot;);</span>
<span class="lineNum">     759 </span><span class="lineNoCov">              0 :                                 result = FAILURE;</span>
<span class="lineNum">     760 </span><span class="lineNoCov">              0 :                                 continue;</span>
<span class="lineNum">     761 </span>                :                         }
<span class="lineNum">     762 </span><span class="lineNoCov">              0 :                         if (input[-1] &gt; input[2]) { /* wrong order */</span>
<span class="lineNum">     763 </span><span class="lineNoCov">              0 :                                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Invalid '..'-range, '..'-range needs to be incrementing&quot;);</span>
<span class="lineNum">     764 </span><span class="lineNoCov">              0 :                                 result = FAILURE;</span>
<span class="lineNum">     765 </span><span class="lineNoCov">              0 :                                 continue;</span>
<span class="lineNum">     766 </span>                :                         }
<span class="lineNum">     767 </span>                :                         /* FIXME: better error (a..b..c is the only left possibility?) */
<span class="lineNum">     768 </span><span class="lineNoCov">              0 :                         php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Invalid '..'-range&quot;);</span>
<span class="lineNum">     769 </span><span class="lineNoCov">              0 :                         result = FAILURE;</span>
<span class="lineNum">     770 </span><span class="lineNoCov">              0 :                         continue;</span>
<span class="lineNum">     771 </span>                :                 } else {
<span class="lineNum">     772 </span><span class="lineCov">          13162 :                         mask[c]=1;</span>
<span class="lineNum">     773 </span>                :                 }
<span class="lineNum">     774 </span>                :         }
<span class="lineNum">     775 </span><span class="lineCov">           2195 :         return result;</span>
<span class="lineNum">     776 </span>                : }
<span class="lineNum">     777 </span>                : /* }}} */
<span class="lineNum">     778 </span>                : 
<span class="lineNum">     779 </span>                : /* {{{ php_trim()
<span class="lineNum">     780 </span>                :  * mode 1 : trim left
<span class="lineNum">     781 </span>                :  * mode 2 : trim right
<span class="lineNum">     782 </span>                :  * mode 3 : trim left and right
<a name="783"><span class="lineNum">     783 </span>                :  * what indicates which chars are to be trimmed. NULL-&gt;default (' \t\n\r\v\0')</a>
<span class="lineNum">     784 </span>                :  */
<span class="lineNum">     785 </span><span class="lineCov">           2193 : PHPAPI char *php_trim(char *c, int len, char *what, int what_len, zval *return_value, int mode TSRMLS_DC)</span>
<span class="lineNum">     786 </span>                : {
<span class="lineNum">     787 </span>                :         register int i;
<span class="lineNum">     788 </span><span class="lineCov">           2193 :         int trimmed = 0;</span>
<span class="lineNum">     789 </span>                :         char mask[256];
<span class="lineNum">     790 </span>                : 
<span class="lineNum">     791 </span><span class="lineCov">           2193 :         if (what) {</span>
<span class="lineNum">     792 </span><span class="lineNoCov">              0 :                 php_charmask((unsigned char*)what, what_len, mask TSRMLS_CC);</span>
<span class="lineNum">     793 </span>                :         } else {
<span class="lineNum">     794 </span><span class="lineCov">           2193 :                 php_charmask((unsigned char*)&quot; \n\r\t\v\0&quot;, 6, mask TSRMLS_CC);</span>
<span class="lineNum">     795 </span>                :         }
<span class="lineNum">     796 </span>                : 
<span class="lineNum">     797 </span><span class="lineCov">           2193 :         if (mode &amp; 1) {</span>
<span class="lineNum">     798 </span><span class="lineCov">           4394 :                 for (i = 0; i &lt; len; i++) {</span>
<span class="lineNum">     799 </span><span class="lineCov">           1847 :                         if (mask[(unsigned char)c[i]]) {</span>
<span class="lineNum">     800 </span><span class="lineCov">              4 :                                 trimmed++;</span>
<span class="lineNum">     801 </span>                :                         } else {
<span class="lineNum">     802 </span><span class="lineCov">           1843 :                                 break;</span>
<span class="lineNum">     803 </span>                :                         }
<span class="lineNum">     804 </span>                :                 }
<span class="lineNum">     805 </span><span class="lineCov">           2193 :                 len -= trimmed;</span>
<span class="lineNum">     806 </span><span class="lineCov">           2193 :                 c += trimmed;</span>
<span class="lineNum">     807 </span>                :         }
<span class="lineNum">     808 </span><span class="lineCov">           2193 :         if (mode &amp; 2) {</span>
<span class="lineNum">     809 </span><span class="lineCov">           4632 :                 for (i = len - 1; i &gt;= 0; i--) {</span>
<span class="lineNum">     810 </span><span class="lineCov">           1966 :                         if (mask[(unsigned char)c[i]]) {</span>
<span class="lineNum">     811 </span><span class="lineCov">            123 :                                 len--;</span>
<span class="lineNum">     812 </span>                :                         } else {
<span class="lineNum">     813 </span><span class="lineCov">           1843 :                                 break;</span>
<span class="lineNum">     814 </span>                :                         }
<span class="lineNum">     815 </span>                :                 }
<span class="lineNum">     816 </span>                :         }
<span class="lineNum">     817 </span>                : 
<span class="lineNum">     818 </span><span class="lineCov">           2193 :         if (return_value) {</span>
<span class="lineNum">     819 </span><span class="lineCov">           2193 :                 RETVAL_STRINGL(c, len, 1);</span>
<span class="lineNum">     820 </span>                :         } else {
<span class="lineNum">     821 </span><span class="lineNoCov">              0 :                 return estrndup(c, len);</span>
<span class="lineNum">     822 </span>                :         }
<span class="lineNum">     823 </span><span class="lineCov">           2193 :         return &quot;&quot;;</span>
<span class="lineNum">     824 </span>                : }
<span class="lineNum">     825 </span>                : /* }}} */
<span class="lineNum">     826 </span>                : 
<span class="lineNum">     827 </span>                : /* {{{ php_do_trim
<a name="828"><span class="lineNum">     828 </span>                :  * Base for trim(), rtrim() and ltrim() functions.</a>
<span class="lineNum">     829 </span>                :  */
<span class="lineNum">     830 </span><span class="lineCov">           2193 : static void php_do_trim(INTERNAL_FUNCTION_PARAMETERS, int mode)</span>
<span class="lineNum">     831 </span>                : {
<span class="lineNum">     832 </span>                :         char *str;
<span class="lineNum">     833 </span><span class="lineCov">           2193 :         char *what = NULL;</span>
<span class="lineNum">     834 </span><span class="lineCov">           2193 :         int str_len, what_len = 0;</span>
<span class="lineNum">     835 </span>                : 
<span class="lineNum">     836 </span><span class="lineCov">           2193 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s|s&quot;, &amp;str, &amp;str_len, &amp;what, &amp;what_len) == FAILURE) {</span>
<span class="lineNum">     837 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">     838 </span>                :         }
<span class="lineNum">     839 </span>                : 
<span class="lineNum">     840 </span><span class="lineCov">           2193 :         php_trim(str, str_len, what, what_len, return_value, mode TSRMLS_CC);</span>
<span class="lineNum">     841 </span>                : }
<span class="lineNum">     842 </span>                : /* }}} */
<span class="lineNum">     843 </span>                : 
<a name="844"><span class="lineNum">     844 </span>                : /* {{{ proto string trim(string str [, string character_mask])</a>
<span class="lineNum">     845 </span>                :    Strips whitespace from the beginning and end of a string */
<span class="lineNum">     846 </span><span class="lineCov">           2193 : PHP_FUNCTION(trim)</span>
<span class="lineNum">     847 </span>                : {
<span class="lineNum">     848 </span><span class="lineCov">           2193 :         php_do_trim(INTERNAL_FUNCTION_PARAM_PASSTHRU, 3);</span>
<span class="lineNum">     849 </span><span class="lineCov">           2193 : }</span>
<span class="lineNum">     850 </span>                : /* }}} */
<span class="lineNum">     851 </span>                : 
<a name="852"><span class="lineNum">     852 </span>                : /* {{{ proto string rtrim(string str [, string character_mask])</a>
<span class="lineNum">     853 </span>                :    Removes trailing whitespace */
<span class="lineNum">     854 </span><span class="lineNoCov">              0 : PHP_FUNCTION(rtrim)</span>
<span class="lineNum">     855 </span>                : {
<span class="lineNum">     856 </span><span class="lineNoCov">              0 :         php_do_trim(INTERNAL_FUNCTION_PARAM_PASSTHRU, 2);</span>
<span class="lineNum">     857 </span><span class="lineNoCov">              0 : }</span>
<span class="lineNum">     858 </span>                : /* }}} */
<span class="lineNum">     859 </span>                : 
<a name="860"><span class="lineNum">     860 </span>                : /* {{{ proto string ltrim(string str [, string character_mask])</a>
<span class="lineNum">     861 </span>                :    Strips whitespace from the beginning of a string */
<span class="lineNum">     862 </span><span class="lineNoCov">              0 : PHP_FUNCTION(ltrim)</span>
<span class="lineNum">     863 </span>                : {
<span class="lineNum">     864 </span><span class="lineNoCov">              0 :         php_do_trim(INTERNAL_FUNCTION_PARAM_PASSTHRU, 1);</span>
<span class="lineNum">     865 </span><span class="lineNoCov">              0 : }</span>
<span class="lineNum">     866 </span>                : /* }}} */
<span class="lineNum">     867 </span>                : 
<a name="868"><span class="lineNum">     868 </span>                : /* {{{ proto string wordwrap(string str [, int width [, string break [, boolean cut]]])</a>
<span class="lineNum">     869 </span>                :    Wraps buffer to selected number of characters using string break char */
<span class="lineNum">     870 </span><span class="lineNoCov">              0 : PHP_FUNCTION(wordwrap)</span>
<span class="lineNum">     871 </span>                : {
<span class="lineNum">     872 </span><span class="lineNoCov">              0 :         const char *text, *breakchar = &quot;\n&quot;;</span>
<span class="lineNum">     873 </span>                :         char *newtext;
<span class="lineNum">     874 </span><span class="lineNoCov">              0 :         int textlen, breakcharlen = 1, newtextlen, chk;</span>
<span class="lineNum">     875 </span>                :         size_t alloced;
<span class="lineNum">     876 </span><span class="lineNoCov">              0 :         long current = 0, laststart = 0, lastspace = 0;</span>
<span class="lineNum">     877 </span><span class="lineNoCov">              0 :         long linelength = 75;</span>
<span class="lineNum">     878 </span><span class="lineNoCov">              0 :         zend_bool docut = 0;</span>
<span class="lineNum">     879 </span>                : 
<span class="lineNum">     880 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s|lsb&quot;, &amp;text, &amp;textlen, &amp;linelength, &amp;breakchar, &amp;breakcharlen, &amp;docut) == FAILURE) {</span>
<span class="lineNum">     881 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">     882 </span>                :         }
<span class="lineNum">     883 </span>                : 
<span class="lineNum">     884 </span><span class="lineNoCov">              0 :         if (textlen == 0) {</span>
<span class="lineNum">     885 </span><span class="lineNoCov">              0 :                 RETURN_EMPTY_STRING();</span>
<span class="lineNum">     886 </span>                :         }
<span class="lineNum">     887 </span>                : 
<span class="lineNum">     888 </span><span class="lineNoCov">              0 :         if (breakcharlen == 0) {</span>
<span class="lineNum">     889 </span><span class="lineNoCov">              0 :                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Break string cannot be empty&quot;);</span>
<span class="lineNum">     890 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">     891 </span>                :         }
<span class="lineNum">     892 </span>                : 
<span class="lineNum">     893 </span><span class="lineNoCov">              0 :         if (linelength == 0 &amp;&amp; docut) {</span>
<span class="lineNum">     894 </span><span class="lineNoCov">              0 :                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Can't force cut when width is zero&quot;);</span>
<span class="lineNum">     895 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">     896 </span>                :         }
<span class="lineNum">     897 </span>                : 
<span class="lineNum">     898 </span>                :         /* Special case for a single-character break as it needs no
<span class="lineNum">     899 </span>                :            additional storage space */
<span class="lineNum">     900 </span><span class="lineNoCov">              0 :         if (breakcharlen == 1 &amp;&amp; !docut) {</span>
<span class="lineNum">     901 </span><span class="lineNoCov">              0 :                 newtext = estrndup(text, textlen);</span>
<span class="lineNum">     902 </span>                : 
<span class="lineNum">     903 </span><span class="lineNoCov">              0 :                 laststart = lastspace = 0;</span>
<span class="lineNum">     904 </span><span class="lineNoCov">              0 :                 for (current = 0; current &lt; textlen; current++) {</span>
<span class="lineNum">     905 </span><span class="lineNoCov">              0 :                         if (text[current] == breakchar[0]) {</span>
<span class="lineNum">     906 </span><span class="lineNoCov">              0 :                                 laststart = lastspace = current + 1;</span>
<span class="lineNum">     907 </span><span class="lineNoCov">              0 :                         } else if (text[current] == ' ') {</span>
<span class="lineNum">     908 </span><span class="lineNoCov">              0 :                                 if (current - laststart &gt;= linelength) {</span>
<span class="lineNum">     909 </span><span class="lineNoCov">              0 :                                         newtext[current] = breakchar[0];</span>
<span class="lineNum">     910 </span><span class="lineNoCov">              0 :                                         laststart = current + 1;</span>
<span class="lineNum">     911 </span>                :                                 }
<span class="lineNum">     912 </span><span class="lineNoCov">              0 :                                 lastspace = current;</span>
<span class="lineNum">     913 </span><span class="lineNoCov">              0 :                         } else if (current - laststart &gt;= linelength &amp;&amp; laststart != lastspace) {</span>
<span class="lineNum">     914 </span><span class="lineNoCov">              0 :                                 newtext[lastspace] = breakchar[0];</span>
<span class="lineNum">     915 </span><span class="lineNoCov">              0 :                                 laststart = lastspace + 1;</span>
<span class="lineNum">     916 </span>                :                         }
<span class="lineNum">     917 </span>                :                 }
<span class="lineNum">     918 </span>                : 
<span class="lineNum">     919 </span><span class="lineNoCov">              0 :                 RETURN_STRINGL(newtext, textlen, 0);</span>
<span class="lineNum">     920 </span>                :         } else {
<span class="lineNum">     921 </span>                :                 /* Multiple character line break or forced cut */
<span class="lineNum">     922 </span><span class="lineNoCov">              0 :                 if (linelength &gt; 0) {</span>
<span class="lineNum">     923 </span><span class="lineNoCov">              0 :                         chk = (int)(textlen/linelength + 1);</span>
<span class="lineNum">     924 </span><span class="lineNoCov">              0 :                         newtext = safe_emalloc(chk, breakcharlen, textlen + 1);</span>
<span class="lineNum">     925 </span><span class="lineNoCov">              0 :                         alloced = textlen + chk * breakcharlen + 1;</span>
<span class="lineNum">     926 </span>                :                 } else {
<span class="lineNum">     927 </span><span class="lineNoCov">              0 :                         chk = textlen;</span>
<span class="lineNum">     928 </span><span class="lineNoCov">              0 :                         alloced = textlen * (breakcharlen + 1) + 1;</span>
<span class="lineNum">     929 </span><span class="lineNoCov">              0 :                         newtext = safe_emalloc(textlen, (breakcharlen + 1), 1);</span>
<span class="lineNum">     930 </span>                :                 }
<span class="lineNum">     931 </span>                : 
<span class="lineNum">     932 </span>                :                 /* now keep track of the actual new text length */
<span class="lineNum">     933 </span><span class="lineNoCov">              0 :                 newtextlen = 0;</span>
<span class="lineNum">     934 </span>                : 
<span class="lineNum">     935 </span><span class="lineNoCov">              0 :                 laststart = lastspace = 0;</span>
<span class="lineNum">     936 </span><span class="lineNoCov">              0 :                 for (current = 0; current &lt; textlen; current++) {</span>
<span class="lineNum">     937 </span><span class="lineNoCov">              0 :                         if (chk &lt;= 0) {</span>
<span class="lineNum">     938 </span><span class="lineNoCov">              0 :                                 alloced += (int) (((textlen - current + 1)/linelength + 1) * breakcharlen) + 1;</span>
<span class="lineNum">     939 </span><span class="lineNoCov">              0 :                                 newtext = erealloc(newtext, alloced);</span>
<span class="lineNum">     940 </span><span class="lineNoCov">              0 :                                 chk = (int) ((textlen - current)/linelength) + 1;</span>
<span class="lineNum">     941 </span>                :                         }
<span class="lineNum">     942 </span>                :                         /* when we hit an existing break, copy to new buffer, and
<span class="lineNum">     943 </span>                :                          * fix up laststart and lastspace */
<span class="lineNum">     944 </span><span class="lineNoCov">              0 :                         if (text[current] == breakchar[0]</span>
<span class="lineNum">     945 </span><span class="lineNoCov">              0 :                                 &amp;&amp; current + breakcharlen &lt; textlen</span>
<span class="lineNum">     946 </span><span class="lineNoCov">              0 :                                 &amp;&amp; !strncmp(text+current, breakchar, breakcharlen)) {</span>
<span class="lineNum">     947 </span><span class="lineNoCov">              0 :                                 memcpy(newtext+newtextlen, text+laststart, current-laststart+breakcharlen);</span>
<span class="lineNum">     948 </span><span class="lineNoCov">              0 :                                 newtextlen += current-laststart+breakcharlen;</span>
<span class="lineNum">     949 </span><span class="lineNoCov">              0 :                                 current += breakcharlen - 1;</span>
<span class="lineNum">     950 </span><span class="lineNoCov">              0 :                                 laststart = lastspace = current + 1;</span>
<span class="lineNum">     951 </span><span class="lineNoCov">              0 :                                 chk--;</span>
<span class="lineNum">     952 </span>                :                         }
<span class="lineNum">     953 </span>                :                         /* if it is a space, check if it is at the line boundary,
<span class="lineNum">     954 </span>                :                          * copy and insert a break, or just keep track of it */
<span class="lineNum">     955 </span><span class="lineNoCov">              0 :                         else if (text[current] == ' ') {</span>
<span class="lineNum">     956 </span><span class="lineNoCov">              0 :                                 if (current - laststart &gt;= linelength) {</span>
<span class="lineNum">     957 </span><span class="lineNoCov">              0 :                                         memcpy(newtext+newtextlen, text+laststart, current-laststart);</span>
<span class="lineNum">     958 </span><span class="lineNoCov">              0 :                                         newtextlen += current - laststart;</span>
<span class="lineNum">     959 </span><span class="lineNoCov">              0 :                                         memcpy(newtext+newtextlen, breakchar, breakcharlen);</span>
<span class="lineNum">     960 </span><span class="lineNoCov">              0 :                                         newtextlen += breakcharlen;</span>
<span class="lineNum">     961 </span><span class="lineNoCov">              0 :                                         laststart = current + 1;</span>
<span class="lineNum">     962 </span><span class="lineNoCov">              0 :                                         chk--;</span>
<span class="lineNum">     963 </span>                :                                 }
<span class="lineNum">     964 </span><span class="lineNoCov">              0 :                                 lastspace = current;</span>
<span class="lineNum">     965 </span>                :                         }
<span class="lineNum">     966 </span>                :                         /* if we are cutting, and we've accumulated enough
<span class="lineNum">     967 </span>                :                          * characters, and we haven't see a space for this line,
<span class="lineNum">     968 </span>                :                          * copy and insert a break. */
<span class="lineNum">     969 </span><span class="lineNoCov">              0 :                         else if (current - laststart &gt;= linelength</span>
<span class="lineNum">     970 </span><span class="lineNoCov">              0 :                                         &amp;&amp; docut &amp;&amp; laststart &gt;= lastspace) {</span>
<span class="lineNum">     971 </span><span class="lineNoCov">              0 :                                 memcpy(newtext+newtextlen, text+laststart, current-laststart);</span>
<span class="lineNum">     972 </span><span class="lineNoCov">              0 :                                 newtextlen += current - laststart;</span>
<span class="lineNum">     973 </span><span class="lineNoCov">              0 :                                 memcpy(newtext+newtextlen, breakchar, breakcharlen);</span>
<span class="lineNum">     974 </span><span class="lineNoCov">              0 :                                 newtextlen += breakcharlen;</span>
<span class="lineNum">     975 </span><span class="lineNoCov">              0 :                                 laststart = lastspace = current;</span>
<span class="lineNum">     976 </span><span class="lineNoCov">              0 :                                 chk--;</span>
<span class="lineNum">     977 </span>                :                         }
<span class="lineNum">     978 </span>                :                         /* if the current word puts us over the linelength, copy
<span class="lineNum">     979 </span>                :                          * back up until the last space, insert a break, and move
<span class="lineNum">     980 </span>                :                          * up the laststart */
<span class="lineNum">     981 </span><span class="lineNoCov">              0 :                         else if (current - laststart &gt;= linelength</span>
<span class="lineNum">     982 </span><span class="lineNoCov">              0 :                                         &amp;&amp; laststart &lt; lastspace) {</span>
<span class="lineNum">     983 </span><span class="lineNoCov">              0 :                                 memcpy(newtext+newtextlen, text+laststart, lastspace-laststart);</span>
<span class="lineNum">     984 </span><span class="lineNoCov">              0 :                                 newtextlen += lastspace - laststart;</span>
<span class="lineNum">     985 </span><span class="lineNoCov">              0 :                                 memcpy(newtext+newtextlen, breakchar, breakcharlen);</span>
<span class="lineNum">     986 </span><span class="lineNoCov">              0 :                                 newtextlen += breakcharlen;</span>
<span class="lineNum">     987 </span><span class="lineNoCov">              0 :                                 laststart = lastspace = lastspace + 1;</span>
<span class="lineNum">     988 </span><span class="lineNoCov">              0 :                                 chk--;</span>
<span class="lineNum">     989 </span>                :                         }
<span class="lineNum">     990 </span>                :                 }
<span class="lineNum">     991 </span>                : 
<span class="lineNum">     992 </span>                :                 /* copy over any stragglers */
<span class="lineNum">     993 </span><span class="lineNoCov">              0 :                 if (laststart != current) {</span>
<span class="lineNum">     994 </span><span class="lineNoCov">              0 :                         memcpy(newtext+newtextlen, text+laststart, current-laststart);</span>
<span class="lineNum">     995 </span><span class="lineNoCov">              0 :                         newtextlen += current - laststart;</span>
<span class="lineNum">     996 </span>                :                 }
<span class="lineNum">     997 </span>                : 
<span class="lineNum">     998 </span><span class="lineNoCov">              0 :                 newtext[newtextlen] = '\0';</span>
<span class="lineNum">     999 </span>                :                 /* free unused memory */
<span class="lineNum">    1000 </span><span class="lineNoCov">              0 :                 newtext = erealloc(newtext, newtextlen+1);</span>
<span class="lineNum">    1001 </span>                : 
<span class="lineNum">    1002 </span><span class="lineNoCov">              0 :                 RETURN_STRINGL(newtext, newtextlen, 0);</span>
<span class="lineNum">    1003 </span>                :         }
<span class="lineNum">    1004 </span>                : }
<span class="lineNum">    1005 </span>                : /* }}} */
<span class="lineNum">    1006 </span>                : 
<a name="1007"><span class="lineNum">    1007 </span>                : /* {{{ php_explode</a>
<span class="lineNum">    1008 </span>                :  */
<span class="lineNum">    1009 </span><span class="lineCov">           1063 : PHPAPI void php_explode(zval *delim, zval *str, zval *return_value, long limit)</span>
<span class="lineNum">    1010 </span>                : {
<span class="lineNum">    1011 </span>                :         char *p1, *p2, *endp;
<span class="lineNum">    1012 </span>                : 
<span class="lineNum">    1013 </span><span class="lineCov">           1063 :         endp = Z_STRVAL_P(str) + Z_STRLEN_P(str);</span>
<span class="lineNum">    1014 </span>                : 
<span class="lineNum">    1015 </span><span class="lineCov">           1063 :         p1 = Z_STRVAL_P(str);</span>
<span class="lineNum">    1016 </span><span class="lineCov">           1063 :         p2 = php_memnstr(Z_STRVAL_P(str), Z_STRVAL_P(delim), Z_STRLEN_P(delim), endp);</span>
<span class="lineNum">    1017 </span>                : 
<span class="lineNum">    1018 </span><span class="lineCov">           1063 :         if (p2 == NULL) {</span>
<span class="lineNum">    1019 </span><span class="lineCov">              1 :                 add_next_index_stringl(return_value, p1, Z_STRLEN_P(str), 1);</span>
<span class="lineNum">    1020 </span>                :         } else {
<span class="lineNum">    1021 </span>                :                 do {
<span class="lineNum">    1022 </span><span class="lineCov">           1571 :                         add_next_index_stringl(return_value, p1, p2 - p1, 1);</span>
<span class="lineNum">    1023 </span><span class="lineCov">           1571 :                         p1 = p2 + Z_STRLEN_P(delim);</span>
<span class="lineNum">    1024 </span><span class="lineCov">           1571 :                 } while ((p2 = php_memnstr(p1, Z_STRVAL_P(delim), Z_STRLEN_P(delim), endp)) != NULL &amp;&amp;</span>
<span class="lineNum">    1025 </span><span class="lineCov">           1571 :                                  --limit &gt; 1);</span>
<span class="lineNum">    1026 </span>                : 
<span class="lineNum">    1027 </span><span class="lineCov">           1062 :                 if (p1 &lt;= endp)</span>
<span class="lineNum">    1028 </span><span class="lineCov">           1062 :                         add_next_index_stringl(return_value, p1, endp-p1, 1);</span>
<span class="lineNum">    1029 </span>                :         }
<span class="lineNum">    1030 </span><span class="lineCov">           1063 : }</span>
<span class="lineNum">    1031 </span>                : /* }}} */
<span class="lineNum">    1032 </span>                : 
<a name="1033"><span class="lineNum">    1033 </span>                : /* {{{ php_explode_negative_limit</a>
<span class="lineNum">    1034 </span>                :  */
<span class="lineNum">    1035 </span><span class="lineNoCov">              0 : PHPAPI void php_explode_negative_limit(zval *delim, zval *str, zval *return_value, long limit)</span>
<span class="lineNum">    1036 </span>                : {
<span class="lineNum">    1037 </span>                : #define EXPLODE_ALLOC_STEP 64
<span class="lineNum">    1038 </span>                :         char *p1, *p2, *endp;
<span class="lineNum">    1039 </span>                : 
<span class="lineNum">    1040 </span><span class="lineNoCov">              0 :         endp = Z_STRVAL_P(str) + Z_STRLEN_P(str);</span>
<span class="lineNum">    1041 </span>                : 
<span class="lineNum">    1042 </span><span class="lineNoCov">              0 :         p1 = Z_STRVAL_P(str);</span>
<span class="lineNum">    1043 </span><span class="lineNoCov">              0 :         p2 = php_memnstr(Z_STRVAL_P(str), Z_STRVAL_P(delim), Z_STRLEN_P(delim), endp);</span>
<span class="lineNum">    1044 </span>                : 
<span class="lineNum">    1045 </span><span class="lineNoCov">              0 :         if (p2 == NULL) {</span>
<span class="lineNum">    1046 </span>                :                 /*
<span class="lineNum">    1047 </span>                :                 do nothing since limit &lt;= -1, thus if only one chunk - 1 + (limit) &lt;= 0
<span class="lineNum">    1048 </span>                :                 by doing nothing we return empty array
<span class="lineNum">    1049 </span>                :                 */
<span class="lineNum">    1050 </span>                :         } else {
<span class="lineNum">    1051 </span><span class="lineNoCov">              0 :                 int allocated = EXPLODE_ALLOC_STEP, found = 0;</span>
<span class="lineNum">    1052 </span>                :                 long i, to_return;
<span class="lineNum">    1053 </span><span class="lineNoCov">              0 :                 char **positions = emalloc(allocated * sizeof(char *));</span>
<span class="lineNum">    1054 </span>                : 
<span class="lineNum">    1055 </span><span class="lineNoCov">              0 :                 positions[found++] = p1;</span>
<span class="lineNum">    1056 </span>                :                 do {
<span class="lineNum">    1057 </span><span class="lineNoCov">              0 :                         if (found &gt;= allocated) {</span>
<span class="lineNum">    1058 </span><span class="lineNoCov">              0 :                                 allocated = found + EXPLODE_ALLOC_STEP;/* make sure we have enough memory */</span>
<span class="lineNum">    1059 </span><span class="lineNoCov">              0 :                                 positions = erealloc(positions, allocated*sizeof(char *));</span>
<span class="lineNum">    1060 </span>                :                         }
<span class="lineNum">    1061 </span><span class="lineNoCov">              0 :                         positions[found++] = p1 = p2 + Z_STRLEN_P(delim);</span>
<span class="lineNum">    1062 </span><span class="lineNoCov">              0 :                 } while ((p2 = php_memnstr(p1, Z_STRVAL_P(delim), Z_STRLEN_P(delim), endp)) != NULL);</span>
<span class="lineNum">    1063 </span>                : 
<span class="lineNum">    1064 </span><span class="lineNoCov">              0 :                 to_return = limit + found;</span>
<span class="lineNum">    1065 </span>                :                 /* limit is at least -1 therefore no need of bounds checking : i will be always less than found */
<span class="lineNum">    1066 </span><span class="lineNoCov">              0 :                 for (i = 0;i &lt; to_return;i++) { /* this checks also for to_return &gt; 0 */</span>
<span class="lineNum">    1067 </span><span class="lineNoCov">              0 :                         add_next_index_stringl(return_value, positions[i],</span>
<span class="lineNum">    1068 </span><span class="lineNoCov">              0 :                                         (positions[i+1] - Z_STRLEN_P(delim)) - positions[i],</span>
<span class="lineNum">    1069 </span>                :                                         1
<span class="lineNum">    1070 </span>                :                                 );
<span class="lineNum">    1071 </span>                :                 }
<span class="lineNum">    1072 </span><span class="lineNoCov">              0 :                 efree(positions);</span>
<span class="lineNum">    1073 </span>                :         }
<span class="lineNum">    1074 </span>                : #undef EXPLODE_ALLOC_STEP
<span class="lineNum">    1075 </span><span class="lineNoCov">              0 : }</span>
<span class="lineNum">    1076 </span>                : /* }}} */
<span class="lineNum">    1077 </span>                : 
<a name="1078"><span class="lineNum">    1078 </span>                : /* {{{ proto array explode(string separator, string str [, int limit])</a>
<span class="lineNum">    1079 </span>                :    Splits a string on string separator and return array of components. If limit is positive only limit number of components is returned. If limit is negative all components except the last abs(limit) are returned. */
<span class="lineNum">    1080 </span><span class="lineCov">           1065 : PHP_FUNCTION(explode)</span>
<span class="lineNum">    1081 </span>                : {
<span class="lineNum">    1082 </span>                :         char *str, *delim;
<span class="lineNum">    1083 </span><span class="lineCov">           1065 :         int str_len = 0, delim_len = 0;</span>
<span class="lineNum">    1084 </span><span class="lineCov">           1065 :         long limit = LONG_MAX; /* No limit */</span>
<span class="lineNum">    1085 </span>                :         zval zdelim, zstr;
<span class="lineNum">    1086 </span>                : 
<span class="lineNum">    1087 </span><span class="lineCov">           1065 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;ss|l&quot;, &amp;delim, &amp;delim_len, &amp;str, &amp;str_len, &amp;limit) == FAILURE) {</span>
<span class="lineNum">    1088 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    1089 </span>                :         }
<span class="lineNum">    1090 </span>                : 
<span class="lineNum">    1091 </span><span class="lineCov">           1065 :         if (delim_len == 0) {</span>
<span class="lineNum">    1092 </span><span class="lineNoCov">              0 :                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Empty delimiter&quot;);</span>
<span class="lineNum">    1093 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    1094 </span>                :         }
<span class="lineNum">    1095 </span>                : 
<span class="lineNum">    1096 </span><span class="lineCov">           1065 :         array_init(return_value);</span>
<span class="lineNum">    1097 </span>                : 
<span class="lineNum">    1098 </span><span class="lineCov">           1065 :         if (str_len == 0) {</span>
<span class="lineNum">    1099 </span><span class="lineCov">              2 :                 if (limit &gt;= 0) {</span>
<span class="lineNum">    1100 </span><span class="lineCov">              2 :                         add_next_index_stringl(return_value, &quot;&quot;, sizeof(&quot;&quot;) - 1, 1);</span>
<span class="lineNum">    1101 </span>                :                 }
<span class="lineNum">    1102 </span><span class="lineCov">              2 :                 return;</span>
<span class="lineNum">    1103 </span>                :         }
<span class="lineNum">    1104 </span>                : 
<span class="lineNum">    1105 </span><span class="lineCov">           1063 :         ZVAL_STRINGL(&amp;zstr, str, str_len, 0);</span>
<span class="lineNum">    1106 </span><span class="lineCov">           1063 :         ZVAL_STRINGL(&amp;zdelim, delim, delim_len, 0);</span>
<span class="lineNum">    1107 </span><span class="lineCov">           1063 :         if (limit &gt; 1) {</span>
<span class="lineNum">    1108 </span><span class="lineCov">           1063 :                 php_explode(&amp;zdelim, &amp;zstr, return_value, limit);</span>
<span class="lineNum">    1109 </span><span class="lineNoCov">              0 :         } else if (limit &lt; 0) {</span>
<span class="lineNum">    1110 </span><span class="lineNoCov">              0 :                 php_explode_negative_limit(&amp;zdelim, &amp;zstr, return_value, limit);</span>
<span class="lineNum">    1111 </span>                :         } else {
<span class="lineNum">    1112 </span><span class="lineNoCov">              0 :                 add_index_stringl(return_value, 0, str, str_len, 1);</span>
<span class="lineNum">    1113 </span>                :         }
<span class="lineNum">    1114 </span>                : }
<span class="lineNum">    1115 </span>                : /* }}} */
<span class="lineNum">    1116 </span>                : 
<span class="lineNum">    1117 </span>                : /* {{{ proto string join(array src, string glue)
<span class="lineNum">    1118 </span>                :    An alias for implode */
<span class="lineNum">    1119 </span>                : /* }}} */
<span class="lineNum">    1120 </span>                : 
<a name="1121"><span class="lineNum">    1121 </span>                : /* {{{ php_implode</a>
<span class="lineNum">    1122 </span>                :  */
<span class="lineNum">    1123 </span><span class="lineCov">             23 : PHPAPI void php_implode(zval *delim, zval *arr, zval *return_value TSRMLS_DC)</span>
<span class="lineNum">    1124 </span>                : {
<span class="lineNum">    1125 </span>                :         zval         **tmp;
<span class="lineNum">    1126 </span>                :         HashPosition   pos;
<span class="lineNum">    1127 </span><span class="lineCov">             23 :         smart_str      implstr = {0};</span>
<span class="lineNum">    1128 </span><span class="lineCov">             23 :         int            numelems, i = 0;</span>
<span class="lineNum">    1129 </span>                :         zval tmp_val;
<span class="lineNum">    1130 </span>                :         int str_len;
<span class="lineNum">    1131 </span>                : 
<span class="lineNum">    1132 </span><span class="lineCov">             23 :         numelems = zend_hash_num_elements(Z_ARRVAL_P(arr));</span>
<span class="lineNum">    1133 </span>                : 
<span class="lineNum">    1134 </span><span class="lineCov">             23 :         if (numelems == 0) {</span>
<span class="lineNum">    1135 </span><span class="lineNoCov">              0 :                 RETURN_EMPTY_STRING();</span>
<span class="lineNum">    1136 </span>                :         }
<span class="lineNum">    1137 </span>                : 
<span class="lineNum">    1138 </span><span class="lineCov">             23 :         zend_hash_internal_pointer_reset_ex(Z_ARRVAL_P(arr), &amp;pos);</span>
<span class="lineNum">    1139 </span>                : 
<span class="lineNum">    1140 </span><span class="lineCov">            189 :         while (zend_hash_get_current_data_ex(Z_ARRVAL_P(arr), (void **) &amp;tmp, &amp;pos) == SUCCESS) {</span>
<span class="lineNum">    1141 </span><span class="lineCov">            143 :                 switch ((*tmp)-&gt;type) {</span>
<span class="lineNum">    1142 </span>                :                         case IS_STRING:
<span class="lineNum">    1143 </span><span class="lineCov">            143 :                                 smart_str_appendl(&amp;implstr, Z_STRVAL_PP(tmp), Z_STRLEN_PP(tmp));</span>
<span class="lineNum">    1144 </span><span class="lineCov">            143 :                                 break;</span>
<span class="lineNum">    1145 </span>                : 
<span class="lineNum">    1146 </span>                :                         case IS_LONG: {
<span class="lineNum">    1147 </span>                :                                 char stmp[MAX_LENGTH_OF_LONG + 1];
<span class="lineNum">    1148 </span><span class="lineNoCov">              0 :                                 str_len = slprintf(stmp, sizeof(stmp), &quot;%ld&quot;, Z_LVAL_PP(tmp));</span>
<span class="lineNum">    1149 </span><span class="lineNoCov">              0 :                                 smart_str_appendl(&amp;implstr, stmp, str_len);</span>
<span class="lineNum">    1150 </span>                :                         }
<span class="lineNum">    1151 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    1152 </span>                : 
<span class="lineNum">    1153 </span>                :                         case IS_BOOL:
<span class="lineNum">    1154 </span><span class="lineNoCov">              0 :                                 if (Z_LVAL_PP(tmp) == 1) {</span>
<span class="lineNum">    1155 </span><span class="lineNoCov">              0 :                                         smart_str_appendl(&amp;implstr, &quot;1&quot;, sizeof(&quot;1&quot;)-1);</span>
<span class="lineNum">    1156 </span>                :                                 }
<span class="lineNum">    1157 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    1158 </span>                : 
<span class="lineNum">    1159 </span>                :                         case IS_NULL:
<span class="lineNum">    1160 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    1161 </span>                : 
<span class="lineNum">    1162 </span>                :                         case IS_DOUBLE: {
<span class="lineNum">    1163 </span>                :                                 char *stmp;
<span class="lineNum">    1164 </span><span class="lineNoCov">              0 :                                 str_len = spprintf(&amp;stmp, 0, &quot;%.*G&quot;, (int) EG(precision), Z_DVAL_PP(tmp));</span>
<span class="lineNum">    1165 </span><span class="lineNoCov">              0 :                                 smart_str_appendl(&amp;implstr, stmp, str_len);</span>
<span class="lineNum">    1166 </span><span class="lineNoCov">              0 :                                 efree(stmp);</span>
<span class="lineNum">    1167 </span>                :                         }
<span class="lineNum">    1168 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    1169 </span>                : 
<span class="lineNum">    1170 </span>                :                         case IS_OBJECT: {
<span class="lineNum">    1171 </span>                :                                 int copy;
<span class="lineNum">    1172 </span>                :                                 zval expr;
<span class="lineNum">    1173 </span><span class="lineNoCov">              0 :                                 zend_make_printable_zval(*tmp, &amp;expr, &amp;copy);</span>
<span class="lineNum">    1174 </span><span class="lineNoCov">              0 :                                 smart_str_appendl(&amp;implstr, Z_STRVAL(expr), Z_STRLEN(expr));</span>
<span class="lineNum">    1175 </span><span class="lineNoCov">              0 :                                 if (copy) {</span>
<span class="lineNum">    1176 </span>                :                                         zval_dtor(&amp;expr);
<span class="lineNum">    1177 </span>                :                                 }
<span class="lineNum">    1178 </span>                :                         }
<span class="lineNum">    1179 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    1180 </span>                : 
<span class="lineNum">    1181 </span>                :                         default:
<span class="lineNum">    1182 </span><span class="lineNoCov">              0 :                                 tmp_val = **tmp;</span>
<span class="lineNum">    1183 </span>                :                                 zval_copy_ctor(&amp;tmp_val);
<span class="lineNum">    1184 </span><span class="lineNoCov">              0 :                                 convert_to_string(&amp;tmp_val);</span>
<span class="lineNum">    1185 </span><span class="lineNoCov">              0 :                                 smart_str_appendl(&amp;implstr, Z_STRVAL(tmp_val), Z_STRLEN(tmp_val));</span>
<span class="lineNum">    1186 </span>                :                                 zval_dtor(&amp;tmp_val);
<span class="lineNum">    1187 </span>                :                                 break;
<span class="lineNum">    1188 </span>                : 
<span class="lineNum">    1189 </span>                :                 }
<span class="lineNum">    1190 </span>                : 
<span class="lineNum">    1191 </span><span class="lineCov">            143 :                 if (++i != numelems) {</span>
<span class="lineNum">    1192 </span><span class="lineCov">            120 :                         smart_str_appendl(&amp;implstr, Z_STRVAL_P(delim), Z_STRLEN_P(delim));</span>
<span class="lineNum">    1193 </span>                :                 }
<span class="lineNum">    1194 </span><span class="lineCov">            143 :                 zend_hash_move_forward_ex(Z_ARRVAL_P(arr), &amp;pos);</span>
<span class="lineNum">    1195 </span>                :         }
<span class="lineNum">    1196 </span><span class="lineCov">             23 :         smart_str_0(&amp;implstr);</span>
<span class="lineNum">    1197 </span>                : 
<span class="lineNum">    1198 </span><span class="lineCov">             23 :         if (implstr.len) {</span>
<span class="lineNum">    1199 </span><span class="lineCov">             23 :                 RETURN_STRINGL(implstr.c, implstr.len, 0);</span>
<span class="lineNum">    1200 </span>                :         } else {
<span class="lineNum">    1201 </span><span class="lineNoCov">              0 :                 smart_str_free(&amp;implstr);</span>
<span class="lineNum">    1202 </span><span class="lineNoCov">              0 :                 RETURN_EMPTY_STRING();</span>
<span class="lineNum">    1203 </span>                :         }
<span class="lineNum">    1204 </span>                : }
<span class="lineNum">    1205 </span>                : /* }}} */
<span class="lineNum">    1206 </span>                : 
<a name="1207"><span class="lineNum">    1207 </span>                : /* {{{ proto string implode([string glue,] array pieces)</a>
<span class="lineNum">    1208 </span>                :    Joins array elements placing glue string between items and return one string */
<span class="lineNum">    1209 </span><span class="lineCov">             23 : PHP_FUNCTION(implode)</span>
<span class="lineNum">    1210 </span>                : {
<span class="lineNum">    1211 </span><span class="lineCov">             23 :         zval **arg1 = NULL, **arg2 = NULL, *delim, *arr;</span>
<span class="lineNum">    1212 </span>                : 
<span class="lineNum">    1213 </span><span class="lineCov">             23 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;Z|Z&quot;, &amp;arg1, &amp;arg2) == FAILURE) {</span>
<span class="lineNum">    1214 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    1215 </span>                :         }
<span class="lineNum">    1216 </span>                : 
<span class="lineNum">    1217 </span><span class="lineCov">             23 :         if (arg2 == NULL) {</span>
<span class="lineNum">    1218 </span><span class="lineNoCov">              0 :                 if (Z_TYPE_PP(arg1) != IS_ARRAY) {</span>
<span class="lineNum">    1219 </span><span class="lineNoCov">              0 :                         php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Argument must be an array&quot;);</span>
<span class="lineNum">    1220 </span><span class="lineNoCov">              0 :                         return;</span>
<span class="lineNum">    1221 </span>                :                 }
<span class="lineNum">    1222 </span>                : 
<span class="lineNum">    1223 </span><span class="lineNoCov">              0 :                 MAKE_STD_ZVAL(delim);</span>
<span class="lineNum">    1224 </span>                : #define _IMPL_EMPTY &quot;&quot;
<span class="lineNum">    1225 </span><span class="lineNoCov">              0 :                 ZVAL_STRINGL(delim, _IMPL_EMPTY, sizeof(_IMPL_EMPTY) - 1, 0);</span>
<span class="lineNum">    1226 </span>                : 
<span class="lineNum">    1227 </span><span class="lineNoCov">              0 :                 SEPARATE_ZVAL(arg1);</span>
<span class="lineNum">    1228 </span><span class="lineNoCov">              0 :                 arr = *arg1;</span>
<span class="lineNum">    1229 </span>                :         } else {
<span class="lineNum">    1230 </span><span class="lineCov">             23 :                 if (Z_TYPE_PP(arg1) == IS_ARRAY) {</span>
<span class="lineNum">    1231 </span><span class="lineNoCov">              0 :                         arr = *arg1;</span>
<span class="lineNum">    1232 </span><span class="lineNoCov">              0 :                         convert_to_string_ex(arg2);</span>
<span class="lineNum">    1233 </span><span class="lineNoCov">              0 :                         delim = *arg2;</span>
<span class="lineNum">    1234 </span><span class="lineCov">             23 :                 } else if (Z_TYPE_PP(arg2) == IS_ARRAY) {</span>
<span class="lineNum">    1235 </span><span class="lineCov">             23 :                         arr = *arg2;</span>
<span class="lineNum">    1236 </span><span class="lineCov">             23 :                         convert_to_string_ex(arg1);</span>
<span class="lineNum">    1237 </span><span class="lineCov">             23 :                         delim = *arg1;</span>
<span class="lineNum">    1238 </span>                :                 } else {
<span class="lineNum">    1239 </span><span class="lineNoCov">              0 :                         php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Invalid arguments passed&quot;);</span>
<span class="lineNum">    1240 </span><span class="lineNoCov">              0 :                         return;</span>
<span class="lineNum">    1241 </span>                :                 }
<span class="lineNum">    1242 </span>                :         }
<span class="lineNum">    1243 </span>                : 
<span class="lineNum">    1244 </span><span class="lineCov">             23 :         php_implode(delim, arr, return_value TSRMLS_CC);</span>
<span class="lineNum">    1245 </span>                : 
<span class="lineNum">    1246 </span><span class="lineCov">             23 :         if (arg2 == NULL) {</span>
<span class="lineNum">    1247 </span><span class="lineNoCov">              0 :                 FREE_ZVAL(delim);</span>
<span class="lineNum">    1248 </span>                :         }
<span class="lineNum">    1249 </span>                : }
<span class="lineNum">    1250 </span>                : /* }}} */
<span class="lineNum">    1251 </span>                : 
<span class="lineNum">    1252 </span>                : #define STRTOK_TABLE(p) BG(strtok_table)[(unsigned char) *p]
<span class="lineNum">    1253 </span>                : 
<a name="1254"><span class="lineNum">    1254 </span>                : /* {{{ proto string strtok([string str,] string token)</a>
<span class="lineNum">    1255 </span>                :    Tokenize a string */
<span class="lineNum">    1256 </span><span class="lineNoCov">              0 : PHP_FUNCTION(strtok)</span>
<span class="lineNum">    1257 </span>                : {
<span class="lineNum">    1258 </span><span class="lineNoCov">              0 :         char *str, *tok = NULL;</span>
<span class="lineNum">    1259 </span><span class="lineNoCov">              0 :         int str_len, tok_len = 0;</span>
<span class="lineNum">    1260 </span>                :         zval *zv;
<span class="lineNum">    1261 </span>                : 
<span class="lineNum">    1262 </span>                :         char *token;
<span class="lineNum">    1263 </span>                :         char *token_end;
<span class="lineNum">    1264 </span>                :         char *p;
<span class="lineNum">    1265 </span>                :         char *pe;
<span class="lineNum">    1266 </span><span class="lineNoCov">              0 :         int skipped = 0;</span>
<span class="lineNum">    1267 </span>                : 
<span class="lineNum">    1268 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s|s&quot;, &amp;str, &amp;str_len, &amp;tok, &amp;tok_len) == FAILURE) {</span>
<span class="lineNum">    1269 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    1270 </span>                :         }
<span class="lineNum">    1271 </span>                : 
<span class="lineNum">    1272 </span><span class="lineNoCov">              0 :         if (ZEND_NUM_ARGS() == 1) {</span>
<span class="lineNum">    1273 </span><span class="lineNoCov">              0 :                 tok = str;</span>
<span class="lineNum">    1274 </span><span class="lineNoCov">              0 :                 tok_len = str_len;</span>
<span class="lineNum">    1275 </span>                :         } else {
<span class="lineNum">    1276 </span><span class="lineNoCov">              0 :                 if (BG(strtok_zval)) {</span>
<span class="lineNum">    1277 </span><span class="lineNoCov">              0 :                         zval_ptr_dtor(&amp;BG(strtok_zval));</span>
<span class="lineNum">    1278 </span>                :                 }
<span class="lineNum">    1279 </span><span class="lineNoCov">              0 :                 MAKE_STD_ZVAL(zv);</span>
<span class="lineNum">    1280 </span><span class="lineNoCov">              0 :                 ZVAL_STRINGL(zv, str, str_len, 1);</span>
<span class="lineNum">    1281 </span>                : 
<span class="lineNum">    1282 </span><span class="lineNoCov">              0 :                 BG(strtok_zval) = zv;</span>
<span class="lineNum">    1283 </span><span class="lineNoCov">              0 :                 BG(strtok_last) = BG(strtok_string) = Z_STRVAL_P(zv);</span>
<span class="lineNum">    1284 </span><span class="lineNoCov">              0 :                 BG(strtok_len) = str_len;</span>
<span class="lineNum">    1285 </span>                :         }
<span class="lineNum">    1286 </span>                : 
<span class="lineNum">    1287 </span><span class="lineNoCov">              0 :         p = BG(strtok_last); /* Where we start to search */</span>
<span class="lineNum">    1288 </span><span class="lineNoCov">              0 :         pe = BG(strtok_string) + BG(strtok_len);</span>
<span class="lineNum">    1289 </span>                : 
<span class="lineNum">    1290 </span><span class="lineNoCov">              0 :         if (!p || p &gt;= pe) {</span>
<span class="lineNum">    1291 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    1292 </span>                :         }
<span class="lineNum">    1293 </span>                : 
<span class="lineNum">    1294 </span><span class="lineNoCov">              0 :         token = tok;</span>
<span class="lineNum">    1295 </span><span class="lineNoCov">              0 :         token_end = token + tok_len;</span>
<span class="lineNum">    1296 </span>                : 
<span class="lineNum">    1297 </span><span class="lineNoCov">              0 :         while (token &lt; token_end) {</span>
<span class="lineNum">    1298 </span><span class="lineNoCov">              0 :                 STRTOK_TABLE(token++) = 1;</span>
<span class="lineNum">    1299 </span>                :         }
<span class="lineNum">    1300 </span>                : 
<span class="lineNum">    1301 </span>                :         /* Skip leading delimiters */
<span class="lineNum">    1302 </span><span class="lineNoCov">              0 :         while (STRTOK_TABLE(p)) {</span>
<span class="lineNum">    1303 </span><span class="lineNoCov">              0 :                 if (++p &gt;= pe) {</span>
<span class="lineNum">    1304 </span>                :                         /* no other chars left */
<span class="lineNum">    1305 </span><span class="lineNoCov">              0 :                         BG(strtok_last) = NULL;</span>
<span class="lineNum">    1306 </span><span class="lineNoCov">              0 :                         RETVAL_FALSE;</span>
<span class="lineNum">    1307 </span><span class="lineNoCov">              0 :                         goto restore;</span>
<span class="lineNum">    1308 </span>                :                 }
<span class="lineNum">    1309 </span><span class="lineNoCov">              0 :                 skipped++;</span>
<span class="lineNum">    1310 </span>                :         }
<span class="lineNum">    1311 </span>                : 
<span class="lineNum">    1312 </span>                :         /* We know at this place that *p is no delimiter, so skip it */
<span class="lineNum">    1313 </span><span class="lineNoCov">              0 :         while (++p &lt; pe) {</span>
<span class="lineNum">    1314 </span><span class="lineNoCov">              0 :                 if (STRTOK_TABLE(p)) {</span>
<span class="lineNum">    1315 </span><span class="lineNoCov">              0 :                         goto return_token;</span>
<span class="lineNum">    1316 </span>                :                 }
<span class="lineNum">    1317 </span>                :         }
<span class="lineNum">    1318 </span>                : 
<span class="lineNum">    1319 </span><span class="lineNoCov">              0 :         if (p - BG(strtok_last)) {</span>
<span class="lineNum">    1320 </span>                : return_token:
<span class="lineNum">    1321 </span><span class="lineNoCov">              0 :                 RETVAL_STRINGL(BG(strtok_last) + skipped, (p - BG(strtok_last)) - skipped, 1);</span>
<span class="lineNum">    1322 </span><span class="lineNoCov">              0 :                 BG(strtok_last) = p + 1;</span>
<span class="lineNum">    1323 </span>                :         } else {
<span class="lineNum">    1324 </span><span class="lineNoCov">              0 :                 RETVAL_FALSE;</span>
<span class="lineNum">    1325 </span><span class="lineNoCov">              0 :                 BG(strtok_last) = NULL;</span>
<span class="lineNum">    1326 </span>                :         }
<span class="lineNum">    1327 </span>                : 
<span class="lineNum">    1328 </span>                :         /* Restore table -- usually faster then memset'ing the table on every invocation */
<span class="lineNum">    1329 </span>                : restore:
<span class="lineNum">    1330 </span><span class="lineNoCov">              0 :         token = tok;</span>
<span class="lineNum">    1331 </span>                : 
<span class="lineNum">    1332 </span><span class="lineNoCov">              0 :         while (token &lt; token_end) {</span>
<span class="lineNum">    1333 </span><span class="lineNoCov">              0 :                 STRTOK_TABLE(token++) = 0;</span>
<span class="lineNum">    1334 </span>                :         }
<span class="lineNum">    1335 </span>                : }
<span class="lineNum">    1336 </span>                : /* }}} */
<span class="lineNum">    1337 </span>                : 
<a name="1338"><span class="lineNum">    1338 </span>                : /* {{{ php_strtoupper</a>
<span class="lineNum">    1339 </span>                :  */
<span class="lineNum">    1340 </span><span class="lineNoCov">              0 : PHPAPI char *php_strtoupper(char *s, size_t len)</span>
<span class="lineNum">    1341 </span>                : {
<span class="lineNum">    1342 </span>                :         unsigned char *c, *e;
<span class="lineNum">    1343 </span>                : 
<span class="lineNum">    1344 </span><span class="lineNoCov">              0 :         c = (unsigned char *)s;</span>
<span class="lineNum">    1345 </span><span class="lineNoCov">              0 :         e = (unsigned char *)c+len;</span>
<span class="lineNum">    1346 </span>                : 
<span class="lineNum">    1347 </span><span class="lineNoCov">              0 :         while (c &lt; e) {</span>
<span class="lineNum">    1348 </span><span class="lineNoCov">              0 :                 *c = toupper(*c);</span>
<span class="lineNum">    1349 </span><span class="lineNoCov">              0 :                 c++;</span>
<span class="lineNum">    1350 </span>                :         }
<span class="lineNum">    1351 </span><span class="lineNoCov">              0 :         return s;</span>
<span class="lineNum">    1352 </span>                : }
<span class="lineNum">    1353 </span>                : /* }}} */
<span class="lineNum">    1354 </span>                : 
<a name="1355"><span class="lineNum">    1355 </span>                : /* {{{ proto string strtoupper(string str)</a>
<span class="lineNum">    1356 </span>                :    Makes a string uppercase */
<span class="lineNum">    1357 </span><span class="lineNoCov">              0 : PHP_FUNCTION(strtoupper)</span>
<span class="lineNum">    1358 </span>                : {
<span class="lineNum">    1359 </span>                :         char *arg;
<span class="lineNum">    1360 </span>                :         int arglen;
<span class="lineNum">    1361 </span>                : 
<span class="lineNum">    1362 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s&quot;, &amp;arg, &amp;arglen) == FAILURE) {</span>
<span class="lineNum">    1363 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    1364 </span>                :         }
<span class="lineNum">    1365 </span>                : 
<span class="lineNum">    1366 </span><span class="lineNoCov">              0 :         arg = estrndup(arg, arglen);</span>
<span class="lineNum">    1367 </span><span class="lineNoCov">              0 :         php_strtoupper(arg, arglen);</span>
<span class="lineNum">    1368 </span><span class="lineNoCov">              0 :         RETURN_STRINGL(arg, arglen, 0);</span>
<span class="lineNum">    1369 </span>                : }
<span class="lineNum">    1370 </span>                : /* }}} */
<span class="lineNum">    1371 </span>                : 
<a name="1372"><span class="lineNum">    1372 </span>                : /* {{{ php_strtolower</a>
<span class="lineNum">    1373 </span>                :  */
<span class="lineNum">    1374 </span><span class="lineCov">            359 : PHPAPI char *php_strtolower(char *s, size_t len)</span>
<span class="lineNum">    1375 </span>                : {
<span class="lineNum">    1376 </span>                :         unsigned char *c, *e;
<span class="lineNum">    1377 </span>                : 
<span class="lineNum">    1378 </span><span class="lineCov">            359 :         c = (unsigned char *)s;</span>
<span class="lineNum">    1379 </span><span class="lineCov">            359 :         e = c+len;</span>
<span class="lineNum">    1380 </span>                : 
<span class="lineNum">    1381 </span><span class="lineCov">           6145 :         while (c &lt; e) {</span>
<span class="lineNum">    1382 </span><span class="lineCov">           5427 :                 *c = tolower(*c);</span>
<span class="lineNum">    1383 </span><span class="lineCov">           5427 :                 c++;</span>
<span class="lineNum">    1384 </span>                :         }
<span class="lineNum">    1385 </span><span class="lineCov">            359 :         return s;</span>
<span class="lineNum">    1386 </span>                : }
<span class="lineNum">    1387 </span>                : /* }}} */
<span class="lineNum">    1388 </span>                : 
<a name="1389"><span class="lineNum">    1389 </span>                : /* {{{ proto string strtolower(string str)</a>
<span class="lineNum">    1390 </span>                :    Makes a string lowercase */
<span class="lineNum">    1391 </span><span class="lineNoCov">              0 : PHP_FUNCTION(strtolower)</span>
<span class="lineNum">    1392 </span>                : {
<span class="lineNum">    1393 </span>                :         char *str;
<span class="lineNum">    1394 </span>                :         int arglen;
<span class="lineNum">    1395 </span>                : 
<span class="lineNum">    1396 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s&quot;, &amp;str, &amp;arglen) == FAILURE) {</span>
<span class="lineNum">    1397 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    1398 </span>                :         }
<span class="lineNum">    1399 </span>                : 
<span class="lineNum">    1400 </span><span class="lineNoCov">              0 :         str = estrndup(str, arglen);</span>
<span class="lineNum">    1401 </span><span class="lineNoCov">              0 :         php_strtolower(str, arglen);</span>
<span class="lineNum">    1402 </span><span class="lineNoCov">              0 :         RETURN_STRINGL(str, arglen, 0);</span>
<span class="lineNum">    1403 </span>                : }
<span class="lineNum">    1404 </span>                : /* }}} */
<span class="lineNum">    1405 </span>                : 
<a name="1406"><span class="lineNum">    1406 </span>                : /* {{{ php_basename</a>
<span class="lineNum">    1407 </span>                :  */
<span class="lineNum">    1408 </span><span class="lineCov">             42 : PHPAPI void php_basename(const char *s, size_t len, char *suffix, size_t sufflen, char **p_ret, size_t *p_len TSRMLS_DC)</span>
<span class="lineNum">    1409 </span>                : {
<span class="lineNum">    1410 </span><span class="lineCov">             42 :         char *ret = NULL, *c, *comp, *cend;</span>
<span class="lineNum">    1411 </span>                :         size_t inc_len, cnt;
<span class="lineNum">    1412 </span>                :         int state;
<span class="lineNum">    1413 </span>                : 
<span class="lineNum">    1414 </span><span class="lineCov">             42 :         c = comp = cend = (char*)s;</span>
<span class="lineNum">    1415 </span><span class="lineCov">             42 :         cnt = len;</span>
<span class="lineNum">    1416 </span><span class="lineCov">             42 :         state = 0;</span>
<span class="lineNum">    1417 </span><span class="lineCov">           2665 :         while (cnt &gt; 0) {</span>
<span class="lineNum">    1418 </span><span class="lineCov">           2581 :                 inc_len = (*c == '\0' ? 1: php_mblen(c, cnt));</span>
<span class="lineNum">    1419 </span>                : 
<span class="lineNum">    1420 </span><span class="lineCov">           2581 :                 switch (inc_len) {</span>
<span class="lineNum">    1421 </span>                :                         case -2:
<span class="lineNum">    1422 </span>                :                         case -1:
<span class="lineNum">    1423 </span><span class="lineNoCov">              0 :                                 inc_len = 1;</span>
<span class="lineNum">    1424 </span><span class="lineNoCov">              0 :                                 php_ignore_value(php_mblen(NULL, 0));</span>
<span class="lineNum">    1425 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    1426 </span>                :                         case 0:
<span class="lineNum">    1427 </span><span class="lineNoCov">              0 :                                 goto quit_loop;</span>
<span class="lineNum">    1428 </span>                :                         case 1:
<span class="lineNum">    1429 </span>                : #if defined(PHP_WIN32) || defined(NETWARE)
<span class="lineNum">    1430 </span>                :                                 if (*c == '/' || *c == '\\') {
<span class="lineNum">    1431 </span>                : #else
<span class="lineNum">    1432 </span><span class="lineCov">           2581 :                                 if (*c == '/') {</span>
<span class="lineNum">    1433 </span>                : #endif
<span class="lineNum">    1434 </span><span class="lineCov">            294 :                                         if (state == 1) {</span>
<span class="lineNum">    1435 </span><span class="lineCov">            252 :                                                 state = 0;</span>
<span class="lineNum">    1436 </span><span class="lineCov">            252 :                                                 cend = c;</span>
<span class="lineNum">    1437 </span>                :                                         }
<span class="lineNum">    1438 </span>                :                                 } else {
<span class="lineNum">    1439 </span><span class="lineCov">           2287 :                                         if (state == 0) {</span>
<span class="lineNum">    1440 </span><span class="lineCov">            294 :                                                 comp = c;</span>
<span class="lineNum">    1441 </span><span class="lineCov">            294 :                                                 state = 1;</span>
<span class="lineNum">    1442 </span>                :                                         }
<span class="lineNum">    1443 </span>                :                                 }
<span class="lineNum">    1444 </span><span class="lineCov">           2581 :                                 break;</span>
<span class="lineNum">    1445 </span>                :                         default:
<span class="lineNum">    1446 </span><span class="lineNoCov">              0 :                                 if (state == 0) {</span>
<span class="lineNum">    1447 </span><span class="lineNoCov">              0 :                                         comp = c;</span>
<span class="lineNum">    1448 </span><span class="lineNoCov">              0 :                                         state = 1;</span>
<span class="lineNum">    1449 </span>                :                                 }
<span class="lineNum">    1450 </span>                :                                 break;
<span class="lineNum">    1451 </span>                :                 }
<span class="lineNum">    1452 </span><span class="lineCov">           2581 :                 c += inc_len;</span>
<span class="lineNum">    1453 </span><span class="lineCov">           2581 :                 cnt -= inc_len;</span>
<span class="lineNum">    1454 </span>                :         }
<span class="lineNum">    1455 </span>                : 
<span class="lineNum">    1456 </span>                : quit_loop:
<span class="lineNum">    1457 </span><span class="lineCov">             42 :         if (state == 1) {</span>
<span class="lineNum">    1458 </span><span class="lineCov">             42 :                 cend = c;</span>
<span class="lineNum">    1459 </span>                :         }
<span class="lineNum">    1460 </span><span class="lineCov">             84 :         if (suffix != NULL &amp;&amp; sufflen &lt; (uint)(cend - comp) &amp;&amp;</span>
<span class="lineNum">    1461 </span><span class="lineCov">             42 :                         memcmp(cend - sufflen, suffix, sufflen) == 0) {</span>
<span class="lineNum">    1462 </span><span class="lineCov">             42 :                 cend -= sufflen;</span>
<span class="lineNum">    1463 </span>                :         }
<span class="lineNum">    1464 </span>                : 
<span class="lineNum">    1465 </span><span class="lineCov">             42 :         len = cend - comp;</span>
<span class="lineNum">    1466 </span>                : 
<span class="lineNum">    1467 </span><span class="lineCov">             42 :         if (p_ret) {</span>
<span class="lineNum">    1468 </span><span class="lineCov">             42 :                 ret = emalloc(len + 1);</span>
<span class="lineNum">    1469 </span><span class="lineCov">             42 :                 memcpy(ret, comp, len);</span>
<span class="lineNum">    1470 </span><span class="lineCov">             42 :                 ret[len] = '\0';</span>
<span class="lineNum">    1471 </span><span class="lineCov">             42 :                 *p_ret = ret;</span>
<span class="lineNum">    1472 </span>                :         }
<span class="lineNum">    1473 </span><span class="lineCov">             42 :         if (p_len) {</span>
<span class="lineNum">    1474 </span><span class="lineCov">             42 :                 *p_len = len;</span>
<span class="lineNum">    1475 </span>                :         }
<span class="lineNum">    1476 </span><span class="lineCov">             42 : }</span>
<span class="lineNum">    1477 </span>                : /* }}} */
<span class="lineNum">    1478 </span>                : 
<a name="1479"><span class="lineNum">    1479 </span>                : /* {{{ proto string basename(string path [, string suffix])</a>
<span class="lineNum">    1480 </span>                :    Returns the filename component of the path */
<span class="lineNum">    1481 </span><span class="lineCov">             42 : PHP_FUNCTION(basename)</span>
<span class="lineNum">    1482 </span>                : {
<span class="lineNum">    1483 </span><span class="lineCov">             42 :         char *string, *suffix = NULL, *ret;</span>
<span class="lineNum">    1484 </span><span class="lineCov">             42 :         int   string_len, suffix_len = 0;</span>
<span class="lineNum">    1485 </span>                :         size_t ret_len;
<span class="lineNum">    1486 </span>                : 
<span class="lineNum">    1487 </span><span class="lineCov">             42 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s|s&quot;, &amp;string, &amp;string_len, &amp;suffix, &amp;suffix_len) == FAILURE) {</span>
<span class="lineNum">    1488 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    1489 </span>                :         }
<span class="lineNum">    1490 </span>                : 
<span class="lineNum">    1491 </span><span class="lineCov">             42 :         php_basename(string, string_len, suffix, suffix_len, &amp;ret, &amp;ret_len TSRMLS_CC);</span>
<span class="lineNum">    1492 </span><span class="lineCov">             42 :         RETURN_STRINGL(ret, (int)ret_len, 0);</span>
<span class="lineNum">    1493 </span>                : }
<span class="lineNum">    1494 </span>                : /* }}} */
<span class="lineNum">    1495 </span>                : 
<a name="1496"><span class="lineNum">    1496 </span>                : /* {{{ php_dirname</a>
<span class="lineNum">    1497 </span>                :    Returns directory name component of path */
<span class="lineNum">    1498 </span><span class="lineCov">             42 : PHPAPI size_t php_dirname(char *path, size_t len)</span>
<span class="lineNum">    1499 </span>                : {
<span class="lineNum">    1500 </span><span class="lineCov">             42 :         return zend_dirname(path, len);</span>
<span class="lineNum">    1501 </span>                : }
<span class="lineNum">    1502 </span>                : /* }}} */
<span class="lineNum">    1503 </span>                : 
<a name="1504"><span class="lineNum">    1504 </span>                : /* {{{ proto string dirname(string path)</a>
<span class="lineNum">    1505 </span>                :    Returns the directory name component of the path */
<span class="lineNum">    1506 </span><span class="lineCov">             42 : PHP_FUNCTION(dirname)</span>
<span class="lineNum">    1507 </span>                : {
<span class="lineNum">    1508 </span>                :         char *str;
<span class="lineNum">    1509 </span>                :         char *ret;
<span class="lineNum">    1510 </span>                :         int str_len;
<span class="lineNum">    1511 </span>                :         size_t ret_len;
<span class="lineNum">    1512 </span>                : 
<span class="lineNum">    1513 </span><span class="lineCov">             42 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s&quot;, &amp;str, &amp;str_len) == FAILURE) {</span>
<span class="lineNum">    1514 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    1515 </span>                :         }
<span class="lineNum">    1516 </span>                : 
<span class="lineNum">    1517 </span><span class="lineCov">             42 :         ret = estrndup(str, str_len);</span>
<span class="lineNum">    1518 </span><span class="lineCov">             42 :         ret_len = php_dirname(ret, str_len);</span>
<span class="lineNum">    1519 </span>                : 
<span class="lineNum">    1520 </span><span class="lineCov">             42 :         RETURN_STRINGL(ret, ret_len, 0);</span>
<span class="lineNum">    1521 </span>                : }
<span class="lineNum">    1522 </span>                : /* }}} */
<span class="lineNum">    1523 </span>                : 
<a name="1524"><span class="lineNum">    1524 </span>                : /* {{{ proto array pathinfo(string path[, int options])</a>
<span class="lineNum">    1525 </span>                :    Returns information about a certain string */
<span class="lineNum">    1526 </span><span class="lineNoCov">              0 : PHP_FUNCTION(pathinfo)</span>
<span class="lineNum">    1527 </span>                : {
<span class="lineNum">    1528 </span>                :         zval *tmp;
<span class="lineNum">    1529 </span><span class="lineNoCov">              0 :         char *path, *ret = NULL;</span>
<span class="lineNum">    1530 </span>                :         int path_len, have_basename;
<span class="lineNum">    1531 </span>                :         size_t ret_len;
<span class="lineNum">    1532 </span><span class="lineNoCov">              0 :         long opt = PHP_PATHINFO_ALL;</span>
<span class="lineNum">    1533 </span>                : 
<span class="lineNum">    1534 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s|l&quot;, &amp;path, &amp;path_len, &amp;opt) == FAILURE) {</span>
<span class="lineNum">    1535 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    1536 </span>                :         }
<span class="lineNum">    1537 </span>                : 
<span class="lineNum">    1538 </span><span class="lineNoCov">              0 :         have_basename = ((opt &amp; PHP_PATHINFO_BASENAME) == PHP_PATHINFO_BASENAME);</span>
<span class="lineNum">    1539 </span>                : 
<span class="lineNum">    1540 </span><span class="lineNoCov">              0 :         MAKE_STD_ZVAL(tmp);</span>
<span class="lineNum">    1541 </span><span class="lineNoCov">              0 :         array_init(tmp);</span>
<span class="lineNum">    1542 </span>                : 
<span class="lineNum">    1543 </span><span class="lineNoCov">              0 :         if ((opt &amp; PHP_PATHINFO_DIRNAME) == PHP_PATHINFO_DIRNAME) {</span>
<span class="lineNum">    1544 </span><span class="lineNoCov">              0 :                 ret = estrndup(path, path_len);</span>
<span class="lineNum">    1545 </span><span class="lineNoCov">              0 :                 php_dirname(ret, path_len);</span>
<span class="lineNum">    1546 </span><span class="lineNoCov">              0 :                 if (*ret) {</span>
<span class="lineNum">    1547 </span><span class="lineNoCov">              0 :                         add_assoc_string(tmp, &quot;dirname&quot;, ret, 1);</span>
<span class="lineNum">    1548 </span>                :                 }
<span class="lineNum">    1549 </span><span class="lineNoCov">              0 :                 efree(ret);</span>
<span class="lineNum">    1550 </span><span class="lineNoCov">              0 :                 ret = NULL;</span>
<span class="lineNum">    1551 </span>                :         }
<span class="lineNum">    1552 </span>                : 
<span class="lineNum">    1553 </span><span class="lineNoCov">              0 :         if (have_basename) {</span>
<span class="lineNum">    1554 </span><span class="lineNoCov">              0 :                 php_basename(path, path_len, NULL, 0, &amp;ret, &amp;ret_len TSRMLS_CC);</span>
<span class="lineNum">    1555 </span><span class="lineNoCov">              0 :                 add_assoc_stringl(tmp, &quot;basename&quot;, ret, ret_len, 0);</span>
<span class="lineNum">    1556 </span>                :         }
<span class="lineNum">    1557 </span>                : 
<span class="lineNum">    1558 </span><span class="lineNoCov">              0 :         if ((opt &amp; PHP_PATHINFO_EXTENSION) == PHP_PATHINFO_EXTENSION) {</span>
<span class="lineNum">    1559 </span>                :                 const char *p;
<span class="lineNum">    1560 </span>                :                 int idx;
<span class="lineNum">    1561 </span>                : 
<span class="lineNum">    1562 </span><span class="lineNoCov">              0 :                 if (!have_basename) {</span>
<span class="lineNum">    1563 </span><span class="lineNoCov">              0 :                         php_basename(path, path_len, NULL, 0, &amp;ret, &amp;ret_len TSRMLS_CC);</span>
<span class="lineNum">    1564 </span>                :                 }
<span class="lineNum">    1565 </span>                : 
<span class="lineNum">    1566 </span><span class="lineNoCov">              0 :                 p = zend_memrchr(ret, '.', ret_len);</span>
<span class="lineNum">    1567 </span>                : 
<span class="lineNum">    1568 </span><span class="lineNoCov">              0 :                 if (p) {</span>
<span class="lineNum">    1569 </span><span class="lineNoCov">              0 :                         idx = p - ret;</span>
<span class="lineNum">    1570 </span><span class="lineNoCov">              0 :                         add_assoc_stringl(tmp, &quot;extension&quot;, ret + idx + 1, ret_len - idx - 1, 1);</span>
<span class="lineNum">    1571 </span>                :                 }
<span class="lineNum">    1572 </span>                :         }
<span class="lineNum">    1573 </span>                : 
<span class="lineNum">    1574 </span><span class="lineNoCov">              0 :         if ((opt &amp; PHP_PATHINFO_FILENAME) == PHP_PATHINFO_FILENAME) {</span>
<span class="lineNum">    1575 </span>                :                 const char *p;
<span class="lineNum">    1576 </span>                :                 int idx;
<span class="lineNum">    1577 </span>                : 
<span class="lineNum">    1578 </span>                :                 /* Have we alrady looked up the basename? */
<span class="lineNum">    1579 </span><span class="lineNoCov">              0 :                 if (!have_basename &amp;&amp; !ret) {</span>
<span class="lineNum">    1580 </span><span class="lineNoCov">              0 :                         php_basename(path, path_len, NULL, 0, &amp;ret, &amp;ret_len TSRMLS_CC);</span>
<span class="lineNum">    1581 </span>                :                 }
<span class="lineNum">    1582 </span>                : 
<span class="lineNum">    1583 </span><span class="lineNoCov">              0 :                 p = zend_memrchr(ret, '.', ret_len);</span>
<span class="lineNum">    1584 </span>                : 
<span class="lineNum">    1585 </span><span class="lineNoCov">              0 :                 idx = p ? (p - ret) : ret_len;</span>
<span class="lineNum">    1586 </span><span class="lineNoCov">              0 :                 add_assoc_stringl(tmp, &quot;filename&quot;, ret, idx, 1);</span>
<span class="lineNum">    1587 </span>                :         }
<span class="lineNum">    1588 </span>                : 
<span class="lineNum">    1589 </span><span class="lineNoCov">              0 :         if (!have_basename &amp;&amp; ret) {</span>
<span class="lineNum">    1590 </span><span class="lineNoCov">              0 :                 efree(ret);</span>
<span class="lineNum">    1591 </span>                :         }
<span class="lineNum">    1592 </span>                : 
<span class="lineNum">    1593 </span><span class="lineNoCov">              0 :         if (opt == PHP_PATHINFO_ALL) {</span>
<span class="lineNum">    1594 </span><span class="lineNoCov">              0 :                 RETURN_ZVAL(tmp, 0, 1);</span>
<span class="lineNum">    1595 </span>                :         } else {
<span class="lineNum">    1596 </span>                :                 zval **element;
<span class="lineNum">    1597 </span><span class="lineNoCov">              0 :                 if (zend_hash_get_current_data(Z_ARRVAL_P(tmp), (void **) &amp;element) == SUCCESS) {</span>
<span class="lineNum">    1598 </span><span class="lineNoCov">              0 :                         RETVAL_ZVAL(*element, 1, 0);</span>
<span class="lineNum">    1599 </span>                :                 } else {
<span class="lineNum">    1600 </span><span class="lineNoCov">              0 :                         ZVAL_EMPTY_STRING(return_value);</span>
<span class="lineNum">    1601 </span>                :                 }
<span class="lineNum">    1602 </span>                :         }
<span class="lineNum">    1603 </span>                : 
<span class="lineNum">    1604 </span><span class="lineNoCov">              0 :         zval_ptr_dtor(&amp;tmp);</span>
<span class="lineNum">    1605 </span>                : }
<span class="lineNum">    1606 </span>                : /* }}} */
<span class="lineNum">    1607 </span>                : 
<a name="1608"><span class="lineNum">    1608 </span>                : /* {{{ php_stristr</a>
<span class="lineNum">    1609 </span>                :    case insensitve strstr */
<span class="lineNum">    1610 </span><span class="lineNoCov">              0 : PHPAPI char *php_stristr(char *s, char *t, size_t s_len, size_t t_len)</span>
<span class="lineNum">    1611 </span>                : {
<span class="lineNum">    1612 </span><span class="lineNoCov">              0 :         php_strtolower(s, s_len);</span>
<span class="lineNum">    1613 </span><span class="lineNoCov">              0 :         php_strtolower(t, t_len);</span>
<span class="lineNum">    1614 </span><span class="lineNoCov">              0 :         return php_memnstr(s, t, t_len, s + s_len);</span>
<span class="lineNum">    1615 </span>                : }
<span class="lineNum">    1616 </span>                : /* }}} */
<span class="lineNum">    1617 </span>                : 
<a name="1618"><span class="lineNum">    1618 </span>                : /* {{{ php_strspn</a>
<span class="lineNum">    1619 </span>                :  */
<span class="lineNum">    1620 </span><span class="lineNoCov">              0 : PHPAPI size_t php_strspn(char *s1, char *s2, char *s1_end, char *s2_end)</span>
<span class="lineNum">    1621 </span>                : {
<span class="lineNum">    1622 </span><span class="lineNoCov">              0 :         register const char *p = s1, *spanp;</span>
<span class="lineNum">    1623 </span><span class="lineNoCov">              0 :         register char c = *p;</span>
<span class="lineNum">    1624 </span>                : 
<span class="lineNum">    1625 </span>                : cont:
<span class="lineNum">    1626 </span><span class="lineNoCov">              0 :         for (spanp = s2; p != s1_end &amp;&amp; spanp != s2_end;) {</span>
<span class="lineNum">    1627 </span><span class="lineNoCov">              0 :                 if (*spanp++ == c) {</span>
<span class="lineNum">    1628 </span><span class="lineNoCov">              0 :                         c = *(++p);</span>
<span class="lineNum">    1629 </span><span class="lineNoCov">              0 :                         goto cont;</span>
<span class="lineNum">    1630 </span>                :                 }
<span class="lineNum">    1631 </span>                :         }
<span class="lineNum">    1632 </span><span class="lineNoCov">              0 :         return (p - s1);</span>
<span class="lineNum">    1633 </span>                : }
<span class="lineNum">    1634 </span>                : /* }}} */
<span class="lineNum">    1635 </span>                : 
<a name="1636"><span class="lineNum">    1636 </span>                : /* {{{ php_strcspn</a>
<span class="lineNum">    1637 </span>                :  */
<span class="lineNum">    1638 </span><span class="lineNoCov">              0 : PHPAPI size_t php_strcspn(char *s1, char *s2, char *s1_end, char *s2_end)</span>
<span class="lineNum">    1639 </span>                : {
<span class="lineNum">    1640 </span>                :         register const char *p, *spanp;
<span class="lineNum">    1641 </span><span class="lineNoCov">              0 :         register char c = *s1;</span>
<span class="lineNum">    1642 </span>                : 
<span class="lineNum">    1643 </span><span class="lineNoCov">              0 :         for (p = s1;;) {</span>
<span class="lineNum">    1644 </span><span class="lineNoCov">              0 :                 spanp = s2;</span>
<span class="lineNum">    1645 </span>                :                 do {
<span class="lineNum">    1646 </span><span class="lineNoCov">              0 :                         if (*spanp == c || p == s1_end) {</span>
<span class="lineNum">    1647 </span><span class="lineNoCov">              0 :                                 return p - s1;</span>
<span class="lineNum">    1648 </span>                :                         }
<span class="lineNum">    1649 </span><span class="lineNoCov">              0 :                 } while (spanp++ &lt; (s2_end - 1));</span>
<span class="lineNum">    1650 </span><span class="lineNoCov">              0 :                 c = *++p;</span>
<span class="lineNum">    1651 </span><span class="lineNoCov">              0 :         }</span>
<span class="lineNum">    1652 </span>                :         /* NOTREACHED */
<span class="lineNum">    1653 </span>                : }
<span class="lineNum">    1654 </span>                : /* }}} */
<span class="lineNum">    1655 </span>                : 
<a name="1656"><span class="lineNum">    1656 </span>                : /* {{{ php_needle_char</a>
<span class="lineNum">    1657 </span>                :  */
<span class="lineNum">    1658 </span><span class="lineNoCov">              0 : static int php_needle_char(zval *needle, char *target TSRMLS_DC)</span>
<span class="lineNum">    1659 </span>                : {
<span class="lineNum">    1660 </span><span class="lineNoCov">              0 :         switch (Z_TYPE_P(needle)) {</span>
<span class="lineNum">    1661 </span>                :                 case IS_LONG:
<span class="lineNum">    1662 </span>                :                 case IS_BOOL:
<span class="lineNum">    1663 </span><span class="lineNoCov">              0 :                         *target = (char)Z_LVAL_P(needle);</span>
<span class="lineNum">    1664 </span><span class="lineNoCov">              0 :                         return SUCCESS;</span>
<span class="lineNum">    1665 </span>                :                 case IS_NULL:
<span class="lineNum">    1666 </span><span class="lineNoCov">              0 :                         *target = '\0';</span>
<span class="lineNum">    1667 </span><span class="lineNoCov">              0 :                         return SUCCESS;</span>
<span class="lineNum">    1668 </span>                :                 case IS_DOUBLE:
<span class="lineNum">    1669 </span><span class="lineNoCov">              0 :                         *target = (char)(int)Z_DVAL_P(needle);</span>
<span class="lineNum">    1670 </span><span class="lineNoCov">              0 :                         return SUCCESS;</span>
<span class="lineNum">    1671 </span>                :                 case IS_OBJECT:
<span class="lineNum">    1672 </span>                :                         {
<span class="lineNum">    1673 </span><span class="lineNoCov">              0 :                                 zval holder = *needle;</span>
<span class="lineNum">    1674 </span>                :                                 zval_copy_ctor(&amp;(holder));
<span class="lineNum">    1675 </span><span class="lineNoCov">              0 :                                 convert_to_long(&amp;(holder));</span>
<span class="lineNum">    1676 </span><span class="lineNoCov">              0 :                                 if(Z_TYPE(holder) != IS_LONG) {</span>
<span class="lineNum">    1677 </span><span class="lineNoCov">              0 :                                         return FAILURE;</span>
<span class="lineNum">    1678 </span>                :                                 }
<span class="lineNum">    1679 </span><span class="lineNoCov">              0 :                                 *target = (char)Z_LVAL(holder);</span>
<span class="lineNum">    1680 </span><span class="lineNoCov">              0 :                                 return SUCCESS;</span>
<span class="lineNum">    1681 </span>                :                         }
<span class="lineNum">    1682 </span>                :                 default: {
<span class="lineNum">    1683 </span><span class="lineNoCov">              0 :                         php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;needle is not a string or an integer&quot;);</span>
<span class="lineNum">    1684 </span><span class="lineNoCov">              0 :                         return FAILURE;</span>
<span class="lineNum">    1685 </span>                :                  }
<span class="lineNum">    1686 </span>                :         }
<span class="lineNum">    1687 </span>                : }
<span class="lineNum">    1688 </span>                : /* }}} */
<span class="lineNum">    1689 </span>                : 
<a name="1690"><span class="lineNum">    1690 </span>                : /* {{{ proto string stristr(string haystack, string needle[, bool part])</a>
<span class="lineNum">    1691 </span>                :    Finds first occurrence of a string within another, case insensitive */
<span class="lineNum">    1692 </span><span class="lineNoCov">              0 : PHP_FUNCTION(stristr)</span>
<span class="lineNum">    1693 </span>                : {
<span class="lineNum">    1694 </span>                :         zval *needle;
<span class="lineNum">    1695 </span>                :         char *haystack;
<span class="lineNum">    1696 </span>                :         int haystack_len;
<span class="lineNum">    1697 </span><span class="lineNoCov">              0 :         char *found = NULL;</span>
<span class="lineNum">    1698 </span>                :         int  found_offset;
<span class="lineNum">    1699 </span>                :         char *haystack_dup;
<span class="lineNum">    1700 </span>                :         char needle_char[2];
<span class="lineNum">    1701 </span><span class="lineNoCov">              0 :         zend_bool part = 0;</span>
<span class="lineNum">    1702 </span>                : 
<span class="lineNum">    1703 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;sz|b&quot;, &amp;haystack, &amp;haystack_len, &amp;needle, &amp;part) == FAILURE) {</span>
<span class="lineNum">    1704 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    1705 </span>                :         }
<span class="lineNum">    1706 </span>                : 
<span class="lineNum">    1707 </span><span class="lineNoCov">              0 :         haystack_dup = estrndup(haystack, haystack_len);</span>
<span class="lineNum">    1708 </span>                : 
<span class="lineNum">    1709 </span><span class="lineNoCov">              0 :         if (Z_TYPE_P(needle) == IS_STRING) {</span>
<span class="lineNum">    1710 </span>                :                 char *orig_needle;
<span class="lineNum">    1711 </span><span class="lineNoCov">              0 :                 if (!Z_STRLEN_P(needle)) {</span>
<span class="lineNum">    1712 </span><span class="lineNoCov">              0 :                         php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Empty delimiter&quot;);</span>
<span class="lineNum">    1713 </span><span class="lineNoCov">              0 :                         efree(haystack_dup);</span>
<span class="lineNum">    1714 </span><span class="lineNoCov">              0 :                         RETURN_FALSE;</span>
<span class="lineNum">    1715 </span>                :                 }
<span class="lineNum">    1716 </span><span class="lineNoCov">              0 :                 orig_needle = estrndup(Z_STRVAL_P(needle), Z_STRLEN_P(needle));</span>
<span class="lineNum">    1717 </span><span class="lineNoCov">              0 :                 found = php_stristr(haystack_dup, orig_needle,  haystack_len, Z_STRLEN_P(needle));</span>
<span class="lineNum">    1718 </span><span class="lineNoCov">              0 :                 efree(orig_needle);</span>
<span class="lineNum">    1719 </span>                :         } else {
<span class="lineNum">    1720 </span><span class="lineNoCov">              0 :                 if (php_needle_char(needle, needle_char TSRMLS_CC) != SUCCESS) {</span>
<span class="lineNum">    1721 </span><span class="lineNoCov">              0 :                         efree(haystack_dup);</span>
<span class="lineNum">    1722 </span><span class="lineNoCov">              0 :                         RETURN_FALSE;</span>
<span class="lineNum">    1723 </span>                :                 }
<span class="lineNum">    1724 </span><span class="lineNoCov">              0 :                 needle_char[1] = 0;</span>
<span class="lineNum">    1725 </span>                : 
<span class="lineNum">    1726 </span><span class="lineNoCov">              0 :                 found = php_stristr(haystack_dup, needle_char,  haystack_len, 1);</span>
<span class="lineNum">    1727 </span>                :         }
<span class="lineNum">    1728 </span>                : 
<span class="lineNum">    1729 </span><span class="lineNoCov">              0 :         if (found) {</span>
<span class="lineNum">    1730 </span><span class="lineNoCov">              0 :                 found_offset = found - haystack_dup;</span>
<span class="lineNum">    1731 </span><span class="lineNoCov">              0 :                 if (part) {</span>
<span class="lineNum">    1732 </span><span class="lineNoCov">              0 :                         RETVAL_STRINGL(haystack, found_offset, 1);</span>
<span class="lineNum">    1733 </span>                :                 } else {
<span class="lineNum">    1734 </span><span class="lineNoCov">              0 :                         RETVAL_STRINGL(haystack + found_offset, haystack_len - found_offset, 1);</span>
<span class="lineNum">    1735 </span>                :                 }
<span class="lineNum">    1736 </span>                :         } else {
<span class="lineNum">    1737 </span><span class="lineNoCov">              0 :                 RETVAL_FALSE;</span>
<span class="lineNum">    1738 </span>                :         }
<span class="lineNum">    1739 </span>                : 
<span class="lineNum">    1740 </span><span class="lineNoCov">              0 :         efree(haystack_dup);</span>
<span class="lineNum">    1741 </span>                : }
<span class="lineNum">    1742 </span>                : /* }}} */
<span class="lineNum">    1743 </span>                : 
<a name="1744"><span class="lineNum">    1744 </span>                : /* {{{ proto string strstr(string haystack, string needle[, bool part])</a>
<span class="lineNum">    1745 </span>                :    Finds first occurrence of a string within another */
<span class="lineNum">    1746 </span><span class="lineNoCov">              0 : PHP_FUNCTION(strstr)</span>
<span class="lineNum">    1747 </span>                : {
<span class="lineNum">    1748 </span>                :         zval *needle;
<span class="lineNum">    1749 </span>                :         char *haystack;
<span class="lineNum">    1750 </span>                :         int haystack_len;
<span class="lineNum">    1751 </span><span class="lineNoCov">              0 :         char *found = NULL;</span>
<span class="lineNum">    1752 </span>                :         char needle_char[2];
<span class="lineNum">    1753 </span>                :         long found_offset;
<span class="lineNum">    1754 </span><span class="lineNoCov">              0 :         zend_bool part = 0;</span>
<span class="lineNum">    1755 </span>                : 
<span class="lineNum">    1756 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;sz|b&quot;, &amp;haystack, &amp;haystack_len, &amp;needle, &amp;part) == FAILURE) {</span>
<span class="lineNum">    1757 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    1758 </span>                :         }
<span class="lineNum">    1759 </span>                : 
<span class="lineNum">    1760 </span><span class="lineNoCov">              0 :         if (Z_TYPE_P(needle) == IS_STRING) {</span>
<span class="lineNum">    1761 </span><span class="lineNoCov">              0 :                 if (!Z_STRLEN_P(needle)) {</span>
<span class="lineNum">    1762 </span><span class="lineNoCov">              0 :                         php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Empty delimiter&quot;);</span>
<span class="lineNum">    1763 </span><span class="lineNoCov">              0 :                         RETURN_FALSE;</span>
<span class="lineNum">    1764 </span>                :                 }
<span class="lineNum">    1765 </span>                : 
<span class="lineNum">    1766 </span><span class="lineNoCov">              0 :                 found = php_memnstr(haystack, Z_STRVAL_P(needle), Z_STRLEN_P(needle), haystack + haystack_len);</span>
<span class="lineNum">    1767 </span>                :         } else {
<span class="lineNum">    1768 </span><span class="lineNoCov">              0 :                 if (php_needle_char(needle, needle_char TSRMLS_CC) != SUCCESS) {</span>
<span class="lineNum">    1769 </span><span class="lineNoCov">              0 :                         RETURN_FALSE;</span>
<span class="lineNum">    1770 </span>                :                 }
<span class="lineNum">    1771 </span><span class="lineNoCov">              0 :                 needle_char[1] = 0;</span>
<span class="lineNum">    1772 </span>                : 
<span class="lineNum">    1773 </span><span class="lineNoCov">              0 :                 found = php_memnstr(haystack, needle_char,      1, haystack + haystack_len);</span>
<span class="lineNum">    1774 </span>                :         }
<span class="lineNum">    1775 </span>                : 
<span class="lineNum">    1776 </span><span class="lineNoCov">              0 :         if (found) {</span>
<span class="lineNum">    1777 </span><span class="lineNoCov">              0 :                 found_offset = found - haystack;</span>
<span class="lineNum">    1778 </span><span class="lineNoCov">              0 :                 if (part) {</span>
<span class="lineNum">    1779 </span><span class="lineNoCov">              0 :                         RETURN_STRINGL(haystack, found_offset, 1);</span>
<span class="lineNum">    1780 </span>                :                 } else {
<span class="lineNum">    1781 </span><span class="lineNoCov">              0 :                         RETURN_STRINGL(found, haystack_len - found_offset, 1);</span>
<span class="lineNum">    1782 </span>                :                 }
<span class="lineNum">    1783 </span>                :         }
<span class="lineNum">    1784 </span><span class="lineNoCov">              0 :         RETURN_FALSE;</span>
<span class="lineNum">    1785 </span>                : }
<span class="lineNum">    1786 </span>                : /* }}} */
<span class="lineNum">    1787 </span>                : 
<span class="lineNum">    1788 </span>                : /* {{{ proto string strchr(string haystack, string needle)
<span class="lineNum">    1789 </span>                :    An alias for strstr */
<span class="lineNum">    1790 </span>                : /* }}} */
<span class="lineNum">    1791 </span>                : 
<a name="1792"><span class="lineNum">    1792 </span>                : /* {{{ proto int strpos(string haystack, string needle [, int offset])</a>
<span class="lineNum">    1793 </span>                :    Finds position of first occurrence of a string within another */
<span class="lineNum">    1794 </span><span class="lineCov">           1520 : PHP_FUNCTION(strpos)</span>
<span class="lineNum">    1795 </span>                : {
<span class="lineNum">    1796 </span>                :         zval *needle;
<span class="lineNum">    1797 </span>                :         char *haystack;
<span class="lineNum">    1798 </span><span class="lineCov">           1520 :         char *found = NULL;</span>
<span class="lineNum">    1799 </span>                :         char  needle_char[2];
<span class="lineNum">    1800 </span><span class="lineCov">           1520 :         long  offset = 0;</span>
<span class="lineNum">    1801 </span>                :         int   haystack_len;
<span class="lineNum">    1802 </span>                : 
<span class="lineNum">    1803 </span><span class="lineCov">           1520 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;sz|l&quot;, &amp;haystack, &amp;haystack_len, &amp;needle, &amp;offset) == FAILURE) {</span>
<span class="lineNum">    1804 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    1805 </span>                :         }
<span class="lineNum">    1806 </span>                : 
<span class="lineNum">    1807 </span><span class="lineCov">           1520 :         if (offset &lt; 0 || offset &gt; haystack_len) {</span>
<span class="lineNum">    1808 </span><span class="lineNoCov">              0 :                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Offset not contained in string&quot;);</span>
<span class="lineNum">    1809 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    1810 </span>                :         }
<span class="lineNum">    1811 </span>                : 
<span class="lineNum">    1812 </span><span class="lineCov">           1520 :         if (Z_TYPE_P(needle) == IS_STRING) {</span>
<span class="lineNum">    1813 </span><span class="lineCov">           1520 :                 if (!Z_STRLEN_P(needle)) {</span>
<span class="lineNum">    1814 </span><span class="lineNoCov">              0 :                         php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Empty delimiter&quot;);</span>
<span class="lineNum">    1815 </span><span class="lineNoCov">              0 :                         RETURN_FALSE;</span>
<span class="lineNum">    1816 </span>                :                 }
<span class="lineNum">    1817 </span>                : 
<span class="lineNum">    1818 </span><span class="lineCov">           6080 :                 found = php_memnstr(haystack + offset,</span>
<span class="lineNum">    1819 </span><span class="lineCov">           1520 :                                         Z_STRVAL_P(needle),</span>
<span class="lineNum">    1820 </span><span class="lineCov">           1520 :                                         Z_STRLEN_P(needle),</span>
<span class="lineNum">    1821 </span><span class="lineCov">           1520 :                                         haystack + haystack_len);</span>
<span class="lineNum">    1822 </span>                :         } else {
<span class="lineNum">    1823 </span><span class="lineNoCov">              0 :                 if (php_needle_char(needle, needle_char TSRMLS_CC) != SUCCESS) {</span>
<span class="lineNum">    1824 </span><span class="lineNoCov">              0 :                         RETURN_FALSE;</span>
<span class="lineNum">    1825 </span>                :                 }
<span class="lineNum">    1826 </span><span class="lineNoCov">              0 :                 needle_char[1] = 0;</span>
<span class="lineNum">    1827 </span>                : 
<span class="lineNum">    1828 </span><span class="lineNoCov">              0 :                 found = php_memnstr(haystack + offset,</span>
<span class="lineNum">    1829 </span>                :                                                         needle_char,
<span class="lineNum">    1830 </span>                :                                                         1,
<span class="lineNum">    1831 </span><span class="lineNoCov">              0 :                                     haystack + haystack_len);</span>
<span class="lineNum">    1832 </span>                :         }
<span class="lineNum">    1833 </span>                : 
<span class="lineNum">    1834 </span><span class="lineCov">           1520 :         if (found) {</span>
<span class="lineNum">    1835 </span><span class="lineCov">           1088 :                 RETURN_LONG(found - haystack);</span>
<span class="lineNum">    1836 </span>                :         } else {
<span class="lineNum">    1837 </span><span class="lineCov">            432 :                 RETURN_FALSE;</span>
<span class="lineNum">    1838 </span>                :         }
<span class="lineNum">    1839 </span>                : }
<span class="lineNum">    1840 </span>                : /* }}} */
<span class="lineNum">    1841 </span>                : 
<a name="1842"><span class="lineNum">    1842 </span>                : /* {{{ proto int stripos(string haystack, string needle [, int offset])</a>
<span class="lineNum">    1843 </span>                :    Finds position of first occurrence of a string within another, case insensitive */
<span class="lineNum">    1844 </span><span class="lineNoCov">              0 : PHP_FUNCTION(stripos)</span>
<span class="lineNum">    1845 </span>                : {
<span class="lineNum">    1846 </span><span class="lineNoCov">              0 :         char *found = NULL;</span>
<span class="lineNum">    1847 </span>                :         char *haystack;
<span class="lineNum">    1848 </span>                :         int haystack_len;
<span class="lineNum">    1849 </span><span class="lineNoCov">              0 :         long offset = 0;</span>
<span class="lineNum">    1850 </span><span class="lineNoCov">              0 :         char *needle_dup = NULL, *haystack_dup;</span>
<span class="lineNum">    1851 </span>                :         char needle_char[2];
<span class="lineNum">    1852 </span>                :         zval *needle;
<span class="lineNum">    1853 </span>                : 
<span class="lineNum">    1854 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;sz|l&quot;, &amp;haystack, &amp;haystack_len, &amp;needle, &amp;offset) == FAILURE) {</span>
<span class="lineNum">    1855 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    1856 </span>                :         }
<span class="lineNum">    1857 </span>                : 
<span class="lineNum">    1858 </span><span class="lineNoCov">              0 :         if (offset &lt; 0 || offset &gt; haystack_len) {</span>
<span class="lineNum">    1859 </span><span class="lineNoCov">              0 :                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Offset not contained in string&quot;);</span>
<span class="lineNum">    1860 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    1861 </span>                :         }
<span class="lineNum">    1862 </span>                : 
<span class="lineNum">    1863 </span><span class="lineNoCov">              0 :         if (haystack_len == 0) {</span>
<span class="lineNum">    1864 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    1865 </span>                :         }
<span class="lineNum">    1866 </span>                : 
<span class="lineNum">    1867 </span><span class="lineNoCov">              0 :         haystack_dup = estrndup(haystack, haystack_len);</span>
<span class="lineNum">    1868 </span><span class="lineNoCov">              0 :         php_strtolower(haystack_dup, haystack_len);</span>
<span class="lineNum">    1869 </span>                : 
<span class="lineNum">    1870 </span><span class="lineNoCov">              0 :         if (Z_TYPE_P(needle) == IS_STRING) {</span>
<span class="lineNum">    1871 </span><span class="lineNoCov">              0 :                 if (Z_STRLEN_P(needle) == 0 || Z_STRLEN_P(needle) &gt; haystack_len) {</span>
<span class="lineNum">    1872 </span><span class="lineNoCov">              0 :                         efree(haystack_dup);</span>
<span class="lineNum">    1873 </span><span class="lineNoCov">              0 :                         RETURN_FALSE;</span>
<span class="lineNum">    1874 </span>                :                 }
<span class="lineNum">    1875 </span>                : 
<span class="lineNum">    1876 </span><span class="lineNoCov">              0 :                 needle_dup = estrndup(Z_STRVAL_P(needle), Z_STRLEN_P(needle));</span>
<span class="lineNum">    1877 </span><span class="lineNoCov">              0 :                 php_strtolower(needle_dup, Z_STRLEN_P(needle));</span>
<span class="lineNum">    1878 </span><span class="lineNoCov">              0 :                 found = php_memnstr(haystack_dup + offset, needle_dup, Z_STRLEN_P(needle), haystack_dup + haystack_len);</span>
<span class="lineNum">    1879 </span>                :         } else {
<span class="lineNum">    1880 </span><span class="lineNoCov">              0 :                 if (php_needle_char(needle, needle_char TSRMLS_CC) != SUCCESS) {</span>
<span class="lineNum">    1881 </span><span class="lineNoCov">              0 :                         efree(haystack_dup);</span>
<span class="lineNum">    1882 </span><span class="lineNoCov">              0 :                         RETURN_FALSE;</span>
<span class="lineNum">    1883 </span>                :                 }
<span class="lineNum">    1884 </span><span class="lineNoCov">              0 :                 needle_char[0] = tolower(needle_char[0]);</span>
<span class="lineNum">    1885 </span><span class="lineNoCov">              0 :                 needle_char[1] = '\0';</span>
<span class="lineNum">    1886 </span><span class="lineNoCov">              0 :                 found = php_memnstr(haystack_dup + offset,</span>
<span class="lineNum">    1887 </span>                :                                                         needle_char,
<span class="lineNum">    1888 </span>                :                                                         sizeof(needle_char) - 1,
<span class="lineNum">    1889 </span><span class="lineNoCov">              0 :                                                         haystack_dup + haystack_len);</span>
<span class="lineNum">    1890 </span>                :         }
<span class="lineNum">    1891 </span>                : 
<span class="lineNum">    1892 </span><span class="lineNoCov">              0 :         efree(haystack_dup);</span>
<span class="lineNum">    1893 </span><span class="lineNoCov">              0 :         if (needle_dup) {</span>
<span class="lineNum">    1894 </span><span class="lineNoCov">              0 :                 efree(needle_dup);</span>
<span class="lineNum">    1895 </span>                :         }
<span class="lineNum">    1896 </span>                : 
<span class="lineNum">    1897 </span><span class="lineNoCov">              0 :         if (found) {</span>
<span class="lineNum">    1898 </span><span class="lineNoCov">              0 :                 RETURN_LONG(found - haystack_dup);</span>
<span class="lineNum">    1899 </span>                :         } else {
<span class="lineNum">    1900 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    1901 </span>                :         }
<span class="lineNum">    1902 </span>                : }
<span class="lineNum">    1903 </span>                : /* }}} */
<span class="lineNum">    1904 </span>                : 
<a name="1905"><span class="lineNum">    1905 </span>                : /* {{{ proto int strrpos(string haystack, string needle [, int offset])</a>
<span class="lineNum">    1906 </span>                :    Finds position of last occurrence of a string within another string */
<span class="lineNum">    1907 </span><span class="lineNoCov">              0 : PHP_FUNCTION(strrpos)</span>
<span class="lineNum">    1908 </span>                : {
<span class="lineNum">    1909 </span>                :         zval *zneedle;
<span class="lineNum">    1910 </span>                :         char *needle, *haystack;
<span class="lineNum">    1911 </span>                :         int needle_len, haystack_len;
<span class="lineNum">    1912 </span><span class="lineNoCov">              0 :         long offset = 0;</span>
<span class="lineNum">    1913 </span>                :         char *p, *e, ord_needle[2];
<span class="lineNum">    1914 </span>                : 
<span class="lineNum">    1915 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;sz|l&quot;, &amp;haystack, &amp;haystack_len, &amp;zneedle, &amp;offset) == FAILURE) {</span>
<span class="lineNum">    1916 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    1917 </span>                :         }
<span class="lineNum">    1918 </span>                : 
<span class="lineNum">    1919 </span><span class="lineNoCov">              0 :         if (Z_TYPE_P(zneedle) == IS_STRING) {</span>
<span class="lineNum">    1920 </span><span class="lineNoCov">              0 :                 needle = Z_STRVAL_P(zneedle);</span>
<span class="lineNum">    1921 </span><span class="lineNoCov">              0 :                 needle_len = Z_STRLEN_P(zneedle);</span>
<span class="lineNum">    1922 </span>                :         } else {
<span class="lineNum">    1923 </span><span class="lineNoCov">              0 :                 if (php_needle_char(zneedle, ord_needle TSRMLS_CC) != SUCCESS) {</span>
<span class="lineNum">    1924 </span><span class="lineNoCov">              0 :                         RETURN_FALSE;</span>
<span class="lineNum">    1925 </span>                :                 }
<span class="lineNum">    1926 </span><span class="lineNoCov">              0 :                 ord_needle[1] = '\0';</span>
<span class="lineNum">    1927 </span><span class="lineNoCov">              0 :                 needle = ord_needle;</span>
<span class="lineNum">    1928 </span><span class="lineNoCov">              0 :                 needle_len = 1;</span>
<span class="lineNum">    1929 </span>                :         }
<span class="lineNum">    1930 </span>                : 
<span class="lineNum">    1931 </span><span class="lineNoCov">              0 :         if ((haystack_len == 0) || (needle_len == 0)) {</span>
<span class="lineNum">    1932 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    1933 </span>                :         }
<span class="lineNum">    1934 </span>                : 
<span class="lineNum">    1935 </span><span class="lineNoCov">              0 :         if (offset &gt;= 0) {</span>
<span class="lineNum">    1936 </span><span class="lineNoCov">              0 :                 if (offset &gt; haystack_len) {</span>
<span class="lineNum">    1937 </span><span class="lineNoCov">              0 :                         php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Offset is greater than the length of haystack string&quot;);</span>
<span class="lineNum">    1938 </span><span class="lineNoCov">              0 :                         RETURN_FALSE;</span>
<span class="lineNum">    1939 </span>                :                 }
<span class="lineNum">    1940 </span><span class="lineNoCov">              0 :                 p = haystack + offset;</span>
<span class="lineNum">    1941 </span><span class="lineNoCov">              0 :                 e = haystack + haystack_len - needle_len;</span>
<span class="lineNum">    1942 </span>                :         } else {
<span class="lineNum">    1943 </span><span class="lineNoCov">              0 :                 if (offset &lt; -INT_MAX || -offset &gt; haystack_len) {</span>
<span class="lineNum">    1944 </span><span class="lineNoCov">              0 :                         php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Offset is greater than the length of haystack string&quot;);</span>
<span class="lineNum">    1945 </span><span class="lineNoCov">              0 :                         RETURN_FALSE;</span>
<span class="lineNum">    1946 </span>                :                 }
<span class="lineNum">    1947 </span>                : 
<span class="lineNum">    1948 </span><span class="lineNoCov">              0 :                 p = haystack;</span>
<span class="lineNum">    1949 </span><span class="lineNoCov">              0 :                 if (needle_len &gt; -offset) {</span>
<span class="lineNum">    1950 </span><span class="lineNoCov">              0 :                         e = haystack + haystack_len - needle_len;</span>
<span class="lineNum">    1951 </span>                :                 } else {
<span class="lineNum">    1952 </span><span class="lineNoCov">              0 :                         e = haystack + haystack_len + offset;</span>
<span class="lineNum">    1953 </span>                :                 }
<span class="lineNum">    1954 </span>                :         }
<span class="lineNum">    1955 </span>                : 
<span class="lineNum">    1956 </span><span class="lineNoCov">              0 :         if (needle_len == 1) {</span>
<span class="lineNum">    1957 </span>                :                 /* Single character search can shortcut memcmps */
<span class="lineNum">    1958 </span><span class="lineNoCov">              0 :                 while (e &gt;= p) {</span>
<span class="lineNum">    1959 </span><span class="lineNoCov">              0 :                         if (*e == *needle) {</span>
<span class="lineNum">    1960 </span><span class="lineNoCov">              0 :                                 RETURN_LONG(e - p + (offset &gt; 0 ? offset : 0));</span>
<span class="lineNum">    1961 </span>                :                         }
<span class="lineNum">    1962 </span><span class="lineNoCov">              0 :                         e--;</span>
<span class="lineNum">    1963 </span>                :                 }
<span class="lineNum">    1964 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    1965 </span>                :         }
<span class="lineNum">    1966 </span>                : 
<span class="lineNum">    1967 </span><span class="lineNoCov">              0 :         while (e &gt;= p) {</span>
<span class="lineNum">    1968 </span><span class="lineNoCov">              0 :                 if (memcmp(e, needle, needle_len) == 0) {</span>
<span class="lineNum">    1969 </span><span class="lineNoCov">              0 :                         RETURN_LONG(e - p + (offset &gt; 0 ? offset : 0));</span>
<span class="lineNum">    1970 </span>                :                 }
<span class="lineNum">    1971 </span><span class="lineNoCov">              0 :                 e--;</span>
<span class="lineNum">    1972 </span>                :         }
<span class="lineNum">    1973 </span>                : 
<span class="lineNum">    1974 </span><span class="lineNoCov">              0 :         RETURN_FALSE;</span>
<span class="lineNum">    1975 </span>                : }
<span class="lineNum">    1976 </span>                : /* }}} */
<span class="lineNum">    1977 </span>                : 
<a name="1978"><span class="lineNum">    1978 </span>                : /* {{{ proto int strripos(string haystack, string needle [, int offset])</a>
<span class="lineNum">    1979 </span>                :    Finds position of last occurrence of a string within another string */
<span class="lineNum">    1980 </span><span class="lineNoCov">              0 : PHP_FUNCTION(strripos)</span>
<span class="lineNum">    1981 </span>                : {
<span class="lineNum">    1982 </span>                :         zval *zneedle;
<span class="lineNum">    1983 </span>                :         char *needle, *haystack;
<span class="lineNum">    1984 </span>                :         int needle_len, haystack_len;
<span class="lineNum">    1985 </span><span class="lineNoCov">              0 :         long offset = 0;</span>
<span class="lineNum">    1986 </span>                :         char *p, *e, ord_needle[2];
<span class="lineNum">    1987 </span>                :         char *needle_dup, *haystack_dup;
<span class="lineNum">    1988 </span>                : 
<span class="lineNum">    1989 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;sz|l&quot;, &amp;haystack, &amp;haystack_len, &amp;zneedle, &amp;offset) == FAILURE) {</span>
<span class="lineNum">    1990 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    1991 </span>                :         }
<span class="lineNum">    1992 </span>                : 
<span class="lineNum">    1993 </span><span class="lineNoCov">              0 :         if (Z_TYPE_P(zneedle) == IS_STRING) {</span>
<span class="lineNum">    1994 </span><span class="lineNoCov">              0 :                 needle = Z_STRVAL_P(zneedle);</span>
<span class="lineNum">    1995 </span><span class="lineNoCov">              0 :                 needle_len = Z_STRLEN_P(zneedle);</span>
<span class="lineNum">    1996 </span>                :         } else {
<span class="lineNum">    1997 </span><span class="lineNoCov">              0 :                 if (php_needle_char(zneedle, ord_needle TSRMLS_CC) != SUCCESS) {</span>
<span class="lineNum">    1998 </span><span class="lineNoCov">              0 :                         RETURN_FALSE;</span>
<span class="lineNum">    1999 </span>                :                 }
<span class="lineNum">    2000 </span><span class="lineNoCov">              0 :                 ord_needle[1] = '\0';</span>
<span class="lineNum">    2001 </span><span class="lineNoCov">              0 :                 needle = ord_needle;</span>
<span class="lineNum">    2002 </span><span class="lineNoCov">              0 :                 needle_len = 1;</span>
<span class="lineNum">    2003 </span>                :         }
<span class="lineNum">    2004 </span>                : 
<span class="lineNum">    2005 </span><span class="lineNoCov">              0 :         if ((haystack_len == 0) || (needle_len == 0)) {</span>
<span class="lineNum">    2006 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    2007 </span>                :         }
<span class="lineNum">    2008 </span>                : 
<span class="lineNum">    2009 </span><span class="lineNoCov">              0 :         if (needle_len == 1) {</span>
<span class="lineNum">    2010 </span>                :                 /* Single character search can shortcut memcmps
<span class="lineNum">    2011 </span>                :                    Can also avoid tolower emallocs */
<span class="lineNum">    2012 </span><span class="lineNoCov">              0 :                 if (offset &gt;= 0) {</span>
<span class="lineNum">    2013 </span><span class="lineNoCov">              0 :                         if (offset &gt; haystack_len) {</span>
<span class="lineNum">    2014 </span><span class="lineNoCov">              0 :                                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Offset is greater than the length of haystack string&quot;);</span>
<span class="lineNum">    2015 </span><span class="lineNoCov">              0 :                                 RETURN_FALSE;</span>
<span class="lineNum">    2016 </span>                :                         }
<span class="lineNum">    2017 </span><span class="lineNoCov">              0 :                         p = haystack + offset;</span>
<span class="lineNum">    2018 </span><span class="lineNoCov">              0 :                         e = haystack + haystack_len - 1;</span>
<span class="lineNum">    2019 </span>                :                 } else {
<span class="lineNum">    2020 </span><span class="lineNoCov">              0 :                         p = haystack;</span>
<span class="lineNum">    2021 </span><span class="lineNoCov">              0 :                         if (offset &lt; -INT_MAX || -offset &gt; haystack_len) {</span>
<span class="lineNum">    2022 </span><span class="lineNoCov">              0 :                                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Offset is greater than the length of haystack string&quot;);</span>
<span class="lineNum">    2023 </span><span class="lineNoCov">              0 :                                 RETURN_FALSE;</span>
<span class="lineNum">    2024 </span>                :                         }
<span class="lineNum">    2025 </span><span class="lineNoCov">              0 :                         e = haystack + haystack_len + offset;</span>
<span class="lineNum">    2026 </span>                :                 }
<span class="lineNum">    2027 </span>                :                 /* Borrow that ord_needle buffer to avoid repeatedly tolower()ing needle */
<span class="lineNum">    2028 </span><span class="lineNoCov">              0 :                 *ord_needle = tolower(*needle);</span>
<span class="lineNum">    2029 </span><span class="lineNoCov">              0 :                 while (e &gt;= p) {</span>
<span class="lineNum">    2030 </span><span class="lineNoCov">              0 :                         if (tolower(*e) == *ord_needle) {</span>
<span class="lineNum">    2031 </span><span class="lineNoCov">              0 :                                 RETURN_LONG(e - p + (offset &gt; 0 ? offset : 0));</span>
<span class="lineNum">    2032 </span>                :                         }
<span class="lineNum">    2033 </span><span class="lineNoCov">              0 :                         e--;</span>
<span class="lineNum">    2034 </span>                :                 }
<span class="lineNum">    2035 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    2036 </span>                :         }
<span class="lineNum">    2037 </span>                : 
<span class="lineNum">    2038 </span><span class="lineNoCov">              0 :         needle_dup = estrndup(needle, needle_len);</span>
<span class="lineNum">    2039 </span><span class="lineNoCov">              0 :         php_strtolower(needle_dup, needle_len);</span>
<span class="lineNum">    2040 </span><span class="lineNoCov">              0 :         haystack_dup = estrndup(haystack, haystack_len);</span>
<span class="lineNum">    2041 </span><span class="lineNoCov">              0 :         php_strtolower(haystack_dup, haystack_len);</span>
<span class="lineNum">    2042 </span>                : 
<span class="lineNum">    2043 </span><span class="lineNoCov">              0 :         if (offset &gt;= 0) {</span>
<span class="lineNum">    2044 </span><span class="lineNoCov">              0 :                 if (offset &gt; haystack_len) {</span>
<span class="lineNum">    2045 </span><span class="lineNoCov">              0 :                         efree(needle_dup);</span>
<span class="lineNum">    2046 </span><span class="lineNoCov">              0 :                         efree(haystack_dup);</span>
<span class="lineNum">    2047 </span><span class="lineNoCov">              0 :                         php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Offset is greater than the length of haystack string&quot;);</span>
<span class="lineNum">    2048 </span><span class="lineNoCov">              0 :                         RETURN_FALSE;</span>
<span class="lineNum">    2049 </span>                :                 }
<span class="lineNum">    2050 </span><span class="lineNoCov">              0 :                 p = haystack_dup + offset;</span>
<span class="lineNum">    2051 </span><span class="lineNoCov">              0 :                 e = haystack_dup + haystack_len - needle_len;</span>
<span class="lineNum">    2052 </span>                :         } else {
<span class="lineNum">    2053 </span><span class="lineNoCov">              0 :                 if (offset &lt; -INT_MAX || -offset &gt; haystack_len) {</span>
<span class="lineNum">    2054 </span><span class="lineNoCov">              0 :                         efree(needle_dup);</span>
<span class="lineNum">    2055 </span><span class="lineNoCov">              0 :                         efree(haystack_dup);</span>
<span class="lineNum">    2056 </span><span class="lineNoCov">              0 :                         php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Offset is greater than the length of haystack string&quot;);</span>
<span class="lineNum">    2057 </span><span class="lineNoCov">              0 :                         RETURN_FALSE;</span>
<span class="lineNum">    2058 </span>                :                 }
<span class="lineNum">    2059 </span><span class="lineNoCov">              0 :                 p = haystack_dup;</span>
<span class="lineNum">    2060 </span><span class="lineNoCov">              0 :                 if (needle_len &gt; -offset) {</span>
<span class="lineNum">    2061 </span><span class="lineNoCov">              0 :                         e = haystack_dup + haystack_len - needle_len;</span>
<span class="lineNum">    2062 </span>                :                 } else {
<span class="lineNum">    2063 </span><span class="lineNoCov">              0 :                         e = haystack_dup + haystack_len + offset;</span>
<span class="lineNum">    2064 </span>                :                 }
<span class="lineNum">    2065 </span>                :         }
<span class="lineNum">    2066 </span>                : 
<span class="lineNum">    2067 </span><span class="lineNoCov">              0 :         while (e &gt;= p) {</span>
<span class="lineNum">    2068 </span><span class="lineNoCov">              0 :                 if (memcmp(e, needle_dup, needle_len) == 0) {</span>
<span class="lineNum">    2069 </span><span class="lineNoCov">              0 :                         efree(haystack_dup);</span>
<span class="lineNum">    2070 </span><span class="lineNoCov">              0 :                         efree(needle_dup);</span>
<span class="lineNum">    2071 </span><span class="lineNoCov">              0 :                         RETURN_LONG(e - p + (offset &gt; 0 ? offset : 0));</span>
<span class="lineNum">    2072 </span>                :                 }
<span class="lineNum">    2073 </span><span class="lineNoCov">              0 :                 e--;</span>
<span class="lineNum">    2074 </span>                :         }
<span class="lineNum">    2075 </span>                : 
<span class="lineNum">    2076 </span><span class="lineNoCov">              0 :         efree(haystack_dup);</span>
<span class="lineNum">    2077 </span><span class="lineNoCov">              0 :         efree(needle_dup);</span>
<span class="lineNum">    2078 </span><span class="lineNoCov">              0 :         RETURN_FALSE;</span>
<span class="lineNum">    2079 </span>                : }
<span class="lineNum">    2080 </span>                : /* }}} */
<span class="lineNum">    2081 </span>                : 
<a name="2082"><span class="lineNum">    2082 </span>                : /* {{{ proto string strrchr(string haystack, string needle)</a>
<span class="lineNum">    2083 </span>                :    Finds the last occurrence of a character in a string within another */
<span class="lineNum">    2084 </span><span class="lineNoCov">              0 : PHP_FUNCTION(strrchr)</span>
<span class="lineNum">    2085 </span>                : {
<span class="lineNum">    2086 </span>                :         zval *needle;
<span class="lineNum">    2087 </span>                :         char *haystack;
<span class="lineNum">    2088 </span><span class="lineNoCov">              0 :         const char *found = NULL;</span>
<span class="lineNum">    2089 </span>                :         long found_offset;
<span class="lineNum">    2090 </span>                :         int  haystack_len;
<span class="lineNum">    2091 </span>                : 
<span class="lineNum">    2092 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;sz&quot;, &amp;haystack, &amp;haystack_len, &amp;needle) == FAILURE) {</span>
<span class="lineNum">    2093 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    2094 </span>                :         }
<span class="lineNum">    2095 </span>                : 
<span class="lineNum">    2096 </span><span class="lineNoCov">              0 :         if (Z_TYPE_P(needle) == IS_STRING) {</span>
<span class="lineNum">    2097 </span><span class="lineNoCov">              0 :                 found = zend_memrchr(haystack, *Z_STRVAL_P(needle), haystack_len);</span>
<span class="lineNum">    2098 </span>                :         } else {
<span class="lineNum">    2099 </span>                :                 char needle_chr;
<span class="lineNum">    2100 </span><span class="lineNoCov">              0 :                 if (php_needle_char(needle, &amp;needle_chr TSRMLS_CC) != SUCCESS) {</span>
<span class="lineNum">    2101 </span><span class="lineNoCov">              0 :                         RETURN_FALSE;</span>
<span class="lineNum">    2102 </span>                :                 }
<span class="lineNum">    2103 </span>                : 
<span class="lineNum">    2104 </span><span class="lineNoCov">              0 :                 found = zend_memrchr(haystack,  needle_chr, haystack_len);</span>
<span class="lineNum">    2105 </span>                :         }
<span class="lineNum">    2106 </span>                : 
<span class="lineNum">    2107 </span><span class="lineNoCov">              0 :         if (found) {</span>
<span class="lineNum">    2108 </span><span class="lineNoCov">              0 :                 found_offset = found - haystack;</span>
<span class="lineNum">    2109 </span><span class="lineNoCov">              0 :                 RETURN_STRINGL(found, haystack_len - found_offset, 1);</span>
<span class="lineNum">    2110 </span>                :         } else {
<span class="lineNum">    2111 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    2112 </span>                :         }
<span class="lineNum">    2113 </span>                : }
<span class="lineNum">    2114 </span>                : /* }}} */
<span class="lineNum">    2115 </span>                : 
<a name="2116"><span class="lineNum">    2116 </span>                : /* {{{ php_chunk_split</a>
<span class="lineNum">    2117 </span>                :  */
<span class="lineNum">    2118 </span><span class="lineNoCov">              0 : static char *php_chunk_split(char *src, int srclen, char *end, int endlen, int chunklen, int *destlen)</span>
<span class="lineNum">    2119 </span>                : {
<span class="lineNum">    2120 </span>                :         char *dest;
<span class="lineNum">    2121 </span>                :         char *p, *q;
<span class="lineNum">    2122 </span>                :         int chunks; /* complete chunks! */
<span class="lineNum">    2123 </span>                :         int restlen;
<span class="lineNum">    2124 </span>                :         int out_len;
<span class="lineNum">    2125 </span>                : 
<span class="lineNum">    2126 </span><span class="lineNoCov">              0 :         chunks = srclen / chunklen;</span>
<span class="lineNum">    2127 </span><span class="lineNoCov">              0 :         restlen = srclen - chunks * chunklen; /* srclen % chunklen */</span>
<span class="lineNum">    2128 </span>                : 
<span class="lineNum">    2129 </span><span class="lineNoCov">              0 :         if(chunks &gt; INT_MAX - 1) {</span>
<span class="lineNum">    2130 </span><span class="lineNoCov">              0 :                 return NULL;</span>
<span class="lineNum">    2131 </span>                :         }
<span class="lineNum">    2132 </span><span class="lineNoCov">              0 :         out_len = chunks + 1;</span>
<span class="lineNum">    2133 </span><span class="lineNoCov">              0 :         if(endlen !=0 &amp;&amp; out_len &gt; INT_MAX/endlen) {</span>
<span class="lineNum">    2134 </span><span class="lineNoCov">              0 :                 return NULL;</span>
<span class="lineNum">    2135 </span>                :         }
<span class="lineNum">    2136 </span><span class="lineNoCov">              0 :         out_len *= endlen;</span>
<span class="lineNum">    2137 </span><span class="lineNoCov">              0 :         if(out_len &gt; INT_MAX - srclen - 1) {</span>
<span class="lineNum">    2138 </span><span class="lineNoCov">              0 :                 return NULL;</span>
<span class="lineNum">    2139 </span>                :         }
<span class="lineNum">    2140 </span><span class="lineNoCov">              0 :         out_len += srclen + 1;</span>
<span class="lineNum">    2141 </span>                : 
<span class="lineNum">    2142 </span><span class="lineNoCov">              0 :         dest = safe_emalloc((int)out_len, sizeof(char), 0);</span>
<span class="lineNum">    2143 </span>                : 
<span class="lineNum">    2144 </span><span class="lineNoCov">              0 :         for (p = src, q = dest; p &lt; (src + srclen - chunklen + 1); ) {</span>
<span class="lineNum">    2145 </span><span class="lineNoCov">              0 :                 memcpy(q, p, chunklen);</span>
<span class="lineNum">    2146 </span><span class="lineNoCov">              0 :                 q += chunklen;</span>
<span class="lineNum">    2147 </span><span class="lineNoCov">              0 :                 memcpy(q, end, endlen);</span>
<span class="lineNum">    2148 </span><span class="lineNoCov">              0 :                 q += endlen;</span>
<span class="lineNum">    2149 </span><span class="lineNoCov">              0 :                 p += chunklen;</span>
<span class="lineNum">    2150 </span>                :         }
<span class="lineNum">    2151 </span>                : 
<span class="lineNum">    2152 </span><span class="lineNoCov">              0 :         if (restlen) {</span>
<span class="lineNum">    2153 </span><span class="lineNoCov">              0 :                 memcpy(q, p, restlen);</span>
<span class="lineNum">    2154 </span><span class="lineNoCov">              0 :                 q += restlen;</span>
<span class="lineNum">    2155 </span><span class="lineNoCov">              0 :                 memcpy(q, end, endlen);</span>
<span class="lineNum">    2156 </span><span class="lineNoCov">              0 :                 q += endlen;</span>
<span class="lineNum">    2157 </span>                :         }
<span class="lineNum">    2158 </span>                : 
<span class="lineNum">    2159 </span><span class="lineNoCov">              0 :         *q = '\0';</span>
<span class="lineNum">    2160 </span><span class="lineNoCov">              0 :         if (destlen) {</span>
<span class="lineNum">    2161 </span><span class="lineNoCov">              0 :                 *destlen = q - dest;</span>
<span class="lineNum">    2162 </span>                :         }
<span class="lineNum">    2163 </span>                : 
<span class="lineNum">    2164 </span><span class="lineNoCov">              0 :         return(dest);</span>
<span class="lineNum">    2165 </span>                : }
<span class="lineNum">    2166 </span>                : /* }}} */
<span class="lineNum">    2167 </span>                : 
<a name="2168"><span class="lineNum">    2168 </span>                : /* {{{ proto string chunk_split(string str [, int chunklen [, string ending]])</a>
<span class="lineNum">    2169 </span>                :    Returns split line */
<span class="lineNum">    2170 </span><span class="lineNoCov">              0 : PHP_FUNCTION(chunk_split)</span>
<span class="lineNum">    2171 </span>                : {
<span class="lineNum">    2172 </span>                :         char *str;
<span class="lineNum">    2173 </span>                :         char *result;
<span class="lineNum">    2174 </span><span class="lineNoCov">              0 :         char *end    = &quot;\r\n&quot;;</span>
<span class="lineNum">    2175 </span><span class="lineNoCov">              0 :         int endlen   = 2;</span>
<span class="lineNum">    2176 </span><span class="lineNoCov">              0 :         long chunklen = 76;</span>
<span class="lineNum">    2177 </span>                :         int result_len;
<span class="lineNum">    2178 </span>                :         int str_len;
<span class="lineNum">    2179 </span>                : 
<span class="lineNum">    2180 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s|ls&quot;, &amp;str, &amp;str_len, &amp;chunklen, &amp;end, &amp;endlen) == FAILURE) {</span>
<span class="lineNum">    2181 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    2182 </span>                :         }
<span class="lineNum">    2183 </span>                : 
<span class="lineNum">    2184 </span><span class="lineNoCov">              0 :         if (chunklen &lt;= 0) {</span>
<span class="lineNum">    2185 </span><span class="lineNoCov">              0 :                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Chunk length should be greater than zero&quot;);</span>
<span class="lineNum">    2186 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    2187 </span>                :         }
<span class="lineNum">    2188 </span>                : 
<span class="lineNum">    2189 </span><span class="lineNoCov">              0 :         if (chunklen &gt; str_len) {</span>
<span class="lineNum">    2190 </span>                :                 /* to maintain BC, we must return original string + ending */
<span class="lineNum">    2191 </span><span class="lineNoCov">              0 :                 result_len = endlen + str_len;</span>
<span class="lineNum">    2192 </span><span class="lineNoCov">              0 :                 result = emalloc(result_len + 1);</span>
<span class="lineNum">    2193 </span><span class="lineNoCov">              0 :                 memcpy(result, str, str_len);</span>
<span class="lineNum">    2194 </span><span class="lineNoCov">              0 :                 memcpy(result + str_len, end, endlen);</span>
<span class="lineNum">    2195 </span><span class="lineNoCov">              0 :                 result[result_len] = '\0';</span>
<span class="lineNum">    2196 </span><span class="lineNoCov">              0 :                 RETURN_STRINGL(result, result_len, 0);</span>
<span class="lineNum">    2197 </span>                :         }
<span class="lineNum">    2198 </span>                : 
<span class="lineNum">    2199 </span><span class="lineNoCov">              0 :         if (!str_len) {</span>
<span class="lineNum">    2200 </span><span class="lineNoCov">              0 :                 RETURN_EMPTY_STRING();</span>
<span class="lineNum">    2201 </span>                :         }
<span class="lineNum">    2202 </span>                : 
<span class="lineNum">    2203 </span><span class="lineNoCov">              0 :         result = php_chunk_split(str, str_len, end, endlen, chunklen, &amp;result_len);</span>
<span class="lineNum">    2204 </span>                : 
<span class="lineNum">    2205 </span><span class="lineNoCov">              0 :         if (result) {</span>
<span class="lineNum">    2206 </span><span class="lineNoCov">              0 :                 RETURN_STRINGL(result, result_len, 0);</span>
<span class="lineNum">    2207 </span>                :         } else {
<span class="lineNum">    2208 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    2209 </span>                :         }
<span class="lineNum">    2210 </span>                : }
<span class="lineNum">    2211 </span>                : /* }}} */
<span class="lineNum">    2212 </span>                : 
<a name="2213"><span class="lineNum">    2213 </span>                : /* {{{ proto string substr(string str, int start [, int length])</a>
<span class="lineNum">    2214 </span>                :    Returns part of a string */
<span class="lineNum">    2215 </span><span class="lineCov">           3430 : PHP_FUNCTION(substr)</span>
<span class="lineNum">    2216 </span>                : {
<span class="lineNum">    2217 </span>                :         char *str;
<span class="lineNum">    2218 </span><span class="lineCov">           3430 :         long l = 0, f;</span>
<span class="lineNum">    2219 </span>                :         int str_len;
<span class="lineNum">    2220 </span><span class="lineCov">           3430 :         int argc = ZEND_NUM_ARGS();</span>
<span class="lineNum">    2221 </span>                : 
<span class="lineNum">    2222 </span><span class="lineCov">           3430 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;sl|l&quot;, &amp;str, &amp;str_len, &amp;f, &amp;l) == FAILURE) {</span>
<span class="lineNum">    2223 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    2224 </span>                :         }
<span class="lineNum">    2225 </span>                : 
<span class="lineNum">    2226 </span><span class="lineCov">           3430 :         if (argc &gt; 2) {</span>
<span class="lineNum">    2227 </span><span class="lineCov">           1066 :                 if ((l &lt; 0 &amp;&amp; -l &gt; str_len)) {</span>
<span class="lineNum">    2228 </span><span class="lineNoCov">              0 :                         RETURN_FALSE;</span>
<span class="lineNum">    2229 </span><span class="lineCov">           1066 :                 } else if (l &gt; str_len) {</span>
<span class="lineNum">    2230 </span><span class="lineNoCov">              0 :                         l = str_len;</span>
<span class="lineNum">    2231 </span>                :                 }
<span class="lineNum">    2232 </span>                :         } else {
<span class="lineNum">    2233 </span><span class="lineCov">           2364 :                 l = str_len;</span>
<span class="lineNum">    2234 </span>                :         }
<span class="lineNum">    2235 </span>                : 
<span class="lineNum">    2236 </span><span class="lineCov">           3430 :         if (f &gt; str_len) {</span>
<span class="lineNum">    2237 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    2238 </span><span class="lineCov">           3430 :         } else if (f &lt; 0 &amp;&amp; -f &gt; str_len) {</span>
<span class="lineNum">    2239 </span><span class="lineCov">            949 :                 f = 0;</span>
<span class="lineNum">    2240 </span>                :         }
<span class="lineNum">    2241 </span>                : 
<span class="lineNum">    2242 </span><span class="lineCov">           3430 :         if (l &lt; 0 &amp;&amp; (l + str_len - f) &lt; 0) {</span>
<span class="lineNum">    2243 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    2244 </span>                :         }
<span class="lineNum">    2245 </span>                : 
<span class="lineNum">    2246 </span>                :         /* if &quot;from&quot; position is negative, count start position from the end
<span class="lineNum">    2247 </span>                :          * of the string
<span class="lineNum">    2248 </span>                :          */
<span class="lineNum">    2249 </span><span class="lineCov">           3430 :         if (f &lt; 0) {</span>
<span class="lineNum">    2250 </span><span class="lineCov">           1415 :                 f = str_len + f;</span>
<span class="lineNum">    2251 </span><span class="lineCov">           1415 :                 if (f &lt; 0) {</span>
<span class="lineNum">    2252 </span><span class="lineNoCov">              0 :                         f = 0;</span>
<span class="lineNum">    2253 </span>                :                 }
<span class="lineNum">    2254 </span>                :         }
<span class="lineNum">    2255 </span>                : 
<span class="lineNum">    2256 </span>                :         /* if &quot;length&quot; position is negative, set it to the length
<span class="lineNum">    2257 </span>                :          * needed to stop that many chars from the end of the string
<span class="lineNum">    2258 </span>                :          */
<span class="lineNum">    2259 </span><span class="lineCov">           3430 :         if (l &lt; 0) {</span>
<span class="lineNum">    2260 </span><span class="lineNoCov">              0 :                 l = (str_len - f) + l;</span>
<span class="lineNum">    2261 </span><span class="lineNoCov">              0 :                 if (l &lt; 0) {</span>
<span class="lineNum">    2262 </span><span class="lineNoCov">              0 :                         l = 0;</span>
<span class="lineNum">    2263 </span>                :                 }
<span class="lineNum">    2264 </span>                :         }
<span class="lineNum">    2265 </span>                : 
<span class="lineNum">    2266 </span><span class="lineCov">           3430 :         if (f &gt;= str_len) {</span>
<span class="lineNum">    2267 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    2268 </span>                :         }
<span class="lineNum">    2269 </span>                : 
<span class="lineNum">    2270 </span><span class="lineCov">           3430 :         if ((f + l) &gt; str_len) {</span>
<span class="lineNum">    2271 </span><span class="lineCov">           1381 :                 l = str_len - f;</span>
<span class="lineNum">    2272 </span>                :         }
<span class="lineNum">    2273 </span>                : 
<span class="lineNum">    2274 </span><span class="lineCov">           3430 :         RETURN_STRINGL(str + f, l, 1);</span>
<span class="lineNum">    2275 </span>                : }
<span class="lineNum">    2276 </span>                : /* }}} */
<span class="lineNum">    2277 </span>                : 
<a name="2278"><span class="lineNum">    2278 </span>                : /* {{{ proto mixed substr_replace(mixed str, mixed repl, mixed start [, mixed length])</a>
<span class="lineNum">    2279 </span>                :    Replaces part of a string with another string */
<span class="lineNum">    2280 </span><span class="lineNoCov">              0 : PHP_FUNCTION(substr_replace)</span>
<span class="lineNum">    2281 </span>                : {
<span class="lineNum">    2282 </span>                :         zval **str;
<span class="lineNum">    2283 </span>                :         zval **from;
<span class="lineNum">    2284 </span><span class="lineNoCov">              0 :         zval **len = NULL;</span>
<span class="lineNum">    2285 </span>                :         zval **repl;
<span class="lineNum">    2286 </span>                :         char *result;
<span class="lineNum">    2287 </span>                :         int result_len;
<span class="lineNum">    2288 </span><span class="lineNoCov">              0 :         int l = 0;</span>
<span class="lineNum">    2289 </span>                :         int f;
<span class="lineNum">    2290 </span><span class="lineNoCov">              0 :         int argc = ZEND_NUM_ARGS();</span>
<span class="lineNum">    2291 </span>                : 
<span class="lineNum">    2292 </span>                :         HashPosition pos_str, pos_from, pos_repl, pos_len;
<span class="lineNum">    2293 </span><span class="lineNoCov">              0 :         zval **tmp_str = NULL, **tmp_from = NULL, **tmp_repl = NULL, **tmp_len= NULL;</span>
<span class="lineNum">    2294 </span>                : 
<span class="lineNum">    2295 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;ZZZ|Z&quot;, &amp;str, &amp;repl, &amp;from, &amp;len) == FAILURE) {</span>
<span class="lineNum">    2296 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    2297 </span>                :         }
<span class="lineNum">    2298 </span>                : 
<span class="lineNum">    2299 </span><span class="lineNoCov">              0 :         if (Z_TYPE_PP(str) != IS_ARRAY) {</span>
<span class="lineNum">    2300 </span><span class="lineNoCov">              0 :                 if (Z_ISREF_PP(str)) {</span>
<span class="lineNum">    2301 </span><span class="lineNoCov">              0 :                         SEPARATE_ZVAL(str);</span>
<span class="lineNum">    2302 </span>                :                 }
<span class="lineNum">    2303 </span><span class="lineNoCov">              0 :                 convert_to_string_ex(str);</span>
<span class="lineNum">    2304 </span>                :         }
<span class="lineNum">    2305 </span><span class="lineNoCov">              0 :         if (Z_TYPE_PP(repl) != IS_ARRAY) {</span>
<span class="lineNum">    2306 </span><span class="lineNoCov">              0 :                 if (Z_ISREF_PP(repl)) {</span>
<span class="lineNum">    2307 </span><span class="lineNoCov">              0 :                         SEPARATE_ZVAL(repl);</span>
<span class="lineNum">    2308 </span>                :                 }
<span class="lineNum">    2309 </span><span class="lineNoCov">              0 :                 convert_to_string_ex(repl);</span>
<span class="lineNum">    2310 </span>                :         }
<span class="lineNum">    2311 </span><span class="lineNoCov">              0 :         if (Z_TYPE_PP(from) != IS_ARRAY) {</span>
<span class="lineNum">    2312 </span><span class="lineNoCov">              0 :                 if (Z_ISREF_PP(from)) {</span>
<span class="lineNum">    2313 </span><span class="lineNoCov">              0 :                         SEPARATE_ZVAL(from);</span>
<span class="lineNum">    2314 </span>                :                 }
<span class="lineNum">    2315 </span><span class="lineNoCov">              0 :                 convert_to_long_ex(from);</span>
<span class="lineNum">    2316 </span>                :         }
<span class="lineNum">    2317 </span>                : 
<span class="lineNum">    2318 </span><span class="lineNoCov">              0 :         if (argc &gt; 3) {</span>
<span class="lineNum">    2319 </span><span class="lineNoCov">              0 :                 SEPARATE_ZVAL(len);</span>
<span class="lineNum">    2320 </span><span class="lineNoCov">              0 :                 if (Z_TYPE_PP(len) != IS_ARRAY) {</span>
<span class="lineNum">    2321 </span><span class="lineNoCov">              0 :                         convert_to_long_ex(len);</span>
<span class="lineNum">    2322 </span><span class="lineNoCov">              0 :                         l = Z_LVAL_PP(len);</span>
<span class="lineNum">    2323 </span>                :                 }
<span class="lineNum">    2324 </span>                :         } else {
<span class="lineNum">    2325 </span><span class="lineNoCov">              0 :                 if (Z_TYPE_PP(str) != IS_ARRAY) {</span>
<span class="lineNum">    2326 </span><span class="lineNoCov">              0 :                         l = Z_STRLEN_PP(str);</span>
<span class="lineNum">    2327 </span>                :                 }
<span class="lineNum">    2328 </span>                :         }
<span class="lineNum">    2329 </span>                : 
<span class="lineNum">    2330 </span><span class="lineNoCov">              0 :         if (Z_TYPE_PP(str) == IS_STRING) {</span>
<span class="lineNum">    2331 </span><span class="lineNoCov">              0 :                 if (</span>
<span class="lineNum">    2332 </span><span class="lineNoCov">              0 :                         (argc == 3 &amp;&amp; Z_TYPE_PP(from) == IS_ARRAY) ||</span>
<span class="lineNum">    2333 </span><span class="lineNoCov">              0 :                         (argc == 4 &amp;&amp; Z_TYPE_PP(from) != Z_TYPE_PP(len))</span>
<span class="lineNum">    2334 </span>                :                 ) {
<span class="lineNum">    2335 </span><span class="lineNoCov">              0 :                         php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;'from' and 'len' should be of same type - numerical or array &quot;);</span>
<span class="lineNum">    2336 </span><span class="lineNoCov">              0 :                         RETURN_STRINGL(Z_STRVAL_PP(str), Z_STRLEN_PP(str), 1);</span>
<span class="lineNum">    2337 </span>                :                 }
<span class="lineNum">    2338 </span><span class="lineNoCov">              0 :                 if (argc == 4 &amp;&amp; Z_TYPE_PP(from) == IS_ARRAY) {</span>
<span class="lineNum">    2339 </span><span class="lineNoCov">              0 :                         if (zend_hash_num_elements(Z_ARRVAL_PP(from)) != zend_hash_num_elements(Z_ARRVAL_PP(len))) {</span>
<span class="lineNum">    2340 </span><span class="lineNoCov">              0 :                                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;'from' and 'len' should have the same number of elements&quot;);</span>
<span class="lineNum">    2341 </span><span class="lineNoCov">              0 :                                 RETURN_STRINGL(Z_STRVAL_PP(str), Z_STRLEN_PP(str), 1);</span>
<span class="lineNum">    2342 </span>                :                         }
<span class="lineNum">    2343 </span>                :                 }
<span class="lineNum">    2344 </span>                :         }
<span class="lineNum">    2345 </span>                : 
<span class="lineNum">    2346 </span><span class="lineNoCov">              0 :         if (Z_TYPE_PP(str) != IS_ARRAY) {</span>
<span class="lineNum">    2347 </span><span class="lineNoCov">              0 :                 if (Z_TYPE_PP(from) != IS_ARRAY) {</span>
<span class="lineNum">    2348 </span><span class="lineNoCov">              0 :                         int repl_len = 0;</span>
<span class="lineNum">    2349 </span>                : 
<span class="lineNum">    2350 </span><span class="lineNoCov">              0 :                         f = Z_LVAL_PP(from);</span>
<span class="lineNum">    2351 </span>                : 
<span class="lineNum">    2352 </span>                :                         /* if &quot;from&quot; position is negative, count start position from the end
<span class="lineNum">    2353 </span>                :                          * of the string
<span class="lineNum">    2354 </span>                :                          */
<span class="lineNum">    2355 </span><span class="lineNoCov">              0 :                         if (f &lt; 0) {</span>
<span class="lineNum">    2356 </span><span class="lineNoCov">              0 :                                 f = Z_STRLEN_PP(str) + f;</span>
<span class="lineNum">    2357 </span><span class="lineNoCov">              0 :                                 if (f &lt; 0) {</span>
<span class="lineNum">    2358 </span><span class="lineNoCov">              0 :                                         f = 0;</span>
<span class="lineNum">    2359 </span>                :                                 }
<span class="lineNum">    2360 </span><span class="lineNoCov">              0 :                         } else if (f &gt; Z_STRLEN_PP(str)) {</span>
<span class="lineNum">    2361 </span><span class="lineNoCov">              0 :                                 f = Z_STRLEN_PP(str);</span>
<span class="lineNum">    2362 </span>                :                         }
<span class="lineNum">    2363 </span>                :                         /* if &quot;length&quot; position is negative, set it to the length
<span class="lineNum">    2364 </span>                :                          * needed to stop that many chars from the end of the string
<span class="lineNum">    2365 </span>                :                          */
<span class="lineNum">    2366 </span><span class="lineNoCov">              0 :                         if (l &lt; 0) {</span>
<span class="lineNum">    2367 </span><span class="lineNoCov">              0 :                                 l = (Z_STRLEN_PP(str) - f) + l;</span>
<span class="lineNum">    2368 </span><span class="lineNoCov">              0 :                                 if (l &lt; 0) {</span>
<span class="lineNum">    2369 </span><span class="lineNoCov">              0 :                                         l = 0;</span>
<span class="lineNum">    2370 </span>                :                                 }
<span class="lineNum">    2371 </span>                :                         }
<span class="lineNum">    2372 </span>                : 
<span class="lineNum">    2373 </span><span class="lineNoCov">              0 :                         if (f &gt; Z_STRLEN_PP(str) || (f &lt; 0 &amp;&amp; -f &gt; Z_STRLEN_PP(str))) {</span>
<span class="lineNum">    2374 </span><span class="lineNoCov">              0 :                                 RETURN_FALSE;</span>
<span class="lineNum">    2375 </span><span class="lineNoCov">              0 :                         } else if (l &gt; Z_STRLEN_PP(str) || (l &lt; 0 &amp;&amp; -l &gt; Z_STRLEN_PP(str))) {</span>
<span class="lineNum">    2376 </span><span class="lineNoCov">              0 :                                 l = Z_STRLEN_PP(str);</span>
<span class="lineNum">    2377 </span>                :                         }
<span class="lineNum">    2378 </span>                : 
<span class="lineNum">    2379 </span><span class="lineNoCov">              0 :                         if ((f + l) &gt; Z_STRLEN_PP(str)) {</span>
<span class="lineNum">    2380 </span><span class="lineNoCov">              0 :                                 l = Z_STRLEN_PP(str) - f;</span>
<span class="lineNum">    2381 </span>                :                         }
<span class="lineNum">    2382 </span><span class="lineNoCov">              0 :                         if (Z_TYPE_PP(repl) == IS_ARRAY) {</span>
<span class="lineNum">    2383 </span><span class="lineNoCov">              0 :                                 zend_hash_internal_pointer_reset_ex(Z_ARRVAL_PP(repl), &amp;pos_repl);</span>
<span class="lineNum">    2384 </span><span class="lineNoCov">              0 :                                 if (SUCCESS == zend_hash_get_current_data_ex(Z_ARRVAL_PP(repl), (void **) &amp;tmp_repl, &amp;pos_repl)) {</span>
<span class="lineNum">    2385 </span><span class="lineNoCov">              0 :                                         convert_to_string_ex(tmp_repl);</span>
<span class="lineNum">    2386 </span><span class="lineNoCov">              0 :                                         repl_len = Z_STRLEN_PP(tmp_repl);</span>
<span class="lineNum">    2387 </span>                :                                 }
<span class="lineNum">    2388 </span>                :                         } else {
<span class="lineNum">    2389 </span><span class="lineNoCov">              0 :                                 repl_len = Z_STRLEN_PP(repl);</span>
<span class="lineNum">    2390 </span>                :                         }
<span class="lineNum">    2391 </span><span class="lineNoCov">              0 :                         result_len = Z_STRLEN_PP(str) - l + repl_len;</span>
<span class="lineNum">    2392 </span><span class="lineNoCov">              0 :                         result = emalloc(result_len + 1);</span>
<span class="lineNum">    2393 </span>                : 
<span class="lineNum">    2394 </span><span class="lineNoCov">              0 :                         memcpy(result, Z_STRVAL_PP(str), f);</span>
<span class="lineNum">    2395 </span><span class="lineNoCov">              0 :                         if (repl_len) {</span>
<span class="lineNum">    2396 </span><span class="lineNoCov">              0 :                                 memcpy((result + f), (Z_TYPE_PP(repl) == IS_ARRAY ? Z_STRVAL_PP(tmp_repl) : Z_STRVAL_PP(repl)), repl_len);</span>
<span class="lineNum">    2397 </span>                :                         }
<span class="lineNum">    2398 </span><span class="lineNoCov">              0 :                         memcpy((result + f + repl_len), Z_STRVAL_PP(str) + f + l, Z_STRLEN_PP(str) - f - l);</span>
<span class="lineNum">    2399 </span><span class="lineNoCov">              0 :                         result[result_len] = '\0';</span>
<span class="lineNum">    2400 </span><span class="lineNoCov">              0 :                         RETURN_STRINGL(result, result_len, 0);</span>
<span class="lineNum">    2401 </span>                :                 } else {
<span class="lineNum">    2402 </span><span class="lineNoCov">              0 :                         php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Functionality of 'from' and 'len' as arrays is not implemented&quot;);</span>
<span class="lineNum">    2403 </span><span class="lineNoCov">              0 :                         RETURN_STRINGL(Z_STRVAL_PP(str), Z_STRLEN_PP(str), 1);</span>
<span class="lineNum">    2404 </span>                :                 }
<span class="lineNum">    2405 </span>                :         } else { /* str is array of strings */
<span class="lineNum">    2406 </span><span class="lineNoCov">              0 :                 char *str_index = NULL;</span>
<span class="lineNum">    2407 </span>                :                 uint str_index_len;
<span class="lineNum">    2408 </span>                :                 ulong num_index;
<span class="lineNum">    2409 </span>                : 
<span class="lineNum">    2410 </span><span class="lineNoCov">              0 :                 array_init(return_value);</span>
<span class="lineNum">    2411 </span>                : 
<span class="lineNum">    2412 </span><span class="lineNoCov">              0 :                 if (Z_TYPE_PP(from) == IS_ARRAY) {</span>
<span class="lineNum">    2413 </span><span class="lineNoCov">              0 :                         zend_hash_internal_pointer_reset_ex(Z_ARRVAL_PP(from), &amp;pos_from);</span>
<span class="lineNum">    2414 </span>                :                 }
<span class="lineNum">    2415 </span>                : 
<span class="lineNum">    2416 </span><span class="lineNoCov">              0 :                 if (argc &gt; 3 &amp;&amp; Z_TYPE_PP(len) == IS_ARRAY) {</span>
<span class="lineNum">    2417 </span><span class="lineNoCov">              0 :                         zend_hash_internal_pointer_reset_ex(Z_ARRVAL_PP(len), &amp;pos_len);</span>
<span class="lineNum">    2418 </span>                :                 }
<span class="lineNum">    2419 </span>                : 
<span class="lineNum">    2420 </span><span class="lineNoCov">              0 :                 if (Z_TYPE_PP(repl) == IS_ARRAY) {</span>
<span class="lineNum">    2421 </span><span class="lineNoCov">              0 :                         zend_hash_internal_pointer_reset_ex(Z_ARRVAL_PP(repl), &amp;pos_repl);</span>
<span class="lineNum">    2422 </span>                :                 }
<span class="lineNum">    2423 </span>                : 
<span class="lineNum">    2424 </span><span class="lineNoCov">              0 :                 zend_hash_internal_pointer_reset_ex(Z_ARRVAL_PP(str), &amp;pos_str);</span>
<span class="lineNum">    2425 </span><span class="lineNoCov">              0 :                 while (zend_hash_get_current_data_ex(Z_ARRVAL_PP(str), (void **) &amp;tmp_str, &amp;pos_str) == SUCCESS) {</span>
<span class="lineNum">    2426 </span>                :                         zval *orig_str;
<span class="lineNum">    2427 </span>                :                         zval dummy;
<span class="lineNum">    2428 </span>                :                         ulong refcount;
<span class="lineNum">    2429 </span>                :                         int was_ref;
<span class="lineNum">    2430 </span>                : 
<span class="lineNum">    2431 </span><span class="lineNoCov">              0 :                         if(Z_TYPE_PP(tmp_str) != IS_STRING) {</span>
<span class="lineNum">    2432 </span><span class="lineNoCov">              0 :                                 dummy = **tmp_str;</span>
<span class="lineNum">    2433 </span><span class="lineNoCov">              0 :                                 orig_str = &amp;dummy;</span>
<span class="lineNum">    2434 </span>                :                                 zval_copy_ctor(orig_str);
<span class="lineNum">    2435 </span><span class="lineNoCov">              0 :                                 convert_to_string(orig_str);</span>
<span class="lineNum">    2436 </span>                :                         } else {
<span class="lineNum">    2437 </span><span class="lineNoCov">              0 :                                 orig_str = *tmp_str;</span>
<span class="lineNum">    2438 </span>                :                         }
<span class="lineNum">    2439 </span><span class="lineNoCov">              0 :                         was_ref = Z_ISREF_P(orig_str);</span>
<span class="lineNum">    2440 </span>                :                         Z_UNSET_ISREF_P(orig_str);
<span class="lineNum">    2441 </span><span class="lineNoCov">              0 :                         refcount = Z_REFCOUNT_P(orig_str);</span>
<span class="lineNum">    2442 </span>                : 
<span class="lineNum">    2443 </span><span class="lineNoCov">              0 :                         if (Z_TYPE_PP(from) == IS_ARRAY) {</span>
<span class="lineNum">    2444 </span><span class="lineNoCov">              0 :                                 if (SUCCESS == zend_hash_get_current_data_ex(Z_ARRVAL_PP(from), (void **) &amp;tmp_from, &amp;pos_from)) {</span>
<span class="lineNum">    2445 </span><span class="lineNoCov">              0 :                                         if(Z_TYPE_PP(tmp_from) != IS_LONG) {</span>
<span class="lineNum">    2446 </span><span class="lineNoCov">              0 :                                                 zval dummy = **tmp_from;</span>
<span class="lineNum">    2447 </span>                :                                                 zval_copy_ctor(&amp;dummy);
<span class="lineNum">    2448 </span><span class="lineNoCov">              0 :                                                 convert_to_long(&amp;dummy);</span>
<span class="lineNum">    2449 </span><span class="lineNoCov">              0 :                                                 f = Z_LVAL(dummy);</span>
<span class="lineNum">    2450 </span>                :                                         } else {
<span class="lineNum">    2451 </span><span class="lineNoCov">              0 :                                                 f = Z_LVAL_PP(tmp_from);</span>
<span class="lineNum">    2452 </span>                :                                         }
<span class="lineNum">    2453 </span>                : 
<span class="lineNum">    2454 </span><span class="lineNoCov">              0 :                                         if (f &lt; 0) {</span>
<span class="lineNum">    2455 </span><span class="lineNoCov">              0 :                                                 f = Z_STRLEN_P(orig_str) + f;</span>
<span class="lineNum">    2456 </span><span class="lineNoCov">              0 :                                                 if (f &lt; 0) {</span>
<span class="lineNum">    2457 </span><span class="lineNoCov">              0 :                                                         f = 0;</span>
<span class="lineNum">    2458 </span>                :                                                 }
<span class="lineNum">    2459 </span><span class="lineNoCov">              0 :                                         } else if (f &gt; Z_STRLEN_P(orig_str)) {</span>
<span class="lineNum">    2460 </span><span class="lineNoCov">              0 :                                                 f = Z_STRLEN_P(orig_str);</span>
<span class="lineNum">    2461 </span>                :                                         }
<span class="lineNum">    2462 </span><span class="lineNoCov">              0 :                                         zend_hash_move_forward_ex(Z_ARRVAL_PP(from), &amp;pos_from);</span>
<span class="lineNum">    2463 </span>                :                                 } else {
<span class="lineNum">    2464 </span><span class="lineNoCov">              0 :                                         f = 0;</span>
<span class="lineNum">    2465 </span>                :                                 }
<span class="lineNum">    2466 </span>                :                         } else {
<span class="lineNum">    2467 </span><span class="lineNoCov">              0 :                                 f = Z_LVAL_PP(from);</span>
<span class="lineNum">    2468 </span><span class="lineNoCov">              0 :                                 if (f &lt; 0) {</span>
<span class="lineNum">    2469 </span><span class="lineNoCov">              0 :                                         f = Z_STRLEN_P(orig_str) + f;</span>
<span class="lineNum">    2470 </span><span class="lineNoCov">              0 :                                         if (f &lt; 0) {</span>
<span class="lineNum">    2471 </span><span class="lineNoCov">              0 :                                                 f = 0;</span>
<span class="lineNum">    2472 </span>                :                                         }
<span class="lineNum">    2473 </span><span class="lineNoCov">              0 :                                 } else if (f &gt; Z_STRLEN_P(orig_str)) {</span>
<span class="lineNum">    2474 </span><span class="lineNoCov">              0 :                                         f = Z_STRLEN_P(orig_str);</span>
<span class="lineNum">    2475 </span>                :                                 }
<span class="lineNum">    2476 </span>                :                         }
<span class="lineNum">    2477 </span>                : 
<span class="lineNum">    2478 </span><span class="lineNoCov">              0 :                         if (argc &gt; 3 &amp;&amp; Z_TYPE_PP(len) == IS_ARRAY) {</span>
<span class="lineNum">    2479 </span><span class="lineNoCov">              0 :                                 if (SUCCESS == zend_hash_get_current_data_ex(Z_ARRVAL_PP(len), (void **) &amp;tmp_len, &amp;pos_len)) {</span>
<span class="lineNum">    2480 </span><span class="lineNoCov">              0 :                                         if(Z_TYPE_PP(tmp_len) != IS_LONG) {</span>
<span class="lineNum">    2481 </span><span class="lineNoCov">              0 :                                                 zval dummy = **tmp_len;</span>
<span class="lineNum">    2482 </span>                :                                                 zval_copy_ctor(&amp;dummy);
<span class="lineNum">    2483 </span><span class="lineNoCov">              0 :                                                 convert_to_long(&amp;dummy);</span>
<span class="lineNum">    2484 </span><span class="lineNoCov">              0 :                                                 l = Z_LVAL(dummy);</span>
<span class="lineNum">    2485 </span>                :                                         } else {
<span class="lineNum">    2486 </span><span class="lineNoCov">              0 :                                                 l = Z_LVAL_PP(tmp_len);</span>
<span class="lineNum">    2487 </span>                :                                         }
<span class="lineNum">    2488 </span><span class="lineNoCov">              0 :                                         zend_hash_move_forward_ex(Z_ARRVAL_PP(len), &amp;pos_len);</span>
<span class="lineNum">    2489 </span>                :                                 } else {
<span class="lineNum">    2490 </span><span class="lineNoCov">              0 :                                         l = Z_STRLEN_P(orig_str);</span>
<span class="lineNum">    2491 </span>                :                                 }
<span class="lineNum">    2492 </span><span class="lineNoCov">              0 :                         } else if (argc &gt; 3) {</span>
<span class="lineNum">    2493 </span><span class="lineNoCov">              0 :                                 l = Z_LVAL_PP(len);</span>
<span class="lineNum">    2494 </span>                :                         } else {
<span class="lineNum">    2495 </span><span class="lineNoCov">              0 :                                 l = Z_STRLEN_P(orig_str);</span>
<span class="lineNum">    2496 </span>                :                         }
<span class="lineNum">    2497 </span>                : 
<span class="lineNum">    2498 </span><span class="lineNoCov">              0 :                         if (l &lt; 0) {</span>
<span class="lineNum">    2499 </span><span class="lineNoCov">              0 :                                 l = (Z_STRLEN_P(orig_str) - f) + l;</span>
<span class="lineNum">    2500 </span><span class="lineNoCov">              0 :                                 if (l &lt; 0) {</span>
<span class="lineNum">    2501 </span><span class="lineNoCov">              0 :                                         l = 0;</span>
<span class="lineNum">    2502 </span>                :                                 }
<span class="lineNum">    2503 </span>                :                         }
<span class="lineNum">    2504 </span>                : 
<span class="lineNum">    2505 </span><span class="lineNoCov">              0 :                         if ((f + l) &gt; Z_STRLEN_P(orig_str)) {</span>
<span class="lineNum">    2506 </span><span class="lineNoCov">              0 :                                 l = Z_STRLEN_P(orig_str) - f;</span>
<span class="lineNum">    2507 </span>                :                         }
<span class="lineNum">    2508 </span>                : 
<span class="lineNum">    2509 </span><span class="lineNoCov">              0 :                         result_len = Z_STRLEN_P(orig_str) - l;</span>
<span class="lineNum">    2510 </span>                : 
<span class="lineNum">    2511 </span><span class="lineNoCov">              0 :                         if (Z_TYPE_PP(repl) == IS_ARRAY) {</span>
<span class="lineNum">    2512 </span><span class="lineNoCov">              0 :                                 if (SUCCESS == zend_hash_get_current_data_ex(Z_ARRVAL_PP(repl), (void **) &amp;tmp_repl, &amp;pos_repl)) {</span>
<span class="lineNum">    2513 </span>                :                                         zval *repl_str;
<span class="lineNum">    2514 </span>                :                                         zval zrepl;
<span class="lineNum">    2515 </span><span class="lineNoCov">              0 :                                         if(Z_TYPE_PP(tmp_repl) != IS_STRING) {</span>
<span class="lineNum">    2516 </span><span class="lineNoCov">              0 :                                                 zrepl = **tmp_repl;</span>
<span class="lineNum">    2517 </span><span class="lineNoCov">              0 :                                                 repl_str = &amp;zrepl;</span>
<span class="lineNum">    2518 </span>                :                                                 zval_copy_ctor(repl_str);
<span class="lineNum">    2519 </span><span class="lineNoCov">              0 :                                                 convert_to_string(repl_str);</span>
<span class="lineNum">    2520 </span>                :                                         } else {
<span class="lineNum">    2521 </span><span class="lineNoCov">              0 :                                                 repl_str = *tmp_repl;</span>
<span class="lineNum">    2522 </span>                :                                         }
<span class="lineNum">    2523 </span>                : 
<span class="lineNum">    2524 </span><span class="lineNoCov">              0 :                                         if(Z_REFCOUNT_P(orig_str) != refcount) {</span>
<span class="lineNum">    2525 </span><span class="lineNoCov">              0 :                                                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Argument was modified while replacing&quot;);</span>
<span class="lineNum">    2526 </span><span class="lineNoCov">              0 :                                                 if(Z_TYPE_PP(tmp_repl) != IS_STRING) {</span>
<span class="lineNum">    2527 </span>                :                                                         zval_dtor(repl_str);
<span class="lineNum">    2528 </span>                :                                                 }
<span class="lineNum">    2529 </span><span class="lineNoCov">              0 :                                                 break;</span>
<span class="lineNum">    2530 </span>                :                                         }
<span class="lineNum">    2531 </span>                : 
<span class="lineNum">    2532 </span><span class="lineNoCov">              0 :                                         result_len += Z_STRLEN_P(repl_str);</span>
<span class="lineNum">    2533 </span><span class="lineNoCov">              0 :                                         zend_hash_move_forward_ex(Z_ARRVAL_PP(repl), &amp;pos_repl);</span>
<span class="lineNum">    2534 </span><span class="lineNoCov">              0 :                                         result = emalloc(result_len + 1);</span>
<span class="lineNum">    2535 </span>                : 
<span class="lineNum">    2536 </span><span class="lineNoCov">              0 :                                         memcpy(result, Z_STRVAL_P(orig_str), f);</span>
<span class="lineNum">    2537 </span><span class="lineNoCov">              0 :                                         memcpy((result + f), Z_STRVAL_P(repl_str), Z_STRLEN_P(repl_str));</span>
<span class="lineNum">    2538 </span><span class="lineNoCov">              0 :                                         memcpy((result + f + Z_STRLEN_P(repl_str)), Z_STRVAL_P(orig_str) + f + l, Z_STRLEN_P(orig_str) - f - l);</span>
<span class="lineNum">    2539 </span><span class="lineNoCov">              0 :                                         if(Z_TYPE_PP(tmp_repl) != IS_STRING) {</span>
<span class="lineNum">    2540 </span>                :                                                 zval_dtor(repl_str);
<span class="lineNum">    2541 </span>                :                                         }
<span class="lineNum">    2542 </span>                :                                 } else {
<span class="lineNum">    2543 </span><span class="lineNoCov">              0 :                                         result = emalloc(result_len + 1);</span>
<span class="lineNum">    2544 </span>                : 
<span class="lineNum">    2545 </span><span class="lineNoCov">              0 :                                         memcpy(result, Z_STRVAL_P(orig_str), f);</span>
<span class="lineNum">    2546 </span><span class="lineNoCov">              0 :                                         memcpy((result + f), Z_STRVAL_P(orig_str) + f + l, Z_STRLEN_P(orig_str) - f - l);</span>
<span class="lineNum">    2547 </span>                :                                 }
<span class="lineNum">    2548 </span>                :                         } else {
<span class="lineNum">    2549 </span><span class="lineNoCov">              0 :                                 result_len += Z_STRLEN_PP(repl);</span>
<span class="lineNum">    2550 </span>                : 
<span class="lineNum">    2551 </span><span class="lineNoCov">              0 :                                 result = emalloc(result_len + 1);</span>
<span class="lineNum">    2552 </span>                : 
<span class="lineNum">    2553 </span><span class="lineNoCov">              0 :                                 memcpy(result, Z_STRVAL_P(orig_str), f);</span>
<span class="lineNum">    2554 </span><span class="lineNoCov">              0 :                                 memcpy((result + f), Z_STRVAL_PP(repl), Z_STRLEN_PP(repl));</span>
<span class="lineNum">    2555 </span><span class="lineNoCov">              0 :                                 memcpy((result + f + Z_STRLEN_PP(repl)), Z_STRVAL_P(orig_str) + f + l, Z_STRLEN_P(orig_str) - f - l);</span>
<span class="lineNum">    2556 </span>                :                         }
<span class="lineNum">    2557 </span>                : 
<span class="lineNum">    2558 </span><span class="lineNoCov">              0 :                         result[result_len] = '\0';</span>
<span class="lineNum">    2559 </span>                : 
<span class="lineNum">    2560 </span><span class="lineNoCov">              0 :                         if (zend_hash_get_current_key_ex(Z_ARRVAL_PP(str), &amp;str_index, &amp;str_index_len, &amp;num_index, 0, &amp;pos_str) == HASH_KEY_IS_STRING) {</span>
<span class="lineNum">    2561 </span><span class="lineNoCov">              0 :                                 add_assoc_stringl_ex(return_value, str_index, str_index_len, result, result_len, 0);</span>
<span class="lineNum">    2562 </span>                :                         } else {
<span class="lineNum">    2563 </span><span class="lineNoCov">              0 :                                 add_index_stringl(return_value, num_index, result, result_len, 0);</span>
<span class="lineNum">    2564 </span>                :                         }
<span class="lineNum">    2565 </span>                : 
<span class="lineNum">    2566 </span><span class="lineNoCov">              0 :                         if(Z_TYPE_PP(tmp_str) != IS_STRING) {</span>
<span class="lineNum">    2567 </span>                :                                 zval_dtor(orig_str);
<span class="lineNum">    2568 </span>                :                         } else {
<span class="lineNum">    2569 </span><span class="lineNoCov">              0 :                                 Z_SET_ISREF_TO_P(orig_str, was_ref);</span>
<span class="lineNum">    2570 </span>                :                         }
<span class="lineNum">    2571 </span><span class="lineNoCov">              0 :                         zend_hash_move_forward_ex(Z_ARRVAL_PP(str), &amp;pos_str);</span>
<span class="lineNum">    2572 </span>                :                 } /*while*/
<span class="lineNum">    2573 </span>                :         } /* if */
<span class="lineNum">    2574 </span>                : }
<span class="lineNum">    2575 </span>                : /* }}} */
<span class="lineNum">    2576 </span>                : 
<a name="2577"><span class="lineNum">    2577 </span>                : /* {{{ proto string quotemeta(string str)</a>
<span class="lineNum">    2578 </span>                :    Quotes meta characters */
<span class="lineNum">    2579 </span><span class="lineNoCov">              0 : PHP_FUNCTION(quotemeta)</span>
<span class="lineNum">    2580 </span>                : {
<span class="lineNum">    2581 </span>                :         char *str, *old;
<span class="lineNum">    2582 </span>                :         char *old_end;
<span class="lineNum">    2583 </span>                :         char *p, *q;
<span class="lineNum">    2584 </span>                :         char c;
<span class="lineNum">    2585 </span>                :         int  old_len;
<span class="lineNum">    2586 </span>                : 
<span class="lineNum">    2587 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s&quot;, &amp;old, &amp;old_len) == FAILURE) {</span>
<span class="lineNum">    2588 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    2589 </span>                :         }
<span class="lineNum">    2590 </span>                : 
<span class="lineNum">    2591 </span><span class="lineNoCov">              0 :         old_end = old + old_len;</span>
<span class="lineNum">    2592 </span>                : 
<span class="lineNum">    2593 </span><span class="lineNoCov">              0 :         if (old == old_end) {</span>
<span class="lineNum">    2594 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    2595 </span>                :         }
<span class="lineNum">    2596 </span>                : 
<span class="lineNum">    2597 </span><span class="lineNoCov">              0 :         str = safe_emalloc(2, old_len, 1);</span>
<span class="lineNum">    2598 </span>                : 
<span class="lineNum">    2599 </span><span class="lineNoCov">              0 :         for (p = old, q = str; p != old_end; p++) {</span>
<span class="lineNum">    2600 </span><span class="lineNoCov">              0 :                 c = *p;</span>
<span class="lineNum">    2601 </span><span class="lineNoCov">              0 :                 switch (c) {</span>
<span class="lineNum">    2602 </span>                :                         case '.':
<span class="lineNum">    2603 </span>                :                         case '\\':
<span class="lineNum">    2604 </span>                :                         case '+':
<span class="lineNum">    2605 </span>                :                         case '*':
<span class="lineNum">    2606 </span>                :                         case '?':
<span class="lineNum">    2607 </span>                :                         case '[':
<span class="lineNum">    2608 </span>                :                         case '^':
<span class="lineNum">    2609 </span>                :                         case ']':
<span class="lineNum">    2610 </span>                :                         case '$':
<span class="lineNum">    2611 </span>                :                         case '(':
<span class="lineNum">    2612 </span>                :                         case ')':
<span class="lineNum">    2613 </span><span class="lineNoCov">              0 :                                 *q++ = '\\';</span>
<span class="lineNum">    2614 </span>                :                                 /* break is missing _intentionally_ */
<span class="lineNum">    2615 </span>                :                         default:
<span class="lineNum">    2616 </span><span class="lineNoCov">              0 :                                 *q++ = c;</span>
<span class="lineNum">    2617 </span>                :                 }
<span class="lineNum">    2618 </span>                :         }
<span class="lineNum">    2619 </span><span class="lineNoCov">              0 :         *q = 0;</span>
<span class="lineNum">    2620 </span>                : 
<span class="lineNum">    2621 </span><span class="lineNoCov">              0 :         RETURN_STRINGL(erealloc(str, q - str + 1), q - str, 0);</span>
<span class="lineNum">    2622 </span>                : }
<span class="lineNum">    2623 </span>                : /* }}} */
<span class="lineNum">    2624 </span>                : 
<a name="2625"><span class="lineNum">    2625 </span>                : /* {{{ proto int ord(string character)</a>
<span class="lineNum">    2626 </span>                :    Returns ASCII value of character */
<span class="lineNum">    2627 </span><span class="lineNoCov">              0 : PHP_FUNCTION(ord)</span>
<span class="lineNum">    2628 </span>                : {
<span class="lineNum">    2629 </span>                :         char *str;
<span class="lineNum">    2630 </span>                :         int   str_len;
<span class="lineNum">    2631 </span>                : 
<span class="lineNum">    2632 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s&quot;, &amp;str, &amp;str_len) == FAILURE) {</span>
<span class="lineNum">    2633 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    2634 </span>                :         }
<span class="lineNum">    2635 </span>                : 
<span class="lineNum">    2636 </span><span class="lineNoCov">              0 :         RETURN_LONG((unsigned char) str[0]);</span>
<span class="lineNum">    2637 </span>                : }
<span class="lineNum">    2638 </span>                : /* }}} */
<span class="lineNum">    2639 </span>                : 
<a name="2640"><span class="lineNum">    2640 </span>                : /* {{{ proto string chr(int ascii)</a>
<span class="lineNum">    2641 </span>                :    Converts ASCII code to a character */
<span class="lineNum">    2642 </span><span class="lineNoCov">              0 : PHP_FUNCTION(chr)</span>
<span class="lineNum">    2643 </span>                : {
<span class="lineNum">    2644 </span>                :         long c;
<span class="lineNum">    2645 </span>                :         char temp[2];
<span class="lineNum">    2646 </span>                : 
<span class="lineNum">    2647 </span><span class="lineNoCov">              0 :         if (ZEND_NUM_ARGS() != 1) {</span>
<span class="lineNum">    2648 </span><span class="lineNoCov">              0 :                 WRONG_PARAM_COUNT;</span>
<span class="lineNum">    2649 </span>                :         }
<span class="lineNum">    2650 </span>                : 
<span class="lineNum">    2651 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters_ex(ZEND_PARSE_PARAMS_QUIET, ZEND_NUM_ARGS() TSRMLS_CC, &quot;l&quot;, &amp;c) == FAILURE) {</span>
<span class="lineNum">    2652 </span><span class="lineNoCov">              0 :                 c = 0;</span>
<span class="lineNum">    2653 </span>                :         }
<span class="lineNum">    2654 </span>                : 
<span class="lineNum">    2655 </span><span class="lineNoCov">              0 :         temp[0] = (char)c;</span>
<span class="lineNum">    2656 </span><span class="lineNoCov">              0 :         temp[1] = '\0';</span>
<span class="lineNum">    2657 </span>                : 
<span class="lineNum">    2658 </span><span class="lineNoCov">              0 :         RETURN_STRINGL(temp, 1, 1);</span>
<span class="lineNum">    2659 </span>                : }
<span class="lineNum">    2660 </span>                : /* }}} */
<span class="lineNum">    2661 </span>                : 
<a name="2662"><span class="lineNum">    2662 </span>                : /* {{{ php_ucfirst</a>
<span class="lineNum">    2663 </span>                :    Uppercase the first character of the word in a native string */
<span class="lineNum">    2664 </span><span class="lineNoCov">              0 : static void php_ucfirst(char *str)</span>
<span class="lineNum">    2665 </span>                : {
<span class="lineNum">    2666 </span>                :         register char *r;
<span class="lineNum">    2667 </span><span class="lineNoCov">              0 :         r = str;</span>
<span class="lineNum">    2668 </span><span class="lineNoCov">              0 :         *r = toupper((unsigned char) *r);</span>
<span class="lineNum">    2669 </span><span class="lineNoCov">              0 : }</span>
<span class="lineNum">    2670 </span>                : /* }}} */
<span class="lineNum">    2671 </span>                : 
<a name="2672"><span class="lineNum">    2672 </span>                : /* {{{ proto string ucfirst(string str)</a>
<span class="lineNum">    2673 </span>                :    Makes a string's first character uppercase */
<span class="lineNum">    2674 </span><span class="lineNoCov">              0 : PHP_FUNCTION(ucfirst)</span>
<span class="lineNum">    2675 </span>                : {
<span class="lineNum">    2676 </span>                :         char *str;
<span class="lineNum">    2677 </span>                :         int  str_len;
<span class="lineNum">    2678 </span>                : 
<span class="lineNum">    2679 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s&quot;, &amp;str, &amp;str_len) == FAILURE) {</span>
<span class="lineNum">    2680 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    2681 </span>                :         }
<span class="lineNum">    2682 </span>                : 
<span class="lineNum">    2683 </span><span class="lineNoCov">              0 :         if (!str_len) {</span>
<span class="lineNum">    2684 </span><span class="lineNoCov">              0 :                 RETURN_EMPTY_STRING();</span>
<span class="lineNum">    2685 </span>                :         }
<span class="lineNum">    2686 </span>                : 
<span class="lineNum">    2687 </span><span class="lineNoCov">              0 :         ZVAL_STRINGL(return_value, str, str_len, 1);</span>
<span class="lineNum">    2688 </span><span class="lineNoCov">              0 :         php_ucfirst(Z_STRVAL_P(return_value));</span>
<span class="lineNum">    2689 </span>                : }
<span class="lineNum">    2690 </span>                : /* }}} */
<span class="lineNum">    2691 </span>                : 
<a name="2692"><span class="lineNum">    2692 </span>                : /* {{{</a>
<span class="lineNum">    2693 </span>                :    Lowercase the first character of the word in a native string */
<span class="lineNum">    2694 </span><span class="lineNoCov">              0 : static void php_lcfirst(char *str)</span>
<span class="lineNum">    2695 </span>                : {
<span class="lineNum">    2696 </span>                :         register char *r;
<span class="lineNum">    2697 </span><span class="lineNoCov">              0 :         r = str;</span>
<span class="lineNum">    2698 </span><span class="lineNoCov">              0 :         *r = tolower((unsigned char) *r);</span>
<span class="lineNum">    2699 </span><span class="lineNoCov">              0 : }</span>
<span class="lineNum">    2700 </span>                : /* }}} */
<span class="lineNum">    2701 </span>                : 
<a name="2702"><span class="lineNum">    2702 </span>                : /* {{{ proto string lcfirst(string str)</a>
<span class="lineNum">    2703 </span>                :    Make a string's first character lowercase */
<span class="lineNum">    2704 </span><span class="lineNoCov">              0 : PHP_FUNCTION(lcfirst)</span>
<span class="lineNum">    2705 </span>                : {
<span class="lineNum">    2706 </span>                :         char  *str;
<span class="lineNum">    2707 </span>                :         int   str_len;
<span class="lineNum">    2708 </span>                : 
<span class="lineNum">    2709 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s&quot;, &amp;str, &amp;str_len) == FAILURE) {</span>
<span class="lineNum">    2710 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    2711 </span>                :         }
<span class="lineNum">    2712 </span>                : 
<span class="lineNum">    2713 </span><span class="lineNoCov">              0 :         if (!str_len) {</span>
<span class="lineNum">    2714 </span><span class="lineNoCov">              0 :                 RETURN_EMPTY_STRING();</span>
<span class="lineNum">    2715 </span>                :         }
<span class="lineNum">    2716 </span>                : 
<span class="lineNum">    2717 </span><span class="lineNoCov">              0 :         ZVAL_STRINGL(return_value, str, str_len, 1);</span>
<span class="lineNum">    2718 </span><span class="lineNoCov">              0 :         php_lcfirst(Z_STRVAL_P(return_value));</span>
<span class="lineNum">    2719 </span>                : }
<span class="lineNum">    2720 </span>                : /* }}} */
<span class="lineNum">    2721 </span>                : 
<a name="2722"><span class="lineNum">    2722 </span>                : /* {{{ proto string ucwords(string str)</a>
<span class="lineNum">    2723 </span>                :    Uppercase the first character of every word in a string */
<span class="lineNum">    2724 </span><span class="lineNoCov">              0 : PHP_FUNCTION(ucwords)</span>
<span class="lineNum">    2725 </span>                : {
<span class="lineNum">    2726 </span>                :         char *str;
<span class="lineNum">    2727 </span>                :         register char *r, *r_end;
<span class="lineNum">    2728 </span>                :         int str_len;
<span class="lineNum">    2729 </span>                : 
<span class="lineNum">    2730 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s&quot;, &amp;str, &amp;str_len) == FAILURE) {</span>
<span class="lineNum">    2731 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    2732 </span>                :         }
<span class="lineNum">    2733 </span>                : 
<span class="lineNum">    2734 </span><span class="lineNoCov">              0 :         if (!str_len) {</span>
<span class="lineNum">    2735 </span><span class="lineNoCov">              0 :                 RETURN_EMPTY_STRING();</span>
<span class="lineNum">    2736 </span>                :         }
<span class="lineNum">    2737 </span>                : 
<span class="lineNum">    2738 </span><span class="lineNoCov">              0 :         ZVAL_STRINGL(return_value, str, str_len, 1);</span>
<span class="lineNum">    2739 </span><span class="lineNoCov">              0 :         r = Z_STRVAL_P(return_value);</span>
<span class="lineNum">    2740 </span>                : 
<span class="lineNum">    2741 </span><span class="lineNoCov">              0 :         *r = toupper((unsigned char) *r);</span>
<span class="lineNum">    2742 </span><span class="lineNoCov">              0 :         for (r_end = r + Z_STRLEN_P(return_value) - 1; r &lt; r_end; ) {</span>
<span class="lineNum">    2743 </span><span class="lineNoCov">              0 :                 if (isspace((int) *(unsigned char *)r++)) {</span>
<span class="lineNum">    2744 </span><span class="lineNoCov">              0 :                         *r = toupper((unsigned char) *r);</span>
<span class="lineNum">    2745 </span>                :                 }
<span class="lineNum">    2746 </span>                :         }
<span class="lineNum">    2747 </span>                : }
<span class="lineNum">    2748 </span>                : /* }}} */
<span class="lineNum">    2749 </span>                : 
<a name="2750"><span class="lineNum">    2750 </span>                : /* {{{ php_strtr</a>
<span class="lineNum">    2751 </span>                :  */
<span class="lineNum">    2752 </span><span class="lineNoCov">              0 : PHPAPI char *php_strtr(char *str, int len, char *str_from, char *str_to, int trlen)</span>
<span class="lineNum">    2753 </span>                : {
<span class="lineNum">    2754 </span>                :         int i;
<span class="lineNum">    2755 </span>                :         unsigned char xlat[256];
<span class="lineNum">    2756 </span>                : 
<span class="lineNum">    2757 </span><span class="lineNoCov">              0 :         if ((trlen &lt; 1) || (len &lt; 1)) {</span>
<span class="lineNum">    2758 </span><span class="lineNoCov">              0 :                 return str;</span>
<span class="lineNum">    2759 </span>                :         }
<span class="lineNum">    2760 </span>                : 
<span class="lineNum">    2761 </span><span class="lineNoCov">              0 :         for (i = 0; i &lt; 256; xlat[i] = i, i++);</span>
<span class="lineNum">    2762 </span>                : 
<span class="lineNum">    2763 </span><span class="lineNoCov">              0 :         for (i = 0; i &lt; trlen; i++) {</span>
<span class="lineNum">    2764 </span><span class="lineNoCov">              0 :                 xlat[(unsigned char) str_from[i]] = str_to[i];</span>
<span class="lineNum">    2765 </span>                :         }
<span class="lineNum">    2766 </span>                : 
<span class="lineNum">    2767 </span><span class="lineNoCov">              0 :         for (i = 0; i &lt; len; i++) {</span>
<span class="lineNum">    2768 </span><span class="lineNoCov">              0 :                 str[i] = xlat[(unsigned char) str[i]];</span>
<span class="lineNum">    2769 </span>                :         }
<span class="lineNum">    2770 </span>                : 
<span class="lineNum">    2771 </span><span class="lineNoCov">              0 :         return str;</span>
<span class="lineNum">    2772 </span>                : }
<span class="lineNum">    2773 </span>                : /* }}} */
<span class="lineNum">    2774 </span>                : 
<a name="2775"><span class="lineNum">    2775 </span>                : /* {{{ php_strtr_array</a>
<span class="lineNum">    2776 </span>                :  */
<span class="lineNum">    2777 </span><span class="lineNoCov">              0 : static void php_strtr_array(zval *return_value, char *str, int slen, HashTable *hash)</span>
<span class="lineNum">    2778 </span>                : {
<span class="lineNum">    2779 </span>                :         zval **entry;
<span class="lineNum">    2780 </span>                :         char  *string_key;
<span class="lineNum">    2781 </span>                :         uint   string_key_len;
<span class="lineNum">    2782 </span>                :         zval **trans;
<span class="lineNum">    2783 </span>                :         zval   ctmp;
<span class="lineNum">    2784 </span>                :         ulong num_key;
<span class="lineNum">    2785 </span><span class="lineNoCov">              0 :         int minlen = 128*1024;</span>
<span class="lineNum">    2786 </span><span class="lineNoCov">              0 :         int maxlen = 0, pos, len, found;</span>
<span class="lineNum">    2787 </span>                :         char *key;
<span class="lineNum">    2788 </span>                :         HashPosition hpos;
<span class="lineNum">    2789 </span><span class="lineNoCov">              0 :         smart_str result = {0};</span>
<span class="lineNum">    2790 </span>                :         HashTable tmp_hash;
<span class="lineNum">    2791 </span>                : 
<span class="lineNum">    2792 </span><span class="lineNoCov">              0 :         zend_hash_init(&amp;tmp_hash, zend_hash_num_elements(hash), NULL, NULL, 0);</span>
<span class="lineNum">    2793 </span><span class="lineNoCov">              0 :         zend_hash_internal_pointer_reset_ex(hash, &amp;hpos);</span>
<span class="lineNum">    2794 </span><span class="lineNoCov">              0 :         while (zend_hash_get_current_data_ex(hash, (void **)&amp;entry, &amp;hpos) == SUCCESS) {</span>
<span class="lineNum">    2795 </span><span class="lineNoCov">              0 :                 switch (zend_hash_get_current_key_ex(hash, &amp;string_key, &amp;string_key_len, &amp;num_key, 0, &amp;hpos)) {</span>
<span class="lineNum">    2796 </span>                :                         case HASH_KEY_IS_STRING:
<span class="lineNum">    2797 </span><span class="lineNoCov">              0 :                                 len = string_key_len-1;</span>
<span class="lineNum">    2798 </span><span class="lineNoCov">              0 :                                 if (len &lt; 1) {</span>
<span class="lineNum">    2799 </span><span class="lineNoCov">              0 :                                         zend_hash_destroy(&amp;tmp_hash);</span>
<span class="lineNum">    2800 </span><span class="lineNoCov">              0 :                                         RETURN_FALSE;</span>
<span class="lineNum">    2801 </span>                :                                 }
<span class="lineNum">    2802 </span><span class="lineNoCov">              0 :                                 zend_hash_add(&amp;tmp_hash, string_key, string_key_len, entry, sizeof(zval*), NULL);</span>
<span class="lineNum">    2803 </span><span class="lineNoCov">              0 :                                 if (len &gt; maxlen) {</span>
<span class="lineNum">    2804 </span><span class="lineNoCov">              0 :                                         maxlen = len;</span>
<span class="lineNum">    2805 </span>                :                                 }
<span class="lineNum">    2806 </span><span class="lineNoCov">              0 :                                 if (len &lt; minlen) {</span>
<span class="lineNum">    2807 </span><span class="lineNoCov">              0 :                                         minlen = len;</span>
<span class="lineNum">    2808 </span>                :                                 }
<span class="lineNum">    2809 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    2810 </span>                : 
<span class="lineNum">    2811 </span>                :                         case HASH_KEY_IS_LONG:
<span class="lineNum">    2812 </span><span class="lineNoCov">              0 :                                 Z_TYPE(ctmp) = IS_LONG;</span>
<span class="lineNum">    2813 </span><span class="lineNoCov">              0 :                                 Z_LVAL(ctmp) = num_key;</span>
<span class="lineNum">    2814 </span>                : 
<span class="lineNum">    2815 </span><span class="lineNoCov">              0 :                                 convert_to_string(&amp;ctmp);</span>
<span class="lineNum">    2816 </span><span class="lineNoCov">              0 :                                 len = Z_STRLEN(ctmp);</span>
<span class="lineNum">    2817 </span><span class="lineNoCov">              0 :                                 zend_hash_add(&amp;tmp_hash, Z_STRVAL(ctmp), len+1, entry, sizeof(zval*), NULL);</span>
<span class="lineNum">    2818 </span>                :                                 zval_dtor(&amp;ctmp);
<span class="lineNum">    2819 </span>                : 
<span class="lineNum">    2820 </span><span class="lineNoCov">              0 :                                 if (len &gt; maxlen) {</span>
<span class="lineNum">    2821 </span><span class="lineNoCov">              0 :                                         maxlen = len;</span>
<span class="lineNum">    2822 </span>                :                                 }
<span class="lineNum">    2823 </span><span class="lineNoCov">              0 :                                 if (len &lt; minlen) {</span>
<span class="lineNum">    2824 </span><span class="lineNoCov">              0 :                                         minlen = len;</span>
<span class="lineNum">    2825 </span>                :                                 }
<span class="lineNum">    2826 </span>                :                                 break;
<span class="lineNum">    2827 </span>                :                 }
<span class="lineNum">    2828 </span><span class="lineNoCov">              0 :                 zend_hash_move_forward_ex(hash, &amp;hpos);</span>
<span class="lineNum">    2829 </span>                :         }
<span class="lineNum">    2830 </span>                : 
<span class="lineNum">    2831 </span><span class="lineNoCov">              0 :         key = emalloc(maxlen+1);</span>
<span class="lineNum">    2832 </span><span class="lineNoCov">              0 :         pos = 0;</span>
<span class="lineNum">    2833 </span>                : 
<span class="lineNum">    2834 </span><span class="lineNoCov">              0 :         while (pos &lt; slen) {</span>
<span class="lineNum">    2835 </span><span class="lineNoCov">              0 :                 if ((pos + maxlen) &gt; slen) {</span>
<span class="lineNum">    2836 </span><span class="lineNoCov">              0 :                         maxlen = slen - pos;</span>
<span class="lineNum">    2837 </span>                :                 }
<span class="lineNum">    2838 </span>                : 
<span class="lineNum">    2839 </span><span class="lineNoCov">              0 :                 found = 0;</span>
<span class="lineNum">    2840 </span><span class="lineNoCov">              0 :                 memcpy(key, str+pos, maxlen);</span>
<span class="lineNum">    2841 </span>                : 
<span class="lineNum">    2842 </span><span class="lineNoCov">              0 :                 for (len = maxlen; len &gt;= minlen; len--) {</span>
<span class="lineNum">    2843 </span><span class="lineNoCov">              0 :                         key[len] = 0;</span>
<span class="lineNum">    2844 </span>                : 
<span class="lineNum">    2845 </span><span class="lineNoCov">              0 :                         if (zend_hash_find(&amp;tmp_hash, key, len+1, (void**)&amp;trans) == SUCCESS) {</span>
<span class="lineNum">    2846 </span>                :                                 char *tval;
<span class="lineNum">    2847 </span>                :                                 int tlen;
<span class="lineNum">    2848 </span>                :                                 zval tmp;
<span class="lineNum">    2849 </span>                : 
<span class="lineNum">    2850 </span><span class="lineNoCov">              0 :                                 if (Z_TYPE_PP(trans) != IS_STRING) {</span>
<span class="lineNum">    2851 </span><span class="lineNoCov">              0 :                                         tmp = **trans;</span>
<span class="lineNum">    2852 </span>                :                                         zval_copy_ctor(&amp;tmp);
<span class="lineNum">    2853 </span><span class="lineNoCov">              0 :                                         convert_to_string(&amp;tmp);</span>
<span class="lineNum">    2854 </span><span class="lineNoCov">              0 :                                         tval = Z_STRVAL(tmp);</span>
<span class="lineNum">    2855 </span><span class="lineNoCov">              0 :                                         tlen = Z_STRLEN(tmp);</span>
<span class="lineNum">    2856 </span>                :                                 } else {
<span class="lineNum">    2857 </span><span class="lineNoCov">              0 :                                         tval = Z_STRVAL_PP(trans);</span>
<span class="lineNum">    2858 </span><span class="lineNoCov">              0 :                                         tlen = Z_STRLEN_PP(trans);</span>
<span class="lineNum">    2859 </span>                :                                 }
<span class="lineNum">    2860 </span>                : 
<span class="lineNum">    2861 </span><span class="lineNoCov">              0 :                                 smart_str_appendl(&amp;result, tval, tlen);</span>
<span class="lineNum">    2862 </span><span class="lineNoCov">              0 :                                 pos += len;</span>
<span class="lineNum">    2863 </span><span class="lineNoCov">              0 :                                 found = 1;</span>
<span class="lineNum">    2864 </span>                : 
<span class="lineNum">    2865 </span><span class="lineNoCov">              0 :                                 if (Z_TYPE_PP(trans) != IS_STRING) {</span>
<span class="lineNum">    2866 </span>                :                                         zval_dtor(&amp;tmp);
<span class="lineNum">    2867 </span>                :                                 }
<span class="lineNum">    2868 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    2869 </span>                :                         }
<span class="lineNum">    2870 </span>                :                 }
<span class="lineNum">    2871 </span>                : 
<span class="lineNum">    2872 </span><span class="lineNoCov">              0 :                 if (! found) {</span>
<span class="lineNum">    2873 </span><span class="lineNoCov">              0 :                         smart_str_appendc(&amp;result, str[pos++]);</span>
<span class="lineNum">    2874 </span>                :                 }
<span class="lineNum">    2875 </span>                :         }
<span class="lineNum">    2876 </span>                : 
<span class="lineNum">    2877 </span><span class="lineNoCov">              0 :         efree(key);</span>
<span class="lineNum">    2878 </span><span class="lineNoCov">              0 :         zend_hash_destroy(&amp;tmp_hash);</span>
<span class="lineNum">    2879 </span><span class="lineNoCov">              0 :         smart_str_0(&amp;result);</span>
<span class="lineNum">    2880 </span><span class="lineNoCov">              0 :         RETVAL_STRINGL(result.c, result.len, 0);</span>
<span class="lineNum">    2881 </span>                : }
<span class="lineNum">    2882 </span>                : /* }}} */
<span class="lineNum">    2883 </span>                : 
<a name="2884"><span class="lineNum">    2884 </span>                : /* {{{ proto string strtr(string str, string from[, string to])</a>
<span class="lineNum">    2885 </span>                :    Translates characters in str using given translation tables */
<span class="lineNum">    2886 </span><span class="lineNoCov">              0 : PHP_FUNCTION(strtr)</span>
<span class="lineNum">    2887 </span>                : {
<span class="lineNum">    2888 </span>                :         zval **from;
<span class="lineNum">    2889 </span><span class="lineNoCov">              0 :         char *str, *to = NULL;</span>
<span class="lineNum">    2890 </span><span class="lineNoCov">              0 :         int str_len, to_len = 0;</span>
<span class="lineNum">    2891 </span><span class="lineNoCov">              0 :         int ac = ZEND_NUM_ARGS();</span>
<span class="lineNum">    2892 </span>                : 
<span class="lineNum">    2893 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;sZ|s&quot;, &amp;str, &amp;str_len, &amp;from, &amp;to, &amp;to_len) == FAILURE) {</span>
<span class="lineNum">    2894 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    2895 </span>                :         }
<span class="lineNum">    2896 </span>                : 
<span class="lineNum">    2897 </span><span class="lineNoCov">              0 :         if (ac == 2 &amp;&amp; Z_TYPE_PP(from) != IS_ARRAY) {</span>
<span class="lineNum">    2898 </span><span class="lineNoCov">              0 :                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;The second argument is not an array&quot;);</span>
<span class="lineNum">    2899 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    2900 </span>                :         }
<span class="lineNum">    2901 </span>                : 
<span class="lineNum">    2902 </span>                :         /* shortcut for empty string */
<span class="lineNum">    2903 </span><span class="lineNoCov">              0 :         if (str_len == 0) {</span>
<span class="lineNum">    2904 </span><span class="lineNoCov">              0 :                 RETURN_EMPTY_STRING();</span>
<span class="lineNum">    2905 </span>                :         }
<span class="lineNum">    2906 </span>                : 
<span class="lineNum">    2907 </span><span class="lineNoCov">              0 :         if (ac == 2) {</span>
<span class="lineNum">    2908 </span><span class="lineNoCov">              0 :                 php_strtr_array(return_value, str, str_len, HASH_OF(*from));</span>
<span class="lineNum">    2909 </span>                :         } else {
<span class="lineNum">    2910 </span><span class="lineNoCov">              0 :                 convert_to_string_ex(from);</span>
<span class="lineNum">    2911 </span>                : 
<span class="lineNum">    2912 </span><span class="lineNoCov">              0 :                 ZVAL_STRINGL(return_value, str, str_len, 1);</span>
<span class="lineNum">    2913 </span>                : 
<span class="lineNum">    2914 </span><span class="lineNoCov">              0 :                 php_strtr(Z_STRVAL_P(return_value),</span>
<span class="lineNum">    2915 </span>                :                                   Z_STRLEN_P(return_value),
<span class="lineNum">    2916 </span><span class="lineNoCov">              0 :                                   Z_STRVAL_PP(from),</span>
<span class="lineNum">    2917 </span>                :                                   to,
<span class="lineNum">    2918 </span><span class="lineNoCov">              0 :                                   MIN(Z_STRLEN_PP(from),</span>
<span class="lineNum">    2919 </span>                :                                   to_len));
<span class="lineNum">    2920 </span>                :         }
<span class="lineNum">    2921 </span>                : }
<span class="lineNum">    2922 </span>                : /* }}} */
<span class="lineNum">    2923 </span>                : 
<a name="2924"><span class="lineNum">    2924 </span>                : /* {{{ proto string strrev(string str)</a>
<span class="lineNum">    2925 </span>                :    Reverse a string */
<span class="lineNum">    2926 </span><span class="lineNoCov">              0 : PHP_FUNCTION(strrev)</span>
<span class="lineNum">    2927 </span>                : {
<span class="lineNum">    2928 </span>                :         char *str;
<span class="lineNum">    2929 </span>                :         char *e, *n, *p;
<span class="lineNum">    2930 </span>                :         int  str_len;
<span class="lineNum">    2931 </span>                : 
<span class="lineNum">    2932 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s&quot;, &amp;str, &amp;str_len) == FAILURE) {</span>
<span class="lineNum">    2933 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    2934 </span>                :         }
<span class="lineNum">    2935 </span>                : 
<span class="lineNum">    2936 </span><span class="lineNoCov">              0 :         n = emalloc(str_len+1);</span>
<span class="lineNum">    2937 </span><span class="lineNoCov">              0 :         p = n;</span>
<span class="lineNum">    2938 </span>                : 
<span class="lineNum">    2939 </span><span class="lineNoCov">              0 :         e = str + str_len;</span>
<span class="lineNum">    2940 </span>                : 
<span class="lineNum">    2941 </span><span class="lineNoCov">              0 :         while (--e&gt;=str) {</span>
<span class="lineNum">    2942 </span><span class="lineNoCov">              0 :                 *p++ = *e;</span>
<span class="lineNum">    2943 </span>                :         }
<span class="lineNum">    2944 </span>                : 
<span class="lineNum">    2945 </span><span class="lineNoCov">              0 :         *p = '\0';</span>
<span class="lineNum">    2946 </span>                : 
<span class="lineNum">    2947 </span><span class="lineNoCov">              0 :         RETVAL_STRINGL(n, str_len, 0);</span>
<span class="lineNum">    2948 </span>                : }
<span class="lineNum">    2949 </span>                : /* }}} */
<span class="lineNum">    2950 </span>                : 
<a name="2951"><span class="lineNum">    2951 </span>                : /* {{{ php_similar_str</a>
<span class="lineNum">    2952 </span>                :  */
<span class="lineNum">    2953 </span><span class="lineNoCov">              0 : static void php_similar_str(const char *txt1, int len1, const char *txt2, int len2, int *pos1, int *pos2, int *max)</span>
<span class="lineNum">    2954 </span>                : {
<span class="lineNum">    2955 </span>                :         char *p, *q;
<span class="lineNum">    2956 </span><span class="lineNoCov">              0 :         char *end1 = (char *) txt1 + len1;</span>
<span class="lineNum">    2957 </span><span class="lineNoCov">              0 :         char *end2 = (char *) txt2 + len2;</span>
<span class="lineNum">    2958 </span>                :         int l;
<span class="lineNum">    2959 </span>                : 
<span class="lineNum">    2960 </span><span class="lineNoCov">              0 :         *max = 0;</span>
<span class="lineNum">    2961 </span><span class="lineNoCov">              0 :         for (p = (char *) txt1; p &lt; end1; p++) {</span>
<span class="lineNum">    2962 </span><span class="lineNoCov">              0 :                 for (q = (char *) txt2; q &lt; end2; q++) {</span>
<span class="lineNum">    2963 </span><span class="lineNoCov">              0 :                         for (l = 0; (p + l &lt; end1) &amp;&amp; (q + l &lt; end2) &amp;&amp; (p[l] == q[l]); l++);</span>
<span class="lineNum">    2964 </span><span class="lineNoCov">              0 :                         if (l &gt; *max) {</span>
<span class="lineNum">    2965 </span><span class="lineNoCov">              0 :                                 *max = l;</span>
<span class="lineNum">    2966 </span><span class="lineNoCov">              0 :                                 *pos1 = p - txt1;</span>
<span class="lineNum">    2967 </span><span class="lineNoCov">              0 :                                 *pos2 = q - txt2;</span>
<span class="lineNum">    2968 </span>                :                         }
<span class="lineNum">    2969 </span>                :                 }
<span class="lineNum">    2970 </span>                :         }
<span class="lineNum">    2971 </span><span class="lineNoCov">              0 : }</span>
<span class="lineNum">    2972 </span>                : /* }}} */
<span class="lineNum">    2973 </span>                : 
<a name="2974"><span class="lineNum">    2974 </span>                : /* {{{ php_similar_char</a>
<span class="lineNum">    2975 </span>                :  */
<span class="lineNum">    2976 </span><span class="lineNoCov">              0 : static int php_similar_char(const char *txt1, int len1, const char *txt2, int len2)</span>
<span class="lineNum">    2977 </span>                : {
<span class="lineNum">    2978 </span>                :         int sum;
<span class="lineNum">    2979 </span>                :         int pos1, pos2, max;
<span class="lineNum">    2980 </span>                : 
<span class="lineNum">    2981 </span><span class="lineNoCov">              0 :         php_similar_str(txt1, len1, txt2, len2, &amp;pos1, &amp;pos2, &amp;max);</span>
<span class="lineNum">    2982 </span><span class="lineNoCov">              0 :         if ((sum = max)) {</span>
<span class="lineNum">    2983 </span><span class="lineNoCov">              0 :                 if (pos1 &amp;&amp; pos2) {</span>
<span class="lineNum">    2984 </span><span class="lineNoCov">              0 :                         sum += php_similar_char(txt1, pos1,</span>
<span class="lineNum">    2985 </span>                :                                                                         txt2, pos2);
<span class="lineNum">    2986 </span>                :                 }
<span class="lineNum">    2987 </span><span class="lineNoCov">              0 :                 if ((pos1 + max &lt; len1) &amp;&amp; (pos2 + max &lt; len2)) {</span>
<span class="lineNum">    2988 </span><span class="lineNoCov">              0 :                         sum += php_similar_char(txt1 + pos1 + max, len1 - pos1 - max,</span>
<span class="lineNum">    2989 </span><span class="lineNoCov">              0 :                                                                         txt2 + pos2 + max, len2 - pos2 - max);</span>
<span class="lineNum">    2990 </span>                :                 }
<span class="lineNum">    2991 </span>                :         }
<span class="lineNum">    2992 </span>                : 
<span class="lineNum">    2993 </span><span class="lineNoCov">              0 :         return sum;</span>
<span class="lineNum">    2994 </span>                : }
<span class="lineNum">    2995 </span>                : /* }}} */
<span class="lineNum">    2996 </span>                : 
<a name="2997"><span class="lineNum">    2997 </span>                : /* {{{ proto int similar_text(string str1, string str2 [, float percent])</a>
<span class="lineNum">    2998 </span>                :    Calculates the similarity between two strings */
<span class="lineNum">    2999 </span><span class="lineNoCov">              0 : PHP_FUNCTION(similar_text)</span>
<span class="lineNum">    3000 </span>                : {
<span class="lineNum">    3001 </span>                :         char *t1, *t2;
<span class="lineNum">    3002 </span><span class="lineNoCov">              0 :         zval **percent = NULL;</span>
<span class="lineNum">    3003 </span><span class="lineNoCov">              0 :         int ac = ZEND_NUM_ARGS();</span>
<span class="lineNum">    3004 </span>                :         int sim;
<span class="lineNum">    3005 </span>                :         int t1_len, t2_len;
<span class="lineNum">    3006 </span>                : 
<span class="lineNum">    3007 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;ss|Z&quot;, &amp;t1, &amp;t1_len, &amp;t2, &amp;t2_len, &amp;percent) == FAILURE) {</span>
<span class="lineNum">    3008 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    3009 </span>                :         }
<span class="lineNum">    3010 </span>                : 
<span class="lineNum">    3011 </span><span class="lineNoCov">              0 :         if (ac &gt; 2) {</span>
<span class="lineNum">    3012 </span><span class="lineNoCov">              0 :                 convert_to_double_ex(percent);</span>
<span class="lineNum">    3013 </span>                :         }
<span class="lineNum">    3014 </span>                : 
<span class="lineNum">    3015 </span><span class="lineNoCov">              0 :         if (t1_len + t2_len == 0) {</span>
<span class="lineNum">    3016 </span><span class="lineNoCov">              0 :                 if (ac &gt; 2) {</span>
<span class="lineNum">    3017 </span><span class="lineNoCov">              0 :                         Z_DVAL_PP(percent) = 0;</span>
<span class="lineNum">    3018 </span>                :                 }
<span class="lineNum">    3019 </span>                : 
<span class="lineNum">    3020 </span><span class="lineNoCov">              0 :                 RETURN_LONG(0);</span>
<span class="lineNum">    3021 </span>                :         }
<span class="lineNum">    3022 </span>                : 
<span class="lineNum">    3023 </span><span class="lineNoCov">              0 :         sim = php_similar_char(t1, t1_len, t2, t2_len);</span>
<span class="lineNum">    3024 </span>                : 
<span class="lineNum">    3025 </span><span class="lineNoCov">              0 :         if (ac &gt; 2) {</span>
<span class="lineNum">    3026 </span><span class="lineNoCov">              0 :                 Z_DVAL_PP(percent) = sim * 200.0 / (t1_len + t2_len);</span>
<span class="lineNum">    3027 </span>                :         }
<span class="lineNum">    3028 </span>                : 
<span class="lineNum">    3029 </span><span class="lineNoCov">              0 :         RETURN_LONG(sim);</span>
<span class="lineNum">    3030 </span>                : }
<span class="lineNum">    3031 </span>                : /* }}} */
<span class="lineNum">    3032 </span>                : 
<span class="lineNum">    3033 </span>                : /* {{{ php_stripslashes
<a name="3034"><span class="lineNum">    3034 </span>                :  *</a>
<span class="lineNum">    3035 </span>                :  * be careful, this edits the string in-place */
<span class="lineNum">    3036 </span><span class="lineNoCov">              0 : PHPAPI void php_stripslashes(char *str, int *len TSRMLS_DC)</span>
<span class="lineNum">    3037 </span>                : {
<span class="lineNum">    3038 </span>                :         char *s, *t;
<span class="lineNum">    3039 </span>                :         int l;
<span class="lineNum">    3040 </span>                : 
<span class="lineNum">    3041 </span><span class="lineNoCov">              0 :         if (len != NULL) {</span>
<span class="lineNum">    3042 </span><span class="lineNoCov">              0 :                 l = *len;</span>
<span class="lineNum">    3043 </span>                :         } else {
<span class="lineNum">    3044 </span><span class="lineNoCov">              0 :                 l = strlen(str);</span>
<span class="lineNum">    3045 </span>                :         }
<span class="lineNum">    3046 </span><span class="lineNoCov">              0 :         s = str;</span>
<span class="lineNum">    3047 </span><span class="lineNoCov">              0 :         t = str;</span>
<span class="lineNum">    3048 </span>                : 
<span class="lineNum">    3049 </span><span class="lineNoCov">              0 :         while (l &gt; 0) {</span>
<span class="lineNum">    3050 </span><span class="lineNoCov">              0 :                 if (*t == '\\') {</span>
<span class="lineNum">    3051 </span><span class="lineNoCov">              0 :                         t++;                            /* skip the slash */</span>
<span class="lineNum">    3052 </span><span class="lineNoCov">              0 :                         if (len != NULL) {</span>
<span class="lineNum">    3053 </span><span class="lineNoCov">              0 :                                 (*len)--;</span>
<span class="lineNum">    3054 </span>                :                         }
<span class="lineNum">    3055 </span><span class="lineNoCov">              0 :                         l--;</span>
<span class="lineNum">    3056 </span><span class="lineNoCov">              0 :                         if (l &gt; 0) {</span>
<span class="lineNum">    3057 </span><span class="lineNoCov">              0 :                                 if (*t == '0') {</span>
<span class="lineNum">    3058 </span><span class="lineNoCov">              0 :                                         *s++='\0';</span>
<span class="lineNum">    3059 </span><span class="lineNoCov">              0 :                                         t++;</span>
<span class="lineNum">    3060 </span>                :                                 } else {
<span class="lineNum">    3061 </span><span class="lineNoCov">              0 :                                         *s++ = *t++;    /* preserve the next character */</span>
<span class="lineNum">    3062 </span>                :                                 }
<span class="lineNum">    3063 </span><span class="lineNoCov">              0 :                                 l--;</span>
<span class="lineNum">    3064 </span>                :                         }
<span class="lineNum">    3065 </span>                :                 } else {
<span class="lineNum">    3066 </span><span class="lineNoCov">              0 :                         *s++ = *t++;</span>
<span class="lineNum">    3067 </span><span class="lineNoCov">              0 :                         l--;</span>
<span class="lineNum">    3068 </span>                :                 }
<span class="lineNum">    3069 </span>                :         }
<span class="lineNum">    3070 </span><span class="lineNoCov">              0 :         if (s != t) {</span>
<span class="lineNum">    3071 </span><span class="lineNoCov">              0 :                 *s = '\0';</span>
<span class="lineNum">    3072 </span>                :         }
<span class="lineNum">    3073 </span><span class="lineNoCov">              0 : }</span>
<span class="lineNum">    3074 </span>                : /* }}} */
<span class="lineNum">    3075 </span>                : 
<a name="3076"><span class="lineNum">    3076 </span>                : /* {{{ proto string addcslashes(string str, string charlist)</a>
<span class="lineNum">    3077 </span>                :    Escapes all chars mentioned in charlist with backslash. It creates octal representations if asked to backslash characters with 8th bit set or with ASCII&lt;32 (except '\n', '\r', '\t' etc...) */
<span class="lineNum">    3078 </span><span class="lineNoCov">              0 : PHP_FUNCTION(addcslashes)</span>
<span class="lineNum">    3079 </span>                : {
<span class="lineNum">    3080 </span>                :         char *str, *what;
<span class="lineNum">    3081 </span>                :         int str_len, what_len;
<span class="lineNum">    3082 </span>                : 
<span class="lineNum">    3083 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;ss&quot;, &amp;str, &amp;str_len, &amp;what, &amp;what_len) == FAILURE) {</span>
<span class="lineNum">    3084 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    3085 </span>                :         }
<span class="lineNum">    3086 </span>                : 
<span class="lineNum">    3087 </span><span class="lineNoCov">              0 :         if (str_len == 0) {</span>
<span class="lineNum">    3088 </span><span class="lineNoCov">              0 :                 RETURN_EMPTY_STRING();</span>
<span class="lineNum">    3089 </span>                :         }
<span class="lineNum">    3090 </span>                : 
<span class="lineNum">    3091 </span><span class="lineNoCov">              0 :         if (what_len == 0) {</span>
<span class="lineNum">    3092 </span><span class="lineNoCov">              0 :                 RETURN_STRINGL(str, str_len, 1);</span>
<span class="lineNum">    3093 </span>                :         }
<span class="lineNum">    3094 </span>                : 
<span class="lineNum">    3095 </span><span class="lineNoCov">              0 :         Z_STRVAL_P(return_value) = php_addcslashes(str, str_len, &amp;Z_STRLEN_P(return_value), 0, what, what_len TSRMLS_CC);</span>
<span class="lineNum">    3096 </span><span class="lineNoCov">              0 :         RETURN_STRINGL(Z_STRVAL_P(return_value), Z_STRLEN_P(return_value), 0);</span>
<span class="lineNum">    3097 </span>                : }
<span class="lineNum">    3098 </span>                : /* }}} */
<span class="lineNum">    3099 </span>                : 
<a name="3100"><span class="lineNum">    3100 </span>                : /* {{{ proto string addslashes(string str)</a>
<span class="lineNum">    3101 </span>                :    Escapes single quote, double quotes and backslash characters in a string with backslashes */
<span class="lineNum">    3102 </span><span class="lineCov">           1033 : PHP_FUNCTION(addslashes)</span>
<span class="lineNum">    3103 </span>                : {
<span class="lineNum">    3104 </span>                :         char *str;
<span class="lineNum">    3105 </span>                :         int  str_len;
<span class="lineNum">    3106 </span>                : 
<span class="lineNum">    3107 </span><span class="lineCov">           1033 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s&quot;, &amp;str, &amp;str_len) == FAILURE) {</span>
<span class="lineNum">    3108 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    3109 </span>                :         }
<span class="lineNum">    3110 </span>                : 
<span class="lineNum">    3111 </span><span class="lineCov">           1033 :         if (str_len == 0) {</span>
<span class="lineNum">    3112 </span><span class="lineCov">            344 :                 RETURN_EMPTY_STRING();</span>
<span class="lineNum">    3113 </span>                :         }
<span class="lineNum">    3114 </span>                : 
<span class="lineNum">    3115 </span><span class="lineCov">            689 :         RETURN_STRING(php_addslashes(str,</span>
<span class="lineNum">    3116 </span>                :                                      str_len,
<span class="lineNum">    3117 </span>                :                                      &amp;Z_STRLEN_P(return_value), 0
<span class="lineNum">    3118 </span>                :                                      TSRMLS_CC), 0);
<span class="lineNum">    3119 </span>                : }
<span class="lineNum">    3120 </span>                : /* }}} */
<span class="lineNum">    3121 </span>                : 
<a name="3122"><span class="lineNum">    3122 </span>                : /* {{{ proto string stripcslashes(string str)</a>
<span class="lineNum">    3123 </span>                :    Strips backslashes from a string. Uses C-style conventions */
<span class="lineNum">    3124 </span><span class="lineNoCov">              0 : PHP_FUNCTION(stripcslashes)</span>
<span class="lineNum">    3125 </span>                : {
<span class="lineNum">    3126 </span>                :         char *str;
<span class="lineNum">    3127 </span>                :         int  str_len;
<span class="lineNum">    3128 </span>                : 
<span class="lineNum">    3129 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s&quot;, &amp;str, &amp;str_len) == FAILURE) {</span>
<span class="lineNum">    3130 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    3131 </span>                :         }
<span class="lineNum">    3132 </span>                : 
<span class="lineNum">    3133 </span><span class="lineNoCov">              0 :         ZVAL_STRINGL(return_value, str, str_len, 1);</span>
<span class="lineNum">    3134 </span><span class="lineNoCov">              0 :         php_stripcslashes(Z_STRVAL_P(return_value), &amp;Z_STRLEN_P(return_value));</span>
<span class="lineNum">    3135 </span>                : }
<span class="lineNum">    3136 </span>                : /* }}} */
<span class="lineNum">    3137 </span>                : 
<a name="3138"><span class="lineNum">    3138 </span>                : /* {{{ proto string stripslashes(string str)</a>
<span class="lineNum">    3139 </span>                :    Strips backslashes from a string */
<span class="lineNum">    3140 </span><span class="lineNoCov">              0 : PHP_FUNCTION(stripslashes)</span>
<span class="lineNum">    3141 </span>                : {
<span class="lineNum">    3142 </span>                :         char *str;
<span class="lineNum">    3143 </span>                :         int  str_len;
<span class="lineNum">    3144 </span>                : 
<span class="lineNum">    3145 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s&quot;, &amp;str, &amp;str_len) == FAILURE) {</span>
<span class="lineNum">    3146 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    3147 </span>                :         }
<span class="lineNum">    3148 </span>                : 
<span class="lineNum">    3149 </span><span class="lineNoCov">              0 :         ZVAL_STRINGL(return_value, str, str_len, 1);</span>
<span class="lineNum">    3150 </span><span class="lineNoCov">              0 :         php_stripslashes(Z_STRVAL_P(return_value), &amp;Z_STRLEN_P(return_value) TSRMLS_CC);</span>
<span class="lineNum">    3151 </span>                : }
<span class="lineNum">    3152 </span>                : /* }}} */
<span class="lineNum">    3153 </span>                : 
<span class="lineNum">    3154 </span>                : #ifndef HAVE_STRERROR
<span class="lineNum">    3155 </span>                : /* {{{ php_strerror
<span class="lineNum">    3156 </span>                :  */
<span class="lineNum">    3157 </span>                : char *php_strerror(int errnum)
<span class="lineNum">    3158 </span>                : {
<span class="lineNum">    3159 </span>                :         extern int sys_nerr;
<span class="lineNum">    3160 </span>                :         extern char *sys_errlist[];
<span class="lineNum">    3161 </span>                :         TSRMLS_FETCH();
<span class="lineNum">    3162 </span>                : 
<span class="lineNum">    3163 </span>                :         if ((unsigned int) errnum &lt; sys_nerr) {
<span class="lineNum">    3164 </span>                :                 return(sys_errlist[errnum]);
<span class="lineNum">    3165 </span>                :         }
<span class="lineNum">    3166 </span>                : 
<span class="lineNum">    3167 </span>                :         (void) snprintf(BG(str_ebuf), sizeof(php_basic_globals.str_ebuf), &quot;Unknown error: %d&quot;, errnum);
<span class="lineNum">    3168 </span>                :         return(BG(str_ebuf));
<span class="lineNum">    3169 </span>                : }
<span class="lineNum">    3170 </span>                : /* }}} */
<span class="lineNum">    3171 </span>                : #endif
<span class="lineNum">    3172 </span>                : 
<a name="3173"><span class="lineNum">    3173 </span>                : /* {{{ php_stripcslashes</a>
<span class="lineNum">    3174 </span>                :  */
<span class="lineNum">    3175 </span><span class="lineNoCov">              0 : PHPAPI void php_stripcslashes(char *str, int *len)</span>
<span class="lineNum">    3176 </span>                : {
<span class="lineNum">    3177 </span>                :         char *source, *target, *end;
<span class="lineNum">    3178 </span><span class="lineNoCov">              0 :         int  nlen = *len, i;</span>
<span class="lineNum">    3179 </span>                :         char numtmp[4];
<span class="lineNum">    3180 </span>                : 
<span class="lineNum">    3181 </span><span class="lineNoCov">              0 :         for (source=str, end=str+nlen, target=str; source &lt; end; source++) {</span>
<span class="lineNum">    3182 </span><span class="lineNoCov">              0 :                 if (*source == '\\' &amp;&amp; source+1 &lt; end) {</span>
<span class="lineNum">    3183 </span><span class="lineNoCov">              0 :                         source++;</span>
<span class="lineNum">    3184 </span><span class="lineNoCov">              0 :                         switch (*source) {</span>
<span class="lineNum">    3185 </span><span class="lineNoCov">              0 :                                 case 'n':  *target++='\n'; nlen--; break;</span>
<span class="lineNum">    3186 </span><span class="lineNoCov">              0 :                                 case 'r':  *target++='\r'; nlen--; break;</span>
<span class="lineNum">    3187 </span><span class="lineNoCov">              0 :                                 case 'a':  *target++='\a'; nlen--; break;</span>
<span class="lineNum">    3188 </span><span class="lineNoCov">              0 :                                 case 't':  *target++='\t'; nlen--; break;</span>
<span class="lineNum">    3189 </span><span class="lineNoCov">              0 :                                 case 'v':  *target++='\v'; nlen--; break;</span>
<span class="lineNum">    3190 </span><span class="lineNoCov">              0 :                                 case 'b':  *target++='\b'; nlen--; break;</span>
<span class="lineNum">    3191 </span><span class="lineNoCov">              0 :                                 case 'f':  *target++='\f'; nlen--; break;</span>
<span class="lineNum">    3192 </span><span class="lineNoCov">              0 :                                 case '\\': *target++='\\'; nlen--; break;</span>
<span class="lineNum">    3193 </span>                :                                 case 'x':
<span class="lineNum">    3194 </span><span class="lineNoCov">              0 :                                         if (source+1 &lt; end &amp;&amp; isxdigit((int)(*(source+1)))) {</span>
<span class="lineNum">    3195 </span><span class="lineNoCov">              0 :                                                 numtmp[0] = *++source;</span>
<span class="lineNum">    3196 </span><span class="lineNoCov">              0 :                                                 if (source+1 &lt; end &amp;&amp; isxdigit((int)(*(source+1)))) {</span>
<span class="lineNum">    3197 </span><span class="lineNoCov">              0 :                                                         numtmp[1] = *++source;</span>
<span class="lineNum">    3198 </span><span class="lineNoCov">              0 :                                                         numtmp[2] = '\0';</span>
<span class="lineNum">    3199 </span><span class="lineNoCov">              0 :                                                         nlen-=3;</span>
<span class="lineNum">    3200 </span>                :                                                 } else {
<span class="lineNum">    3201 </span><span class="lineNoCov">              0 :                                                         numtmp[1] = '\0';</span>
<span class="lineNum">    3202 </span><span class="lineNoCov">              0 :                                                         nlen-=2;</span>
<span class="lineNum">    3203 </span>                :                                                 }
<span class="lineNum">    3204 </span><span class="lineNoCov">              0 :                                                 *target++=(char)strtol(numtmp, NULL, 16);</span>
<span class="lineNum">    3205 </span><span class="lineNoCov">              0 :                                                 break;</span>
<span class="lineNum">    3206 </span>                :                                         }
<span class="lineNum">    3207 </span>                :                                         /* break is left intentionally */
<span class="lineNum">    3208 </span>                :                                 default:
<span class="lineNum">    3209 </span><span class="lineNoCov">              0 :                                         i=0;</span>
<span class="lineNum">    3210 </span><span class="lineNoCov">              0 :                                         while (source &lt; end &amp;&amp; *source &gt;= '0' &amp;&amp; *source &lt;= '7' &amp;&amp; i&lt;3) {</span>
<span class="lineNum">    3211 </span><span class="lineNoCov">              0 :                                                 numtmp[i++] = *source++;</span>
<span class="lineNum">    3212 </span>                :                                         }
<span class="lineNum">    3213 </span><span class="lineNoCov">              0 :                                         if (i) {</span>
<span class="lineNum">    3214 </span><span class="lineNoCov">              0 :                                                 numtmp[i]='\0';</span>
<span class="lineNum">    3215 </span><span class="lineNoCov">              0 :                                                 *target++=(char)strtol(numtmp, NULL, 8);</span>
<span class="lineNum">    3216 </span><span class="lineNoCov">              0 :                                                 nlen-=i;</span>
<span class="lineNum">    3217 </span><span class="lineNoCov">              0 :                                                 source--;</span>
<span class="lineNum">    3218 </span>                :                                         } else {
<span class="lineNum">    3219 </span><span class="lineNoCov">              0 :                                                 *target++=*source;</span>
<span class="lineNum">    3220 </span><span class="lineNoCov">              0 :                                                 nlen--;</span>
<span class="lineNum">    3221 </span>                :                                         }
<span class="lineNum">    3222 </span>                :                         }
<span class="lineNum">    3223 </span>                :                 } else {
<span class="lineNum">    3224 </span><span class="lineNoCov">              0 :                         *target++=*source;</span>
<span class="lineNum">    3225 </span>                :                 }
<span class="lineNum">    3226 </span>                :         }
<span class="lineNum">    3227 </span>                : 
<span class="lineNum">    3228 </span><span class="lineNoCov">              0 :         if (nlen != 0) {</span>
<span class="lineNum">    3229 </span><span class="lineNoCov">              0 :                 *target='\0';</span>
<span class="lineNum">    3230 </span>                :         }
<span class="lineNum">    3231 </span>                : 
<span class="lineNum">    3232 </span><span class="lineNoCov">              0 :         *len = nlen;</span>
<span class="lineNum">    3233 </span><span class="lineNoCov">              0 : }</span>
<span class="lineNum">    3234 </span>                : /* }}} */
<span class="lineNum">    3235 </span>                : 
<a name="3236"><span class="lineNum">    3236 </span>                : /* {{{ php_addcslashes</a>
<span class="lineNum">    3237 </span>                :  */
<span class="lineNum">    3238 </span><span class="lineCov">              2 : PHPAPI char *php_addcslashes(const char *str, int length, int *new_length, int should_free, char *what, int wlength TSRMLS_DC)</span>
<span class="lineNum">    3239 </span>                : {
<span class="lineNum">    3240 </span>                :         char flags[256];
<span class="lineNum">    3241 </span><span class="lineCov">              2 :         char *new_str = safe_emalloc(4, (length?length:(length=strlen(str))), 1);</span>
<span class="lineNum">    3242 </span>                :         char *source, *target;
<span class="lineNum">    3243 </span>                :         char *end;
<span class="lineNum">    3244 </span>                :         char c;
<span class="lineNum">    3245 </span>                :         int  newlen;
<span class="lineNum">    3246 </span>                : 
<span class="lineNum">    3247 </span><span class="lineCov">              2 :         if (!wlength) {</span>
<span class="lineNum">    3248 </span><span class="lineNoCov">              0 :                 wlength = strlen(what);</span>
<span class="lineNum">    3249 </span>                :         }
<span class="lineNum">    3250 </span>                : 
<span class="lineNum">    3251 </span><span class="lineCov">              2 :         php_charmask((unsigned char *)what, wlength, flags TSRMLS_CC);</span>
<span class="lineNum">    3252 </span>                : 
<span class="lineNum">    3253 </span><span class="lineCov">             29 :         for (source = (char*)str, end = source + length, target = new_str; source &lt; end; source++) {</span>
<span class="lineNum">    3254 </span><span class="lineCov">             27 :                 c = *source;</span>
<span class="lineNum">    3255 </span><span class="lineCov">             27 :                 if (flags[(unsigned char)c]) {</span>
<span class="lineNum">    3256 </span><span class="lineNoCov">              0 :                         if ((unsigned char) c &lt; 32 || (unsigned char) c &gt; 126) {</span>
<span class="lineNum">    3257 </span><span class="lineNoCov">              0 :                                 *target++ = '\\';</span>
<span class="lineNum">    3258 </span><span class="lineNoCov">              0 :                                 switch (c) {</span>
<span class="lineNum">    3259 </span><span class="lineNoCov">              0 :                                         case '\n': *target++ = 'n'; break;</span>
<span class="lineNum">    3260 </span><span class="lineNoCov">              0 :                                         case '\t': *target++ = 't'; break;</span>
<span class="lineNum">    3261 </span><span class="lineNoCov">              0 :                                         case '\r': *target++ = 'r'; break;</span>
<span class="lineNum">    3262 </span><span class="lineNoCov">              0 :                                         case '\a': *target++ = 'a'; break;</span>
<span class="lineNum">    3263 </span><span class="lineNoCov">              0 :                                         case '\v': *target++ = 'v'; break;</span>
<span class="lineNum">    3264 </span><span class="lineNoCov">              0 :                                         case '\b': *target++ = 'b'; break;</span>
<span class="lineNum">    3265 </span><span class="lineNoCov">              0 :                                         case '\f': *target++ = 'f'; break;</span>
<span class="lineNum">    3266 </span><span class="lineNoCov">              0 :                                         default: target += sprintf(target, &quot;%03o&quot;, (unsigned char) c);</span>
<span class="lineNum">    3267 </span>                :                                 }
<span class="lineNum">    3268 </span><span class="lineNoCov">              0 :                                 continue;</span>
<span class="lineNum">    3269 </span>                :                         }
<span class="lineNum">    3270 </span><span class="lineNoCov">              0 :                         *target++ = '\\';</span>
<span class="lineNum">    3271 </span>                :                 }
<span class="lineNum">    3272 </span><span class="lineCov">             27 :                 *target++ = c;</span>
<span class="lineNum">    3273 </span>                :         }
<span class="lineNum">    3274 </span><span class="lineCov">              2 :         *target = 0;</span>
<span class="lineNum">    3275 </span><span class="lineCov">              2 :         newlen = target - new_str;</span>
<span class="lineNum">    3276 </span><span class="lineCov">              2 :         if (target - new_str &lt; length * 4) {</span>
<span class="lineNum">    3277 </span><span class="lineCov">              2 :                 new_str = erealloc(new_str, newlen + 1);</span>
<span class="lineNum">    3278 </span>                :         }
<span class="lineNum">    3279 </span><span class="lineCov">              2 :         if (new_length) {</span>
<span class="lineNum">    3280 </span><span class="lineCov">              2 :                 *new_length = newlen;</span>
<span class="lineNum">    3281 </span>                :         }
<span class="lineNum">    3282 </span><span class="lineCov">              2 :         if (should_free) {</span>
<span class="lineNum">    3283 </span><span class="lineNoCov">              0 :                 STR_FREE((char*)str);</span>
<span class="lineNum">    3284 </span>                :         }
<span class="lineNum">    3285 </span><span class="lineCov">              2 :         return new_str;</span>
<span class="lineNum">    3286 </span>                : }
<span class="lineNum">    3287 </span>                : /* }}} */
<span class="lineNum">    3288 </span>                : 
<a name="3289"><span class="lineNum">    3289 </span>                : /* {{{ php_addslashes</a>
<span class="lineNum">    3290 </span>                :  */
<span class="lineNum">    3291 </span><span class="lineCov">            689 : PHPAPI char *php_addslashes(char *str, int length, int *new_length, int should_free TSRMLS_DC)</span>
<span class="lineNum">    3292 </span>                : {
<span class="lineNum">    3293 </span>                :         /* maximum string length, worst case situation */
<span class="lineNum">    3294 </span>                :         char *new_str;
<span class="lineNum">    3295 </span>                :         char *source, *target;
<span class="lineNum">    3296 </span>                :         char *end;
<span class="lineNum">    3297 </span>                :         int local_new_length;
<span class="lineNum">    3298 </span>                : 
<span class="lineNum">    3299 </span><span class="lineCov">            689 :         if (!new_length) {</span>
<span class="lineNum">    3300 </span><span class="lineNoCov">              0 :                 new_length = &amp;local_new_length;</span>
<span class="lineNum">    3301 </span>                :         }
<span class="lineNum">    3302 </span><span class="lineCov">            689 :         if (!str) {</span>
<span class="lineNum">    3303 </span><span class="lineNoCov">              0 :                 *new_length = 0;</span>
<span class="lineNum">    3304 </span><span class="lineNoCov">              0 :                 return str;</span>
<span class="lineNum">    3305 </span>                :         }
<span class="lineNum">    3306 </span><span class="lineCov">            689 :         new_str = (char *) safe_emalloc(2, (length ? length : (length = strlen(str))), 1);</span>
<span class="lineNum">    3307 </span><span class="lineCov">            689 :         source = str;</span>
<span class="lineNum">    3308 </span><span class="lineCov">            689 :         end = source + length;</span>
<span class="lineNum">    3309 </span><span class="lineCov">            689 :         target = new_str;</span>
<span class="lineNum">    3310 </span>                : 
<span class="lineNum">    3311 </span><span class="lineCov">           3916 :         while (source &lt; end) {</span>
<span class="lineNum">    3312 </span><span class="lineCov">           2538 :                 switch (*source) {</span>
<span class="lineNum">    3313 </span>                :                         case '\0':
<span class="lineNum">    3314 </span><span class="lineNoCov">              0 :                                 *target++ = '\\';</span>
<span class="lineNum">    3315 </span><span class="lineNoCov">              0 :                                 *target++ = '0';</span>
<span class="lineNum">    3316 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    3317 </span>                :                         case '\'':
<span class="lineNum">    3318 </span>                :                         case '\&quot;':
<span class="lineNum">    3319 </span>                :                         case '\\':
<span class="lineNum">    3320 </span><span class="lineNoCov">              0 :                                 *target++ = '\\';</span>
<span class="lineNum">    3321 </span>                :                                 /* break is missing *intentionally* */
<span class="lineNum">    3322 </span>                :                         default:
<span class="lineNum">    3323 </span><span class="lineCov">           2538 :                                 *target++ = *source;</span>
<span class="lineNum">    3324 </span>                :                                 break;
<span class="lineNum">    3325 </span>                :                 }
<span class="lineNum">    3326 </span>                : 
<span class="lineNum">    3327 </span><span class="lineCov">           2538 :                 source++;</span>
<span class="lineNum">    3328 </span>                :         }
<span class="lineNum">    3329 </span>                : 
<span class="lineNum">    3330 </span><span class="lineCov">            689 :         *target = 0;</span>
<span class="lineNum">    3331 </span><span class="lineCov">            689 :         *new_length = target - new_str;</span>
<span class="lineNum">    3332 </span><span class="lineCov">            689 :         if (should_free) {</span>
<span class="lineNum">    3333 </span><span class="lineNoCov">              0 :                 STR_FREE(str);</span>
<span class="lineNum">    3334 </span>                :         }
<span class="lineNum">    3335 </span><span class="lineCov">            689 :         new_str = (char *) erealloc(new_str, *new_length + 1);</span>
<span class="lineNum">    3336 </span><span class="lineCov">            689 :         return new_str;</span>
<span class="lineNum">    3337 </span>                : }
<span class="lineNum">    3338 </span>                : /* }}} */
<span class="lineNum">    3339 </span>                : 
<span class="lineNum">    3340 </span>                : #define _HEB_BLOCK_TYPE_ENG 1
<span class="lineNum">    3341 </span>                : #define _HEB_BLOCK_TYPE_HEB 2
<span class="lineNum">    3342 </span>                : #define isheb(c)      (((((unsigned char) c) &gt;= 224) &amp;&amp; (((unsigned char) c) &lt;= 250)) ? 1 : 0)
<span class="lineNum">    3343 </span>                : #define _isblank(c)   (((((unsigned char) c) == ' '  || ((unsigned char) c) == '\t')) ? 1 : 0)
<span class="lineNum">    3344 </span>                : #define _isnewline(c) (((((unsigned char) c) == '\n' || ((unsigned char) c) == '\r')) ? 1 : 0)
<span class="lineNum">    3345 </span>                : 
<a name="3346"><span class="lineNum">    3346 </span>                : /* {{{ php_char_to_str_ex</a>
<span class="lineNum">    3347 </span>                :  */
<span class="lineNum">    3348 </span><span class="lineNoCov">              0 : PHPAPI int php_char_to_str_ex(char *str, uint len, char from, char *to, int to_len, zval *result, int case_sensitivity, int *replace_count)</span>
<span class="lineNum">    3349 </span>                : {
<span class="lineNum">    3350 </span><span class="lineNoCov">              0 :         int char_count = 0;</span>
<span class="lineNum">    3351 </span><span class="lineNoCov">              0 :         int replaced = 0;</span>
<span class="lineNum">    3352 </span><span class="lineNoCov">              0 :         char *source, *target, *tmp, *source_end=str+len, *tmp_end = NULL;</span>
<span class="lineNum">    3353 </span>                : 
<span class="lineNum">    3354 </span><span class="lineNoCov">              0 :         if (case_sensitivity) {</span>
<span class="lineNum">    3355 </span><span class="lineNoCov">              0 :                 char *p = str, *e = p + len;</span>
<span class="lineNum">    3356 </span><span class="lineNoCov">              0 :                 while ((p = memchr(p, from, (e - p)))) {</span>
<span class="lineNum">    3357 </span><span class="lineNoCov">              0 :                         char_count++;</span>
<span class="lineNum">    3358 </span><span class="lineNoCov">              0 :                         p++;</span>
<span class="lineNum">    3359 </span>                :                 }
<span class="lineNum">    3360 </span>                :         } else {
<span class="lineNum">    3361 </span><span class="lineNoCov">              0 :                 for (source = str; source &lt; source_end; source++) {</span>
<span class="lineNum">    3362 </span><span class="lineNoCov">              0 :                         if (tolower(*source) == tolower(from)) {</span>
<span class="lineNum">    3363 </span><span class="lineNoCov">              0 :                                 char_count++;</span>
<span class="lineNum">    3364 </span>                :                         }
<span class="lineNum">    3365 </span>                :                 }
<span class="lineNum">    3366 </span>                :         }
<span class="lineNum">    3367 </span>                : 
<span class="lineNum">    3368 </span><span class="lineNoCov">              0 :         if (char_count == 0 &amp;&amp; case_sensitivity) {</span>
<span class="lineNum">    3369 </span><span class="lineNoCov">              0 :                 ZVAL_STRINGL(result, str, len, 1);</span>
<span class="lineNum">    3370 </span><span class="lineNoCov">              0 :                 return 0;</span>
<span class="lineNum">    3371 </span>                :         }
<span class="lineNum">    3372 </span>                : 
<span class="lineNum">    3373 </span><span class="lineNoCov">              0 :         Z_STRLEN_P(result) = len + (char_count * (to_len - 1));</span>
<span class="lineNum">    3374 </span><span class="lineNoCov">              0 :         Z_STRVAL_P(result) = target = safe_emalloc(char_count, to_len, len + 1);</span>
<span class="lineNum">    3375 </span><span class="lineNoCov">              0 :         Z_TYPE_P(result) = IS_STRING;</span>
<span class="lineNum">    3376 </span>                : 
<span class="lineNum">    3377 </span><span class="lineNoCov">              0 :         if (case_sensitivity) {</span>
<span class="lineNum">    3378 </span><span class="lineNoCov">              0 :                 char *p = str, *e = p + len, *s = str;</span>
<span class="lineNum">    3379 </span><span class="lineNoCov">              0 :                 while ((p = memchr(p, from, (e - p)))) {</span>
<span class="lineNum">    3380 </span><span class="lineNoCov">              0 :                         memcpy(target, s, (p - s));</span>
<span class="lineNum">    3381 </span><span class="lineNoCov">              0 :                         target += p - s;</span>
<span class="lineNum">    3382 </span><span class="lineNoCov">              0 :                         memcpy(target, to, to_len);</span>
<span class="lineNum">    3383 </span><span class="lineNoCov">              0 :                         target += to_len;</span>
<span class="lineNum">    3384 </span><span class="lineNoCov">              0 :                         p++;</span>
<span class="lineNum">    3385 </span><span class="lineNoCov">              0 :                         s = p;</span>
<span class="lineNum">    3386 </span><span class="lineNoCov">              0 :                         if (replace_count) {</span>
<span class="lineNum">    3387 </span><span class="lineNoCov">              0 :                                 *replace_count += 1;</span>
<span class="lineNum">    3388 </span>                :                         }
<span class="lineNum">    3389 </span>                :                 }
<span class="lineNum">    3390 </span><span class="lineNoCov">              0 :                 if (s &lt; e) {</span>
<span class="lineNum">    3391 </span><span class="lineNoCov">              0 :                         memcpy(target, s, (e - s));</span>
<span class="lineNum">    3392 </span><span class="lineNoCov">              0 :                         target += e - s;</span>
<span class="lineNum">    3393 </span>                :                 }
<span class="lineNum">    3394 </span>                :         } else {
<span class="lineNum">    3395 </span><span class="lineNoCov">              0 :                 for (source = str; source &lt; source_end; source++) {</span>
<span class="lineNum">    3396 </span><span class="lineNoCov">              0 :                         if (tolower(*source) == tolower(from)) {</span>
<span class="lineNum">    3397 </span><span class="lineNoCov">              0 :                                 replaced = 1;</span>
<span class="lineNum">    3398 </span><span class="lineNoCov">              0 :                                 if (replace_count) {</span>
<span class="lineNum">    3399 </span><span class="lineNoCov">              0 :                                         *replace_count += 1;</span>
<span class="lineNum">    3400 </span>                :                                 }
<span class="lineNum">    3401 </span><span class="lineNoCov">              0 :                                 for (tmp = to, tmp_end = tmp+to_len; tmp &lt; tmp_end; tmp++) {</span>
<span class="lineNum">    3402 </span><span class="lineNoCov">              0 :                                         *target = *tmp;</span>
<span class="lineNum">    3403 </span><span class="lineNoCov">              0 :                                         target++;</span>
<span class="lineNum">    3404 </span>                :                                 }
<span class="lineNum">    3405 </span>                :                         } else {
<span class="lineNum">    3406 </span><span class="lineNoCov">              0 :                                 *target = *source;</span>
<span class="lineNum">    3407 </span><span class="lineNoCov">              0 :                                 target++;</span>
<span class="lineNum">    3408 </span>                :                         }
<span class="lineNum">    3409 </span>                :                 }
<span class="lineNum">    3410 </span>                :         }
<span class="lineNum">    3411 </span><span class="lineNoCov">              0 :         *target = 0;</span>
<span class="lineNum">    3412 </span><span class="lineNoCov">              0 :         return replaced;</span>
<span class="lineNum">    3413 </span>                : }
<span class="lineNum">    3414 </span>                : /* }}} */
<span class="lineNum">    3415 </span>                : 
<a name="3416"><span class="lineNum">    3416 </span>                : /* {{{ php_char_to_str</a>
<span class="lineNum">    3417 </span>                :  */
<span class="lineNum">    3418 </span><span class="lineNoCov">              0 : PHPAPI int php_char_to_str(char *str, uint len, char from, char *to, int to_len, zval *result)</span>
<span class="lineNum">    3419 </span>                : {
<span class="lineNum">    3420 </span><span class="lineNoCov">              0 :         return php_char_to_str_ex(str, len, from, to, to_len, result, 1, NULL);</span>
<span class="lineNum">    3421 </span>                : }
<span class="lineNum">    3422 </span>                : /* }}} */
<span class="lineNum">    3423 </span>                : 
<a name="3424"><span class="lineNum">    3424 </span>                : /* {{{ php_str_to_str_ex</a>
<span class="lineNum">    3425 </span>                :  */
<span class="lineNum">    3426 </span><span class="lineCov">            436 : PHPAPI char *php_str_to_str_ex(char *haystack, int length,</span>
<span class="lineNum">    3427 </span>                :         char *needle, int needle_len, char *str, int str_len, int *_new_length, int case_sensitivity, int *replace_count)
<span class="lineNum">    3428 </span>                : {
<span class="lineNum">    3429 </span>                :         char *new_str;
<span class="lineNum">    3430 </span>                : 
<span class="lineNum">    3431 </span><span class="lineCov">            436 :         if (needle_len &lt; length) {</span>
<span class="lineNum">    3432 </span><span class="lineCov">            436 :                 char *end, *haystack_dup = NULL, *needle_dup = NULL;</span>
<span class="lineNum">    3433 </span>                :                 char *e, *s, *p, *r;
<span class="lineNum">    3434 </span>                : 
<span class="lineNum">    3435 </span><span class="lineCov">            436 :                 if (needle_len == str_len) {</span>
<span class="lineNum">    3436 </span><span class="lineCov">             60 :                         new_str = estrndup(haystack, length);</span>
<span class="lineNum">    3437 </span><span class="lineCov">             60 :                         *_new_length = length;</span>
<span class="lineNum">    3438 </span>                : 
<span class="lineNum">    3439 </span><span class="lineCov">             60 :                         if (case_sensitivity) {</span>
<span class="lineNum">    3440 </span><span class="lineCov">             60 :                                 end = new_str + length;</span>
<span class="lineNum">    3441 </span><span class="lineCov">             60 :                                 for (p = new_str; (r = php_memnstr(p, needle, needle_len, end)); p = r + needle_len) {</span>
<span class="lineNum">    3442 </span><span class="lineNoCov">              0 :                                         memcpy(r, str, str_len);</span>
<span class="lineNum">    3443 </span><span class="lineNoCov">              0 :                                         if (replace_count) {</span>
<span class="lineNum">    3444 </span><span class="lineNoCov">              0 :                                                 (*replace_count)++;</span>
<span class="lineNum">    3445 </span>                :                                         }
<span class="lineNum">    3446 </span>                :                                 }
<span class="lineNum">    3447 </span>                :                         } else {
<span class="lineNum">    3448 </span><span class="lineNoCov">              0 :                                 haystack_dup = estrndup(haystack, length);</span>
<span class="lineNum">    3449 </span><span class="lineNoCov">              0 :                                 needle_dup = estrndup(needle, needle_len);</span>
<span class="lineNum">    3450 </span><span class="lineNoCov">              0 :                                 php_strtolower(haystack_dup, length);</span>
<span class="lineNum">    3451 </span><span class="lineNoCov">              0 :                                 php_strtolower(needle_dup, needle_len);</span>
<span class="lineNum">    3452 </span><span class="lineNoCov">              0 :                                 end = haystack_dup + length;</span>
<span class="lineNum">    3453 </span><span class="lineNoCov">              0 :                                 for (p = haystack_dup; (r = php_memnstr(p, needle_dup, needle_len, end)); p = r + needle_len) {</span>
<span class="lineNum">    3454 </span><span class="lineNoCov">              0 :                                         memcpy(new_str + (r - haystack_dup), str, str_len);</span>
<span class="lineNum">    3455 </span><span class="lineNoCov">              0 :                                         if (replace_count) {</span>
<span class="lineNum">    3456 </span><span class="lineNoCov">              0 :                                                 (*replace_count)++;</span>
<span class="lineNum">    3457 </span>                :                                         }
<span class="lineNum">    3458 </span>                :                                 }
<span class="lineNum">    3459 </span><span class="lineNoCov">              0 :                                 efree(haystack_dup);</span>
<span class="lineNum">    3460 </span><span class="lineNoCov">              0 :                                 efree(needle_dup);</span>
<span class="lineNum">    3461 </span>                :                         }
<span class="lineNum">    3462 </span><span class="lineCov">             60 :                         return new_str;</span>
<span class="lineNum">    3463 </span>                :                 } else {
<span class="lineNum">    3464 </span><span class="lineCov">            376 :                         if (!case_sensitivity) {</span>
<span class="lineNum">    3465 </span><span class="lineCov">              1 :                                 haystack_dup = estrndup(haystack, length);</span>
<span class="lineNum">    3466 </span><span class="lineCov">              1 :                                 needle_dup = estrndup(needle, needle_len);</span>
<span class="lineNum">    3467 </span><span class="lineCov">              1 :                                 php_strtolower(haystack_dup, length);</span>
<span class="lineNum">    3468 </span><span class="lineCov">              1 :                                 php_strtolower(needle_dup, needle_len);</span>
<span class="lineNum">    3469 </span>                :                         }
<span class="lineNum">    3470 </span>                : 
<span class="lineNum">    3471 </span><span class="lineCov">            376 :                         if (str_len &lt; needle_len) {</span>
<span class="lineNum">    3472 </span><span class="lineCov">            235 :                                 new_str = emalloc(length + 1);</span>
<span class="lineNum">    3473 </span>                :                         } else {
<span class="lineNum">    3474 </span><span class="lineCov">            141 :                                 int count = 0;</span>
<span class="lineNum">    3475 </span>                :                                 char *o, *n, *endp;
<span class="lineNum">    3476 </span>                : 
<span class="lineNum">    3477 </span><span class="lineCov">            141 :                                 if (case_sensitivity) {</span>
<span class="lineNum">    3478 </span><span class="lineCov">            140 :                                         o = haystack;</span>
<span class="lineNum">    3479 </span><span class="lineCov">            140 :                                         n = needle;</span>
<span class="lineNum">    3480 </span>                :                                 } else {
<span class="lineNum">    3481 </span><span class="lineCov">              1 :                                         o = haystack_dup;</span>
<span class="lineNum">    3482 </span><span class="lineCov">              1 :                                         n = needle_dup;</span>
<span class="lineNum">    3483 </span>                :                                 }
<span class="lineNum">    3484 </span><span class="lineCov">            141 :                                 endp = o + length;</span>
<span class="lineNum">    3485 </span>                : 
<span class="lineNum">    3486 </span><span class="lineCov">            335 :                                 while ((o = php_memnstr(o, n, needle_len, endp))) {</span>
<span class="lineNum">    3487 </span><span class="lineCov">             53 :                                         o += needle_len;</span>
<span class="lineNum">    3488 </span><span class="lineCov">             53 :                                         count++;</span>
<span class="lineNum">    3489 </span>                :                                 }
<span class="lineNum">    3490 </span><span class="lineCov">            141 :                                 if (count == 0) {</span>
<span class="lineNum">    3491 </span>                :                                         /* Needle doesn't occur, shortcircuit the actual replacement. */
<span class="lineNum">    3492 </span><span class="lineCov">            120 :                                         if (haystack_dup) {</span>
<span class="lineNum">    3493 </span><span class="lineCov">              1 :                                                 efree(haystack_dup);</span>
<span class="lineNum">    3494 </span>                :                                         }
<span class="lineNum">    3495 </span><span class="lineCov">            120 :                                         if (needle_dup) {</span>
<span class="lineNum">    3496 </span><span class="lineCov">              1 :                                                 efree(needle_dup);</span>
<span class="lineNum">    3497 </span>                :                                         }
<span class="lineNum">    3498 </span><span class="lineCov">            120 :                                         new_str = estrndup(haystack, length);</span>
<span class="lineNum">    3499 </span><span class="lineCov">            120 :                                         if (_new_length) {</span>
<span class="lineNum">    3500 </span><span class="lineCov">            120 :                                                 *_new_length = length;</span>
<span class="lineNum">    3501 </span>                :                                         }
<span class="lineNum">    3502 </span><span class="lineCov">            120 :                                         return new_str;</span>
<span class="lineNum">    3503 </span>                :                                 } else {
<span class="lineNum">    3504 </span><span class="lineCov">             21 :                                         new_str = safe_emalloc(count, str_len - needle_len, length + 1);</span>
<span class="lineNum">    3505 </span>                :                                 }
<span class="lineNum">    3506 </span>                :                         }
<span class="lineNum">    3507 </span>                : 
<span class="lineNum">    3508 </span><span class="lineCov">            256 :                         e = s = new_str;</span>
<span class="lineNum">    3509 </span>                : 
<span class="lineNum">    3510 </span><span class="lineCov">            256 :                         if (case_sensitivity) {</span>
<span class="lineNum">    3511 </span><span class="lineCov">            256 :                                 end = haystack + length;</span>
<span class="lineNum">    3512 </span><span class="lineCov">            393 :                                 for (p = haystack; (r = php_memnstr(p, needle, needle_len, end)); p = r + needle_len) {</span>
<span class="lineNum">    3513 </span><span class="lineCov">            137 :                                         memcpy(e, p, r - p);</span>
<span class="lineNum">    3514 </span><span class="lineCov">            137 :                                         e += r - p;</span>
<span class="lineNum">    3515 </span><span class="lineCov">            137 :                                         memcpy(e, str, str_len);</span>
<span class="lineNum">    3516 </span><span class="lineCov">            137 :                                         e += str_len;</span>
<span class="lineNum">    3517 </span><span class="lineCov">            137 :                                         if (replace_count) {</span>
<span class="lineNum">    3518 </span><span class="lineNoCov">              0 :                                                 (*replace_count)++;</span>
<span class="lineNum">    3519 </span>                :                                         }
<span class="lineNum">    3520 </span>                :                                 }
<span class="lineNum">    3521 </span>                : 
<span class="lineNum">    3522 </span><span class="lineCov">            256 :                                 if (p &lt; end) {</span>
<span class="lineNum">    3523 </span><span class="lineCov">            256 :                                         memcpy(e, p, end - p);</span>
<span class="lineNum">    3524 </span><span class="lineCov">            256 :                                         e += end - p;</span>
<span class="lineNum">    3525 </span>                :                                 }
<span class="lineNum">    3526 </span>                :                         } else {
<span class="lineNum">    3527 </span><span class="lineNoCov">              0 :                                 end = haystack_dup + length;</span>
<span class="lineNum">    3528 </span>                : 
<span class="lineNum">    3529 </span><span class="lineNoCov">              0 :                                 for (p = haystack_dup; (r = php_memnstr(p, needle_dup, needle_len, end)); p = r + needle_len) {</span>
<span class="lineNum">    3530 </span><span class="lineNoCov">              0 :                                         memcpy(e, haystack + (p - haystack_dup), r - p);</span>
<span class="lineNum">    3531 </span><span class="lineNoCov">              0 :                                         e += r - p;</span>
<span class="lineNum">    3532 </span><span class="lineNoCov">              0 :                                         memcpy(e, str, str_len);</span>
<span class="lineNum">    3533 </span><span class="lineNoCov">              0 :                                         e += str_len;</span>
<span class="lineNum">    3534 </span><span class="lineNoCov">              0 :                                         if (replace_count) {</span>
<span class="lineNum">    3535 </span><span class="lineNoCov">              0 :                                                 (*replace_count)++;</span>
<span class="lineNum">    3536 </span>                :                                         }
<span class="lineNum">    3537 </span>                :                                 }
<span class="lineNum">    3538 </span>                : 
<span class="lineNum">    3539 </span><span class="lineNoCov">              0 :                                 if (p &lt; end) {</span>
<span class="lineNum">    3540 </span><span class="lineNoCov">              0 :                                         memcpy(e, haystack + (p - haystack_dup), end - p);</span>
<span class="lineNum">    3541 </span><span class="lineNoCov">              0 :                                         e += end - p;</span>
<span class="lineNum">    3542 </span>                :                                 }
<span class="lineNum">    3543 </span>                :                         }
<span class="lineNum">    3544 </span>                : 
<span class="lineNum">    3545 </span><span class="lineCov">            256 :                         if (haystack_dup) {</span>
<span class="lineNum">    3546 </span><span class="lineNoCov">              0 :                                 efree(haystack_dup);</span>
<span class="lineNum">    3547 </span>                :                         }
<span class="lineNum">    3548 </span><span class="lineCov">            256 :                         if (needle_dup) {</span>
<span class="lineNum">    3549 </span><span class="lineNoCov">              0 :                                 efree(needle_dup);</span>
<span class="lineNum">    3550 </span>                :                         }
<span class="lineNum">    3551 </span>                : 
<span class="lineNum">    3552 </span><span class="lineCov">            256 :                         *e = '\0';</span>
<span class="lineNum">    3553 </span><span class="lineCov">            256 :                         *_new_length = e - s;</span>
<span class="lineNum">    3554 </span>                : 
<span class="lineNum">    3555 </span><span class="lineCov">            256 :                         new_str = erealloc(new_str, *_new_length + 1);</span>
<span class="lineNum">    3556 </span><span class="lineCov">            256 :                         return new_str;</span>
<span class="lineNum">    3557 </span>                :                 }
<span class="lineNum">    3558 </span><span class="lineNoCov">              0 :         } else if (needle_len &gt; length) {</span>
<span class="lineNum">    3559 </span>                : nothing_todo:
<span class="lineNum">    3560 </span><span class="lineNoCov">              0 :                 *_new_length = length;</span>
<span class="lineNum">    3561 </span><span class="lineNoCov">              0 :                 new_str = estrndup(haystack, length);</span>
<span class="lineNum">    3562 </span><span class="lineNoCov">              0 :                 return new_str;</span>
<span class="lineNum">    3563 </span>                :         } else {
<span class="lineNum">    3564 </span><span class="lineNoCov">              0 :                 if (case_sensitivity &amp;&amp; memcmp(haystack, needle, length)) {</span>
<span class="lineNum">    3565 </span>                :                         goto nothing_todo;
<span class="lineNum">    3566 </span><span class="lineNoCov">              0 :                 } else if (!case_sensitivity) {</span>
<span class="lineNum">    3567 </span>                :                         char *l_haystack, *l_needle;
<span class="lineNum">    3568 </span>                : 
<span class="lineNum">    3569 </span><span class="lineNoCov">              0 :                         l_haystack = estrndup(haystack, length);</span>
<span class="lineNum">    3570 </span><span class="lineNoCov">              0 :                         l_needle = estrndup(needle, length);</span>
<span class="lineNum">    3571 </span>                : 
<span class="lineNum">    3572 </span><span class="lineNoCov">              0 :                         php_strtolower(l_haystack, length);</span>
<span class="lineNum">    3573 </span><span class="lineNoCov">              0 :                         php_strtolower(l_needle, length);</span>
<span class="lineNum">    3574 </span>                : 
<span class="lineNum">    3575 </span><span class="lineNoCov">              0 :                         if (memcmp(l_haystack, l_needle, length)) {</span>
<span class="lineNum">    3576 </span><span class="lineNoCov">              0 :                                 efree(l_haystack);</span>
<span class="lineNum">    3577 </span><span class="lineNoCov">              0 :                                 efree(l_needle);</span>
<span class="lineNum">    3578 </span><span class="lineNoCov">              0 :                                 goto nothing_todo;</span>
<span class="lineNum">    3579 </span>                :                         }
<span class="lineNum">    3580 </span><span class="lineNoCov">              0 :                         efree(l_haystack);</span>
<span class="lineNum">    3581 </span><span class="lineNoCov">              0 :                         efree(l_needle);</span>
<span class="lineNum">    3582 </span>                :                 }
<span class="lineNum">    3583 </span>                : 
<span class="lineNum">    3584 </span><span class="lineNoCov">              0 :                 *_new_length = str_len;</span>
<span class="lineNum">    3585 </span><span class="lineNoCov">              0 :                 new_str = estrndup(str, str_len);</span>
<span class="lineNum">    3586 </span>                : 
<span class="lineNum">    3587 </span><span class="lineNoCov">              0 :                 if (replace_count) {</span>
<span class="lineNum">    3588 </span><span class="lineNoCov">              0 :                         (*replace_count)++;</span>
<span class="lineNum">    3589 </span>                :                 }
<span class="lineNum">    3590 </span><span class="lineNoCov">              0 :                 return new_str;</span>
<span class="lineNum">    3591 </span>                :         }
<span class="lineNum">    3592 </span>                : 
<span class="lineNum">    3593 </span>                : }
<span class="lineNum">    3594 </span>                : /* }}} */
<span class="lineNum">    3595 </span>                : 
<a name="3596"><span class="lineNum">    3596 </span>                : /* {{{ php_str_to_str</a>
<span class="lineNum">    3597 </span>                :  */
<span class="lineNum">    3598 </span><span class="lineNoCov">              0 : PHPAPI char *php_str_to_str(char *haystack, int length,</span>
<span class="lineNum">    3599 </span>                :         char *needle, int needle_len, char *str, int str_len, int *_new_length)
<span class="lineNum">    3600 </span>                : {
<span class="lineNum">    3601 </span><span class="lineNoCov">              0 :         return php_str_to_str_ex(haystack, length, needle, needle_len, str, str_len, _new_length, 1, NULL);</span>
<span class="lineNum">    3602 </span>                : }
<span class="lineNum">    3603 </span>                : /* }}} */
<span class="lineNum">    3604 </span>                : 
<a name="3605"><span class="lineNum">    3605 </span>                : /* {{{ php_str_replace_in_subject</a>
<span class="lineNum">    3606 </span>                :  */
<span class="lineNum">    3607 </span><span class="lineCov">            426 : static void php_str_replace_in_subject(zval *search, zval *replace, zval **subject, zval *result, int case_sensitivity, int *replace_count)</span>
<span class="lineNum">    3608 </span>                : {
<span class="lineNum">    3609 </span>                :         zval            **search_entry,
<span class="lineNum">    3610 </span><span class="lineCov">            426 :                                 **replace_entry = NULL,</span>
<span class="lineNum">    3611 </span>                :                                   temp_result;
<span class="lineNum">    3612 </span><span class="lineCov">            426 :         char            *replace_value = NULL;</span>
<span class="lineNum">    3613 </span><span class="lineCov">            426 :         int                      replace_len = 0;</span>
<span class="lineNum">    3614 </span>                : 
<span class="lineNum">    3615 </span>                :         /* Make sure we're dealing with strings. */
<span class="lineNum">    3616 </span><span class="lineCov">            429 :         convert_to_string_ex(subject);</span>
<span class="lineNum">    3617 </span><span class="lineCov">            426 :         Z_TYPE_P(result) = IS_STRING;</span>
<span class="lineNum">    3618 </span><span class="lineCov">            426 :         if (Z_STRLEN_PP(subject) == 0) {</span>
<span class="lineNum">    3619 </span><span class="lineCov">             31 :                 ZVAL_STRINGL(result, &quot;&quot;, 0, 1);</span>
<span class="lineNum">    3620 </span><span class="lineCov">             31 :                 return;</span>
<span class="lineNum">    3621 </span>                :         }
<span class="lineNum">    3622 </span>                : 
<span class="lineNum">    3623 </span>                :         /* If search is an array */
<span class="lineNum">    3624 </span><span class="lineCov">            395 :         if (Z_TYPE_P(search) == IS_ARRAY) {</span>
<span class="lineNum">    3625 </span>                :                 /* Duplicate subject string for repeated replacement */
<span class="lineNum">    3626 </span><span class="lineCov">             80 :                 MAKE_COPY_ZVAL(subject, result);</span>
<span class="lineNum">    3627 </span>                : 
<span class="lineNum">    3628 </span><span class="lineCov">             80 :                 zend_hash_internal_pointer_reset(Z_ARRVAL_P(search));</span>
<span class="lineNum">    3629 </span>                : 
<span class="lineNum">    3630 </span><span class="lineCov">             80 :                 if (Z_TYPE_P(replace) == IS_ARRAY) {</span>
<span class="lineNum">    3631 </span><span class="lineNoCov">              0 :                         zend_hash_internal_pointer_reset(Z_ARRVAL_P(replace));</span>
<span class="lineNum">    3632 </span>                :                 } else {
<span class="lineNum">    3633 </span>                :                         /* Set replacement value to the passed one */
<span class="lineNum">    3634 </span><span class="lineCov">             80 :                         replace_value = Z_STRVAL_P(replace);</span>
<span class="lineNum">    3635 </span><span class="lineCov">             80 :                         replace_len = Z_STRLEN_P(replace);</span>
<span class="lineNum">    3636 </span>                :                 }
<span class="lineNum">    3637 </span>                : 
<span class="lineNum">    3638 </span>                :                 /* For each entry in the search array, get the entry */
<span class="lineNum">    3639 </span><span class="lineCov">            280 :                 while (zend_hash_get_current_data(Z_ARRVAL_P(search), (void **) &amp;search_entry) == SUCCESS) {</span>
<span class="lineNum">    3640 </span>                :                         /* Make sure we're dealing with strings. */
<span class="lineNum">    3641 </span><span class="lineCov">            240 :                         SEPARATE_ZVAL(search_entry);</span>
<span class="lineNum">    3642 </span><span class="lineCov">            120 :                         convert_to_string(*search_entry);</span>
<span class="lineNum">    3643 </span><span class="lineCov">            120 :                         if (Z_STRLEN_PP(search_entry) == 0) {</span>
<span class="lineNum">    3644 </span><span class="lineNoCov">              0 :                                 zend_hash_move_forward(Z_ARRVAL_P(search));</span>
<span class="lineNum">    3645 </span><span class="lineNoCov">              0 :                                 if (Z_TYPE_P(replace) == IS_ARRAY) {</span>
<span class="lineNum">    3646 </span><span class="lineNoCov">              0 :                                         zend_hash_move_forward(Z_ARRVAL_P(replace));</span>
<span class="lineNum">    3647 </span>                :                                 }
<span class="lineNum">    3648 </span><span class="lineNoCov">              0 :                                 continue;</span>
<span class="lineNum">    3649 </span>                :                         }
<span class="lineNum">    3650 </span>                : 
<span class="lineNum">    3651 </span>                :                         /* If replace is an array. */
<span class="lineNum">    3652 </span><span class="lineCov">            120 :                         if (Z_TYPE_P(replace) == IS_ARRAY) {</span>
<span class="lineNum">    3653 </span>                :                                 /* Get current entry */
<span class="lineNum">    3654 </span><span class="lineNoCov">              0 :                                 if (zend_hash_get_current_data(Z_ARRVAL_P(replace), (void **)&amp;replace_entry) == SUCCESS) {</span>
<span class="lineNum">    3655 </span>                :                                         /* Make sure we're dealing with strings. */
<span class="lineNum">    3656 </span><span class="lineNoCov">              0 :                                         convert_to_string_ex(replace_entry);</span>
<span class="lineNum">    3657 </span>                : 
<span class="lineNum">    3658 </span>                :                                         /* Set replacement value to the one we got from array */
<span class="lineNum">    3659 </span><span class="lineNoCov">              0 :                                         replace_value = Z_STRVAL_PP(replace_entry);</span>
<span class="lineNum">    3660 </span><span class="lineNoCov">              0 :                                         replace_len = Z_STRLEN_PP(replace_entry);</span>
<span class="lineNum">    3661 </span>                : 
<span class="lineNum">    3662 </span><span class="lineNoCov">              0 :                                         zend_hash_move_forward(Z_ARRVAL_P(replace));</span>
<span class="lineNum">    3663 </span>                :                                 } else {
<span class="lineNum">    3664 </span>                :                                         /* We've run out of replacement strings, so use an empty one. */
<span class="lineNum">    3665 </span><span class="lineNoCov">              0 :                                         replace_value = &quot;&quot;;</span>
<span class="lineNum">    3666 </span><span class="lineNoCov">              0 :                                         replace_len = 0;</span>
<span class="lineNum">    3667 </span>                :                                 }
<span class="lineNum">    3668 </span>                :                         }
<span class="lineNum">    3669 </span>                : 
<span class="lineNum">    3670 </span><span class="lineCov">            120 :                         if (Z_STRLEN_PP(search_entry) == 1) {</span>
<span class="lineNum">    3671 </span><span class="lineNoCov">              0 :                                 php_char_to_str_ex(Z_STRVAL_P(result),</span>
<span class="lineNum">    3672 </span><span class="lineNoCov">              0 :                                                                 Z_STRLEN_P(result),</span>
<span class="lineNum">    3673 </span><span class="lineNoCov">              0 :                                                                 Z_STRVAL_PP(search_entry)[0],</span>
<span class="lineNum">    3674 </span>                :                                                                 replace_value,
<span class="lineNum">    3675 </span>                :                                                                 replace_len,
<span class="lineNum">    3676 </span>                :                                                                 &amp;temp_result,
<span class="lineNum">    3677 </span>                :                                                                 case_sensitivity,
<span class="lineNum">    3678 </span>                :                                                                 replace_count);
<span class="lineNum">    3679 </span><span class="lineCov">            120 :                         } else if (Z_STRLEN_PP(search_entry) &gt; 1) {</span>
<span class="lineNum">    3680 </span><span class="lineCov">            240 :                                 Z_STRVAL(temp_result) = php_str_to_str_ex(Z_STRVAL_P(result), Z_STRLEN_P(result),</span>
<span class="lineNum">    3681 </span><span class="lineCov">            240 :                                                                                                                    Z_STRVAL_PP(search_entry), Z_STRLEN_PP(search_entry),</span>
<span class="lineNum">    3682 </span>                :                                                                                                                    replace_value, replace_len, &amp;Z_STRLEN(temp_result), case_sensitivity, replace_count);
<span class="lineNum">    3683 </span>                :                         }
<span class="lineNum">    3684 </span>                : 
<span class="lineNum">    3685 </span><span class="lineCov">            120 :            str_efree(Z_STRVAL_P(result));</span>
<span class="lineNum">    3686 </span><span class="lineCov">            120 :                         Z_STRVAL_P(result) = Z_STRVAL(temp_result);</span>
<span class="lineNum">    3687 </span><span class="lineCov">            120 :                         Z_STRLEN_P(result) = Z_STRLEN(temp_result);</span>
<span class="lineNum">    3688 </span>                : 
<span class="lineNum">    3689 </span><span class="lineCov">            120 :                         if (Z_STRLEN_P(result) == 0) {</span>
<span class="lineNum">    3690 </span><span class="lineNoCov">              0 :                                 return;</span>
<span class="lineNum">    3691 </span>                :                         }
<span class="lineNum">    3692 </span>                : 
<span class="lineNum">    3693 </span><span class="lineCov">            120 :                         zend_hash_move_forward(Z_ARRVAL_P(search));</span>
<span class="lineNum">    3694 </span>                :                 }
<span class="lineNum">    3695 </span>                :         } else {
<span class="lineNum">    3696 </span><span class="lineCov">            315 :                 if (Z_STRLEN_P(search) == 1) {</span>
<span class="lineNum">    3697 </span><span class="lineNoCov">              0 :                         php_char_to_str_ex(Z_STRVAL_PP(subject),</span>
<span class="lineNum">    3698 </span><span class="lineNoCov">              0 :                                                         Z_STRLEN_PP(subject),</span>
<span class="lineNum">    3699 </span><span class="lineNoCov">              0 :                                                         Z_STRVAL_P(search)[0],</span>
<span class="lineNum">    3700 </span>                :                                                         Z_STRVAL_P(replace),
<span class="lineNum">    3701 </span>                :                                                         Z_STRLEN_P(replace),
<span class="lineNum">    3702 </span>                :                                                         result,
<span class="lineNum">    3703 </span>                :                                                         case_sensitivity,
<span class="lineNum">    3704 </span>                :                                                         replace_count);
<span class="lineNum">    3705 </span><span class="lineCov">            315 :                 } else if (Z_STRLEN_P(search) &gt; 1) {</span>
<span class="lineNum">    3706 </span><span class="lineCov">            315 :                         Z_STRVAL_P(result) = php_str_to_str_ex(Z_STRVAL_PP(subject), Z_STRLEN_PP(subject),</span>
<span class="lineNum">    3707 </span>                :                                                                                                         Z_STRVAL_P(search), Z_STRLEN_P(search),
<span class="lineNum">    3708 </span>                :                                                                                                         Z_STRVAL_P(replace), Z_STRLEN_P(replace), &amp;Z_STRLEN_P(result), case_sensitivity, replace_count);
<span class="lineNum">    3709 </span>                :                 } else {
<span class="lineNum">    3710 </span><span class="lineNoCov">              0 :                         MAKE_COPY_ZVAL(subject, result);</span>
<span class="lineNum">    3711 </span>                :                 }
<span class="lineNum">    3712 </span>                :         }
<span class="lineNum">    3713 </span>                : }
<span class="lineNum">    3714 </span>                : /* }}} */
<span class="lineNum">    3715 </span>                : 
<a name="3716"><span class="lineNum">    3716 </span>                : /* {{{ php_str_replace_common</a>
<span class="lineNum">    3717 </span>                :  */
<span class="lineNum">    3718 </span><span class="lineCov">            426 : static void php_str_replace_common(INTERNAL_FUNCTION_PARAMETERS, int case_sensitivity)</span>
<span class="lineNum">    3719 </span>                : {
<span class="lineNum">    3720 </span><span class="lineCov">            426 :         zval **subject, **search, **replace, **subject_entry, **zcount = NULL;</span>
<span class="lineNum">    3721 </span>                :         zval *result;
<span class="lineNum">    3722 </span>                :         char *string_key;
<span class="lineNum">    3723 </span>                :         uint string_key_len;
<span class="lineNum">    3724 </span>                :         ulong num_key;
<span class="lineNum">    3725 </span><span class="lineCov">            426 :         int count = 0;</span>
<span class="lineNum">    3726 </span><span class="lineCov">            426 :         int argc = ZEND_NUM_ARGS();</span>
<span class="lineNum">    3727 </span>                : 
<span class="lineNum">    3728 </span><span class="lineCov">            426 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;ZZZ|Z&quot;, &amp;search, &amp;replace, &amp;subject, &amp;zcount) == FAILURE) {</span>
<span class="lineNum">    3729 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    3730 </span>                :         }
<span class="lineNum">    3731 </span>                : 
<span class="lineNum">    3732 </span><span class="lineCov">            852 :         SEPARATE_ZVAL(search);</span>
<span class="lineNum">    3733 </span><span class="lineCov">            852 :         SEPARATE_ZVAL(replace);</span>
<span class="lineNum">    3734 </span><span class="lineCov">           1702 :         SEPARATE_ZVAL(subject);</span>
<span class="lineNum">    3735 </span>                : 
<span class="lineNum">    3736 </span>                :         /* Make sure we're dealing with strings and do the replacement. */
<span class="lineNum">    3737 </span><span class="lineCov">            426 :         if (Z_TYPE_PP(search) != IS_ARRAY) {</span>
<span class="lineNum">    3738 </span><span class="lineCov">            338 :                 convert_to_string_ex(search);</span>
<span class="lineNum">    3739 </span><span class="lineCov">            338 :                 convert_to_string_ex(replace);</span>
<span class="lineNum">    3740 </span><span class="lineCov">             88 :         } else if (Z_TYPE_PP(replace) != IS_ARRAY) {</span>
<span class="lineNum">    3741 </span><span class="lineCov">             88 :                 convert_to_string_ex(replace);</span>
<span class="lineNum">    3742 </span>                :         }
<span class="lineNum">    3743 </span>                : 
<span class="lineNum">    3744 </span>                :         /* if subject is an array */
<span class="lineNum">    3745 </span><span class="lineCov">            426 :         if (Z_TYPE_PP(subject) == IS_ARRAY) {</span>
<span class="lineNum">    3746 </span><span class="lineNoCov">              0 :                 array_init(return_value);</span>
<span class="lineNum">    3747 </span><span class="lineNoCov">              0 :                 zend_hash_internal_pointer_reset(Z_ARRVAL_PP(subject));</span>
<span class="lineNum">    3748 </span>                : 
<span class="lineNum">    3749 </span>                :                 /* For each subject entry, convert it to string, then perform replacement
<span class="lineNum">    3750 </span>                :                    and add the result to the return_value array. */
<span class="lineNum">    3751 </span><span class="lineNoCov">              0 :                 while (zend_hash_get_current_data(Z_ARRVAL_PP(subject), (void **)&amp;subject_entry) == SUCCESS) {</span>
<span class="lineNum">    3752 </span><span class="lineNoCov">              0 :                         if (Z_TYPE_PP(subject_entry) != IS_ARRAY &amp;&amp; Z_TYPE_PP(subject_entry) != IS_OBJECT) {</span>
<span class="lineNum">    3753 </span><span class="lineNoCov">              0 :                                 MAKE_STD_ZVAL(result);</span>
<span class="lineNum">    3754 </span><span class="lineNoCov">              0 :                                 SEPARATE_ZVAL(subject_entry);</span>
<span class="lineNum">    3755 </span><span class="lineNoCov">              0 :                                 php_str_replace_in_subject(*search, *replace, subject_entry, result, case_sensitivity, (argc &gt; 3) ? &amp;count : NULL);</span>
<span class="lineNum">    3756 </span>                :                         } else {
<span class="lineNum">    3757 </span><span class="lineNoCov">              0 :                                 ALLOC_ZVAL(result);</span>
<span class="lineNum">    3758 </span><span class="lineNoCov">              0 :                                 Z_ADDREF_P(*subject_entry);</span>
<span class="lineNum">    3759 </span><span class="lineNoCov">              0 :                                 COPY_PZVAL_TO_ZVAL(*result, *subject_entry);</span>
<span class="lineNum">    3760 </span>                :                         }
<span class="lineNum">    3761 </span>                :                         /* Add to return array */
<span class="lineNum">    3762 </span><span class="lineNoCov">              0 :                         switch (zend_hash_get_current_key_ex(Z_ARRVAL_PP(subject), &amp;string_key,</span>
<span class="lineNum">    3763 </span><span class="lineNoCov">              0 :                                                                                                 &amp;string_key_len, &amp;num_key, 0, NULL)) {</span>
<span class="lineNum">    3764 </span>                :                                 case HASH_KEY_IS_STRING:
<span class="lineNum">    3765 </span><span class="lineNoCov">              0 :                                         add_assoc_zval_ex(return_value, string_key, string_key_len, result);</span>
<span class="lineNum">    3766 </span><span class="lineNoCov">              0 :                                         break;</span>
<span class="lineNum">    3767 </span>                : 
<span class="lineNum">    3768 </span>                :                                 case HASH_KEY_IS_LONG:
<span class="lineNum">    3769 </span><span class="lineNoCov">              0 :                                         add_index_zval(return_value, num_key, result);</span>
<span class="lineNum">    3770 </span>                :                                         break;
<span class="lineNum">    3771 </span>                :                         }
<span class="lineNum">    3772 </span>                : 
<span class="lineNum">    3773 </span><span class="lineNoCov">              0 :                         zend_hash_move_forward(Z_ARRVAL_PP(subject));</span>
<span class="lineNum">    3774 </span>                :                 }
<span class="lineNum">    3775 </span>                :         } else {        /* if subject is not an array */
<span class="lineNum">    3776 </span><span class="lineCov">            426 :                 php_str_replace_in_subject(*search, *replace, subject, return_value, case_sensitivity, (argc &gt; 3) ? &amp;count : NULL);</span>
<span class="lineNum">    3777 </span>                :         }
<span class="lineNum">    3778 </span><span class="lineCov">            426 :         if (argc &gt; 3) {</span>
<span class="lineNum">    3779 </span><span class="lineNoCov">              0 :                 zval_dtor(*zcount);</span>
<span class="lineNum">    3780 </span><span class="lineNoCov">              0 :                 ZVAL_LONG(*zcount, count);</span>
<span class="lineNum">    3781 </span>                :         }
<span class="lineNum">    3782 </span>                : }
<span class="lineNum">    3783 </span>                : /* }}} */
<span class="lineNum">    3784 </span>                : 
<a name="3785"><span class="lineNum">    3785 </span>                : /* {{{ proto mixed str_replace(mixed search, mixed replace, mixed subject [, int &amp;replace_count])</a>
<span class="lineNum">    3786 </span>                :    Replaces all occurrences of search in haystack with replace */
<span class="lineNum">    3787 </span><span class="lineCov">            426 : PHP_FUNCTION(str_replace)</span>
<span class="lineNum">    3788 </span>                : {
<span class="lineNum">    3789 </span><span class="lineCov">            426 :         php_str_replace_common(INTERNAL_FUNCTION_PARAM_PASSTHRU, 1);</span>
<span class="lineNum">    3790 </span><span class="lineCov">            426 : }</span>
<span class="lineNum">    3791 </span>                : /* }}} */
<span class="lineNum">    3792 </span>                : 
<a name="3793"><span class="lineNum">    3793 </span>                : /* {{{ proto mixed str_ireplace(mixed search, mixed replace, mixed subject [, int &amp;replace_count])</a>
<span class="lineNum">    3794 </span>                :    Replaces all occurrences of search in haystack with replace / case-insensitive */
<span class="lineNum">    3795 </span><span class="lineNoCov">              0 : PHP_FUNCTION(str_ireplace)</span>
<span class="lineNum">    3796 </span>                : {
<span class="lineNum">    3797 </span><span class="lineNoCov">              0 :         php_str_replace_common(INTERNAL_FUNCTION_PARAM_PASSTHRU, 0);</span>
<span class="lineNum">    3798 </span><span class="lineNoCov">              0 : }</span>
<span class="lineNum">    3799 </span>                : /* }}} */
<span class="lineNum">    3800 </span>                : 
<span class="lineNum">    3801 </span>                : /* {{{ php_hebrev
<span class="lineNum">    3802 </span>                :  *
<span class="lineNum">    3803 </span>                :  * Converts Logical Hebrew text (Hebrew Windows style) to Visual text
<a name="3804"><span class="lineNum">    3804 </span>                :  * Cheers/complaints/flames - Zeev Suraski &lt;zeev@php.net&gt;</a>
<span class="lineNum">    3805 </span>                :  */
<span class="lineNum">    3806 </span><span class="lineNoCov">              0 : static void php_hebrev(INTERNAL_FUNCTION_PARAMETERS, int convert_newlines)</span>
<span class="lineNum">    3807 </span>                : {
<span class="lineNum">    3808 </span>                :         char *str;
<span class="lineNum">    3809 </span>                :         char *heb_str, *tmp, *target, *broken_str;
<span class="lineNum">    3810 </span>                :         int block_start, block_end, block_type, block_length, i;
<span class="lineNum">    3811 </span><span class="lineNoCov">              0 :         long max_chars=0;</span>
<span class="lineNum">    3812 </span>                :         int begin, end, char_count, orig_begin;
<span class="lineNum">    3813 </span>                :         int str_len;
<span class="lineNum">    3814 </span>                : 
<span class="lineNum">    3815 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s|l&quot;, &amp;str, &amp;str_len, &amp;max_chars) == FAILURE) {</span>
<span class="lineNum">    3816 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    3817 </span>                :         }
<span class="lineNum">    3818 </span>                : 
<span class="lineNum">    3819 </span><span class="lineNoCov">              0 :         if (str_len == 0) {</span>
<span class="lineNum">    3820 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    3821 </span>                :         }
<span class="lineNum">    3822 </span>                : 
<span class="lineNum">    3823 </span><span class="lineNoCov">              0 :         tmp = str;</span>
<span class="lineNum">    3824 </span><span class="lineNoCov">              0 :         block_start=block_end=0;</span>
<span class="lineNum">    3825 </span>                : 
<span class="lineNum">    3826 </span><span class="lineNoCov">              0 :         heb_str = (char *) emalloc(str_len+1);</span>
<span class="lineNum">    3827 </span><span class="lineNoCov">              0 :         target = heb_str+str_len;</span>
<span class="lineNum">    3828 </span><span class="lineNoCov">              0 :         *target = 0;</span>
<span class="lineNum">    3829 </span><span class="lineNoCov">              0 :         target--;</span>
<span class="lineNum">    3830 </span>                : 
<span class="lineNum">    3831 </span><span class="lineNoCov">              0 :         block_length=0;</span>
<span class="lineNum">    3832 </span>                : 
<span class="lineNum">    3833 </span><span class="lineNoCov">              0 :         if (isheb(*tmp)) {</span>
<span class="lineNum">    3834 </span><span class="lineNoCov">              0 :                 block_type = _HEB_BLOCK_TYPE_HEB;</span>
<span class="lineNum">    3835 </span>                :         } else {
<span class="lineNum">    3836 </span><span class="lineNoCov">              0 :                 block_type = _HEB_BLOCK_TYPE_ENG;</span>
<span class="lineNum">    3837 </span>                :         }
<span class="lineNum">    3838 </span>                : 
<span class="lineNum">    3839 </span>                :         do {
<span class="lineNum">    3840 </span><span class="lineNoCov">              0 :                 if (block_type == _HEB_BLOCK_TYPE_HEB) {</span>
<span class="lineNum">    3841 </span><span class="lineNoCov">              0 :                         while ((isheb((int)*(tmp+1)) || _isblank((int)*(tmp+1)) || ispunct((int)*(tmp+1)) || (int)*(tmp+1)=='\n' ) &amp;&amp; block_end&lt;str_len-1) {</span>
<span class="lineNum">    3842 </span><span class="lineNoCov">              0 :                                 tmp++;</span>
<span class="lineNum">    3843 </span><span class="lineNoCov">              0 :                                 block_end++;</span>
<span class="lineNum">    3844 </span><span class="lineNoCov">              0 :                                 block_length++;</span>
<span class="lineNum">    3845 </span>                :                         }
<span class="lineNum">    3846 </span><span class="lineNoCov">              0 :                         for (i = block_start; i&lt;= block_end; i++) {</span>
<span class="lineNum">    3847 </span><span class="lineNoCov">              0 :                                 *target = str[i];</span>
<span class="lineNum">    3848 </span><span class="lineNoCov">              0 :                                 switch (*target) {</span>
<span class="lineNum">    3849 </span>                :                                         case '(':
<span class="lineNum">    3850 </span><span class="lineNoCov">              0 :                                                 *target = ')';</span>
<span class="lineNum">    3851 </span><span class="lineNoCov">              0 :                                                 break;</span>
<span class="lineNum">    3852 </span>                :                                         case ')':
<span class="lineNum">    3853 </span><span class="lineNoCov">              0 :                                                 *target = '(';</span>
<span class="lineNum">    3854 </span><span class="lineNoCov">              0 :                                                 break;</span>
<span class="lineNum">    3855 </span>                :                                         case '[':
<span class="lineNum">    3856 </span><span class="lineNoCov">              0 :                                                 *target = ']';</span>
<span class="lineNum">    3857 </span><span class="lineNoCov">              0 :                                                 break;</span>
<span class="lineNum">    3858 </span>                :                                         case ']':
<span class="lineNum">    3859 </span><span class="lineNoCov">              0 :                                                 *target = '[';</span>
<span class="lineNum">    3860 </span><span class="lineNoCov">              0 :                                                 break;</span>
<span class="lineNum">    3861 </span>                :                                         case '{':
<span class="lineNum">    3862 </span><span class="lineNoCov">              0 :                                                 *target = '}';</span>
<span class="lineNum">    3863 </span><span class="lineNoCov">              0 :                                                 break;</span>
<span class="lineNum">    3864 </span>                :                                         case '}':
<span class="lineNum">    3865 </span><span class="lineNoCov">              0 :                                                 *target = '{';</span>
<span class="lineNum">    3866 </span><span class="lineNoCov">              0 :                                                 break;</span>
<span class="lineNum">    3867 </span>                :                                         case '&lt;':
<span class="lineNum">    3868 </span><span class="lineNoCov">              0 :                                                 *target = '&gt;';</span>
<span class="lineNum">    3869 </span><span class="lineNoCov">              0 :                                                 break;</span>
<span class="lineNum">    3870 </span>                :                                         case '&gt;':
<span class="lineNum">    3871 </span><span class="lineNoCov">              0 :                                                 *target = '&lt;';</span>
<span class="lineNum">    3872 </span><span class="lineNoCov">              0 :                                                 break;</span>
<span class="lineNum">    3873 </span>                :                                         case '\\':
<span class="lineNum">    3874 </span><span class="lineNoCov">              0 :                                                 *target = '/';</span>
<span class="lineNum">    3875 </span><span class="lineNoCov">              0 :                                                 break;</span>
<span class="lineNum">    3876 </span>                :                                         case '/':
<span class="lineNum">    3877 </span><span class="lineNoCov">              0 :                                                 *target = '\\';</span>
<span class="lineNum">    3878 </span>                :                                                 break;
<span class="lineNum">    3879 </span>                :                                         default:
<span class="lineNum">    3880 </span>                :                                                 break;
<span class="lineNum">    3881 </span>                :                                 }
<span class="lineNum">    3882 </span><span class="lineNoCov">              0 :                                 target--;</span>
<span class="lineNum">    3883 </span>                :                         }
<span class="lineNum">    3884 </span><span class="lineNoCov">              0 :                         block_type = _HEB_BLOCK_TYPE_ENG;</span>
<span class="lineNum">    3885 </span>                :                 } else {
<span class="lineNum">    3886 </span><span class="lineNoCov">              0 :                         while (!isheb(*(tmp+1)) &amp;&amp; (int)*(tmp+1)!='\n' &amp;&amp; block_end &lt; str_len-1) {</span>
<span class="lineNum">    3887 </span><span class="lineNoCov">              0 :                                 tmp++;</span>
<span class="lineNum">    3888 </span><span class="lineNoCov">              0 :                                 block_end++;</span>
<span class="lineNum">    3889 </span><span class="lineNoCov">              0 :                                 block_length++;</span>
<span class="lineNum">    3890 </span>                :                         }
<span class="lineNum">    3891 </span><span class="lineNoCov">              0 :                         while ((_isblank((int)*tmp) || ispunct((int)*tmp)) &amp;&amp; *tmp!='/' &amp;&amp; *tmp!='-' &amp;&amp; block_end &gt; block_start) {</span>
<span class="lineNum">    3892 </span><span class="lineNoCov">              0 :                                 tmp--;</span>
<span class="lineNum">    3893 </span><span class="lineNoCov">              0 :                                 block_end--;</span>
<span class="lineNum">    3894 </span>                :                         }
<span class="lineNum">    3895 </span><span class="lineNoCov">              0 :                         for (i = block_end; i &gt;= block_start; i--) {</span>
<span class="lineNum">    3896 </span><span class="lineNoCov">              0 :                                 *target = str[i];</span>
<span class="lineNum">    3897 </span><span class="lineNoCov">              0 :                                 target--;</span>
<span class="lineNum">    3898 </span>                :                         }
<span class="lineNum">    3899 </span><span class="lineNoCov">              0 :                         block_type = _HEB_BLOCK_TYPE_HEB;</span>
<span class="lineNum">    3900 </span>                :                 }
<span class="lineNum">    3901 </span><span class="lineNoCov">              0 :                 block_start=block_end+1;</span>
<span class="lineNum">    3902 </span><span class="lineNoCov">              0 :         } while (block_end &lt; str_len-1);</span>
<span class="lineNum">    3903 </span>                : 
<span class="lineNum">    3904 </span>                : 
<span class="lineNum">    3905 </span><span class="lineNoCov">              0 :         broken_str = (char *) emalloc(str_len+1);</span>
<span class="lineNum">    3906 </span><span class="lineNoCov">              0 :         begin=end=str_len-1;</span>
<span class="lineNum">    3907 </span><span class="lineNoCov">              0 :         target = broken_str;</span>
<span class="lineNum">    3908 </span>                : 
<span class="lineNum">    3909 </span>                :         while (1) {
<span class="lineNum">    3910 </span><span class="lineNoCov">              0 :                 char_count=0;</span>
<span class="lineNum">    3911 </span><span class="lineNoCov">              0 :                 while ((!max_chars || char_count &lt; max_chars) &amp;&amp; begin &gt; 0) {</span>
<span class="lineNum">    3912 </span><span class="lineNoCov">              0 :                         char_count++;</span>
<span class="lineNum">    3913 </span><span class="lineNoCov">              0 :                         begin--;</span>
<span class="lineNum">    3914 </span><span class="lineNoCov">              0 :                         if (begin &lt;= 0 || _isnewline(heb_str[begin])) {</span>
<span class="lineNum">    3915 </span><span class="lineNoCov">              0 :                                 while (begin &gt; 0 &amp;&amp; _isnewline(heb_str[begin-1])) {</span>
<span class="lineNum">    3916 </span><span class="lineNoCov">              0 :                                         begin--;</span>
<span class="lineNum">    3917 </span><span class="lineNoCov">              0 :                                         char_count++;</span>
<span class="lineNum">    3918 </span>                :                                 }
<span class="lineNum">    3919 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    3920 </span>                :                         }
<span class="lineNum">    3921 </span>                :                 }
<span class="lineNum">    3922 </span><span class="lineNoCov">              0 :                 if (char_count == max_chars) { /* try to avoid breaking words */</span>
<span class="lineNum">    3923 </span><span class="lineNoCov">              0 :                         int new_char_count=char_count, new_begin=begin;</span>
<span class="lineNum">    3924 </span>                : 
<span class="lineNum">    3925 </span><span class="lineNoCov">              0 :                         while (new_char_count &gt; 0) {</span>
<span class="lineNum">    3926 </span><span class="lineNoCov">              0 :                                 if (_isblank(heb_str[new_begin]) || _isnewline(heb_str[new_begin])) {</span>
<span class="lineNum">    3927 </span>                :                                         break;
<span class="lineNum">    3928 </span>                :                                 }
<span class="lineNum">    3929 </span><span class="lineNoCov">              0 :                                 new_begin++;</span>
<span class="lineNum">    3930 </span><span class="lineNoCov">              0 :                                 new_char_count--;</span>
<span class="lineNum">    3931 </span>                :                         }
<span class="lineNum">    3932 </span><span class="lineNoCov">              0 :                         if (new_char_count &gt; 0) {</span>
<span class="lineNum">    3933 </span><span class="lineNoCov">              0 :                                 char_count=new_char_count;</span>
<span class="lineNum">    3934 </span><span class="lineNoCov">              0 :                                 begin=new_begin;</span>
<span class="lineNum">    3935 </span>                :                         }
<span class="lineNum">    3936 </span>                :                 }
<span class="lineNum">    3937 </span><span class="lineNoCov">              0 :                 orig_begin=begin;</span>
<span class="lineNum">    3938 </span>                : 
<span class="lineNum">    3939 </span><span class="lineNoCov">              0 :                 if (_isblank(heb_str[begin])) {</span>
<span class="lineNum">    3940 </span><span class="lineNoCov">              0 :                         heb_str[begin]='\n';</span>
<span class="lineNum">    3941 </span>                :                 }
<span class="lineNum">    3942 </span><span class="lineNoCov">              0 :                 while (begin &lt;= end &amp;&amp; _isnewline(heb_str[begin])) { /* skip leading newlines */</span>
<span class="lineNum">    3943 </span><span class="lineNoCov">              0 :                         begin++;</span>
<span class="lineNum">    3944 </span>                :                 }
<span class="lineNum">    3945 </span><span class="lineNoCov">              0 :                 for (i = begin; i &lt;= end; i++) { /* copy content */</span>
<span class="lineNum">    3946 </span><span class="lineNoCov">              0 :                         *target = heb_str[i];</span>
<span class="lineNum">    3947 </span><span class="lineNoCov">              0 :                         target++;</span>
<span class="lineNum">    3948 </span>                :                 }
<span class="lineNum">    3949 </span><span class="lineNoCov">              0 :                 for (i = orig_begin; i &lt;= end &amp;&amp; _isnewline(heb_str[i]); i++) {</span>
<span class="lineNum">    3950 </span><span class="lineNoCov">              0 :                         *target = heb_str[i];</span>
<span class="lineNum">    3951 </span><span class="lineNoCov">              0 :                         target++;</span>
<span class="lineNum">    3952 </span>                :                 }
<span class="lineNum">    3953 </span><span class="lineNoCov">              0 :                 begin=orig_begin;</span>
<span class="lineNum">    3954 </span>                : 
<span class="lineNum">    3955 </span><span class="lineNoCov">              0 :                 if (begin &lt;= 0) {</span>
<span class="lineNum">    3956 </span><span class="lineNoCov">              0 :                         *target = 0;</span>
<span class="lineNum">    3957 </span>                :                         break;
<span class="lineNum">    3958 </span>                :                 }
<span class="lineNum">    3959 </span><span class="lineNoCov">              0 :                 begin--;</span>
<span class="lineNum">    3960 </span><span class="lineNoCov">              0 :                 end=begin;</span>
<span class="lineNum">    3961 </span><span class="lineNoCov">              0 :         }</span>
<span class="lineNum">    3962 </span><span class="lineNoCov">              0 :         efree(heb_str);</span>
<span class="lineNum">    3963 </span>                : 
<span class="lineNum">    3964 </span><span class="lineNoCov">              0 :         if (convert_newlines) {</span>
<span class="lineNum">    3965 </span><span class="lineNoCov">              0 :                 php_char_to_str(broken_str, str_len,'\n', &quot;&lt;br /&gt;\n&quot;, 7, return_value);</span>
<span class="lineNum">    3966 </span><span class="lineNoCov">              0 :                 efree(broken_str);</span>
<span class="lineNum">    3967 </span>                :         } else {
<span class="lineNum">    3968 </span><span class="lineNoCov">              0 :                 Z_STRVAL_P(return_value) = broken_str;</span>
<span class="lineNum">    3969 </span><span class="lineNoCov">              0 :                 Z_STRLEN_P(return_value) = str_len;</span>
<span class="lineNum">    3970 </span><span class="lineNoCov">              0 :                 Z_TYPE_P(return_value) = IS_STRING;</span>
<span class="lineNum">    3971 </span>                :         }
<span class="lineNum">    3972 </span>                : }
<span class="lineNum">    3973 </span>                : /* }}} */
<span class="lineNum">    3974 </span>                : 
<a name="3975"><span class="lineNum">    3975 </span>                : /* {{{ proto string hebrev(string str [, int max_chars_per_line])</a>
<span class="lineNum">    3976 </span>                :    Converts logical Hebrew text to visual text */
<span class="lineNum">    3977 </span><span class="lineNoCov">              0 : PHP_FUNCTION(hebrev)</span>
<span class="lineNum">    3978 </span>                : {
<span class="lineNum">    3979 </span><span class="lineNoCov">              0 :         php_hebrev(INTERNAL_FUNCTION_PARAM_PASSTHRU, 0);</span>
<span class="lineNum">    3980 </span><span class="lineNoCov">              0 : }</span>
<span class="lineNum">    3981 </span>                : /* }}} */
<span class="lineNum">    3982 </span>                : 
<a name="3983"><span class="lineNum">    3983 </span>                : /* {{{ proto string hebrevc(string str [, int max_chars_per_line])</a>
<span class="lineNum">    3984 </span>                :    Converts logical Hebrew text to visual text with newline conversion */
<span class="lineNum">    3985 </span><span class="lineNoCov">              0 : PHP_FUNCTION(hebrevc)</span>
<span class="lineNum">    3986 </span>                : {
<span class="lineNum">    3987 </span><span class="lineNoCov">              0 :         php_hebrev(INTERNAL_FUNCTION_PARAM_PASSTHRU, 1);</span>
<span class="lineNum">    3988 </span><span class="lineNoCov">              0 : }</span>
<span class="lineNum">    3989 </span>                : /* }}} */
<span class="lineNum">    3990 </span>                : 
<a name="3991"><span class="lineNum">    3991 </span>                : /* {{{ proto string nl2br(string str [, bool is_xhtml])</a>
<span class="lineNum">    3992 </span>                :    Converts newlines to HTML line breaks */
<span class="lineNum">    3993 </span><span class="lineNoCov">              0 : PHP_FUNCTION(nl2br)</span>
<span class="lineNum">    3994 </span>                : {
<span class="lineNum">    3995 </span>                :         /* in brief this inserts &lt;br /&gt; or &lt;br&gt; before matched regexp \n\r?|\r\n? */
<span class="lineNum">    3996 </span>                :         char            *tmp, *str;
<span class="lineNum">    3997 </span>                :         int             new_length;
<span class="lineNum">    3998 </span>                :         char            *end, *target;
<span class="lineNum">    3999 </span><span class="lineNoCov">              0 :         int             repl_cnt = 0;</span>
<span class="lineNum">    4000 </span>                :         int             str_len;
<span class="lineNum">    4001 </span><span class="lineNoCov">              0 :         zend_bool       is_xhtml = 1;</span>
<span class="lineNum">    4002 </span>                : 
<span class="lineNum">    4003 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s|b&quot;, &amp;str, &amp;str_len, &amp;is_xhtml) == FAILURE) {</span>
<span class="lineNum">    4004 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    4005 </span>                :         }
<span class="lineNum">    4006 </span>                : 
<span class="lineNum">    4007 </span><span class="lineNoCov">              0 :         tmp = str;</span>
<span class="lineNum">    4008 </span><span class="lineNoCov">              0 :         end = str + str_len;</span>
<span class="lineNum">    4009 </span>                : 
<span class="lineNum">    4010 </span>                :         /* it is really faster to scan twice and allocate mem once instead of scanning once
<span class="lineNum">    4011 </span>                :            and constantly reallocing */
<span class="lineNum">    4012 </span><span class="lineNoCov">              0 :         while (tmp &lt; end) {</span>
<span class="lineNum">    4013 </span><span class="lineNoCov">              0 :                 if (*tmp == '\r') {</span>
<span class="lineNum">    4014 </span><span class="lineNoCov">              0 :                         if (*(tmp+1) == '\n') {</span>
<span class="lineNum">    4015 </span><span class="lineNoCov">              0 :                                 tmp++;</span>
<span class="lineNum">    4016 </span>                :                         }
<span class="lineNum">    4017 </span><span class="lineNoCov">              0 :                         repl_cnt++;</span>
<span class="lineNum">    4018 </span><span class="lineNoCov">              0 :                 } else if (*tmp == '\n') {</span>
<span class="lineNum">    4019 </span><span class="lineNoCov">              0 :                         if (*(tmp+1) == '\r') {</span>
<span class="lineNum">    4020 </span><span class="lineNoCov">              0 :                                 tmp++;</span>
<span class="lineNum">    4021 </span>                :                         }
<span class="lineNum">    4022 </span><span class="lineNoCov">              0 :                         repl_cnt++;</span>
<span class="lineNum">    4023 </span>                :                 }
<span class="lineNum">    4024 </span>                : 
<span class="lineNum">    4025 </span><span class="lineNoCov">              0 :                 tmp++;</span>
<span class="lineNum">    4026 </span>                :         }
<span class="lineNum">    4027 </span>                : 
<span class="lineNum">    4028 </span><span class="lineNoCov">              0 :         if (repl_cnt == 0) {</span>
<span class="lineNum">    4029 </span><span class="lineNoCov">              0 :                 RETURN_STRINGL(str, str_len, 1);</span>
<span class="lineNum">    4030 </span>                :         }
<span class="lineNum">    4031 </span>                : 
<span class="lineNum">    4032 </span><span class="lineNoCov">              0 :         if (is_xhtml) {</span>
<span class="lineNum">    4033 </span><span class="lineNoCov">              0 :                 new_length = str_len + repl_cnt * (sizeof(&quot;&lt;br /&gt;&quot;) - 1);</span>
<span class="lineNum">    4034 </span>                :         } else {
<span class="lineNum">    4035 </span><span class="lineNoCov">              0 :                 new_length = str_len + repl_cnt * (sizeof(&quot;&lt;br&gt;&quot;) - 1);</span>
<span class="lineNum">    4036 </span>                :         }
<span class="lineNum">    4037 </span>                : 
<span class="lineNum">    4038 </span><span class="lineNoCov">              0 :         tmp = target = emalloc(new_length + 1);</span>
<span class="lineNum">    4039 </span>                : 
<span class="lineNum">    4040 </span><span class="lineNoCov">              0 :         while (str &lt; end) {</span>
<span class="lineNum">    4041 </span><span class="lineNoCov">              0 :                 switch (*str) {</span>
<span class="lineNum">    4042 </span>                :                         case '\r':
<span class="lineNum">    4043 </span>                :                         case '\n':
<span class="lineNum">    4044 </span><span class="lineNoCov">              0 :                                 *target++ = '&lt;';</span>
<span class="lineNum">    4045 </span><span class="lineNoCov">              0 :                                 *target++ = 'b';</span>
<span class="lineNum">    4046 </span><span class="lineNoCov">              0 :                                 *target++ = 'r';</span>
<span class="lineNum">    4047 </span>                : 
<span class="lineNum">    4048 </span><span class="lineNoCov">              0 :                                 if (is_xhtml) {</span>
<span class="lineNum">    4049 </span><span class="lineNoCov">              0 :                                         *target++ = ' ';</span>
<span class="lineNum">    4050 </span><span class="lineNoCov">              0 :                                         *target++ = '/';</span>
<span class="lineNum">    4051 </span>                :                                 }
<span class="lineNum">    4052 </span>                : 
<span class="lineNum">    4053 </span><span class="lineNoCov">              0 :                                 *target++ = '&gt;';</span>
<span class="lineNum">    4054 </span>                : 
<span class="lineNum">    4055 </span><span class="lineNoCov">              0 :                                 if ((*str == '\r' &amp;&amp; *(str+1) == '\n') || (*str == '\n' &amp;&amp; *(str+1) == '\r')) {</span>
<span class="lineNum">    4056 </span><span class="lineNoCov">              0 :                                         *target++ = *str++;</span>
<span class="lineNum">    4057 </span>                :                                 }
<span class="lineNum">    4058 </span>                :                                 /* lack of a break; is intentional */
<span class="lineNum">    4059 </span>                :                         default:
<span class="lineNum">    4060 </span><span class="lineNoCov">              0 :                                 *target++ = *str;</span>
<span class="lineNum">    4061 </span>                :                 }
<span class="lineNum">    4062 </span>                : 
<span class="lineNum">    4063 </span><span class="lineNoCov">              0 :                 str++;</span>
<span class="lineNum">    4064 </span>                :         }
<span class="lineNum">    4065 </span>                : 
<span class="lineNum">    4066 </span><span class="lineNoCov">              0 :         *target = '\0';</span>
<span class="lineNum">    4067 </span>                : 
<span class="lineNum">    4068 </span><span class="lineNoCov">              0 :         RETURN_STRINGL(tmp, new_length, 0);</span>
<span class="lineNum">    4069 </span>                : }
<span class="lineNum">    4070 </span>                : /* }}} */
<span class="lineNum">    4071 </span>                : 
<a name="4072"><span class="lineNum">    4072 </span>                : /* {{{ proto string strip_tags(string str [, string allowable_tags])</a>
<span class="lineNum">    4073 </span>                :    Strips HTML and PHP tags from a string */
<span class="lineNum">    4074 </span><span class="lineNoCov">              0 : PHP_FUNCTION(strip_tags)</span>
<span class="lineNum">    4075 </span>                : {
<span class="lineNum">    4076 </span>                :         char *buf;
<span class="lineNum">    4077 </span>                :         char *str;
<span class="lineNum">    4078 </span><span class="lineNoCov">              0 :         zval **allow=NULL;</span>
<span class="lineNum">    4079 </span><span class="lineNoCov">              0 :         char *allowed_tags=NULL;</span>
<span class="lineNum">    4080 </span><span class="lineNoCov">              0 :         int allowed_tags_len=0;</span>
<span class="lineNum">    4081 </span>                :         int str_len;
<span class="lineNum">    4082 </span>                :         size_t retval_len;
<span class="lineNum">    4083 </span>                : 
<span class="lineNum">    4084 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s|Z&quot;, &amp;str, &amp;str_len, &amp;allow) == FAILURE) {</span>
<span class="lineNum">    4085 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    4086 </span>                :         }
<span class="lineNum">    4087 </span>                : 
<span class="lineNum">    4088 </span>                :         /* To maintain a certain BC, we allow anything for the second parameter and return original string */
<span class="lineNum">    4089 </span><span class="lineNoCov">              0 :         if (allow != NULL) {</span>
<span class="lineNum">    4090 </span><span class="lineNoCov">              0 :                 convert_to_string_ex(allow);</span>
<span class="lineNum">    4091 </span><span class="lineNoCov">              0 :                 allowed_tags = Z_STRVAL_PP(allow);</span>
<span class="lineNum">    4092 </span><span class="lineNoCov">              0 :                 allowed_tags_len = Z_STRLEN_PP(allow);</span>
<span class="lineNum">    4093 </span>                :         }
<span class="lineNum">    4094 </span>                : 
<span class="lineNum">    4095 </span><span class="lineNoCov">              0 :         buf = estrndup(str, str_len);</span>
<span class="lineNum">    4096 </span><span class="lineNoCov">              0 :         retval_len = php_strip_tags_ex(buf, str_len, NULL, allowed_tags, allowed_tags_len, 0);</span>
<span class="lineNum">    4097 </span><span class="lineNoCov">              0 :         RETURN_STRINGL(buf, retval_len, 0);</span>
<span class="lineNum">    4098 </span>                : }
<span class="lineNum">    4099 </span>                : /* }}} */
<span class="lineNum">    4100 </span>                : 
<a name="4101"><span class="lineNum">    4101 </span>                : /* {{{ proto string setlocale(mixed category, string locale [, string ...])</a>
<span class="lineNum">    4102 </span>                :    Set locale information */
<span class="lineNum">    4103 </span><span class="lineNoCov">              0 : PHP_FUNCTION(setlocale)</span>
<span class="lineNum">    4104 </span>                : {
<span class="lineNum">    4105 </span><span class="lineNoCov">              0 :         zval ***args = NULL;</span>
<span class="lineNum">    4106 </span>                :         zval **pcategory, **plocale;
<span class="lineNum">    4107 </span><span class="lineNoCov">              0 :         int num_args, cat, i = 0;</span>
<span class="lineNum">    4108 </span>                :         char *loc, *retval;
<span class="lineNum">    4109 </span>                : 
<span class="lineNum">    4110 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;Z+&quot;, &amp;pcategory, &amp;args, &amp;num_args) == FAILURE) {</span>
<span class="lineNum">    4111 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    4112 </span>                :         }
<span class="lineNum">    4113 </span>                : 
<span class="lineNum">    4114 </span>                : #ifdef HAVE_SETLOCALE
<span class="lineNum">    4115 </span><span class="lineNoCov">              0 :         if (Z_TYPE_PP(pcategory) == IS_LONG) {</span>
<span class="lineNum">    4116 </span><span class="lineNoCov">              0 :                 convert_to_long_ex(pcategory);</span>
<span class="lineNum">    4117 </span><span class="lineNoCov">              0 :                 cat = Z_LVAL_PP(pcategory);</span>
<span class="lineNum">    4118 </span>                :         } else {
<span class="lineNum">    4119 </span>                :                 /* FIXME: The following behaviour should be removed. */
<span class="lineNum">    4120 </span>                :                 char *category;
<span class="lineNum">    4121 </span>                : 
<span class="lineNum">    4122 </span><span class="lineNoCov">              0 :                 php_error_docref(NULL TSRMLS_CC, E_DEPRECATED, &quot;Passing locale category name as string is deprecated. Use the LC_* -constants instead&quot;);</span>
<span class="lineNum">    4123 </span>                : 
<span class="lineNum">    4124 </span><span class="lineNoCov">              0 :                 convert_to_string_ex(pcategory);</span>
<span class="lineNum">    4125 </span><span class="lineNoCov">              0 :                 category = Z_STRVAL_PP(pcategory);</span>
<span class="lineNum">    4126 </span>                : 
<span class="lineNum">    4127 </span><span class="lineNoCov">              0 :                 if (!strcasecmp(&quot;LC_ALL&quot;, category)) {</span>
<span class="lineNum">    4128 </span><span class="lineNoCov">              0 :                         cat = LC_ALL;</span>
<span class="lineNum">    4129 </span><span class="lineNoCov">              0 :                 } else if (!strcasecmp(&quot;LC_COLLATE&quot;, category)) {</span>
<span class="lineNum">    4130 </span><span class="lineNoCov">              0 :                         cat = LC_COLLATE;</span>
<span class="lineNum">    4131 </span><span class="lineNoCov">              0 :                 } else if (!strcasecmp(&quot;LC_CTYPE&quot;, category)) {</span>
<span class="lineNum">    4132 </span><span class="lineNoCov">              0 :                         cat = LC_CTYPE;</span>
<span class="lineNum">    4133 </span>                : #ifdef LC_MESSAGES
<span class="lineNum">    4134 </span><span class="lineNoCov">              0 :                 } else if (!strcasecmp(&quot;LC_MESSAGES&quot;, category)) {</span>
<span class="lineNum">    4135 </span><span class="lineNoCov">              0 :                         cat = LC_MESSAGES;</span>
<span class="lineNum">    4136 </span>                : #endif
<span class="lineNum">    4137 </span><span class="lineNoCov">              0 :                 } else if (!strcasecmp(&quot;LC_MONETARY&quot;, category)) {</span>
<span class="lineNum">    4138 </span><span class="lineNoCov">              0 :                         cat = LC_MONETARY;</span>
<span class="lineNum">    4139 </span><span class="lineNoCov">              0 :                 } else if (!strcasecmp(&quot;LC_NUMERIC&quot;, category)) {</span>
<span class="lineNum">    4140 </span><span class="lineNoCov">              0 :                         cat = LC_NUMERIC;</span>
<span class="lineNum">    4141 </span><span class="lineNoCov">              0 :                 } else if (!strcasecmp(&quot;LC_TIME&quot;, category)) {</span>
<span class="lineNum">    4142 </span><span class="lineNoCov">              0 :                         cat = LC_TIME;</span>
<span class="lineNum">    4143 </span>                :                 } else {
<span class="lineNum">    4144 </span><span class="lineNoCov">              0 :                         php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Invalid locale category name %s, must be one of LC_ALL, LC_COLLATE, LC_CTYPE, LC_MONETARY, LC_NUMERIC, or LC_TIME&quot;, category);</span>
<span class="lineNum">    4145 </span>                : 
<span class="lineNum">    4146 </span><span class="lineNoCov">              0 :                         if (args) {</span>
<span class="lineNum">    4147 </span><span class="lineNoCov">              0 :                                 efree(args);</span>
<span class="lineNum">    4148 </span>                :                         }
<span class="lineNum">    4149 </span><span class="lineNoCov">              0 :                         RETURN_FALSE;</span>
<span class="lineNum">    4150 </span>                :                 }
<span class="lineNum">    4151 </span>                :         }
<span class="lineNum">    4152 </span>                : 
<span class="lineNum">    4153 </span><span class="lineNoCov">              0 :         if (Z_TYPE_PP(args[0]) == IS_ARRAY) {</span>
<span class="lineNum">    4154 </span><span class="lineNoCov">              0 :                 zend_hash_internal_pointer_reset(Z_ARRVAL_PP(args[0]));</span>
<span class="lineNum">    4155 </span>                :         }
<span class="lineNum">    4156 </span>                : 
<span class="lineNum">    4157 </span>                :         while (1) {
<span class="lineNum">    4158 </span><span class="lineNoCov">              0 :                 if (Z_TYPE_PP(args[0]) == IS_ARRAY) {</span>
<span class="lineNum">    4159 </span><span class="lineNoCov">              0 :                         if (!zend_hash_num_elements(Z_ARRVAL_PP(args[0]))) {</span>
<span class="lineNum">    4160 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    4161 </span>                :                         }
<span class="lineNum">    4162 </span><span class="lineNoCov">              0 :                         zend_hash_get_current_data(Z_ARRVAL_PP(args[0]), (void **)&amp;plocale);</span>
<span class="lineNum">    4163 </span>                :                 } else {
<span class="lineNum">    4164 </span><span class="lineNoCov">              0 :                         plocale = args[i];</span>
<span class="lineNum">    4165 </span>                :                 }
<span class="lineNum">    4166 </span>                : 
<span class="lineNum">    4167 </span><span class="lineNoCov">              0 :                 convert_to_string_ex(plocale);</span>
<span class="lineNum">    4168 </span>                : 
<span class="lineNum">    4169 </span><span class="lineNoCov">              0 :                 if (!strcmp (&quot;0&quot;, Z_STRVAL_PP(plocale))) {</span>
<span class="lineNum">    4170 </span><span class="lineNoCov">              0 :                         loc = NULL;</span>
<span class="lineNum">    4171 </span>                :                 } else {
<span class="lineNum">    4172 </span><span class="lineNoCov">              0 :                         loc = Z_STRVAL_PP(plocale);</span>
<span class="lineNum">    4173 </span><span class="lineNoCov">              0 :                         if (Z_STRLEN_PP(plocale) &gt;= 255) {</span>
<span class="lineNum">    4174 </span><span class="lineNoCov">              0 :                                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Specified locale name is too long&quot;);</span>
<span class="lineNum">    4175 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    4176 </span>                :                         }
<span class="lineNum">    4177 </span>                :                 }
<span class="lineNum">    4178 </span>                : 
<span class="lineNum">    4179 </span><span class="lineNoCov">              0 :                 retval = php_my_setlocale(cat, loc);</span>
<span class="lineNum">    4180 </span>                :                 zend_update_current_locale();
<span class="lineNum">    4181 </span><span class="lineNoCov">              0 :                 if (retval) {</span>
<span class="lineNum">    4182 </span>                :                         /* Remember if locale was changed */
<span class="lineNum">    4183 </span><span class="lineNoCov">              0 :                         if (loc) {</span>
<span class="lineNum">    4184 </span><span class="lineNoCov">              0 :                                 STR_FREE(BG(locale_string));</span>
<span class="lineNum">    4185 </span><span class="lineNoCov">              0 :                                 BG(locale_string) = estrdup(retval);</span>
<span class="lineNum">    4186 </span>                :                         }
<span class="lineNum">    4187 </span>                : 
<span class="lineNum">    4188 </span><span class="lineNoCov">              0 :                         if (args) {</span>
<span class="lineNum">    4189 </span><span class="lineNoCov">              0 :                                 efree(args);</span>
<span class="lineNum">    4190 </span>                :                         }
<span class="lineNum">    4191 </span><span class="lineNoCov">              0 :                         RETURN_STRING(retval, 1);</span>
<span class="lineNum">    4192 </span>                :                 }
<span class="lineNum">    4193 </span>                : 
<span class="lineNum">    4194 </span><span class="lineNoCov">              0 :                 if (Z_TYPE_PP(args[0]) == IS_ARRAY) {</span>
<span class="lineNum">    4195 </span><span class="lineNoCov">              0 :                         if (zend_hash_move_forward(Z_ARRVAL_PP(args[0])) == FAILURE) break;</span>
<span class="lineNum">    4196 </span>                :                 } else {
<span class="lineNum">    4197 </span><span class="lineNoCov">              0 :                         if (++i &gt;= num_args) break;</span>
<span class="lineNum">    4198 </span>                :                 }
<span class="lineNum">    4199 </span><span class="lineNoCov">              0 :         }</span>
<span class="lineNum">    4200 </span>                : 
<span class="lineNum">    4201 </span>                : #endif
<span class="lineNum">    4202 </span><span class="lineNoCov">              0 :         if (args) {</span>
<span class="lineNum">    4203 </span><span class="lineNoCov">              0 :                 efree(args);</span>
<span class="lineNum">    4204 </span>                :         }
<span class="lineNum">    4205 </span><span class="lineNoCov">              0 :         RETURN_FALSE;</span>
<span class="lineNum">    4206 </span>                : }
<span class="lineNum">    4207 </span>                : /* }}} */
<span class="lineNum">    4208 </span>                : 
<a name="4209"><span class="lineNum">    4209 </span>                : /* {{{ proto void parse_str(string encoded_string [, array result])</a>
<span class="lineNum">    4210 </span>                :    Parses GET/POST/COOKIE data and sets global variables */
<span class="lineNum">    4211 </span><span class="lineNoCov">              0 : PHP_FUNCTION(parse_str)</span>
<span class="lineNum">    4212 </span>                : {
<span class="lineNum">    4213 </span>                :         char *arg;
<span class="lineNum">    4214 </span><span class="lineNoCov">              0 :         zval *arrayArg = NULL;</span>
<span class="lineNum">    4215 </span><span class="lineNoCov">              0 :         char *res = NULL;</span>
<span class="lineNum">    4216 </span>                :         int arglen;
<span class="lineNum">    4217 </span>                : 
<span class="lineNum">    4218 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s|z&quot;, &amp;arg, &amp;arglen, &amp;arrayArg) == FAILURE) {</span>
<span class="lineNum">    4219 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    4220 </span>                :         }
<span class="lineNum">    4221 </span>                : 
<span class="lineNum">    4222 </span><span class="lineNoCov">              0 :         res = estrndup(arg, arglen);</span>
<span class="lineNum">    4223 </span>                : 
<span class="lineNum">    4224 </span><span class="lineNoCov">              0 :         if (arrayArg == NULL) {</span>
<span class="lineNum">    4225 </span>                :                 zval tmp;
<span class="lineNum">    4226 </span>                : 
<span class="lineNum">    4227 </span><span class="lineNoCov">              0 :                 if (!EG(active_symbol_table)) {</span>
<span class="lineNum">    4228 </span><span class="lineNoCov">              0 :                         zend_rebuild_symbol_table(TSRMLS_C);</span>
<span class="lineNum">    4229 </span>                :                 }
<span class="lineNum">    4230 </span><span class="lineNoCov">              0 :                 Z_ARRVAL(tmp) = EG(active_symbol_table);</span>
<span class="lineNum">    4231 </span><span class="lineNoCov">              0 :                 sapi_module.treat_data(PARSE_STRING, res, &amp;tmp TSRMLS_CC);</span>
<span class="lineNum">    4232 </span>                :         } else  {
<span class="lineNum">    4233 </span>                :                 zval ret;
<span class="lineNum">    4234 </span>                : 
<span class="lineNum">    4235 </span><span class="lineNoCov">              0 :                 array_init(&amp;ret);</span>
<span class="lineNum">    4236 </span><span class="lineNoCov">              0 :                 sapi_module.treat_data(PARSE_STRING, res, &amp;ret TSRMLS_CC);</span>
<span class="lineNum">    4237 </span>                :                 /* Clear out the array that was passed in. */
<span class="lineNum">    4238 </span><span class="lineNoCov">              0 :                 zval_dtor(arrayArg);</span>
<span class="lineNum">    4239 </span><span class="lineNoCov">              0 :                 ZVAL_COPY_VALUE(arrayArg, &amp;ret);</span>
<span class="lineNum">    4240 </span>                :         }
<span class="lineNum">    4241 </span>                : }
<span class="lineNum">    4242 </span>                : /* }}} */
<span class="lineNum">    4243 </span>                : 
<span class="lineNum">    4244 </span>                : #define PHP_TAG_BUF_SIZE 1023
<span class="lineNum">    4245 </span>                : 
<span class="lineNum">    4246 </span>                : /* {{{ php_tag_find
<span class="lineNum">    4247 </span>                :  *
<span class="lineNum">    4248 </span>                :  * Check if tag is in a set of tags
<span class="lineNum">    4249 </span>                :  *
<span class="lineNum">    4250 </span>                :  * states:
<span class="lineNum">    4251 </span>                :  *
<span class="lineNum">    4252 </span>                :  * 0 start tag
<a name="4253"><span class="lineNum">    4253 </span>                :  * 1 first non-whitespace char seen</a>
<span class="lineNum">    4254 </span>                :  */
<span class="lineNum">    4255 </span><span class="lineNoCov">              0 : int php_tag_find(char *tag, int len, char *set) {</span>
<span class="lineNum">    4256 </span>                :         char c, *n, *t;
<span class="lineNum">    4257 </span><span class="lineNoCov">              0 :         int state=0, done=0;</span>
<span class="lineNum">    4258 </span>                :         char *norm;
<span class="lineNum">    4259 </span>                : 
<span class="lineNum">    4260 </span><span class="lineNoCov">              0 :         if (len &lt;= 0) {</span>
<span class="lineNum">    4261 </span><span class="lineNoCov">              0 :                 return 0;</span>
<span class="lineNum">    4262 </span>                :         }
<span class="lineNum">    4263 </span>                : 
<span class="lineNum">    4264 </span><span class="lineNoCov">              0 :         norm = emalloc(len+1);</span>
<span class="lineNum">    4265 </span>                : 
<span class="lineNum">    4266 </span><span class="lineNoCov">              0 :         n = norm;</span>
<span class="lineNum">    4267 </span><span class="lineNoCov">              0 :         t = tag;</span>
<span class="lineNum">    4268 </span><span class="lineNoCov">              0 :         c = tolower(*t);</span>
<span class="lineNum">    4269 </span>                :         /*
<span class="lineNum">    4270 </span>                :            normalize the tag removing leading and trailing whitespace
<span class="lineNum">    4271 </span>                :            and turn any &lt;a whatever...&gt; into just &lt;a&gt; and any &lt;/tag&gt;
<span class="lineNum">    4272 </span>                :            into &lt;tag&gt;
<span class="lineNum">    4273 </span>                :         */
<span class="lineNum">    4274 </span><span class="lineNoCov">              0 :         while (!done) {</span>
<span class="lineNum">    4275 </span><span class="lineNoCov">              0 :                 switch (c) {</span>
<span class="lineNum">    4276 </span>                :                         case '&lt;':
<span class="lineNum">    4277 </span><span class="lineNoCov">              0 :                                 *(n++) = c;</span>
<span class="lineNum">    4278 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    4279 </span>                :                         case '&gt;':
<span class="lineNum">    4280 </span><span class="lineNoCov">              0 :                                 done =1;</span>
<span class="lineNum">    4281 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    4282 </span>                :                         default:
<span class="lineNum">    4283 </span><span class="lineNoCov">              0 :                                 if (!isspace((int)c)) {</span>
<span class="lineNum">    4284 </span><span class="lineNoCov">              0 :                                         if (state == 0) {</span>
<span class="lineNum">    4285 </span><span class="lineNoCov">              0 :                                                 state=1;</span>
<span class="lineNum">    4286 </span>                :                                         }
<span class="lineNum">    4287 </span><span class="lineNoCov">              0 :                                         if (c != '/') {</span>
<span class="lineNum">    4288 </span><span class="lineNoCov">              0 :                                                 *(n++) = c;</span>
<span class="lineNum">    4289 </span>                :                                         }
<span class="lineNum">    4290 </span>                :                                 } else {
<span class="lineNum">    4291 </span><span class="lineNoCov">              0 :                                         if (state == 1)</span>
<span class="lineNum">    4292 </span><span class="lineNoCov">              0 :                                                 done=1;</span>
<span class="lineNum">    4293 </span>                :                                 }
<span class="lineNum">    4294 </span>                :                                 break;
<span class="lineNum">    4295 </span>                :                 }
<span class="lineNum">    4296 </span><span class="lineNoCov">              0 :                 c = tolower(*(++t));</span>
<span class="lineNum">    4297 </span>                :         }
<span class="lineNum">    4298 </span><span class="lineNoCov">              0 :         *(n++) = '&gt;';</span>
<span class="lineNum">    4299 </span><span class="lineNoCov">              0 :         *n = '\0';</span>
<span class="lineNum">    4300 </span><span class="lineNoCov">              0 :         if (strstr(set, norm)) {</span>
<span class="lineNum">    4301 </span><span class="lineNoCov">              0 :                 done=1;</span>
<span class="lineNum">    4302 </span>                :         } else {
<span class="lineNum">    4303 </span><span class="lineNoCov">              0 :                 done=0;</span>
<span class="lineNum">    4304 </span>                :         }
<span class="lineNum">    4305 </span><span class="lineNoCov">              0 :         efree(norm);</span>
<span class="lineNum">    4306 </span><span class="lineNoCov">              0 :         return done;</span>
<span class="lineNum">    4307 </span>                : }
<a name="4308"><span class="lineNum">    4308 </span>                : /* }}} */</a>
<span class="lineNum">    4309 </span>                : 
<span class="lineNum">    4310 </span><span class="lineNoCov">              0 : PHPAPI size_t php_strip_tags(char *rbuf, int len, int *stateptr, char *allow, int allow_len) /* {{{ */</span>
<span class="lineNum">    4311 </span>                : {
<span class="lineNum">    4312 </span><span class="lineNoCov">              0 :         return php_strip_tags_ex(rbuf, len, stateptr, allow, allow_len, 0);</span>
<span class="lineNum">    4313 </span>                : }
<span class="lineNum">    4314 </span>                : /* }}} */
<span class="lineNum">    4315 </span>                : 
<span class="lineNum">    4316 </span>                : /* {{{ php_strip_tags
<span class="lineNum">    4317 </span>                : 
<span class="lineNum">    4318 </span>                :         A simple little state-machine to strip out html and php tags
<span class="lineNum">    4319 </span>                : 
<span class="lineNum">    4320 </span>                :         State 0 is the output state, State 1 means we are inside a
<span class="lineNum">    4321 </span>                :         normal html tag and state 2 means we are inside a php tag.
<span class="lineNum">    4322 </span>                : 
<span class="lineNum">    4323 </span>                :         The state variable is passed in to allow a function like fgetss
<span class="lineNum">    4324 </span>                :         to maintain state across calls to the function.
<span class="lineNum">    4325 </span>                : 
<span class="lineNum">    4326 </span>                :         lc holds the last significant character read and br is a bracket
<span class="lineNum">    4327 </span>                :         counter.
<span class="lineNum">    4328 </span>                : 
<span class="lineNum">    4329 </span>                :         When an allow string is passed in we keep track of the string
<span class="lineNum">    4330 </span>                :         in state 1 and when the tag is closed check it against the
<span class="lineNum">    4331 </span>                :         allow string to see if we should allow it.
<span class="lineNum">    4332 </span>                : 
<span class="lineNum">    4333 </span>                :         swm: Added ability to strip &lt;?xml tags without assuming it PHP
<a name="4334"><span class="lineNum">    4334 </span>                :         code.</a>
<span class="lineNum">    4335 </span>                : */
<span class="lineNum">    4336 </span><span class="lineNoCov">              0 : PHPAPI size_t php_strip_tags_ex(char *rbuf, int len, int *stateptr, char *allow, int allow_len, zend_bool allow_tag_spaces)</span>
<span class="lineNum">    4337 </span>                : {
<span class="lineNum">    4338 </span>                :         char *tbuf, *buf, *p, *tp, *rp, c, lc;
<span class="lineNum">    4339 </span><span class="lineNoCov">              0 :         int br, i=0, depth=0, in_q = 0;</span>
<span class="lineNum">    4340 </span><span class="lineNoCov">              0 :         int state = 0, pos;</span>
<span class="lineNum">    4341 </span>                :         char *allow_free;
<span class="lineNum">    4342 </span>                : 
<span class="lineNum">    4343 </span><span class="lineNoCov">              0 :         if (stateptr)</span>
<span class="lineNum">    4344 </span><span class="lineNoCov">              0 :                 state = *stateptr;</span>
<span class="lineNum">    4345 </span>                : 
<span class="lineNum">    4346 </span><span class="lineNoCov">              0 :         buf = estrndup(rbuf, len);</span>
<span class="lineNum">    4347 </span><span class="lineNoCov">              0 :         c = *buf;</span>
<span class="lineNum">    4348 </span><span class="lineNoCov">              0 :         lc = '\0';</span>
<span class="lineNum">    4349 </span><span class="lineNoCov">              0 :         p = buf;</span>
<span class="lineNum">    4350 </span><span class="lineNoCov">              0 :         rp = rbuf;</span>
<span class="lineNum">    4351 </span><span class="lineNoCov">              0 :         br = 0;</span>
<span class="lineNum">    4352 </span><span class="lineNoCov">              0 :         if (allow) {</span>
<span class="lineNum">    4353 </span><span class="lineNoCov">              0 :                 if (IS_INTERNED(allow)) {</span>
<span class="lineNum">    4354 </span><span class="lineNoCov">              0 :                         allow_free = allow = zend_str_tolower_dup(allow, allow_len);</span>
<span class="lineNum">    4355 </span>                :                 } else {
<span class="lineNum">    4356 </span><span class="lineNoCov">              0 :                         allow_free = NULL;</span>
<span class="lineNum">    4357 </span><span class="lineNoCov">              0 :                         php_strtolower(allow, allow_len);</span>
<span class="lineNum">    4358 </span>                :                 }
<span class="lineNum">    4359 </span><span class="lineNoCov">              0 :                 tbuf = emalloc(PHP_TAG_BUF_SIZE + 1);</span>
<span class="lineNum">    4360 </span><span class="lineNoCov">              0 :                 tp = tbuf;</span>
<span class="lineNum">    4361 </span>                :         } else {
<span class="lineNum">    4362 </span><span class="lineNoCov">              0 :                 tbuf = tp = NULL;</span>
<span class="lineNum">    4363 </span>                :         }
<span class="lineNum">    4364 </span>                : 
<span class="lineNum">    4365 </span><span class="lineNoCov">              0 :         while (i &lt; len) {</span>
<span class="lineNum">    4366 </span><span class="lineNoCov">              0 :                 switch (c) {</span>
<span class="lineNum">    4367 </span>                :                         case '\0':
<span class="lineNum">    4368 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    4369 </span>                :                         case '&lt;':
<span class="lineNum">    4370 </span><span class="lineNoCov">              0 :                                 if (in_q) {</span>
<span class="lineNum">    4371 </span><span class="lineNoCov">              0 :                                         break;</span>
<span class="lineNum">    4372 </span>                :                                 }
<span class="lineNum">    4373 </span><span class="lineNoCov">              0 :                                 if (isspace(*(p + 1)) &amp;&amp; !allow_tag_spaces) {</span>
<span class="lineNum">    4374 </span><span class="lineNoCov">              0 :                                         goto reg_char;</span>
<span class="lineNum">    4375 </span>                :                                 }
<span class="lineNum">    4376 </span><span class="lineNoCov">              0 :                                 if (state == 0) {</span>
<span class="lineNum">    4377 </span><span class="lineNoCov">              0 :                                         lc = '&lt;';</span>
<span class="lineNum">    4378 </span><span class="lineNoCov">              0 :                                         state = 1;</span>
<span class="lineNum">    4379 </span><span class="lineNoCov">              0 :                                         if (allow) {</span>
<span class="lineNum">    4380 </span><span class="lineNoCov">              0 :                                                 if (tp - tbuf &gt;= PHP_TAG_BUF_SIZE) {</span>
<span class="lineNum">    4381 </span><span class="lineNoCov">              0 :                                                         pos = tp - tbuf;</span>
<span class="lineNum">    4382 </span><span class="lineNoCov">              0 :                                                         tbuf = erealloc(tbuf, (tp - tbuf) + PHP_TAG_BUF_SIZE + 1);</span>
<span class="lineNum">    4383 </span><span class="lineNoCov">              0 :                                                         tp = tbuf + pos;</span>
<span class="lineNum">    4384 </span>                :                                                 }
<span class="lineNum">    4385 </span><span class="lineNoCov">              0 :                                                 *(tp++) = '&lt;';</span>
<span class="lineNum">    4386 </span>                :                                         }
<span class="lineNum">    4387 </span><span class="lineNoCov">              0 :                                 } else if (state == 1) {</span>
<span class="lineNum">    4388 </span><span class="lineNoCov">              0 :                                         depth++;</span>
<span class="lineNum">    4389 </span>                :                                 }
<span class="lineNum">    4390 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    4391 </span>                : 
<span class="lineNum">    4392 </span>                :                         case '(':
<span class="lineNum">    4393 </span><span class="lineNoCov">              0 :                                 if (state == 2) {</span>
<span class="lineNum">    4394 </span><span class="lineNoCov">              0 :                                         if (lc != '&quot;' &amp;&amp; lc != '\'') {</span>
<span class="lineNum">    4395 </span><span class="lineNoCov">              0 :                                                 lc = '(';</span>
<span class="lineNum">    4396 </span><span class="lineNoCov">              0 :                                                 br++;</span>
<span class="lineNum">    4397 </span>                :                                         }
<span class="lineNum">    4398 </span><span class="lineNoCov">              0 :                                 } else if (allow &amp;&amp; state == 1) {</span>
<span class="lineNum">    4399 </span><span class="lineNoCov">              0 :                                         if (tp - tbuf &gt;= PHP_TAG_BUF_SIZE) {</span>
<span class="lineNum">    4400 </span><span class="lineNoCov">              0 :                                                 pos = tp - tbuf;</span>
<span class="lineNum">    4401 </span><span class="lineNoCov">              0 :                                                 tbuf = erealloc(tbuf, (tp - tbuf) + PHP_TAG_BUF_SIZE + 1);</span>
<span class="lineNum">    4402 </span><span class="lineNoCov">              0 :                                                 tp = tbuf + pos;</span>
<span class="lineNum">    4403 </span>                :                                         }
<span class="lineNum">    4404 </span><span class="lineNoCov">              0 :                                         *(tp++) = c;</span>
<span class="lineNum">    4405 </span><span class="lineNoCov">              0 :                                 } else if (state == 0) {</span>
<span class="lineNum">    4406 </span><span class="lineNoCov">              0 :                                         *(rp++) = c;</span>
<span class="lineNum">    4407 </span>                :                                 }
<span class="lineNum">    4408 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    4409 </span>                : 
<span class="lineNum">    4410 </span>                :                         case ')':
<span class="lineNum">    4411 </span><span class="lineNoCov">              0 :                                 if (state == 2) {</span>
<span class="lineNum">    4412 </span><span class="lineNoCov">              0 :                                         if (lc != '&quot;' &amp;&amp; lc != '\'') {</span>
<span class="lineNum">    4413 </span><span class="lineNoCov">              0 :                                                 lc = ')';</span>
<span class="lineNum">    4414 </span><span class="lineNoCov">              0 :                                                 br--;</span>
<span class="lineNum">    4415 </span>                :                                         }
<span class="lineNum">    4416 </span><span class="lineNoCov">              0 :                                 } else if (allow &amp;&amp; state == 1) {</span>
<span class="lineNum">    4417 </span><span class="lineNoCov">              0 :                                         if (tp - tbuf &gt;= PHP_TAG_BUF_SIZE) {</span>
<span class="lineNum">    4418 </span><span class="lineNoCov">              0 :                                                 pos = tp - tbuf;</span>
<span class="lineNum">    4419 </span><span class="lineNoCov">              0 :                                                 tbuf = erealloc(tbuf, (tp - tbuf) + PHP_TAG_BUF_SIZE + 1);</span>
<span class="lineNum">    4420 </span><span class="lineNoCov">              0 :                                                 tp = tbuf + pos;</span>
<span class="lineNum">    4421 </span>                :                                         }
<span class="lineNum">    4422 </span><span class="lineNoCov">              0 :                                         *(tp++) = c;</span>
<span class="lineNum">    4423 </span><span class="lineNoCov">              0 :                                 } else if (state == 0) {</span>
<span class="lineNum">    4424 </span><span class="lineNoCov">              0 :                                         *(rp++) = c;</span>
<span class="lineNum">    4425 </span>                :                                 }
<span class="lineNum">    4426 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    4427 </span>                : 
<span class="lineNum">    4428 </span>                :                         case '&gt;':
<span class="lineNum">    4429 </span><span class="lineNoCov">              0 :                                 if (depth) {</span>
<span class="lineNum">    4430 </span><span class="lineNoCov">              0 :                                         depth--;</span>
<span class="lineNum">    4431 </span><span class="lineNoCov">              0 :                                         break;</span>
<span class="lineNum">    4432 </span>                :                                 }
<span class="lineNum">    4433 </span>                : 
<span class="lineNum">    4434 </span><span class="lineNoCov">              0 :                                 if (in_q) {</span>
<span class="lineNum">    4435 </span><span class="lineNoCov">              0 :                                         break;</span>
<span class="lineNum">    4436 </span>                :                                 }
<span class="lineNum">    4437 </span>                : 
<span class="lineNum">    4438 </span><span class="lineNoCov">              0 :                                 switch (state) {</span>
<span class="lineNum">    4439 </span>                :                                         case 1: /* HTML/XML */
<span class="lineNum">    4440 </span><span class="lineNoCov">              0 :                                                 lc = '&gt;';</span>
<span class="lineNum">    4441 </span><span class="lineNoCov">              0 :                                                 in_q = state = 0;</span>
<span class="lineNum">    4442 </span><span class="lineNoCov">              0 :                                                 if (allow) {</span>
<span class="lineNum">    4443 </span><span class="lineNoCov">              0 :                                                         if (tp - tbuf &gt;= PHP_TAG_BUF_SIZE) {</span>
<span class="lineNum">    4444 </span><span class="lineNoCov">              0 :                                                                 pos = tp - tbuf;</span>
<span class="lineNum">    4445 </span><span class="lineNoCov">              0 :                                                                 tbuf = erealloc(tbuf, (tp - tbuf) + PHP_TAG_BUF_SIZE + 1);</span>
<span class="lineNum">    4446 </span><span class="lineNoCov">              0 :                                                                 tp = tbuf + pos;</span>
<span class="lineNum">    4447 </span>                :                                                         }
<span class="lineNum">    4448 </span><span class="lineNoCov">              0 :                                                         *(tp++) = '&gt;';</span>
<span class="lineNum">    4449 </span><span class="lineNoCov">              0 :                                                         *tp='\0';</span>
<span class="lineNum">    4450 </span><span class="lineNoCov">              0 :                                                         if (php_tag_find(tbuf, tp-tbuf, allow)) {</span>
<span class="lineNum">    4451 </span><span class="lineNoCov">              0 :                                                                 memcpy(rp, tbuf, tp-tbuf);</span>
<span class="lineNum">    4452 </span><span class="lineNoCov">              0 :                                                                 rp += tp-tbuf;</span>
<span class="lineNum">    4453 </span>                :                                                         }
<span class="lineNum">    4454 </span><span class="lineNoCov">              0 :                                                         tp = tbuf;</span>
<span class="lineNum">    4455 </span>                :                                                 }
<span class="lineNum">    4456 </span><span class="lineNoCov">              0 :                                                 break;</span>
<span class="lineNum">    4457 </span>                : 
<span class="lineNum">    4458 </span>                :                                         case 2: /* PHP */
<span class="lineNum">    4459 </span><span class="lineNoCov">              0 :                                                 if (!br &amp;&amp; lc != '\&quot;' &amp;&amp; *(p-1) == '?') {</span>
<span class="lineNum">    4460 </span><span class="lineNoCov">              0 :                                                         in_q = state = 0;</span>
<span class="lineNum">    4461 </span><span class="lineNoCov">              0 :                                                         tp = tbuf;</span>
<span class="lineNum">    4462 </span>                :                                                 }
<span class="lineNum">    4463 </span><span class="lineNoCov">              0 :                                                 break;</span>
<span class="lineNum">    4464 </span>                : 
<span class="lineNum">    4465 </span>                :                                         case 3:
<span class="lineNum">    4466 </span><span class="lineNoCov">              0 :                                                 in_q = state = 0;</span>
<span class="lineNum">    4467 </span><span class="lineNoCov">              0 :                                                 tp = tbuf;</span>
<span class="lineNum">    4468 </span><span class="lineNoCov">              0 :                                                 break;</span>
<span class="lineNum">    4469 </span>                : 
<span class="lineNum">    4470 </span>                :                                         case 4: /* JavaScript/CSS/etc... */
<span class="lineNum">    4471 </span><span class="lineNoCov">              0 :                                                 if (p &gt;= buf + 2 &amp;&amp; *(p-1) == '-' &amp;&amp; *(p-2) == '-') {</span>
<span class="lineNum">    4472 </span><span class="lineNoCov">              0 :                                                         in_q = state = 0;</span>
<span class="lineNum">    4473 </span><span class="lineNoCov">              0 :                                                         tp = tbuf;</span>
<span class="lineNum">    4474 </span>                :                                                 }
<span class="lineNum">    4475 </span><span class="lineNoCov">              0 :                                                 break;</span>
<span class="lineNum">    4476 </span>                : 
<span class="lineNum">    4477 </span>                :                                         default:
<span class="lineNum">    4478 </span><span class="lineNoCov">              0 :                                                 *(rp++) = c;</span>
<span class="lineNum">    4479 </span>                :                                                 break;
<span class="lineNum">    4480 </span>                :                                 }
<span class="lineNum">    4481 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    4482 </span>                : 
<span class="lineNum">    4483 </span>                :                         case '&quot;':
<span class="lineNum">    4484 </span>                :                         case '\'':
<span class="lineNum">    4485 </span><span class="lineNoCov">              0 :                                 if (state == 4) {</span>
<span class="lineNum">    4486 </span>                :                                         /* Inside &lt;!-- comment --&gt; */
<span class="lineNum">    4487 </span><span class="lineNoCov">              0 :                                         break;</span>
<span class="lineNum">    4488 </span><span class="lineNoCov">              0 :                                 } else if (state == 2 &amp;&amp; *(p-1) != '\\') {</span>
<span class="lineNum">    4489 </span><span class="lineNoCov">              0 :                                         if (lc == c) {</span>
<span class="lineNum">    4490 </span><span class="lineNoCov">              0 :                                                 lc = '\0';</span>
<span class="lineNum">    4491 </span><span class="lineNoCov">              0 :                                         } else if (lc != '\\') {</span>
<span class="lineNum">    4492 </span><span class="lineNoCov">              0 :                                                 lc = c;</span>
<span class="lineNum">    4493 </span>                :                                         }
<span class="lineNum">    4494 </span><span class="lineNoCov">              0 :                                 } else if (state == 0) {</span>
<span class="lineNum">    4495 </span><span class="lineNoCov">              0 :                                         *(rp++) = c;</span>
<span class="lineNum">    4496 </span><span class="lineNoCov">              0 :                                 } else if (allow &amp;&amp; state == 1) {</span>
<span class="lineNum">    4497 </span><span class="lineNoCov">              0 :                                         if (tp - tbuf &gt;= PHP_TAG_BUF_SIZE) {</span>
<span class="lineNum">    4498 </span><span class="lineNoCov">              0 :                                                 pos = tp - tbuf;</span>
<span class="lineNum">    4499 </span><span class="lineNoCov">              0 :                                                 tbuf = erealloc(tbuf, (tp - tbuf) + PHP_TAG_BUF_SIZE + 1);</span>
<span class="lineNum">    4500 </span><span class="lineNoCov">              0 :                                                 tp = tbuf + pos;</span>
<span class="lineNum">    4501 </span>                :                                         }
<span class="lineNum">    4502 </span><span class="lineNoCov">              0 :                                         *(tp++) = c;</span>
<span class="lineNum">    4503 </span>                :                                 }
<span class="lineNum">    4504 </span><span class="lineNoCov">              0 :                                 if (state &amp;&amp; p != buf &amp;&amp; (state == 1 || *(p-1) != '\\') &amp;&amp; (!in_q || *p == in_q)) {</span>
<span class="lineNum">    4505 </span><span class="lineNoCov">              0 :                                         if (in_q) {</span>
<span class="lineNum">    4506 </span><span class="lineNoCov">              0 :                                                 in_q = 0;</span>
<span class="lineNum">    4507 </span>                :                                         } else {
<span class="lineNum">    4508 </span><span class="lineNoCov">              0 :                                                 in_q = *p;</span>
<span class="lineNum">    4509 </span>                :                                         }
<span class="lineNum">    4510 </span>                :                                 }
<span class="lineNum">    4511 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    4512 </span>                : 
<span class="lineNum">    4513 </span>                :                         case '!':
<span class="lineNum">    4514 </span>                :                                 /* JavaScript &amp; Other HTML scripting languages */
<span class="lineNum">    4515 </span><span class="lineNoCov">              0 :                                 if (state == 1 &amp;&amp; *(p-1) == '&lt;') {</span>
<span class="lineNum">    4516 </span><span class="lineNoCov">              0 :                                         state = 3;</span>
<span class="lineNum">    4517 </span><span class="lineNoCov">              0 :                                         lc = c;</span>
<span class="lineNum">    4518 </span>                :                                 } else {
<span class="lineNum">    4519 </span><span class="lineNoCov">              0 :                                         if (state == 0) {</span>
<span class="lineNum">    4520 </span><span class="lineNoCov">              0 :                                                 *(rp++) = c;</span>
<span class="lineNum">    4521 </span><span class="lineNoCov">              0 :                                         } else if (allow &amp;&amp; state == 1) {</span>
<span class="lineNum">    4522 </span><span class="lineNoCov">              0 :                                                 if (tp - tbuf &gt;= PHP_TAG_BUF_SIZE) {</span>
<span class="lineNum">    4523 </span><span class="lineNoCov">              0 :                                                         pos = tp - tbuf;</span>
<span class="lineNum">    4524 </span><span class="lineNoCov">              0 :                                                         tbuf = erealloc(tbuf, (tp - tbuf) + PHP_TAG_BUF_SIZE + 1);</span>
<span class="lineNum">    4525 </span><span class="lineNoCov">              0 :                                                         tp = tbuf + pos;</span>
<span class="lineNum">    4526 </span>                :                                                 }
<span class="lineNum">    4527 </span><span class="lineNoCov">              0 :                                                 *(tp++) = c;</span>
<span class="lineNum">    4528 </span>                :                                         }
<span class="lineNum">    4529 </span>                :                                 }
<span class="lineNum">    4530 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    4531 </span>                : 
<span class="lineNum">    4532 </span>                :                         case '-':
<span class="lineNum">    4533 </span><span class="lineNoCov">              0 :                                 if (state == 3 &amp;&amp; p &gt;= buf + 2 &amp;&amp; *(p-1) == '-' &amp;&amp; *(p-2) == '!') {</span>
<span class="lineNum">    4534 </span><span class="lineNoCov">              0 :                                         state = 4;</span>
<span class="lineNum">    4535 </span>                :                                 } else {
<span class="lineNum">    4536 </span>                :                                         goto reg_char;
<span class="lineNum">    4537 </span>                :                                 }
<span class="lineNum">    4538 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    4539 </span>                : 
<span class="lineNum">    4540 </span>                :                         case '?':
<span class="lineNum">    4541 </span>                : 
<span class="lineNum">    4542 </span><span class="lineNoCov">              0 :                                 if (state == 1 &amp;&amp; *(p-1) == '&lt;') {</span>
<span class="lineNum">    4543 </span><span class="lineNoCov">              0 :                                         br=0;</span>
<span class="lineNum">    4544 </span><span class="lineNoCov">              0 :                                         state=2;</span>
<span class="lineNum">    4545 </span><span class="lineNoCov">              0 :                                         break;</span>
<span class="lineNum">    4546 </span>                :                                 }
<span class="lineNum">    4547 </span>                : 
<span class="lineNum">    4548 </span>                :                         case 'E':
<span class="lineNum">    4549 </span>                :                         case 'e':
<span class="lineNum">    4550 </span>                :                                 /* !DOCTYPE exception */
<span class="lineNum">    4551 </span><span class="lineNoCov">              0 :                                 if (state==3 &amp;&amp; p &gt; buf+6</span>
<span class="lineNum">    4552 </span><span class="lineNoCov">              0 :                                                      &amp;&amp; tolower(*(p-1)) == 'p'</span>
<span class="lineNum">    4553 </span><span class="lineNoCov">              0 :                                                  &amp;&amp; tolower(*(p-2)) == 'y'</span>
<span class="lineNum">    4554 </span><span class="lineNoCov">              0 :                                                      &amp;&amp; tolower(*(p-3)) == 't'</span>
<span class="lineNum">    4555 </span><span class="lineNoCov">              0 :                                                      &amp;&amp; tolower(*(p-4)) == 'c'</span>
<span class="lineNum">    4556 </span><span class="lineNoCov">              0 :                                                      &amp;&amp; tolower(*(p-5)) == 'o'</span>
<span class="lineNum">    4557 </span><span class="lineNoCov">              0 :                                                      &amp;&amp; tolower(*(p-6)) == 'd') {</span>
<span class="lineNum">    4558 </span><span class="lineNoCov">              0 :                                         state = 1;</span>
<span class="lineNum">    4559 </span><span class="lineNoCov">              0 :                                         break;</span>
<span class="lineNum">    4560 </span>                :                                 }
<span class="lineNum">    4561 </span>                :                                 /* fall-through */
<span class="lineNum">    4562 </span>                : 
<span class="lineNum">    4563 </span>                :                         case 'l':
<span class="lineNum">    4564 </span>                :                         case 'L':
<span class="lineNum">    4565 </span>                : 
<span class="lineNum">    4566 </span>                :                                 /* swm: If we encounter '&lt;?xml' then we shouldn't be in
<span class="lineNum">    4567 </span>                :                                  * state == 2 (PHP). Switch back to HTML.
<span class="lineNum">    4568 </span>                :                                  */
<span class="lineNum">    4569 </span>                : 
<span class="lineNum">    4570 </span><span class="lineNoCov">              0 :                                 if (state == 2 &amp;&amp; p &gt; buf+2 &amp;&amp; strncasecmp(p-2, &quot;xm&quot;, 2) == 0) {</span>
<span class="lineNum">    4571 </span><span class="lineNoCov">              0 :                                         state = 1;</span>
<span class="lineNum">    4572 </span><span class="lineNoCov">              0 :                                         break;</span>
<span class="lineNum">    4573 </span>                :                                 }
<span class="lineNum">    4574 </span>                : 
<span class="lineNum">    4575 </span>                :                                 /* fall-through */
<span class="lineNum">    4576 </span>                :                         default:
<span class="lineNum">    4577 </span>                : reg_char:
<span class="lineNum">    4578 </span><span class="lineNoCov">              0 :                                 if (state == 0) {</span>
<span class="lineNum">    4579 </span><span class="lineNoCov">              0 :                                         *(rp++) = c;</span>
<span class="lineNum">    4580 </span><span class="lineNoCov">              0 :                                 } else if (allow &amp;&amp; state == 1) {</span>
<span class="lineNum">    4581 </span><span class="lineNoCov">              0 :                                         if (tp - tbuf &gt;= PHP_TAG_BUF_SIZE) {</span>
<span class="lineNum">    4582 </span><span class="lineNoCov">              0 :                                                 pos = tp - tbuf;</span>
<span class="lineNum">    4583 </span><span class="lineNoCov">              0 :                                                 tbuf = erealloc(tbuf, (tp - tbuf) + PHP_TAG_BUF_SIZE + 1);</span>
<span class="lineNum">    4584 </span><span class="lineNoCov">              0 :                                                 tp = tbuf + pos;</span>
<span class="lineNum">    4585 </span>                :                                         }
<span class="lineNum">    4586 </span><span class="lineNoCov">              0 :                                         *(tp++) = c;</span>
<span class="lineNum">    4587 </span>                :                                 }
<span class="lineNum">    4588 </span>                :                                 break;
<span class="lineNum">    4589 </span>                :                 }
<span class="lineNum">    4590 </span><span class="lineNoCov">              0 :                 c = *(++p);</span>
<span class="lineNum">    4591 </span><span class="lineNoCov">              0 :                 i++;</span>
<span class="lineNum">    4592 </span>                :         }
<span class="lineNum">    4593 </span><span class="lineNoCov">              0 :         if (rp &lt; rbuf + len) {</span>
<span class="lineNum">    4594 </span><span class="lineNoCov">              0 :                 *rp = '\0';</span>
<span class="lineNum">    4595 </span>                :         }
<span class="lineNum">    4596 </span><span class="lineNoCov">              0 :         efree(buf);</span>
<span class="lineNum">    4597 </span><span class="lineNoCov">              0 :         if (allow) {</span>
<span class="lineNum">    4598 </span><span class="lineNoCov">              0 :                 efree(tbuf);</span>
<span class="lineNum">    4599 </span><span class="lineNoCov">              0 :                 if (allow_free) {</span>
<span class="lineNum">    4600 </span><span class="lineNoCov">              0 :                         efree(allow_free);</span>
<span class="lineNum">    4601 </span>                :                 }
<span class="lineNum">    4602 </span>                :         }
<span class="lineNum">    4603 </span><span class="lineNoCov">              0 :         if (stateptr)</span>
<span class="lineNum">    4604 </span><span class="lineNoCov">              0 :                 *stateptr = state;</span>
<span class="lineNum">    4605 </span>                : 
<span class="lineNum">    4606 </span><span class="lineNoCov">              0 :         return (size_t)(rp - rbuf);</span>
<span class="lineNum">    4607 </span>                : }
<span class="lineNum">    4608 </span>                : /* }}} */
<span class="lineNum">    4609 </span>                : 
<a name="4610"><span class="lineNum">    4610 </span>                : /* {{{ proto array str_getcsv(string input[, string delimiter[, string enclosure[, string escape]]])</a>
<span class="lineNum">    4611 </span>                : Parse a CSV string into an array */
<span class="lineNum">    4612 </span><span class="lineNoCov">              0 : PHP_FUNCTION(str_getcsv)</span>
<span class="lineNum">    4613 </span>                : {
<span class="lineNum">    4614 </span><span class="lineNoCov">              0 :         char *str, delim = ',', enc = '&quot;', esc = '\\';</span>
<span class="lineNum">    4615 </span><span class="lineNoCov">              0 :         char *delim_str = NULL, *enc_str = NULL, *esc_str = NULL;</span>
<span class="lineNum">    4616 </span><span class="lineNoCov">              0 :         int str_len = 0, delim_len = 0, enc_len = 0, esc_len = 0;</span>
<span class="lineNum">    4617 </span>                : 
<span class="lineNum">    4618 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s|sss&quot;, &amp;str, &amp;str_len, &amp;delim_str, &amp;delim_len,</span>
<span class="lineNum">    4619 </span>                :                 &amp;enc_str, &amp;enc_len, &amp;esc_str, &amp;esc_len) == FAILURE) {
<span class="lineNum">    4620 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    4621 </span>                :         }
<span class="lineNum">    4622 </span>                : 
<span class="lineNum">    4623 </span><span class="lineNoCov">              0 :         delim = delim_len ? delim_str[0] : delim;</span>
<span class="lineNum">    4624 </span><span class="lineNoCov">              0 :         enc = enc_len ? enc_str[0] : enc;</span>
<span class="lineNum">    4625 </span><span class="lineNoCov">              0 :         esc = esc_len ? esc_str[0] : esc;</span>
<span class="lineNum">    4626 </span>                : 
<span class="lineNum">    4627 </span><span class="lineNoCov">              0 :         php_fgetcsv(NULL, delim, enc, esc, str_len, str, return_value TSRMLS_CC);</span>
<span class="lineNum">    4628 </span>                : }
<span class="lineNum">    4629 </span>                : /* }}} */
<span class="lineNum">    4630 </span>                : 
<a name="4631"><span class="lineNum">    4631 </span>                : /* {{{ proto string str_repeat(string input, int mult)</a>
<span class="lineNum">    4632 </span>                :    Returns the input string repeat mult times */
<span class="lineNum">    4633 </span><span class="lineCov">              1 : PHP_FUNCTION(str_repeat)</span>
<span class="lineNum">    4634 </span>                : {
<span class="lineNum">    4635 </span>                :         char            *input_str;             /* Input string */
<span class="lineNum">    4636 </span>                :         int             input_len;
<span class="lineNum">    4637 </span>                :         long            mult;                   /* Multiplier */
<span class="lineNum">    4638 </span>                :         char            *result;                /* Resulting string */
<span class="lineNum">    4639 </span>                :         size_t          result_len;             /* Length of the resulting string */
<span class="lineNum">    4640 </span>                : 
<span class="lineNum">    4641 </span><span class="lineCov">              1 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;sl&quot;, &amp;input_str, &amp;input_len, &amp;mult) == FAILURE) {</span>
<span class="lineNum">    4642 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    4643 </span>                :         }
<span class="lineNum">    4644 </span>                : 
<span class="lineNum">    4645 </span><span class="lineCov">              1 :         if (mult &lt; 0) {</span>
<span class="lineNum">    4646 </span><span class="lineNoCov">              0 :                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Second argument has to be greater than or equal to 0&quot;);</span>
<span class="lineNum">    4647 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    4648 </span>                :         }
<span class="lineNum">    4649 </span>                : 
<span class="lineNum">    4650 </span>                :         /* Don't waste our time if it's empty */
<span class="lineNum">    4651 </span>                :         /* ... or if the multiplier is zero */
<span class="lineNum">    4652 </span><span class="lineCov">              1 :         if (input_len == 0 || mult == 0)</span>
<span class="lineNum">    4653 </span><span class="lineNoCov">              0 :                 RETURN_EMPTY_STRING();</span>
<span class="lineNum">    4654 </span>                : 
<span class="lineNum">    4655 </span>                :         /* Initialize the result string */
<span class="lineNum">    4656 </span><span class="lineCov">              1 :         result_len = input_len * mult;</span>
<span class="lineNum">    4657 </span><span class="lineCov">              1 :         result = (char *)safe_emalloc(input_len, mult, 1);</span>
<span class="lineNum">    4658 </span>                : 
<span class="lineNum">    4659 </span>                :         /* Heavy optimization for situations where input string is 1 byte long */
<span class="lineNum">    4660 </span><span class="lineCov">              1 :         if (input_len == 1) {</span>
<span class="lineNum">    4661 </span><span class="lineCov">              1 :                 memset(result, *(input_str), mult);</span>
<span class="lineNum">    4662 </span>                :         } else {
<span class="lineNum">    4663 </span>                :                 char *s, *e, *ee;
<span class="lineNum">    4664 </span><span class="lineNoCov">              0 :                 int l=0;</span>
<span class="lineNum">    4665 </span><span class="lineNoCov">              0 :                 memcpy(result, input_str, input_len);</span>
<span class="lineNum">    4666 </span><span class="lineNoCov">              0 :                 s = result;</span>
<span class="lineNum">    4667 </span><span class="lineNoCov">              0 :                 e = result + input_len;</span>
<span class="lineNum">    4668 </span><span class="lineNoCov">              0 :                 ee = result + result_len;</span>
<span class="lineNum">    4669 </span>                : 
<span class="lineNum">    4670 </span><span class="lineNoCov">              0 :                 while (e&lt;ee) {</span>
<span class="lineNum">    4671 </span><span class="lineNoCov">              0 :                         l = (e-s) &lt; (ee-e) ? (e-s) : (ee-e);</span>
<span class="lineNum">    4672 </span><span class="lineNoCov">              0 :                         memmove(e, s, l);</span>
<span class="lineNum">    4673 </span><span class="lineNoCov">              0 :                         e += l;</span>
<span class="lineNum">    4674 </span>                :                 }
<span class="lineNum">    4675 </span>                :         }
<span class="lineNum">    4676 </span>                : 
<span class="lineNum">    4677 </span><span class="lineCov">              1 :         result[result_len] = '\0';</span>
<span class="lineNum">    4678 </span>                : 
<span class="lineNum">    4679 </span><span class="lineCov">              1 :         RETURN_STRINGL(result, result_len, 0);</span>
<span class="lineNum">    4680 </span>                : }
<span class="lineNum">    4681 </span>                : /* }}} */
<span class="lineNum">    4682 </span>                : 
<a name="4683"><span class="lineNum">    4683 </span>                : /* {{{ proto mixed count_chars(string input [, int mode])</a>
<span class="lineNum">    4684 </span>                :    Returns info about what characters are used in input */
<span class="lineNum">    4685 </span><span class="lineNoCov">              0 : PHP_FUNCTION(count_chars)</span>
<span class="lineNum">    4686 </span>                : {
<span class="lineNum">    4687 </span>                :         char *input;
<span class="lineNum">    4688 </span>                :         int chars[256];
<span class="lineNum">    4689 </span><span class="lineNoCov">              0 :         long mymode=0;</span>
<span class="lineNum">    4690 </span>                :         unsigned char *buf;
<span class="lineNum">    4691 </span>                :         int len, inx;
<span class="lineNum">    4692 </span>                :         char retstr[256];
<span class="lineNum">    4693 </span><span class="lineNoCov">              0 :         int retlen=0;</span>
<span class="lineNum">    4694 </span>                : 
<span class="lineNum">    4695 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s|l&quot;, &amp;input, &amp;len, &amp;mymode) == FAILURE) {</span>
<span class="lineNum">    4696 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    4697 </span>                :         }
<span class="lineNum">    4698 </span>                : 
<span class="lineNum">    4699 </span><span class="lineNoCov">              0 :         if (mymode &lt; 0 || mymode &gt; 4) {</span>
<span class="lineNum">    4700 </span><span class="lineNoCov">              0 :                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Unknown mode&quot;);</span>
<span class="lineNum">    4701 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    4702 </span>                :         }
<span class="lineNum">    4703 </span>                : 
<span class="lineNum">    4704 </span><span class="lineNoCov">              0 :         buf = (unsigned char *) input;</span>
<span class="lineNum">    4705 </span><span class="lineNoCov">              0 :         memset((void*) chars, 0, sizeof(chars));</span>
<span class="lineNum">    4706 </span>                : 
<span class="lineNum">    4707 </span><span class="lineNoCov">              0 :         while (len &gt; 0) {</span>
<span class="lineNum">    4708 </span><span class="lineNoCov">              0 :                 chars[*buf]++;</span>
<span class="lineNum">    4709 </span><span class="lineNoCov">              0 :                 buf++;</span>
<span class="lineNum">    4710 </span><span class="lineNoCov">              0 :                 len--;</span>
<span class="lineNum">    4711 </span>                :         }
<span class="lineNum">    4712 </span>                : 
<span class="lineNum">    4713 </span><span class="lineNoCov">              0 :         if (mymode &lt; 3) {</span>
<span class="lineNum">    4714 </span><span class="lineNoCov">              0 :                 array_init(return_value);</span>
<span class="lineNum">    4715 </span>                :         }
<span class="lineNum">    4716 </span>                : 
<span class="lineNum">    4717 </span><span class="lineNoCov">              0 :         for (inx = 0; inx &lt; 256; inx++) {</span>
<span class="lineNum">    4718 </span><span class="lineNoCov">              0 :                 switch (mymode) {</span>
<span class="lineNum">    4719 </span>                :                         case 0:
<span class="lineNum">    4720 </span><span class="lineNoCov">              0 :                                 add_index_long(return_value, inx, chars[inx]);</span>
<span class="lineNum">    4721 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    4722 </span>                :                         case 1:
<span class="lineNum">    4723 </span><span class="lineNoCov">              0 :                                 if (chars[inx] != 0) {</span>
<span class="lineNum">    4724 </span><span class="lineNoCov">              0 :                                         add_index_long(return_value, inx, chars[inx]);</span>
<span class="lineNum">    4725 </span>                :                                 }
<span class="lineNum">    4726 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    4727 </span>                :                         case 2:
<span class="lineNum">    4728 </span><span class="lineNoCov">              0 :                                 if (chars[inx] == 0) {</span>
<span class="lineNum">    4729 </span><span class="lineNoCov">              0 :                                         add_index_long(return_value, inx, chars[inx]);</span>
<span class="lineNum">    4730 </span>                :                                 }
<span class="lineNum">    4731 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    4732 </span>                :                         case 3:
<span class="lineNum">    4733 </span><span class="lineNoCov">              0 :                                 if (chars[inx] != 0) {</span>
<span class="lineNum">    4734 </span><span class="lineNoCov">              0 :                                         retstr[retlen++] = inx;</span>
<span class="lineNum">    4735 </span>                :                                 }
<span class="lineNum">    4736 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    4737 </span>                :                         case 4:
<span class="lineNum">    4738 </span><span class="lineNoCov">              0 :                                 if (chars[inx] == 0) {</span>
<span class="lineNum">    4739 </span><span class="lineNoCov">              0 :                                         retstr[retlen++] = inx;</span>
<span class="lineNum">    4740 </span>                :                                 }
<span class="lineNum">    4741 </span>                :                                 break;
<span class="lineNum">    4742 </span>                :                 }
<span class="lineNum">    4743 </span>                :         }
<span class="lineNum">    4744 </span>                : 
<span class="lineNum">    4745 </span><span class="lineNoCov">              0 :         if (mymode &gt;= 3 &amp;&amp; mymode &lt;= 4) {</span>
<span class="lineNum">    4746 </span><span class="lineNoCov">              0 :                 RETURN_STRINGL(retstr, retlen, 1);</span>
<span class="lineNum">    4747 </span>                :         }
<span class="lineNum">    4748 </span>                : }
<span class="lineNum">    4749 </span>                : /* }}} */
<span class="lineNum">    4750 </span>                : 
<a name="4751"><span class="lineNum">    4751 </span>                : /* {{{ php_strnatcmp</a>
<span class="lineNum">    4752 </span>                :  */
<span class="lineNum">    4753 </span><span class="lineNoCov">              0 : static void php_strnatcmp(INTERNAL_FUNCTION_PARAMETERS, int fold_case)</span>
<span class="lineNum">    4754 </span>                : {
<span class="lineNum">    4755 </span>                :         char *s1, *s2;
<span class="lineNum">    4756 </span>                :         int s1_len, s2_len;
<span class="lineNum">    4757 </span>                : 
<span class="lineNum">    4758 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;ss&quot;, &amp;s1, &amp;s1_len, &amp;s2, &amp;s2_len) == FAILURE) {</span>
<span class="lineNum">    4759 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    4760 </span>                :         }
<span class="lineNum">    4761 </span>                : 
<span class="lineNum">    4762 </span><span class="lineNoCov">              0 :         RETURN_LONG(strnatcmp_ex(s1, s1_len,</span>
<span class="lineNum">    4763 </span>                :                                                          s2, s2_len,
<span class="lineNum">    4764 </span>                :                                                          fold_case));
<span class="lineNum">    4765 </span>                : }
<a name="4766"><span class="lineNum">    4766 </span>                : /* }}} */</a>
<span class="lineNum">    4767 </span>                : 
<span class="lineNum">    4768 </span><span class="lineNoCov">              0 : PHPAPI int string_natural_compare_function_ex(zval *result, zval *op1, zval *op2, zend_bool case_insensitive TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">    4769 </span>                : {
<span class="lineNum">    4770 </span>                :         zval op1_copy, op2_copy;
<span class="lineNum">    4771 </span><span class="lineNoCov">              0 :         int use_copy1 = 0, use_copy2 = 0;</span>
<span class="lineNum">    4772 </span>                : 
<span class="lineNum">    4773 </span><span class="lineNoCov">              0 :         if (Z_TYPE_P(op1) != IS_STRING) {</span>
<span class="lineNum">    4774 </span><span class="lineNoCov">              0 :                 zend_make_printable_zval(op1, &amp;op1_copy, &amp;use_copy1);</span>
<span class="lineNum">    4775 </span>                :         }
<span class="lineNum">    4776 </span><span class="lineNoCov">              0 :         if (Z_TYPE_P(op2) != IS_STRING) {</span>
<span class="lineNum">    4777 </span><span class="lineNoCov">              0 :                 zend_make_printable_zval(op2, &amp;op2_copy, &amp;use_copy2);</span>
<span class="lineNum">    4778 </span>                :         }
<span class="lineNum">    4779 </span>                : 
<span class="lineNum">    4780 </span><span class="lineNoCov">              0 :         if (use_copy1) {</span>
<span class="lineNum">    4781 </span><span class="lineNoCov">              0 :                 op1 = &amp;op1_copy;</span>
<span class="lineNum">    4782 </span>                :         }
<span class="lineNum">    4783 </span><span class="lineNoCov">              0 :         if (use_copy2) {</span>
<span class="lineNum">    4784 </span><span class="lineNoCov">              0 :                 op2 = &amp;op2_copy;</span>
<span class="lineNum">    4785 </span>                :         }
<span class="lineNum">    4786 </span>                : 
<span class="lineNum">    4787 </span><span class="lineNoCov">              0 :         ZVAL_LONG(result, strnatcmp_ex(Z_STRVAL_P(op1), Z_STRLEN_P(op1), Z_STRVAL_P(op2), Z_STRLEN_P(op2), case_insensitive));</span>
<span class="lineNum">    4788 </span>                : 
<span class="lineNum">    4789 </span><span class="lineNoCov">              0 :         if (use_copy1) {</span>
<span class="lineNum">    4790 </span>                :                 zval_dtor(op1);
<span class="lineNum">    4791 </span>                :         }
<span class="lineNum">    4792 </span><span class="lineNoCov">              0 :         if (use_copy2) {</span>
<span class="lineNum">    4793 </span>                :                 zval_dtor(op2);
<span class="lineNum">    4794 </span>                :         }
<span class="lineNum">    4795 </span><span class="lineNoCov">              0 :         return SUCCESS;</span>
<span class="lineNum">    4796 </span>                : }
<a name="4797"><span class="lineNum">    4797 </span>                : /* }}} */</a>
<span class="lineNum">    4798 </span>                : 
<span class="lineNum">    4799 </span><span class="lineNoCov">              0 : PHPAPI int string_natural_case_compare_function(zval *result, zval *op1, zval *op2 TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">    4800 </span>                : {
<span class="lineNum">    4801 </span><span class="lineNoCov">              0 :         return string_natural_compare_function_ex(result, op1, op2, 1 TSRMLS_CC);</span>
<span class="lineNum">    4802 </span>                : }
<a name="4803"><span class="lineNum">    4803 </span>                : /* }}} */</a>
<span class="lineNum">    4804 </span>                : 
<span class="lineNum">    4805 </span><span class="lineNoCov">              0 : PHPAPI int string_natural_compare_function(zval *result, zval *op1, zval *op2 TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">    4806 </span>                : {
<span class="lineNum">    4807 </span><span class="lineNoCov">              0 :         return string_natural_compare_function_ex(result, op1, op2, 0 TSRMLS_CC);</span>
<span class="lineNum">    4808 </span>                : }
<span class="lineNum">    4809 </span>                : /* }}} */
<span class="lineNum">    4810 </span>                : 
<a name="4811"><span class="lineNum">    4811 </span>                : /* {{{ proto int strnatcmp(string s1, string s2)</a>
<span class="lineNum">    4812 </span>                :    Returns the result of string comparison using 'natural' algorithm */
<span class="lineNum">    4813 </span><span class="lineNoCov">              0 : PHP_FUNCTION(strnatcmp)</span>
<span class="lineNum">    4814 </span>                : {
<span class="lineNum">    4815 </span><span class="lineNoCov">              0 :         php_strnatcmp(INTERNAL_FUNCTION_PARAM_PASSTHRU, 0);</span>
<span class="lineNum">    4816 </span><span class="lineNoCov">              0 : }</span>
<span class="lineNum">    4817 </span>                : /* }}} */
<span class="lineNum">    4818 </span>                : 
<a name="4819"><span class="lineNum">    4819 </span>                : /* {{{ proto array localeconv(void)</a>
<span class="lineNum">    4820 </span>                :    Returns numeric formatting information based on the current locale */
<span class="lineNum">    4821 </span><span class="lineNoCov">              0 : PHP_FUNCTION(localeconv)</span>
<span class="lineNum">    4822 </span>                : {
<span class="lineNum">    4823 </span>                :         zval *grouping, *mon_grouping;
<span class="lineNum">    4824 </span>                :         int len, i;
<span class="lineNum">    4825 </span>                : 
<span class="lineNum">    4826 </span>                :         /* We don't need no stinkin' parameters... */
<span class="lineNum">    4827 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters_none() == FAILURE) {</span>
<span class="lineNum">    4828 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    4829 </span>                :         }
<span class="lineNum">    4830 </span>                : 
<span class="lineNum">    4831 </span><span class="lineNoCov">              0 :         MAKE_STD_ZVAL(grouping);</span>
<span class="lineNum">    4832 </span><span class="lineNoCov">              0 :         MAKE_STD_ZVAL(mon_grouping);</span>
<span class="lineNum">    4833 </span>                : 
<span class="lineNum">    4834 </span><span class="lineNoCov">              0 :         array_init(return_value);</span>
<span class="lineNum">    4835 </span><span class="lineNoCov">              0 :         array_init(grouping);</span>
<span class="lineNum">    4836 </span><span class="lineNoCov">              0 :         array_init(mon_grouping);</span>
<span class="lineNum">    4837 </span>                : 
<span class="lineNum">    4838 </span>                : #ifdef HAVE_LOCALECONV
<span class="lineNum">    4839 </span>                :         {
<span class="lineNum">    4840 </span>                :                 struct lconv currlocdata;
<span class="lineNum">    4841 </span>                : 
<span class="lineNum">    4842 </span><span class="lineNoCov">              0 :                 localeconv_r( &amp;currlocdata );</span>
<span class="lineNum">    4843 </span>                : 
<span class="lineNum">    4844 </span>                :                 /* Grab the grouping data out of the array */
<span class="lineNum">    4845 </span><span class="lineNoCov">              0 :                 len = strlen(currlocdata.grouping);</span>
<span class="lineNum">    4846 </span>                : 
<span class="lineNum">    4847 </span><span class="lineNoCov">              0 :                 for (i = 0; i &lt; len; i++) {</span>
<span class="lineNum">    4848 </span><span class="lineNoCov">              0 :                         add_index_long(grouping, i, currlocdata.grouping[i]);</span>
<span class="lineNum">    4849 </span>                :                 }
<span class="lineNum">    4850 </span>                : 
<span class="lineNum">    4851 </span>                :                 /* Grab the monetary grouping data out of the array */
<span class="lineNum">    4852 </span><span class="lineNoCov">              0 :                 len = strlen(currlocdata.mon_grouping);</span>
<span class="lineNum">    4853 </span>                : 
<span class="lineNum">    4854 </span><span class="lineNoCov">              0 :                 for (i = 0; i &lt; len; i++) {</span>
<span class="lineNum">    4855 </span><span class="lineNoCov">              0 :                         add_index_long(mon_grouping, i, currlocdata.mon_grouping[i]);</span>
<span class="lineNum">    4856 </span>                :                 }
<span class="lineNum">    4857 </span>                : 
<span class="lineNum">    4858 </span><span class="lineNoCov">              0 :                 add_assoc_string(return_value, &quot;decimal_point&quot;,     currlocdata.decimal_point,     1);</span>
<span class="lineNum">    4859 </span><span class="lineNoCov">              0 :                 add_assoc_string(return_value, &quot;thousands_sep&quot;,     currlocdata.thousands_sep,     1);</span>
<span class="lineNum">    4860 </span><span class="lineNoCov">              0 :                 add_assoc_string(return_value, &quot;int_curr_symbol&quot;,   currlocdata.int_curr_symbol,   1);</span>
<span class="lineNum">    4861 </span><span class="lineNoCov">              0 :                 add_assoc_string(return_value, &quot;currency_symbol&quot;,   currlocdata.currency_symbol,   1);</span>
<span class="lineNum">    4862 </span><span class="lineNoCov">              0 :                 add_assoc_string(return_value, &quot;mon_decimal_point&quot;, currlocdata.mon_decimal_point, 1);</span>
<span class="lineNum">    4863 </span><span class="lineNoCov">              0 :                 add_assoc_string(return_value, &quot;mon_thousands_sep&quot;, currlocdata.mon_thousands_sep, 1);</span>
<span class="lineNum">    4864 </span><span class="lineNoCov">              0 :                 add_assoc_string(return_value, &quot;positive_sign&quot;,     currlocdata.positive_sign,     1);</span>
<span class="lineNum">    4865 </span><span class="lineNoCov">              0 :                 add_assoc_string(return_value, &quot;negative_sign&quot;,     currlocdata.negative_sign,     1);</span>
<span class="lineNum">    4866 </span><span class="lineNoCov">              0 :                 add_assoc_long(  return_value, &quot;int_frac_digits&quot;,   currlocdata.int_frac_digits     );</span>
<span class="lineNum">    4867 </span><span class="lineNoCov">              0 :                 add_assoc_long(  return_value, &quot;frac_digits&quot;,       currlocdata.frac_digits         );</span>
<span class="lineNum">    4868 </span><span class="lineNoCov">              0 :                 add_assoc_long(  return_value, &quot;p_cs_precedes&quot;,     currlocdata.p_cs_precedes       );</span>
<span class="lineNum">    4869 </span><span class="lineNoCov">              0 :                 add_assoc_long(  return_value, &quot;p_sep_by_space&quot;,    currlocdata.p_sep_by_space      );</span>
<span class="lineNum">    4870 </span><span class="lineNoCov">              0 :                 add_assoc_long(  return_value, &quot;n_cs_precedes&quot;,     currlocdata.n_cs_precedes       );</span>
<span class="lineNum">    4871 </span><span class="lineNoCov">              0 :                 add_assoc_long(  return_value, &quot;n_sep_by_space&quot;,    currlocdata.n_sep_by_space      );</span>
<span class="lineNum">    4872 </span><span class="lineNoCov">              0 :                 add_assoc_long(  return_value, &quot;p_sign_posn&quot;,       currlocdata.p_sign_posn         );</span>
<span class="lineNum">    4873 </span><span class="lineNoCov">              0 :                 add_assoc_long(  return_value, &quot;n_sign_posn&quot;,       currlocdata.n_sign_posn         );</span>
<span class="lineNum">    4874 </span>                :         }
<span class="lineNum">    4875 </span>                : #else
<span class="lineNum">    4876 </span>                :         /* Ok, it doesn't look like we have locale info floating around, so I guess it
<span class="lineNum">    4877 </span>                :            wouldn't hurt to just go ahead and return the POSIX locale information?  */
<span class="lineNum">    4878 </span>                : 
<span class="lineNum">    4879 </span>                :         add_index_long(grouping, 0, -1);
<span class="lineNum">    4880 </span>                :         add_index_long(mon_grouping, 0, -1);
<span class="lineNum">    4881 </span>                : 
<span class="lineNum">    4882 </span>                :         add_assoc_string(return_value, &quot;decimal_point&quot;,     &quot;\x2E&quot;, 1);
<span class="lineNum">    4883 </span>                :         add_assoc_string(return_value, &quot;thousands_sep&quot;,     &quot;&quot;,     1);
<span class="lineNum">    4884 </span>                :         add_assoc_string(return_value, &quot;int_curr_symbol&quot;,   &quot;&quot;,     1);
<span class="lineNum">    4885 </span>                :         add_assoc_string(return_value, &quot;currency_symbol&quot;,   &quot;&quot;,     1);
<span class="lineNum">    4886 </span>                :         add_assoc_string(return_value, &quot;mon_decimal_point&quot;, &quot;\x2E&quot;, 1);
<span class="lineNum">    4887 </span>                :         add_assoc_string(return_value, &quot;mon_thousands_sep&quot;, &quot;&quot;,     1);
<span class="lineNum">    4888 </span>                :         add_assoc_string(return_value, &quot;positive_sign&quot;,     &quot;&quot;,     1);
<span class="lineNum">    4889 </span>                :         add_assoc_string(return_value, &quot;negative_sign&quot;,     &quot;&quot;,     1);
<span class="lineNum">    4890 </span>                :         add_assoc_long(  return_value, &quot;int_frac_digits&quot;,   CHAR_MAX );
<span class="lineNum">    4891 </span>                :         add_assoc_long(  return_value, &quot;frac_digits&quot;,       CHAR_MAX );
<span class="lineNum">    4892 </span>                :         add_assoc_long(  return_value, &quot;p_cs_precedes&quot;,     CHAR_MAX );
<span class="lineNum">    4893 </span>                :         add_assoc_long(  return_value, &quot;p_sep_by_space&quot;,    CHAR_MAX );
<span class="lineNum">    4894 </span>                :         add_assoc_long(  return_value, &quot;n_cs_precedes&quot;,     CHAR_MAX );
<span class="lineNum">    4895 </span>                :         add_assoc_long(  return_value, &quot;n_sep_by_space&quot;,    CHAR_MAX );
<span class="lineNum">    4896 </span>                :         add_assoc_long(  return_value, &quot;p_sign_posn&quot;,       CHAR_MAX );
<span class="lineNum">    4897 </span>                :         add_assoc_long(  return_value, &quot;n_sign_posn&quot;,       CHAR_MAX );
<span class="lineNum">    4898 </span>                : #endif
<span class="lineNum">    4899 </span>                : 
<span class="lineNum">    4900 </span><span class="lineNoCov">              0 :         zend_hash_update(Z_ARRVAL_P(return_value), &quot;grouping&quot;, 9, &amp;grouping, sizeof(zval *), NULL);</span>
<span class="lineNum">    4901 </span><span class="lineNoCov">              0 :         zend_hash_update(Z_ARRVAL_P(return_value), &quot;mon_grouping&quot;, 13, &amp;mon_grouping, sizeof(zval *), NULL);</span>
<span class="lineNum">    4902 </span>                : }
<span class="lineNum">    4903 </span>                : /* }}} */
<span class="lineNum">    4904 </span>                : 
<a name="4905"><span class="lineNum">    4905 </span>                : /* {{{ proto int strnatcasecmp(string s1, string s2)</a>
<span class="lineNum">    4906 </span>                :    Returns the result of case-insensitive string comparison using 'natural' algorithm */
<span class="lineNum">    4907 </span><span class="lineNoCov">              0 : PHP_FUNCTION(strnatcasecmp)</span>
<span class="lineNum">    4908 </span>                : {
<span class="lineNum">    4909 </span><span class="lineNoCov">              0 :         php_strnatcmp(INTERNAL_FUNCTION_PARAM_PASSTHRU, 1);</span>
<span class="lineNum">    4910 </span><span class="lineNoCov">              0 : }</span>
<span class="lineNum">    4911 </span>                : /* }}} */
<span class="lineNum">    4912 </span>                : 
<a name="4913"><span class="lineNum">    4913 </span>                : /* {{{ proto int substr_count(string haystack, string needle [, int offset [, int length]])</a>
<span class="lineNum">    4914 </span>                :    Returns the number of times a substring occurs in the string */
<span class="lineNum">    4915 </span><span class="lineNoCov">              0 : PHP_FUNCTION(substr_count)</span>
<span class="lineNum">    4916 </span>                : {
<span class="lineNum">    4917 </span>                :         char *haystack, *needle;
<span class="lineNum">    4918 </span><span class="lineNoCov">              0 :         long offset = 0, length = 0;</span>
<span class="lineNum">    4919 </span><span class="lineNoCov">              0 :         int ac = ZEND_NUM_ARGS();</span>
<span class="lineNum">    4920 </span><span class="lineNoCov">              0 :         int count = 0;</span>
<span class="lineNum">    4921 </span>                :         int haystack_len, needle_len;
<span class="lineNum">    4922 </span>                :         char *p, *endp, cmp;
<span class="lineNum">    4923 </span>                : 
<span class="lineNum">    4924 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;ss|ll&quot;, &amp;haystack, &amp;haystack_len, &amp;needle, &amp;needle_len, &amp;offset, &amp;length) == FAILURE) {</span>
<span class="lineNum">    4925 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    4926 </span>                :         }
<span class="lineNum">    4927 </span>                : 
<span class="lineNum">    4928 </span><span class="lineNoCov">              0 :         if (needle_len == 0) {</span>
<span class="lineNum">    4929 </span><span class="lineNoCov">              0 :                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Empty substring&quot;);</span>
<span class="lineNum">    4930 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    4931 </span>                :         }
<span class="lineNum">    4932 </span>                : 
<span class="lineNum">    4933 </span><span class="lineNoCov">              0 :         p = haystack;</span>
<span class="lineNum">    4934 </span><span class="lineNoCov">              0 :         endp = p + haystack_len;</span>
<span class="lineNum">    4935 </span>                : 
<span class="lineNum">    4936 </span><span class="lineNoCov">              0 :         if (offset &lt; 0) {</span>
<span class="lineNum">    4937 </span><span class="lineNoCov">              0 :                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Offset should be greater than or equal to 0&quot;);</span>
<span class="lineNum">    4938 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    4939 </span>                :         }
<span class="lineNum">    4940 </span>                : 
<span class="lineNum">    4941 </span><span class="lineNoCov">              0 :         if (offset &gt; haystack_len) {</span>
<span class="lineNum">    4942 </span><span class="lineNoCov">              0 :                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Offset value %ld exceeds string length&quot;, offset);</span>
<span class="lineNum">    4943 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    4944 </span>                :         }
<span class="lineNum">    4945 </span><span class="lineNoCov">              0 :         p += offset;</span>
<span class="lineNum">    4946 </span>                : 
<span class="lineNum">    4947 </span><span class="lineNoCov">              0 :         if (ac == 4) {</span>
<span class="lineNum">    4948 </span>                : 
<span class="lineNum">    4949 </span><span class="lineNoCov">              0 :                 if (length &lt;= 0) {</span>
<span class="lineNum">    4950 </span><span class="lineNoCov">              0 :                         php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Length should be greater than 0&quot;);</span>
<span class="lineNum">    4951 </span><span class="lineNoCov">              0 :                         RETURN_FALSE;</span>
<span class="lineNum">    4952 </span>                :                 }
<span class="lineNum">    4953 </span><span class="lineNoCov">              0 :                 if (length &gt; (haystack_len - offset)) {</span>
<span class="lineNum">    4954 </span><span class="lineNoCov">              0 :                         php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Length value %ld exceeds string length&quot;, length);</span>
<span class="lineNum">    4955 </span><span class="lineNoCov">              0 :                         RETURN_FALSE;</span>
<span class="lineNum">    4956 </span>                :                 }
<span class="lineNum">    4957 </span><span class="lineNoCov">              0 :                 endp = p + length;</span>
<span class="lineNum">    4958 </span>                :         }
<span class="lineNum">    4959 </span>                : 
<span class="lineNum">    4960 </span><span class="lineNoCov">              0 :         if (needle_len == 1) {</span>
<span class="lineNum">    4961 </span><span class="lineNoCov">              0 :                 cmp = needle[0];</span>
<span class="lineNum">    4962 </span>                : 
<span class="lineNum">    4963 </span><span class="lineNoCov">              0 :                 while ((p = memchr(p, cmp, endp - p))) {</span>
<span class="lineNum">    4964 </span><span class="lineNoCov">              0 :                         count++;</span>
<span class="lineNum">    4965 </span><span class="lineNoCov">              0 :                         p++;</span>
<span class="lineNum">    4966 </span>                :                 }
<span class="lineNum">    4967 </span>                :         } else {
<span class="lineNum">    4968 </span><span class="lineNoCov">              0 :                 while ((p = php_memnstr(p, needle, needle_len, endp))) {</span>
<span class="lineNum">    4969 </span><span class="lineNoCov">              0 :                         p += needle_len;</span>
<span class="lineNum">    4970 </span><span class="lineNoCov">              0 :                         count++;</span>
<span class="lineNum">    4971 </span>                :                 }
<span class="lineNum">    4972 </span>                :         }
<span class="lineNum">    4973 </span>                : 
<span class="lineNum">    4974 </span><span class="lineNoCov">              0 :         RETURN_LONG(count);</span>
<span class="lineNum">    4975 </span>                : }
<span class="lineNum">    4976 </span>                : /* }}} */
<span class="lineNum">    4977 </span>                : 
<a name="4978"><span class="lineNum">    4978 </span>                : /* {{{ proto string str_pad(string input, int pad_length [, string pad_string [, int pad_type]])</a>
<span class="lineNum">    4979 </span>                :    Returns input string padded on the left or right to specified length with pad_string */
<span class="lineNum">    4980 </span><span class="lineNoCov">              0 : PHP_FUNCTION(str_pad)</span>
<span class="lineNum">    4981 </span>                : {
<span class="lineNum">    4982 </span>                :         /* Input arguments */
<span class="lineNum">    4983 </span>                :         char *input;                            /* Input string */
<span class="lineNum">    4984 </span>                :         int  input_len;
<span class="lineNum">    4985 </span>                :         long pad_length;                        /* Length to pad to */
<span class="lineNum">    4986 </span>                : 
<span class="lineNum">    4987 </span>                :         /* Helper variables */
<span class="lineNum">    4988 </span>                :         size_t     num_pad_chars;               /* Number of padding characters (total - input size) */
<span class="lineNum">    4989 </span><span class="lineNoCov">              0 :         char  *result = NULL;           /* Resulting string */</span>
<span class="lineNum">    4990 </span><span class="lineNoCov">              0 :         int        result_len = 0;              /* Length of the resulting string */</span>
<span class="lineNum">    4991 </span><span class="lineNoCov">              0 :         char  *pad_str_val = &quot; &quot;;     /* Pointer to padding string */</span>
<span class="lineNum">    4992 </span><span class="lineNoCov">              0 :         int    pad_str_len = 1;         /* Length of the padding string */</span>
<span class="lineNum">    4993 </span><span class="lineNoCov">              0 :         long   pad_type_val = STR_PAD_RIGHT; /* The padding type value */</span>
<span class="lineNum">    4994 </span><span class="lineNoCov">              0 :         int        i, left_pad=0, right_pad=0;</span>
<span class="lineNum">    4995 </span>                : 
<span class="lineNum">    4996 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;sl|sl&quot;, &amp;input, &amp;input_len, &amp;pad_length,</span>
<span class="lineNum">    4997 </span>                :                                                                                                                                   &amp;pad_str_val, &amp;pad_str_len, &amp;pad_type_val) == FAILURE) {
<span class="lineNum">    4998 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    4999 </span>                :         }
<span class="lineNum">    5000 </span>                : 
<span class="lineNum">    5001 </span>                :         /* If resulting string turns out to be shorter than input string,
<span class="lineNum">    5002 </span>                :            we simply copy the input and return. */
<span class="lineNum">    5003 </span><span class="lineNoCov">              0 :         if (pad_length &lt;= 0 || (pad_length - input_len) &lt;= 0) {</span>
<span class="lineNum">    5004 </span><span class="lineNoCov">              0 :                 RETURN_STRINGL(input, input_len, 1);</span>
<span class="lineNum">    5005 </span>                :         }
<span class="lineNum">    5006 </span>                : 
<span class="lineNum">    5007 </span><span class="lineNoCov">              0 :         if (pad_str_len == 0) {</span>
<span class="lineNum">    5008 </span><span class="lineNoCov">              0 :                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Padding string cannot be empty&quot;);</span>
<span class="lineNum">    5009 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    5010 </span>                :         }
<span class="lineNum">    5011 </span>                : 
<span class="lineNum">    5012 </span><span class="lineNoCov">              0 :         if (pad_type_val &lt; STR_PAD_LEFT || pad_type_val &gt; STR_PAD_BOTH) {</span>
<span class="lineNum">    5013 </span><span class="lineNoCov">              0 :                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Padding type has to be STR_PAD_LEFT, STR_PAD_RIGHT, or STR_PAD_BOTH&quot;);</span>
<span class="lineNum">    5014 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    5015 </span>                :         }
<span class="lineNum">    5016 </span>                : 
<span class="lineNum">    5017 </span><span class="lineNoCov">              0 :         num_pad_chars = pad_length - input_len;</span>
<span class="lineNum">    5018 </span><span class="lineNoCov">              0 :         if (num_pad_chars &gt;= INT_MAX) {</span>
<span class="lineNum">    5019 </span><span class="lineNoCov">              0 :                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Padding length is too long&quot;);</span>
<span class="lineNum">    5020 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    5021 </span>                :         }
<span class="lineNum">    5022 </span><span class="lineNoCov">              0 :         result = (char *)emalloc(input_len + num_pad_chars + 1);</span>
<span class="lineNum">    5023 </span>                : 
<span class="lineNum">    5024 </span>                :         /* We need to figure out the left/right padding lengths. */
<span class="lineNum">    5025 </span><span class="lineNoCov">              0 :         switch (pad_type_val) {</span>
<span class="lineNum">    5026 </span>                :                 case STR_PAD_RIGHT:
<span class="lineNum">    5027 </span><span class="lineNoCov">              0 :                         left_pad = 0;</span>
<span class="lineNum">    5028 </span><span class="lineNoCov">              0 :                         right_pad = num_pad_chars;</span>
<span class="lineNum">    5029 </span><span class="lineNoCov">              0 :                         break;</span>
<span class="lineNum">    5030 </span>                : 
<span class="lineNum">    5031 </span>                :                 case STR_PAD_LEFT:
<span class="lineNum">    5032 </span><span class="lineNoCov">              0 :                         left_pad = num_pad_chars;</span>
<span class="lineNum">    5033 </span><span class="lineNoCov">              0 :                         right_pad = 0;</span>
<span class="lineNum">    5034 </span><span class="lineNoCov">              0 :                         break;</span>
<span class="lineNum">    5035 </span>                : 
<span class="lineNum">    5036 </span>                :                 case STR_PAD_BOTH:
<span class="lineNum">    5037 </span><span class="lineNoCov">              0 :                         left_pad = num_pad_chars / 2;</span>
<span class="lineNum">    5038 </span><span class="lineNoCov">              0 :                         right_pad = num_pad_chars - left_pad;</span>
<span class="lineNum">    5039 </span>                :                         break;
<span class="lineNum">    5040 </span>                :         }
<span class="lineNum">    5041 </span>                : 
<span class="lineNum">    5042 </span>                :         /* First we pad on the left. */
<span class="lineNum">    5043 </span><span class="lineNoCov">              0 :         for (i = 0; i &lt; left_pad; i++)</span>
<span class="lineNum">    5044 </span><span class="lineNoCov">              0 :                 result[result_len++] = pad_str_val[i % pad_str_len];</span>
<span class="lineNum">    5045 </span>                : 
<span class="lineNum">    5046 </span>                :         /* Then we copy the input string. */
<span class="lineNum">    5047 </span><span class="lineNoCov">              0 :         memcpy(result + result_len, input, input_len);</span>
<span class="lineNum">    5048 </span><span class="lineNoCov">              0 :         result_len += input_len;</span>
<span class="lineNum">    5049 </span>                : 
<span class="lineNum">    5050 </span>                :         /* Finally, we pad on the right. */
<span class="lineNum">    5051 </span><span class="lineNoCov">              0 :         for (i = 0; i &lt; right_pad; i++)</span>
<span class="lineNum">    5052 </span><span class="lineNoCov">              0 :                 result[result_len++] = pad_str_val[i % pad_str_len];</span>
<span class="lineNum">    5053 </span>                : 
<span class="lineNum">    5054 </span><span class="lineNoCov">              0 :         result[result_len] = '\0';</span>
<span class="lineNum">    5055 </span>                : 
<span class="lineNum">    5056 </span><span class="lineNoCov">              0 :         RETURN_STRINGL(result, result_len, 0);</span>
<span class="lineNum">    5057 </span>                : }
<span class="lineNum">    5058 </span>                : /* }}} */
<span class="lineNum">    5059 </span>                : 
<a name="5060"><span class="lineNum">    5060 </span>                : /* {{{ proto mixed sscanf(string str, string format [, string ...])</a>
<span class="lineNum">    5061 </span>                :    Implements an ANSI C compatible sscanf */
<span class="lineNum">    5062 </span><span class="lineNoCov">              0 : PHP_FUNCTION(sscanf)</span>
<span class="lineNum">    5063 </span>                : {
<span class="lineNum">    5064 </span><span class="lineNoCov">              0 :         zval ***args = NULL;</span>
<span class="lineNum">    5065 </span>                :         char *str, *format;
<span class="lineNum">    5066 </span><span class="lineNoCov">              0 :         int str_len, format_len, result, num_args = 0;</span>
<span class="lineNum">    5067 </span>                : 
<span class="lineNum">    5068 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;ss*&quot;, &amp;str, &amp;str_len, &amp;format, &amp;format_len,</span>
<span class="lineNum">    5069 </span>                :                 &amp;args, &amp;num_args) == FAILURE) {
<span class="lineNum">    5070 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    5071 </span>                :         }
<span class="lineNum">    5072 </span>                : 
<span class="lineNum">    5073 </span><span class="lineNoCov">              0 :         result = php_sscanf_internal(str, format, num_args, args, 0, &amp;return_value TSRMLS_CC);</span>
<span class="lineNum">    5074 </span>                : 
<span class="lineNum">    5075 </span><span class="lineNoCov">              0 :         if (args) {</span>
<span class="lineNum">    5076 </span><span class="lineNoCov">              0 :                 efree(args);</span>
<span class="lineNum">    5077 </span>                :         }
<span class="lineNum">    5078 </span>                : 
<span class="lineNum">    5079 </span><span class="lineNoCov">              0 :         if (SCAN_ERROR_WRONG_PARAM_COUNT == result) {</span>
<span class="lineNum">    5080 </span><span class="lineNoCov">              0 :                 WRONG_PARAM_COUNT;</span>
<span class="lineNum">    5081 </span>                :         }
<span class="lineNum">    5082 </span>                : }
<span class="lineNum">    5083 </span>                : /* }}} */
<span class="lineNum">    5084 </span>                : 
<span class="lineNum">    5085 </span>                : static char rot13_from[] = &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;;
<span class="lineNum">    5086 </span>                : static char rot13_to[] = &quot;nopqrstuvwxyzabcdefghijklmNOPQRSTUVWXYZABCDEFGHIJKLM&quot;;
<span class="lineNum">    5087 </span>                : 
<a name="5088"><span class="lineNum">    5088 </span>                : /* {{{ proto string str_rot13(string str)</a>
<span class="lineNum">    5089 </span>                :    Perform the rot13 transform on a string */
<span class="lineNum">    5090 </span><span class="lineNoCov">              0 : PHP_FUNCTION(str_rot13)</span>
<span class="lineNum">    5091 </span>                : {
<span class="lineNum">    5092 </span>                :         char *arg;
<span class="lineNum">    5093 </span>                :         int arglen;
<span class="lineNum">    5094 </span>                : 
<span class="lineNum">    5095 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s&quot;, &amp;arg, &amp;arglen) == FAILURE) {</span>
<span class="lineNum">    5096 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    5097 </span>                :         }
<span class="lineNum">    5098 </span>                : 
<span class="lineNum">    5099 </span><span class="lineNoCov">              0 :         RETVAL_STRINGL(arg, arglen, 1);</span>
<span class="lineNum">    5100 </span>                : 
<span class="lineNum">    5101 </span><span class="lineNoCov">              0 :         php_strtr(Z_STRVAL_P(return_value), Z_STRLEN_P(return_value), rot13_from, rot13_to, 52);</span>
<span class="lineNum">    5102 </span>                : }
<a name="5103"><span class="lineNum">    5103 </span>                : /* }}} */</a>
<span class="lineNum">    5104 </span>                : 
<span class="lineNum">    5105 </span><span class="lineNoCov">              0 : static void php_string_shuffle(char *str, long len TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">    5106 </span>                : {
<span class="lineNum">    5107 </span>                :         long n_elems, rnd_idx, n_left;
<span class="lineNum">    5108 </span>                :         char temp;
<span class="lineNum">    5109 </span>                :         /* The implementation is stolen from array_data_shuffle       */
<span class="lineNum">    5110 </span>                :         /* Thus the characteristics of the randomization are the same */
<span class="lineNum">    5111 </span><span class="lineNoCov">              0 :         n_elems = len;</span>
<span class="lineNum">    5112 </span>                : 
<span class="lineNum">    5113 </span><span class="lineNoCov">              0 :         if (n_elems &lt;= 1) {</span>
<span class="lineNum">    5114 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    5115 </span>                :         }
<span class="lineNum">    5116 </span>                : 
<span class="lineNum">    5117 </span><span class="lineNoCov">              0 :         n_left = n_elems;</span>
<span class="lineNum">    5118 </span>                : 
<span class="lineNum">    5119 </span><span class="lineNoCov">              0 :         while (--n_left) {</span>
<span class="lineNum">    5120 </span><span class="lineNoCov">              0 :                 rnd_idx = php_rand(TSRMLS_C);</span>
<span class="lineNum">    5121 </span><span class="lineNoCov">              0 :                 RAND_RANGE(rnd_idx, 0, n_left, PHP_RAND_MAX);</span>
<span class="lineNum">    5122 </span><span class="lineNoCov">              0 :                 if (rnd_idx != n_left) {</span>
<span class="lineNum">    5123 </span><span class="lineNoCov">              0 :                         temp = str[n_left];</span>
<span class="lineNum">    5124 </span><span class="lineNoCov">              0 :                         str[n_left] = str[rnd_idx];</span>
<span class="lineNum">    5125 </span><span class="lineNoCov">              0 :                         str[rnd_idx] = temp;</span>
<span class="lineNum">    5126 </span>                :                 }
<span class="lineNum">    5127 </span>                :         }
<span class="lineNum">    5128 </span>                : }
<span class="lineNum">    5129 </span>                : /* }}} */
<span class="lineNum">    5130 </span>                : 
<a name="5131"><span class="lineNum">    5131 </span>                : /* {{{ proto void str_shuffle(string str)</a>
<span class="lineNum">    5132 </span>                :    Shuffles string. One permutation of all possible is created */
<span class="lineNum">    5133 </span><span class="lineNoCov">              0 : PHP_FUNCTION(str_shuffle)</span>
<span class="lineNum">    5134 </span>                : {
<span class="lineNum">    5135 </span>                :         char *arg;
<span class="lineNum">    5136 </span>                :         int arglen;
<span class="lineNum">    5137 </span>                : 
<span class="lineNum">    5138 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s&quot;, &amp;arg, &amp;arglen) == FAILURE) {</span>
<span class="lineNum">    5139 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    5140 </span>                :         }
<span class="lineNum">    5141 </span>                : 
<span class="lineNum">    5142 </span><span class="lineNoCov">              0 :         RETVAL_STRINGL(arg, arglen, 1);</span>
<span class="lineNum">    5143 </span><span class="lineNoCov">              0 :         if (Z_STRLEN_P(return_value) &gt; 1) {</span>
<span class="lineNum">    5144 </span><span class="lineNoCov">              0 :                 php_string_shuffle(Z_STRVAL_P(return_value), (long) Z_STRLEN_P(return_value) TSRMLS_CC);</span>
<span class="lineNum">    5145 </span>                :         }
<span class="lineNum">    5146 </span>                : }
<span class="lineNum">    5147 </span>                : /* }}} */
<span class="lineNum">    5148 </span>                : 
<span class="lineNum">    5149 </span>                : /* {{{ proto mixed str_word_count(string str, [int format [, string charlist]])
<span class="lineNum">    5150 </span>                :         Counts the number of words inside a string. If format of 1 is specified,
<span class="lineNum">    5151 </span>                :         then the function will return an array containing all the words
<span class="lineNum">    5152 </span>                :         found inside the string. If format of 2 is specified, then the function
<span class="lineNum">    5153 </span>                :         will return an associated array where the position of the word is the key
<span class="lineNum">    5154 </span>                :         and the word itself is the value.
<span class="lineNum">    5155 </span>                : 
<span class="lineNum">    5156 </span>                :         For the purpose of this function, 'word' is defined as a locale dependent
<span class="lineNum">    5157 </span>                :         string containing alphabetic characters, which also may contain, but not start
<a name="5158"><span class="lineNum">    5158 </span>                :         with &quot;'&quot; and &quot;-&quot; characters.</a>
<span class="lineNum">    5159 </span>                : */
<span class="lineNum">    5160 </span><span class="lineNoCov">              0 : PHP_FUNCTION(str_word_count)</span>
<span class="lineNum">    5161 </span>                : {
<span class="lineNum">    5162 </span><span class="lineNoCov">              0 :         char *buf, *str, *char_list = NULL, *p, *e, *s, ch[256];</span>
<span class="lineNum">    5163 </span><span class="lineNoCov">              0 :         int str_len, char_list_len = 0, word_count = 0;</span>
<span class="lineNum">    5164 </span><span class="lineNoCov">              0 :         long type = 0;</span>
<span class="lineNum">    5165 </span>                : 
<span class="lineNum">    5166 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s|ls&quot;, &amp;str, &amp;str_len, &amp;type, &amp;char_list, &amp;char_list_len) == FAILURE) {</span>
<span class="lineNum">    5167 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    5168 </span>                :         }
<span class="lineNum">    5169 </span>                : 
<span class="lineNum">    5170 </span><span class="lineNoCov">              0 :         switch(type) {</span>
<span class="lineNum">    5171 </span>                :                 case 1:
<span class="lineNum">    5172 </span>                :                 case 2:
<span class="lineNum">    5173 </span><span class="lineNoCov">              0 :                         array_init(return_value);</span>
<span class="lineNum">    5174 </span><span class="lineNoCov">              0 :                         if (!str_len) {</span>
<span class="lineNum">    5175 </span><span class="lineNoCov">              0 :                                 return;</span>
<span class="lineNum">    5176 </span>                :                         }
<span class="lineNum">    5177 </span><span class="lineNoCov">              0 :                         break;</span>
<span class="lineNum">    5178 </span>                :                 case 0:
<span class="lineNum">    5179 </span><span class="lineNoCov">              0 :                         if (!str_len) {</span>
<span class="lineNum">    5180 </span><span class="lineNoCov">              0 :                                 RETURN_LONG(0);</span>
<span class="lineNum">    5181 </span>                :                         }
<span class="lineNum">    5182 </span>                :                         /* nothing to be done */
<span class="lineNum">    5183 </span><span class="lineNoCov">              0 :                         break;</span>
<span class="lineNum">    5184 </span>                :                 default:
<span class="lineNum">    5185 </span><span class="lineNoCov">              0 :                         php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Invalid format value %ld&quot;, type);</span>
<span class="lineNum">    5186 </span><span class="lineNoCov">              0 :                         RETURN_FALSE;</span>
<span class="lineNum">    5187 </span>                :         }
<span class="lineNum">    5188 </span>                : 
<span class="lineNum">    5189 </span><span class="lineNoCov">              0 :         if (char_list) {</span>
<span class="lineNum">    5190 </span><span class="lineNoCov">              0 :                 php_charmask((unsigned char *)char_list, char_list_len, ch TSRMLS_CC);</span>
<span class="lineNum">    5191 </span>                :         }
<span class="lineNum">    5192 </span>                : 
<span class="lineNum">    5193 </span><span class="lineNoCov">              0 :         p = str;</span>
<span class="lineNum">    5194 </span><span class="lineNoCov">              0 :         e = str + str_len;</span>
<span class="lineNum">    5195 </span>                : 
<span class="lineNum">    5196 </span>                :         /* first character cannot be ' or -, unless explicitly allowed by the user */
<span class="lineNum">    5197 </span><span class="lineNoCov">              0 :         if ((*p == '\'' &amp;&amp; (!char_list || !ch['\''])) || (*p == '-' &amp;&amp; (!char_list || !ch['-']))) {</span>
<span class="lineNum">    5198 </span><span class="lineNoCov">              0 :                 p++;</span>
<span class="lineNum">    5199 </span>                :         }
<span class="lineNum">    5200 </span>                :         /* last character cannot be -, unless explicitly allowed by the user */
<span class="lineNum">    5201 </span><span class="lineNoCov">              0 :         if (*(e - 1) == '-' &amp;&amp; (!char_list || !ch['-'])) {</span>
<span class="lineNum">    5202 </span><span class="lineNoCov">              0 :                 e--;</span>
<span class="lineNum">    5203 </span>                :         }
<span class="lineNum">    5204 </span>                : 
<span class="lineNum">    5205 </span><span class="lineNoCov">              0 :         while (p &lt; e) {</span>
<span class="lineNum">    5206 </span><span class="lineNoCov">              0 :                 s = p;</span>
<span class="lineNum">    5207 </span><span class="lineNoCov">              0 :                 while (p &lt; e &amp;&amp; (isalpha((unsigned char)*p) || (char_list &amp;&amp; ch[(unsigned char)*p]) || *p == '\'' || *p == '-')) {</span>
<span class="lineNum">    5208 </span><span class="lineNoCov">              0 :                         p++;</span>
<span class="lineNum">    5209 </span>                :                 }
<span class="lineNum">    5210 </span><span class="lineNoCov">              0 :                 if (p &gt; s) {</span>
<span class="lineNum">    5211 </span><span class="lineNoCov">              0 :                         switch (type)</span>
<span class="lineNum">    5212 </span>                :                         {
<span class="lineNum">    5213 </span>                :                                 case 1:
<span class="lineNum">    5214 </span><span class="lineNoCov">              0 :                                         buf = estrndup(s, (p-s));</span>
<span class="lineNum">    5215 </span><span class="lineNoCov">              0 :                                         add_next_index_stringl(return_value, buf, (p-s), 0);</span>
<span class="lineNum">    5216 </span><span class="lineNoCov">              0 :                                         break;</span>
<span class="lineNum">    5217 </span>                :                                 case 2:
<span class="lineNum">    5218 </span><span class="lineNoCov">              0 :                                         buf = estrndup(s, (p-s));</span>
<span class="lineNum">    5219 </span><span class="lineNoCov">              0 :                                         add_index_stringl(return_value, (s - str), buf, p-s, 0);</span>
<span class="lineNum">    5220 </span><span class="lineNoCov">              0 :                                         break;</span>
<span class="lineNum">    5221 </span>                :                                 default:
<span class="lineNum">    5222 </span><span class="lineNoCov">              0 :                                         word_count++;</span>
<span class="lineNum">    5223 </span>                :                                         break;
<span class="lineNum">    5224 </span>                :                         }
<span class="lineNum">    5225 </span>                :                 }
<span class="lineNum">    5226 </span><span class="lineNoCov">              0 :                 p++;</span>
<span class="lineNum">    5227 </span>                :         }
<span class="lineNum">    5228 </span>                : 
<span class="lineNum">    5229 </span><span class="lineNoCov">              0 :         if (!type) {</span>
<span class="lineNum">    5230 </span><span class="lineNoCov">              0 :                 RETURN_LONG(word_count);</span>
<span class="lineNum">    5231 </span>                :         }
<span class="lineNum">    5232 </span>                : }
<span class="lineNum">    5233 </span>                : 
<span class="lineNum">    5234 </span>                : /* }}} */
<span class="lineNum">    5235 </span>                : 
<span class="lineNum">    5236 </span>                : #if HAVE_STRFMON
<a name="5237"><span class="lineNum">    5237 </span>                : /* {{{ proto string money_format(string format , float value)</a>
<span class="lineNum">    5238 </span>                :    Convert monetary value(s) to string */
<span class="lineNum">    5239 </span><span class="lineNoCov">              0 : PHP_FUNCTION(money_format)</span>
<span class="lineNum">    5240 </span>                : {
<span class="lineNum">    5241 </span><span class="lineNoCov">              0 :         int format_len = 0, str_len;</span>
<span class="lineNum">    5242 </span>                :         char *format, *str, *p, *e;
<span class="lineNum">    5243 </span>                :         double value;
<span class="lineNum">    5244 </span><span class="lineNoCov">              0 :         zend_bool check = 0;</span>
<span class="lineNum">    5245 </span>                : 
<span class="lineNum">    5246 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;sd&quot;, &amp;format, &amp;format_len, &amp;value) == FAILURE) {</span>
<span class="lineNum">    5247 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    5248 </span>                :         }
<span class="lineNum">    5249 </span>                : 
<span class="lineNum">    5250 </span><span class="lineNoCov">              0 :         p = format;</span>
<span class="lineNum">    5251 </span><span class="lineNoCov">              0 :         e = p + format_len;</span>
<span class="lineNum">    5252 </span><span class="lineNoCov">              0 :         while ((p = memchr(p, '%', (e - p)))) {</span>
<span class="lineNum">    5253 </span><span class="lineNoCov">              0 :                 if (*(p + 1) == '%') {</span>
<span class="lineNum">    5254 </span><span class="lineNoCov">              0 :                         p += 2;</span>
<span class="lineNum">    5255 </span><span class="lineNoCov">              0 :                 } else if (!check) {</span>
<span class="lineNum">    5256 </span><span class="lineNoCov">              0 :                         check = 1;</span>
<span class="lineNum">    5257 </span><span class="lineNoCov">              0 :                         p++;</span>
<span class="lineNum">    5258 </span>                :                 } else {
<span class="lineNum">    5259 </span><span class="lineNoCov">              0 :                         php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;Only a single %%i or %%n token can be used&quot;);</span>
<span class="lineNum">    5260 </span><span class="lineNoCov">              0 :                         RETURN_FALSE;</span>
<span class="lineNum">    5261 </span>                :                 }
<span class="lineNum">    5262 </span>                :         }
<span class="lineNum">    5263 </span>                : 
<span class="lineNum">    5264 </span><span class="lineNoCov">              0 :         str_len = format_len + 1024;</span>
<span class="lineNum">    5265 </span><span class="lineNoCov">              0 :         str = emalloc(str_len);</span>
<span class="lineNum">    5266 </span><span class="lineNoCov">              0 :         if ((str_len = strfmon(str, str_len, format, value)) &lt; 0) {</span>
<span class="lineNum">    5267 </span><span class="lineNoCov">              0 :                 efree(str);</span>
<span class="lineNum">    5268 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    5269 </span>                :         }
<span class="lineNum">    5270 </span><span class="lineNoCov">              0 :         str[str_len] = 0;</span>
<span class="lineNum">    5271 </span>                : 
<span class="lineNum">    5272 </span><span class="lineNoCov">              0 :         RETURN_STRINGL(erealloc(str, str_len + 1), str_len, 0);</span>
<span class="lineNum">    5273 </span>                : }
<span class="lineNum">    5274 </span>                : /* }}} */
<span class="lineNum">    5275 </span>                : #endif
<span class="lineNum">    5276 </span>                : 
<a name="5277"><span class="lineNum">    5277 </span>                : /* {{{ proto array str_split(string str [, int split_length])</a>
<span class="lineNum">    5278 </span>                :    Convert a string to an array. If split_length is specified, break the string down into chunks each split_length characters long. */
<span class="lineNum">    5279 </span><span class="lineNoCov">              0 : PHP_FUNCTION(str_split)</span>
<span class="lineNum">    5280 </span>                : {
<span class="lineNum">    5281 </span>                :         char *str;
<span class="lineNum">    5282 </span>                :         int str_len;
<span class="lineNum">    5283 </span><span class="lineNoCov">              0 :         long split_length = 1;</span>
<span class="lineNum">    5284 </span>                :         char *p;
<span class="lineNum">    5285 </span>                :         int n_reg_segments;
<span class="lineNum">    5286 </span>                : 
<span class="lineNum">    5287 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;s|l&quot;, &amp;str, &amp;str_len, &amp;split_length) == FAILURE) {</span>
<span class="lineNum">    5288 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    5289 </span>                :         }
<span class="lineNum">    5290 </span>                : 
<span class="lineNum">    5291 </span><span class="lineNoCov">              0 :         if (split_length &lt;= 0) {</span>
<span class="lineNum">    5292 </span><span class="lineNoCov">              0 :                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;The length of each segment must be greater than zero&quot;);</span>
<span class="lineNum">    5293 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    5294 </span>                :         }
<span class="lineNum">    5295 </span>                : 
<span class="lineNum">    5296 </span><span class="lineNoCov">              0 :         array_init_size(return_value, ((str_len - 1) / split_length) + 1);</span>
<span class="lineNum">    5297 </span>                : 
<span class="lineNum">    5298 </span><span class="lineNoCov">              0 :         if (split_length &gt;= str_len) {</span>
<span class="lineNum">    5299 </span><span class="lineNoCov">              0 :                 add_next_index_stringl(return_value, str, str_len, 1);</span>
<span class="lineNum">    5300 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    5301 </span>                :         }
<span class="lineNum">    5302 </span>                : 
<span class="lineNum">    5303 </span><span class="lineNoCov">              0 :         n_reg_segments = str_len / split_length;</span>
<span class="lineNum">    5304 </span><span class="lineNoCov">              0 :         p = str;</span>
<span class="lineNum">    5305 </span>                : 
<span class="lineNum">    5306 </span><span class="lineNoCov">              0 :         while (n_reg_segments-- &gt; 0) {</span>
<span class="lineNum">    5307 </span><span class="lineNoCov">              0 :                 add_next_index_stringl(return_value, p, split_length, 1);</span>
<span class="lineNum">    5308 </span><span class="lineNoCov">              0 :                 p += split_length;</span>
<span class="lineNum">    5309 </span>                :         }
<span class="lineNum">    5310 </span>                : 
<span class="lineNum">    5311 </span><span class="lineNoCov">              0 :         if (p != (str + str_len)) {</span>
<span class="lineNum">    5312 </span><span class="lineNoCov">              0 :                 add_next_index_stringl(return_value, p, (str + str_len - p), 1);</span>
<span class="lineNum">    5313 </span>                :         }
<span class="lineNum">    5314 </span>                : }
<span class="lineNum">    5315 </span>                : /* }}} */
<span class="lineNum">    5316 </span>                : 
<a name="5317"><span class="lineNum">    5317 </span>                : /* {{{ proto array strpbrk(string haystack, string char_list)</a>
<span class="lineNum">    5318 </span>                :    Search a string for any of a set of characters */
<span class="lineNum">    5319 </span><span class="lineNoCov">              0 : PHP_FUNCTION(strpbrk)</span>
<span class="lineNum">    5320 </span>                : {
<span class="lineNum">    5321 </span>                :         char *haystack, *char_list;
<span class="lineNum">    5322 </span>                :         int haystack_len, char_list_len;
<span class="lineNum">    5323 </span>                :         char *haystack_ptr, *cl_ptr;
<span class="lineNum">    5324 </span>                : 
<span class="lineNum">    5325 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;ss&quot;, &amp;haystack, &amp;haystack_len, &amp;char_list, &amp;char_list_len) == FAILURE) {</span>
<span class="lineNum">    5326 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    5327 </span>                :         }
<span class="lineNum">    5328 </span>                : 
<span class="lineNum">    5329 </span><span class="lineNoCov">              0 :         if (!char_list_len) {</span>
<span class="lineNum">    5330 </span><span class="lineNoCov">              0 :                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;The character list cannot be empty&quot;);</span>
<span class="lineNum">    5331 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    5332 </span>                :         }
<span class="lineNum">    5333 </span>                : 
<span class="lineNum">    5334 </span><span class="lineNoCov">              0 :         for (haystack_ptr = haystack; haystack_ptr &lt; (haystack + haystack_len); ++haystack_ptr) {</span>
<span class="lineNum">    5335 </span><span class="lineNoCov">              0 :                 for (cl_ptr = char_list; cl_ptr &lt; (char_list + char_list_len); ++cl_ptr) {</span>
<span class="lineNum">    5336 </span><span class="lineNoCov">              0 :                         if (*cl_ptr == *haystack_ptr) {</span>
<span class="lineNum">    5337 </span><span class="lineNoCov">              0 :                                 RETURN_STRINGL(haystack_ptr, (haystack + haystack_len - haystack_ptr), 1);</span>
<span class="lineNum">    5338 </span>                :                         }
<span class="lineNum">    5339 </span>                :                 }
<span class="lineNum">    5340 </span>                :         }
<span class="lineNum">    5341 </span>                : 
<span class="lineNum">    5342 </span><span class="lineNoCov">              0 :         RETURN_FALSE;</span>
<span class="lineNum">    5343 </span>                : }
<span class="lineNum">    5344 </span>                : /* }}} */
<span class="lineNum">    5345 </span>                : 
<a name="5346"><span class="lineNum">    5346 </span>                : /* {{{ proto int substr_compare(string main_str, string str, int offset [, int length [, bool case_sensitivity]])</a>
<span class="lineNum">    5347 </span>                :    Binary safe optionally case insensitive comparison of 2 strings from an offset, up to length characters */
<span class="lineNum">    5348 </span><span class="lineNoCov">              0 : PHP_FUNCTION(substr_compare)</span>
<span class="lineNum">    5349 </span>                : {
<span class="lineNum">    5350 </span>                :         char *s1, *s2;
<span class="lineNum">    5351 </span>                :         int s1_len, s2_len;
<span class="lineNum">    5352 </span><span class="lineNoCov">              0 :         long offset, len=0;</span>
<span class="lineNum">    5353 </span><span class="lineNoCov">              0 :         zend_bool cs=0;</span>
<span class="lineNum">    5354 </span>                :         uint cmp_len;
<span class="lineNum">    5355 </span>                : 
<span class="lineNum">    5356 </span><span class="lineNoCov">              0 :         if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, &quot;ssl|lb&quot;, &amp;s1, &amp;s1_len, &amp;s2, &amp;s2_len, &amp;offset, &amp;len, &amp;cs) == FAILURE) {</span>
<span class="lineNum">    5357 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    5358 </span>                :         }
<span class="lineNum">    5359 </span>                : 
<span class="lineNum">    5360 </span><span class="lineNoCov">              0 :         if (ZEND_NUM_ARGS() &gt;= 4 &amp;&amp; len &lt;= 0) {</span>
<span class="lineNum">    5361 </span><span class="lineNoCov">              0 :                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;The length must be greater than zero&quot;);</span>
<span class="lineNum">    5362 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    5363 </span>                :         }
<span class="lineNum">    5364 </span>                : 
<span class="lineNum">    5365 </span><span class="lineNoCov">              0 :         if (offset &lt; 0) {</span>
<span class="lineNum">    5366 </span><span class="lineNoCov">              0 :                 offset = s1_len + offset;</span>
<span class="lineNum">    5367 </span><span class="lineNoCov">              0 :                 offset = (offset &lt; 0) ? 0 : offset;</span>
<span class="lineNum">    5368 </span>                :         }
<span class="lineNum">    5369 </span>                : 
<span class="lineNum">    5370 </span><span class="lineNoCov">              0 :         if (offset &gt;= s1_len) {</span>
<span class="lineNum">    5371 </span><span class="lineNoCov">              0 :                 php_error_docref(NULL TSRMLS_CC, E_WARNING, &quot;The start position cannot exceed initial string length&quot;);</span>
<span class="lineNum">    5372 </span><span class="lineNoCov">              0 :                 RETURN_FALSE;</span>
<span class="lineNum">    5373 </span>                :         }
<span class="lineNum">    5374 </span>                : 
<span class="lineNum">    5375 </span><span class="lineNoCov">              0 :         cmp_len = (uint) (len ? len : MAX(s2_len, (s1_len - offset)));</span>
<span class="lineNum">    5376 </span>                : 
<span class="lineNum">    5377 </span><span class="lineNoCov">              0 :         if (!cs) {</span>
<span class="lineNum">    5378 </span><span class="lineNoCov">              0 :                 RETURN_LONG(zend_binary_strncmp(s1 + offset, (s1_len - offset), s2, s2_len, cmp_len));</span>
<span class="lineNum">    5379 </span>                :         } else {
<span class="lineNum">    5380 </span><span class="lineNoCov">              0 :                 RETURN_LONG(zend_binary_strncasecmp(s1 + offset, (s1_len - offset), s2, s2_len, cmp_len));</span>
<span class="lineNum">    5381 </span>                :         }
<span class="lineNum">    5382 </span>                : }
<span class="lineNum">    5383 </span>                : /* }}} */
<span class="lineNum">    5384 </span>                : 
<span class="lineNum">    5385 </span>                : /*
<span class="lineNum">    5386 </span>                :  * Local variables:
<span class="lineNum">    5387 </span>                :  * tab-width: 4
<span class="lineNum">    5388 </span>                :  * c-basic-offset: 4
<span class="lineNum">    5389 </span>                :  * End:
<span class="lineNum">    5390 </span>                :  * vim600: noet sw=4 ts=4 fdm=marker
<span class="lineNum">    5391 </span>                :  * vim&lt;600: noet sw=4 ts=4
<span class="lineNum">    5392 </span>                :  */
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
  <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.7</a></td></tr>
  </table>
  <br>

</body>
</html>
