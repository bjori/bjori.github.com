<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <title>LCOV - PHP Code Coverage - Zend/zend_execute_API.c</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
        <tr>
          <td width="5%"></td>
          <td width="10%" class="headerItem">Current view:</td>
          <td width="35%" class="headerValue"><a href="../index.html">directory</a> - <a href="index.html">Zend</a> - zend_execute_API.c (source / <a href="zend_execute_API.c.func.html">functions</a>)</td>
          <td width="10%"></td>
          <td width="10%" class="headerCovTableHead">Found</td>
          <td width="10%" class="headerCovTableHead">Hit</td>
          <td width="15%" class="headerCovTableHead">Coverage</td>
          <td width="5%"></td>
        </tr>
        <tr>
          <td></td>
          <td class="headerItem">Test:</td>
          <td class="headerValue">PHP Code Coverage</td>
          <td class="headerItem">Lines:</td>
          <td class="headerCovTableEntry">803</td>
          <td class="headerCovTableEntry">366</td>
          <td class="headerCovTableEntryMed">45.6 %</td>
        </tr>
        <tr>
          <td></td>
          <td class="headerItem">Date:</td>
          <td class="headerValue">2012-06-19</td>
          <td class="headerItem">Functions:</td>
          <td class="headerCovTableEntry">45</td>
          <td class="headerCovTableEntry">29</td>
          <td class="headerCovTableEntryLo">64.4 %</td>
        </tr>
        <tr>
          <td></td>
          <td class="headerItem">Colors:</td>
          <td class="headerValueLeg" colspan=5>
            <span class="coverLegendNoCov">not hit</span>
            <span class="coverLegendCov">hit</span>
          </td>
        </tr>
                <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td><pre class="source">
<a name="1"><span class="lineNum">       1 </span>                : /*</a>
<span class="lineNum">       2 </span>                :    +----------------------------------------------------------------------+
<span class="lineNum">       3 </span>                :    | Zend Engine                                                          |
<span class="lineNum">       4 </span>                :    +----------------------------------------------------------------------+
<span class="lineNum">       5 </span>                :    | Copyright (c) 1998-2012 Zend Technologies Ltd. (http://www.zend.com) |
<span class="lineNum">       6 </span>                :    +----------------------------------------------------------------------+
<span class="lineNum">       7 </span>                :    | This source file is subject to version 2.00 of the Zend license,     |
<span class="lineNum">       8 </span>                :    | that is bundled with this package in the file LICENSE, and is        |
<span class="lineNum">       9 </span>                :    | available through the world-wide-web at the following url:           |
<span class="lineNum">      10 </span>                :    | http://www.zend.com/license/2_00.txt.                                |
<span class="lineNum">      11 </span>                :    | If you did not receive a copy of the Zend license and are unable to  |
<span class="lineNum">      12 </span>                :    | obtain it through the world-wide-web, please send a note to          |
<span class="lineNum">      13 </span>                :    | license@zend.com so we can mail you a copy immediately.              |
<span class="lineNum">      14 </span>                :    +----------------------------------------------------------------------+
<span class="lineNum">      15 </span>                :    | Authors: Andi Gutmans &lt;andi@zend.com&gt;                                |
<span class="lineNum">      16 </span>                :    |          Zeev Suraski &lt;zeev@zend.com&gt;                                |
<span class="lineNum">      17 </span>                :    +----------------------------------------------------------------------+
<span class="lineNum">      18 </span>                : */
<span class="lineNum">      19 </span>                : 
<span class="lineNum">      20 </span>                : /* $Id$ */
<span class="lineNum">      21 </span>                : 
<span class="lineNum">      22 </span>                : #include &lt;stdio.h&gt;
<span class="lineNum">      23 </span>                : #include &lt;signal.h&gt;
<span class="lineNum">      24 </span>                : 
<span class="lineNum">      25 </span>                : #include &quot;zend.h&quot;
<span class="lineNum">      26 </span>                : #include &quot;zend_compile.h&quot;
<span class="lineNum">      27 </span>                : #include &quot;zend_execute.h&quot;
<span class="lineNum">      28 </span>                : #include &quot;zend_API.h&quot;
<span class="lineNum">      29 </span>                : #include &quot;zend_ptr_stack.h&quot;
<span class="lineNum">      30 </span>                : #include &quot;zend_constants.h&quot;
<span class="lineNum">      31 </span>                : #include &quot;zend_extensions.h&quot;
<span class="lineNum">      32 </span>                : #include &quot;zend_exceptions.h&quot;
<span class="lineNum">      33 </span>                : #include &quot;zend_closures.h&quot;
<span class="lineNum">      34 </span>                : #include &quot;zend_vm.h&quot;
<span class="lineNum">      35 </span>                : #include &quot;zend_float.h&quot;
<span class="lineNum">      36 </span>                : #ifdef HAVE_SYS_TIME_H
<span class="lineNum">      37 </span>                : #include &lt;sys/time.h&gt;
<span class="lineNum">      38 </span>                : #endif
<span class="lineNum">      39 </span>                : 
<span class="lineNum">      40 </span>                : ZEND_API void (*zend_execute)(zend_op_array *op_array TSRMLS_DC);
<span class="lineNum">      41 </span>                : ZEND_API void (*zend_execute_internal)(zend_execute_data *execute_data_ptr, int return_value_used TSRMLS_DC);
<span class="lineNum">      42 </span>                : 
<span class="lineNum">      43 </span>                : /* true globals */
<span class="lineNum">      44 </span>                : ZEND_API const zend_fcall_info empty_fcall_info = { 0, NULL, NULL, NULL, NULL, 0, NULL, NULL, 0 };
<span class="lineNum">      45 </span>                : ZEND_API const zend_fcall_info_cache empty_fcall_info_cache = { 0, NULL, NULL, NULL, NULL };
<span class="lineNum">      46 </span>                : 
<span class="lineNum">      47 </span>                : #ifdef ZEND_WIN32
<span class="lineNum">      48 </span>                : #include &lt;process.h&gt;
<span class="lineNum">      49 </span>                : static WNDCLASS wc;
<span class="lineNum">      50 </span>                : static HWND timeout_window;
<span class="lineNum">      51 </span>                : static HANDLE timeout_thread_event;
<span class="lineNum">      52 </span>                : static HANDLE timeout_thread_handle;
<span class="lineNum">      53 </span>                : static DWORD timeout_thread_id;
<span class="lineNum">      54 </span>                : static int timeout_thread_initialized=0;
<span class="lineNum">      55 </span>                : #endif
<span class="lineNum">      56 </span>                : 
<span class="lineNum">      57 </span>                : #if 0&amp;&amp;ZEND_DEBUG
<span class="lineNum">      58 </span>                : static void (*original_sigsegv_handler)(int);
<span class="lineNum">      59 </span>                : static void zend_handle_sigsegv(int dummy) /* {{{ */
<span class="lineNum">      60 </span>                : {
<span class="lineNum">      61 </span>                :         fflush(stdout);
<span class="lineNum">      62 </span>                :         fflush(stderr);
<span class="lineNum">      63 </span>                :         if (original_sigsegv_handler == zend_handle_sigsegv) {
<span class="lineNum">      64 </span>                :                 signal(SIGSEGV, original_sigsegv_handler);
<span class="lineNum">      65 </span>                :         } else {
<span class="lineNum">      66 </span>                :                 signal(SIGSEGV, SIG_DFL);
<span class="lineNum">      67 </span>                :         }
<span class="lineNum">      68 </span>                :         {
<span class="lineNum">      69 </span>                :                 TSRMLS_FETCH();
<span class="lineNum">      70 </span>                : 
<span class="lineNum">      71 </span>                :                 fprintf(stderr, &quot;SIGSEGV caught on opcode %d on opline %d of %s() at %s:%d\n\n&quot;,
<span class="lineNum">      72 </span>                :                                 active_opline-&gt;opcode,
<span class="lineNum">      73 </span>                :                                 active_opline-EG(active_op_array)-&gt;opcodes,
<span class="lineNum">      74 </span>                :                                 get_active_function_name(TSRMLS_C),
<span class="lineNum">      75 </span>                :                                 zend_get_executed_filename(TSRMLS_C),
<span class="lineNum">      76 </span>                :                                 zend_get_executed_lineno(TSRMLS_C));
<span class="lineNum">      77 </span>                : /* See http://support.microsoft.com/kb/190351 */
<span class="lineNum">      78 </span>                : #ifdef PHP_WIN32
<span class="lineNum">      79 </span>                :                 fflush(stderr);
<span class="lineNum">      80 </span>                : #endif
<span class="lineNum">      81 </span>                :         }
<span class="lineNum">      82 </span>                :         if (original_sigsegv_handler!=zend_handle_sigsegv) {
<span class="lineNum">      83 </span>                :                 original_sigsegv_handler(dummy);
<span class="lineNum">      84 </span>                :         }
<span class="lineNum">      85 </span>                : }
<span class="lineNum">      86 </span>                : /* }}} */
<a name="87"><span class="lineNum">      87 </span>                : #endif</a>
<span class="lineNum">      88 </span>                : 
<span class="lineNum">      89 </span><span class="lineNoCov">              0 : static void zend_extension_activator(zend_extension *extension TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">      90 </span>                : {
<span class="lineNum">      91 </span><span class="lineNoCov">              0 :         if (extension-&gt;activate) {</span>
<span class="lineNum">      92 </span><span class="lineNoCov">              0 :                 extension-&gt;activate();</span>
<span class="lineNum">      93 </span>                :         }
<span class="lineNum">      94 </span><span class="lineNoCov">              0 : }</span>
<a name="95"><span class="lineNum">      95 </span>                : /* }}} */</a>
<span class="lineNum">      96 </span>                : 
<span class="lineNum">      97 </span><span class="lineNoCov">              0 : static void zend_extension_deactivator(zend_extension *extension TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">      98 </span>                : {
<span class="lineNum">      99 </span><span class="lineNoCov">              0 :         if (extension-&gt;deactivate) {</span>
<span class="lineNum">     100 </span><span class="lineNoCov">              0 :                 extension-&gt;deactivate();</span>
<span class="lineNum">     101 </span>                :         }
<span class="lineNum">     102 </span><span class="lineNoCov">              0 : }</span>
<a name="103"><span class="lineNum">     103 </span>                : /* }}} */</a>
<span class="lineNum">     104 </span>                : 
<span class="lineNum">     105 </span><span class="lineCov">             93 : static int clean_non_persistent_function(zend_function *function TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">     106 </span>                : {
<span class="lineNum">     107 </span><span class="lineCov">             93 :         return (function-&gt;type == ZEND_INTERNAL_FUNCTION) ? ZEND_HASH_APPLY_STOP : ZEND_HASH_APPLY_REMOVE;</span>
<span class="lineNum">     108 </span>                : }
<a name="109"><span class="lineNum">     109 </span>                : /* }}} */</a>
<span class="lineNum">     110 </span>                : 
<span class="lineNum">     111 </span><span class="lineNoCov">              0 : static int clean_non_persistent_function_full(zend_function *function TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">     112 </span>                : {
<span class="lineNum">     113 </span><span class="lineNoCov">              0 :         return (function-&gt;type == ZEND_INTERNAL_FUNCTION) ? ZEND_HASH_APPLY_KEEP : ZEND_HASH_APPLY_REMOVE;</span>
<span class="lineNum">     114 </span>                : }
<a name="115"><span class="lineNum">     115 </span>                : /* }}} */</a>
<span class="lineNum">     116 </span>                : 
<span class="lineNum">     117 </span><span class="lineCov">             51 : static int clean_non_persistent_class(zend_class_entry **ce TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">     118 </span>                : {
<span class="lineNum">     119 </span><span class="lineCov">             51 :         return ((*ce)-&gt;type == ZEND_INTERNAL_CLASS) ? ZEND_HASH_APPLY_STOP : ZEND_HASH_APPLY_REMOVE;</span>
<span class="lineNum">     120 </span>                : }
<a name="121"><span class="lineNum">     121 </span>                : /* }}} */</a>
<span class="lineNum">     122 </span>                : 
<span class="lineNum">     123 </span><span class="lineNoCov">              0 : static int clean_non_persistent_class_full(zend_class_entry **ce TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">     124 </span>                : {
<span class="lineNum">     125 </span><span class="lineNoCov">              0 :         return ((*ce)-&gt;type == ZEND_INTERNAL_CLASS) ? ZEND_HASH_APPLY_KEEP : ZEND_HASH_APPLY_REMOVE;</span>
<span class="lineNum">     126 </span>                : }
<a name="127"><span class="lineNum">     127 </span>                : /* }}} */</a>
<span class="lineNum">     128 </span>                : 
<span class="lineNum">     129 </span><span class="lineCov">             48 : void init_executor(TSRMLS_D) /* {{{ */</span>
<span class="lineNum">     130 </span>                : {
<span class="lineNum">     131 </span><span class="lineCov">             48 :         zend_init_fpu(TSRMLS_C);</span>
<span class="lineNum">     132 </span>                : 
<span class="lineNum">     133 </span><span class="lineCov">             48 :         INIT_ZVAL(EG(uninitialized_zval));</span>
<span class="lineNum">     134 </span>                :         /* trick to make uninitialized_zval never be modified, passed by ref, etc. */
<span class="lineNum">     135 </span>                :         Z_ADDREF(EG(uninitialized_zval));
<span class="lineNum">     136 </span><span class="lineCov">             48 :         INIT_ZVAL(EG(error_zval));</span>
<span class="lineNum">     137 </span><span class="lineCov">             48 :         EG(uninitialized_zval_ptr)=&amp;EG(uninitialized_zval);</span>
<span class="lineNum">     138 </span><span class="lineCov">             48 :         EG(error_zval_ptr)=&amp;EG(error_zval);</span>
<span class="lineNum">     139 </span><span class="lineCov">             48 :         zend_ptr_stack_init(&amp;EG(arg_types_stack));</span>
<span class="lineNum">     140 </span>                : /* destroys stack frame, therefore makes core dumps worthless */
<span class="lineNum">     141 </span>                : #if 0&amp;&amp;ZEND_DEBUG
<span class="lineNum">     142 </span>                :         original_sigsegv_handler = signal(SIGSEGV, zend_handle_sigsegv);
<span class="lineNum">     143 </span>                : #endif
<span class="lineNum">     144 </span><span class="lineCov">             48 :         EG(return_value_ptr_ptr) = NULL;</span>
<span class="lineNum">     145 </span>                : 
<span class="lineNum">     146 </span><span class="lineCov">             48 :         EG(symtable_cache_ptr) = EG(symtable_cache) - 1;</span>
<span class="lineNum">     147 </span><span class="lineCov">             48 :         EG(symtable_cache_limit) = EG(symtable_cache) + SYMTABLE_CACHE_SIZE - 1;</span>
<span class="lineNum">     148 </span><span class="lineCov">             48 :         EG(no_extensions) = 0;</span>
<span class="lineNum">     149 </span>                : 
<span class="lineNum">     150 </span><span class="lineCov">             48 :         EG(function_table) = CG(function_table);</span>
<span class="lineNum">     151 </span><span class="lineCov">             48 :         EG(class_table) = CG(class_table);</span>
<span class="lineNum">     152 </span>                : 
<span class="lineNum">     153 </span><span class="lineCov">             48 :         EG(in_execution) = 0;</span>
<span class="lineNum">     154 </span><span class="lineCov">             48 :         EG(in_autoload) = NULL;</span>
<span class="lineNum">     155 </span><span class="lineCov">             48 :         EG(autoload_func) = NULL;</span>
<span class="lineNum">     156 </span><span class="lineCov">             48 :         EG(error_handling) = EH_NORMAL;</span>
<span class="lineNum">     157 </span>                : 
<span class="lineNum">     158 </span>                :         zend_vm_stack_init(TSRMLS_C);
<span class="lineNum">     159 </span>                :         zend_vm_stack_push((void *) NULL TSRMLS_CC);
<span class="lineNum">     160 </span>                : 
<span class="lineNum">     161 </span><span class="lineCov">             48 :         zend_hash_init(&amp;EG(symbol_table), 50, NULL, ZVAL_PTR_DTOR, 0);</span>
<span class="lineNum">     162 </span><span class="lineCov">             48 :         EG(active_symbol_table) = &amp;EG(symbol_table);</span>
<span class="lineNum">     163 </span>                : 
<span class="lineNum">     164 </span><span class="lineCov">             48 :         zend_llist_apply(&amp;zend_extensions, (llist_apply_func_t) zend_extension_activator TSRMLS_CC);</span>
<span class="lineNum">     165 </span><span class="lineCov">             48 :         EG(opline_ptr) = NULL;</span>
<span class="lineNum">     166 </span>                : 
<span class="lineNum">     167 </span><span class="lineCov">             48 :         zend_hash_init(&amp;EG(included_files), 5, NULL, NULL, 0);</span>
<span class="lineNum">     168 </span>                : 
<span class="lineNum">     169 </span><span class="lineCov">             48 :         EG(ticks_count) = 0;</span>
<span class="lineNum">     170 </span>                : 
<span class="lineNum">     171 </span><span class="lineCov">             48 :         EG(user_error_handler) = NULL;</span>
<span class="lineNum">     172 </span>                : 
<span class="lineNum">     173 </span><span class="lineCov">             48 :         EG(current_execute_data) = NULL;</span>
<span class="lineNum">     174 </span>                : 
<span class="lineNum">     175 </span><span class="lineCov">             48 :         zend_stack_init(&amp;EG(user_error_handlers_error_reporting));</span>
<span class="lineNum">     176 </span><span class="lineCov">             48 :         zend_ptr_stack_init(&amp;EG(user_error_handlers));</span>
<span class="lineNum">     177 </span><span class="lineCov">             48 :         zend_ptr_stack_init(&amp;EG(user_exception_handlers));</span>
<span class="lineNum">     178 </span>                : 
<span class="lineNum">     179 </span><span class="lineCov">             48 :         zend_objects_store_init(&amp;EG(objects_store), 1024);</span>
<span class="lineNum">     180 </span>                : 
<span class="lineNum">     181 </span><span class="lineCov">             48 :         EG(full_tables_cleanup) = 0;</span>
<span class="lineNum">     182 </span>                : #ifdef ZEND_WIN32
<span class="lineNum">     183 </span>                :         EG(timed_out) = 0;
<span class="lineNum">     184 </span>                : #endif
<span class="lineNum">     185 </span>                : 
<span class="lineNum">     186 </span><span class="lineCov">             48 :         EG(exception) = NULL;</span>
<span class="lineNum">     187 </span><span class="lineCov">             48 :         EG(prev_exception) = NULL;</span>
<span class="lineNum">     188 </span>                : 
<span class="lineNum">     189 </span><span class="lineCov">             48 :         EG(scope) = NULL;</span>
<span class="lineNum">     190 </span><span class="lineCov">             48 :         EG(called_scope) = NULL;</span>
<span class="lineNum">     191 </span>                : 
<span class="lineNum">     192 </span><span class="lineCov">             48 :         EG(This) = NULL;</span>
<span class="lineNum">     193 </span>                : 
<span class="lineNum">     194 </span><span class="lineCov">             48 :         EG(active_op_array) = NULL;</span>
<span class="lineNum">     195 </span>                : 
<span class="lineNum">     196 </span><span class="lineCov">             48 :         EG(active) = 1;</span>
<span class="lineNum">     197 </span><span class="lineCov">             48 :         EG(start_op) = NULL;</span>
<span class="lineNum">     198 </span><span class="lineCov">             48 : }</span>
<a name="199"><span class="lineNum">     199 </span>                : /* }}} */</a>
<span class="lineNum">     200 </span>                : 
<span class="lineNum">     201 </span><span class="lineCov">            879 : static int zval_call_destructor(zval **zv TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">     202 </span>                : {
<span class="lineNum">     203 </span><span class="lineCov">            986 :         if (Z_TYPE_PP(zv) == IS_OBJECT &amp;&amp; Z_REFCOUNT_PP(zv) == 1) {</span>
<span class="lineNum">     204 </span><span class="lineCov">            103 :                 return ZEND_HASH_APPLY_REMOVE;</span>
<span class="lineNum">     205 </span>                :         } else {
<span class="lineNum">     206 </span><span class="lineCov">            776 :                 return ZEND_HASH_APPLY_KEEP;</span>
<span class="lineNum">     207 </span>                :         }
<span class="lineNum">     208 </span>                : }
<a name="209"><span class="lineNum">     209 </span>                : /* }}} */</a>
<span class="lineNum">     210 </span>                : 
<span class="lineNum">     211 </span><span class="lineCov">             48 : void shutdown_destructors(TSRMLS_D) /* {{{ */</span>
<span class="lineNum">     212 </span>                : {
<span class="lineNum">     213 </span><span class="lineCov">             48 :         zend_try {</span>
<span class="lineNum">     214 </span>                :                 int symbols;
<span class="lineNum">     215 </span>                :                 do {
<span class="lineNum">     216 </span><span class="lineCov">             85 :                         symbols = zend_hash_num_elements(&amp;EG(symbol_table));</span>
<span class="lineNum">     217 </span><span class="lineCov">             85 :                         zend_hash_reverse_apply(&amp;EG(symbol_table), (apply_func_t) zval_call_destructor TSRMLS_CC);</span>
<span class="lineNum">     218 </span><span class="lineCov">             85 :                 } while (symbols != zend_hash_num_elements(&amp;EG(symbol_table)));</span>
<span class="lineNum">     219 </span><span class="lineCov">             48 :                 zend_objects_store_call_destructors(&amp;EG(objects_store) TSRMLS_CC);</span>
<span class="lineNum">     220 </span><span class="lineNoCov">              0 :         } zend_catch {</span>
<span class="lineNum">     221 </span>                :                 /* if we couldn't destruct cleanly, mark all objects as destructed anyway */
<span class="lineNum">     222 </span><span class="lineNoCov">              0 :                 zend_objects_store_mark_destructed(&amp;EG(objects_store) TSRMLS_CC);</span>
<span class="lineNum">     223 </span><span class="lineCov">             48 :         } zend_end_try();</span>
<span class="lineNum">     224 </span><span class="lineCov">             48 : }</span>
<a name="225"><span class="lineNum">     225 </span>                : /* }}} */</a>
<span class="lineNum">     226 </span>                : 
<span class="lineNum">     227 </span><span class="lineCov">             48 : void shutdown_executor(TSRMLS_D) /* {{{ */</span>
<span class="lineNum">     228 </span>                : {
<span class="lineNum">     229 </span><span class="lineCov">             48 :         zend_try {</span>
<span class="lineNum">     230 </span>                : 
<span class="lineNum">     231 </span>                : /* Removed because this can not be safely done, e.g. in this situation:
<span class="lineNum">     232 </span>                :    Object 1 creates object 2
<span class="lineNum">     233 </span>                :    Object 3 holds reference to object 2.
<span class="lineNum">     234 </span>                :    Now when 1 and 2 are destroyed, 3 can still access 2 in its destructor, with
<span class="lineNum">     235 </span>                :    very problematic results */
<span class="lineNum">     236 </span>                : /*              zend_objects_store_call_destructors(&amp;EG(objects_store) TSRMLS_CC); */
<span class="lineNum">     237 </span>                : 
<span class="lineNum">     238 </span>                : /* Moved after symbol table cleaners, because  some of the cleaners can call
<span class="lineNum">     239 </span>                :    destructors, which would use EG(symtable_cache_ptr) and thus leave leaks */
<span class="lineNum">     240 </span>                : /*              while (EG(symtable_cache_ptr)&gt;=EG(symtable_cache)) {
<span class="lineNum">     241 </span>                :                         zend_hash_destroy(*EG(symtable_cache_ptr));
<span class="lineNum">     242 </span>                :                         efree(*EG(symtable_cache_ptr));
<span class="lineNum">     243 </span>                :                         EG(symtable_cache_ptr)--;
<span class="lineNum">     244 </span>                :                 }
<span class="lineNum">     245 </span>                : */
<span class="lineNum">     246 </span><span class="lineCov">             48 :                 zend_llist_apply(&amp;zend_extensions, (llist_apply_func_t) zend_extension_deactivator TSRMLS_CC);</span>
<span class="lineNum">     247 </span><span class="lineCov">             48 :                 zend_hash_graceful_reverse_destroy(&amp;EG(symbol_table));</span>
<span class="lineNum">     248 </span><span class="lineCov">             48 :         } zend_end_try();</span>
<span class="lineNum">     249 </span>                : 
<span class="lineNum">     250 </span><span class="lineCov">             48 :         zend_try {</span>
<span class="lineNum">     251 </span>                :                 zval *zeh;
<span class="lineNum">     252 </span>                :                 /* remove error handlers before destroying classes and functions,
<span class="lineNum">     253 </span>                :                  * so that if handler used some class, crash would not happen */
<span class="lineNum">     254 </span><span class="lineCov">             48 :                 if (EG(user_error_handler)) {</span>
<span class="lineNum">     255 </span><span class="lineCov">              4 :                         zeh = EG(user_error_handler);</span>
<span class="lineNum">     256 </span><span class="lineCov">              4 :                         EG(user_error_handler) = NULL;</span>
<span class="lineNum">     257 </span>                :                         zval_dtor(zeh);
<span class="lineNum">     258 </span><span class="lineCov">              4 :                         FREE_ZVAL(zeh);</span>
<span class="lineNum">     259 </span>                :                 }
<span class="lineNum">     260 </span>                : 
<span class="lineNum">     261 </span><span class="lineCov">             48 :                 if (EG(user_exception_handler)) {</span>
<span class="lineNum">     262 </span><span class="lineNoCov">              0 :                         zeh = EG(user_exception_handler);</span>
<span class="lineNum">     263 </span><span class="lineNoCov">              0 :                         EG(user_exception_handler) = NULL;</span>
<span class="lineNum">     264 </span>                :                         zval_dtor(zeh);
<span class="lineNum">     265 </span><span class="lineNoCov">              0 :                         FREE_ZVAL(zeh);</span>
<span class="lineNum">     266 </span>                :                 }
<span class="lineNum">     267 </span>                : 
<span class="lineNum">     268 </span><span class="lineCov">             48 :                 zend_stack_destroy(&amp;EG(user_error_handlers_error_reporting));</span>
<span class="lineNum">     269 </span><span class="lineCov">             48 :                 zend_stack_init(&amp;EG(user_error_handlers_error_reporting));</span>
<span class="lineNum">     270 </span><span class="lineCov">             48 :                 zend_ptr_stack_clean(&amp;EG(user_error_handlers), ZVAL_DESTRUCTOR, 1);</span>
<span class="lineNum">     271 </span><span class="lineCov">             48 :                 zend_ptr_stack_clean(&amp;EG(user_exception_handlers), ZVAL_DESTRUCTOR, 1);</span>
<span class="lineNum">     272 </span><span class="lineCov">             48 :         } zend_end_try();</span>
<span class="lineNum">     273 </span>                : 
<span class="lineNum">     274 </span><span class="lineCov">             48 :         zend_try {</span>
<span class="lineNum">     275 </span>                :                 /* Cleanup static data for functions and arrays.
<span class="lineNum">     276 </span>                :                  * We need a separate cleanup stage because of the following problem:
<span class="lineNum">     277 </span>                :                  * Suppose we destroy class X, which destroys the class's function table,
<span class="lineNum">     278 </span>                :                  * and in the function table we have function foo() that has static $bar.
<span class="lineNum">     279 </span>                :                  * Now if an object of class X is assigned to $bar, its destructor will be
<span class="lineNum">     280 </span>                :                  * called and will fail since X's function table is in mid-destruction.
<span class="lineNum">     281 </span>                :                  * So we want first of all to clean up all data and then move to tables destruction.
<span class="lineNum">     282 </span>                :                  * Note that only run-time accessed data need to be cleaned up, pre-defined data can
<span class="lineNum">     283 </span>                :                  * not contain objects and thus are not probelmatic */
<span class="lineNum">     284 </span><span class="lineCov">             48 :                 if (EG(full_tables_cleanup)) {</span>
<span class="lineNum">     285 </span><span class="lineNoCov">              0 :                         zend_hash_apply(EG(function_table), (apply_func_t) zend_cleanup_function_data_full TSRMLS_CC);</span>
<span class="lineNum">     286 </span><span class="lineNoCov">              0 :                         zend_hash_apply(EG(class_table), (apply_func_t) zend_cleanup_class_data TSRMLS_CC);</span>
<span class="lineNum">     287 </span>                :                 } else {
<span class="lineNum">     288 </span><span class="lineCov">             48 :                         zend_hash_reverse_apply(EG(function_table), (apply_func_t) zend_cleanup_function_data TSRMLS_CC);</span>
<span class="lineNum">     289 </span><span class="lineCov">             48 :                         zend_hash_reverse_apply(EG(class_table), (apply_func_t) zend_cleanup_user_class_data TSRMLS_CC);</span>
<span class="lineNum">     290 </span><span class="lineCov">             48 :                         zend_cleanup_internal_classes(TSRMLS_C);</span>
<span class="lineNum">     291 </span>                :                 }
<span class="lineNum">     292 </span><span class="lineCov">             48 :         } zend_end_try();</span>
<span class="lineNum">     293 </span>                : 
<span class="lineNum">     294 </span><span class="lineCov">             48 :         zend_try {</span>
<span class="lineNum">     295 </span>                :                 zend_vm_stack_destroy(TSRMLS_C);
<span class="lineNum">     296 </span>                : 
<span class="lineNum">     297 </span><span class="lineCov">             48 :                 zend_objects_store_free_object_storage(&amp;EG(objects_store) TSRMLS_CC);</span>
<span class="lineNum">     298 </span>                : 
<span class="lineNum">     299 </span>                :                 /* Destroy all op arrays */
<span class="lineNum">     300 </span><span class="lineCov">             48 :                 if (EG(full_tables_cleanup)) {</span>
<span class="lineNum">     301 </span><span class="lineNoCov">              0 :                         zend_hash_reverse_apply(EG(function_table), (apply_func_t) clean_non_persistent_function_full TSRMLS_CC);</span>
<span class="lineNum">     302 </span><span class="lineNoCov">              0 :                         zend_hash_reverse_apply(EG(class_table), (apply_func_t) clean_non_persistent_class_full TSRMLS_CC);</span>
<span class="lineNum">     303 </span>                :                 } else {
<span class="lineNum">     304 </span><span class="lineCov">             48 :                         zend_hash_reverse_apply(EG(function_table), (apply_func_t) clean_non_persistent_function TSRMLS_CC);</span>
<span class="lineNum">     305 </span><span class="lineCov">             48 :                         zend_hash_reverse_apply(EG(class_table), (apply_func_t) clean_non_persistent_class TSRMLS_CC);</span>
<span class="lineNum">     306 </span>                :                 }
<span class="lineNum">     307 </span>                : 
<span class="lineNum">     308 </span><span class="lineCov">             98 :                 while (EG(symtable_cache_ptr)&gt;=EG(symtable_cache)) {</span>
<span class="lineNum">     309 </span><span class="lineCov">              2 :                         zend_hash_destroy(*EG(symtable_cache_ptr));</span>
<span class="lineNum">     310 </span><span class="lineCov">              2 :                         FREE_HASHTABLE(*EG(symtable_cache_ptr));</span>
<span class="lineNum">     311 </span><span class="lineCov">              2 :                         EG(symtable_cache_ptr)--;</span>
<span class="lineNum">     312 </span>                :                 }
<span class="lineNum">     313 </span><span class="lineCov">             48 :         } zend_end_try();</span>
<span class="lineNum">     314 </span>                : 
<span class="lineNum">     315 </span><span class="lineCov">             48 :         zend_try {</span>
<span class="lineNum">     316 </span><span class="lineCov">             48 :                 clean_non_persistent_constants(TSRMLS_C);</span>
<span class="lineNum">     317 </span><span class="lineCov">             48 :         } zend_end_try();</span>
<span class="lineNum">     318 </span>                : 
<span class="lineNum">     319 </span><span class="lineCov">             48 :         zend_try {</span>
<span class="lineNum">     320 </span>                : #if 0&amp;&amp;ZEND_DEBUG
<span class="lineNum">     321 </span>                :         signal(SIGSEGV, original_sigsegv_handler);
<span class="lineNum">     322 </span>                : #endif
<span class="lineNum">     323 </span>                : 
<span class="lineNum">     324 </span><span class="lineCov">             48 :                 zend_hash_destroy(&amp;EG(included_files));</span>
<span class="lineNum">     325 </span>                : 
<span class="lineNum">     326 </span><span class="lineCov">             48 :                 zend_ptr_stack_destroy(&amp;EG(arg_types_stack));</span>
<span class="lineNum">     327 </span><span class="lineCov">             48 :                 zend_stack_destroy(&amp;EG(user_error_handlers_error_reporting));</span>
<span class="lineNum">     328 </span><span class="lineCov">             48 :                 zend_ptr_stack_destroy(&amp;EG(user_error_handlers));</span>
<span class="lineNum">     329 </span><span class="lineCov">             48 :                 zend_ptr_stack_destroy(&amp;EG(user_exception_handlers));</span>
<span class="lineNum">     330 </span><span class="lineCov">             48 :                 zend_objects_store_destroy(&amp;EG(objects_store));</span>
<span class="lineNum">     331 </span><span class="lineCov">             48 :                 if (EG(in_autoload)) {</span>
<span class="lineNum">     332 </span><span class="lineNoCov">              0 :                         zend_hash_destroy(EG(in_autoload));</span>
<span class="lineNum">     333 </span><span class="lineNoCov">              0 :                         FREE_HASHTABLE(EG(in_autoload));</span>
<span class="lineNum">     334 </span>                :                 }
<span class="lineNum">     335 </span><span class="lineCov">             48 :         } zend_end_try();</span>
<span class="lineNum">     336 </span>                : 
<span class="lineNum">     337 </span><span class="lineCov">             48 :         zend_shutdown_fpu(TSRMLS_C);</span>
<span class="lineNum">     338 </span>                : 
<span class="lineNum">     339 </span><span class="lineCov">             48 :         EG(active) = 0;</span>
<span class="lineNum">     340 </span><span class="lineCov">             48 : }</span>
<span class="lineNum">     341 </span>                : /* }}} */
<a name="342"><span class="lineNum">     342 </span>                : </a>
<span class="lineNum">     343 </span>                : /* return class name and &quot;::&quot; or &quot;&quot;. */
<span class="lineNum">     344 </span><span class="lineCov">            907 : ZEND_API const char *get_active_class_name(const char **space TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">     345 </span>                : {
<span class="lineNum">     346 </span><span class="lineCov">            907 :         if (!zend_is_executing(TSRMLS_C)) {</span>
<span class="lineNum">     347 </span><span class="lineNoCov">              0 :                 if (space) {</span>
<span class="lineNum">     348 </span><span class="lineNoCov">              0 :                         *space = &quot;&quot;;</span>
<span class="lineNum">     349 </span>                :                 }
<span class="lineNum">     350 </span><span class="lineNoCov">              0 :                 return &quot;&quot;;</span>
<span class="lineNum">     351 </span>                :         }
<span class="lineNum">     352 </span><span class="lineCov">            907 :         switch (EG(current_execute_data)-&gt;function_state.function-&gt;type) {</span>
<span class="lineNum">     353 </span>                :                 case ZEND_USER_FUNCTION:
<span class="lineNum">     354 </span>                :                 case ZEND_INTERNAL_FUNCTION:
<span class="lineNum">     355 </span>                :                 {
<span class="lineNum">     356 </span><span class="lineCov">            907 :                         zend_class_entry *ce = EG(current_execute_data)-&gt;function_state.function-&gt;common.scope;</span>
<span class="lineNum">     357 </span>                : 
<span class="lineNum">     358 </span><span class="lineCov">            907 :                         if (space) {</span>
<span class="lineNum">     359 </span><span class="lineCov">            907 :                                 *space = ce ? &quot;::&quot; : &quot;&quot;;</span>
<span class="lineNum">     360 </span>                :                         }
<span class="lineNum">     361 </span><span class="lineCov">            907 :                         return ce ? ce-&gt;name : &quot;&quot;;</span>
<span class="lineNum">     362 </span>                :                 }
<span class="lineNum">     363 </span>                :                 default:
<span class="lineNum">     364 </span><span class="lineNoCov">              0 :                         if (space) {</span>
<span class="lineNum">     365 </span><span class="lineNoCov">              0 :                                 *space = &quot;&quot;;</span>
<span class="lineNum">     366 </span>                :                         }
<span class="lineNum">     367 </span><span class="lineNoCov">              0 :                         return &quot;&quot;;</span>
<span class="lineNum">     368 </span>                :         }
<span class="lineNum">     369 </span>                : }
<a name="370"><span class="lineNum">     370 </span>                : /* }}} */</a>
<span class="lineNum">     371 </span>                : 
<span class="lineNum">     372 </span><span class="lineCov">            909 : ZEND_API const char *get_active_function_name(TSRMLS_D) /* {{{ */</span>
<span class="lineNum">     373 </span>                : {
<span class="lineNum">     374 </span><span class="lineCov">            909 :         if (!zend_is_executing(TSRMLS_C)) {</span>
<span class="lineNum">     375 </span><span class="lineCov">              2 :                 return NULL;</span>
<span class="lineNum">     376 </span>                :         }
<span class="lineNum">     377 </span><span class="lineCov">            907 :         switch (EG(current_execute_data)-&gt;function_state.function-&gt;type) {</span>
<span class="lineNum">     378 </span>                :                 case ZEND_USER_FUNCTION: {
<span class="lineNum">     379 </span><span class="lineCov">              1 :                                 const char *function_name = ((zend_op_array *) EG(current_execute_data)-&gt;function_state.function)-&gt;function_name;</span>
<span class="lineNum">     380 </span>                : 
<span class="lineNum">     381 </span><span class="lineCov">              1 :                                 if (function_name) {</span>
<span class="lineNum">     382 </span><span class="lineNoCov">              0 :                                         return function_name;</span>
<span class="lineNum">     383 </span>                :                                 } else {
<span class="lineNum">     384 </span><span class="lineCov">              1 :                                         return &quot;main&quot;;</span>
<span class="lineNum">     385 </span>                :                                 }
<span class="lineNum">     386 </span>                :                         }
<span class="lineNum">     387 </span>                :                         break;
<span class="lineNum">     388 </span>                :                 case ZEND_INTERNAL_FUNCTION:
<span class="lineNum">     389 </span><span class="lineCov">            906 :                         return ((zend_internal_function *) EG(current_execute_data)-&gt;function_state.function)-&gt;function_name;</span>
<span class="lineNum">     390 </span>                :                         break;
<span class="lineNum">     391 </span>                :                 default:
<span class="lineNum">     392 </span><span class="lineNoCov">              0 :                         return NULL;</span>
<span class="lineNum">     393 </span>                :         }
<span class="lineNum">     394 </span>                : }
<a name="395"><span class="lineNum">     395 </span>                : /* }}} */</a>
<span class="lineNum">     396 </span>                : 
<span class="lineNum">     397 </span><span class="lineCov">           1352 : ZEND_API const char *zend_get_executed_filename(TSRMLS_D) /* {{{ */</span>
<span class="lineNum">     398 </span>                : {
<span class="lineNum">     399 </span><span class="lineCov">           1352 :         if (EG(active_op_array)) {</span>
<span class="lineNum">     400 </span><span class="lineCov">           1352 :                 return EG(active_op_array)-&gt;filename;</span>
<span class="lineNum">     401 </span>                :         } else {
<span class="lineNum">     402 </span><span class="lineNoCov">              0 :                 return &quot;[no active file]&quot;;</span>
<span class="lineNum">     403 </span>                :         }
<span class="lineNum">     404 </span>                : }
<a name="405"><span class="lineNum">     405 </span>                : /* }}} */</a>
<span class="lineNum">     406 </span>                : 
<span class="lineNum">     407 </span><span class="lineCov">           1352 : ZEND_API uint zend_get_executed_lineno(TSRMLS_D) /* {{{ */</span>
<span class="lineNum">     408 </span>                : {
<span class="lineNum">     409 </span><span class="lineCov">           1354 :         if(EG(exception) &amp;&amp; EG(opline_ptr) &amp;&amp; active_opline-&gt;opcode == ZEND_HANDLE_EXCEPTION &amp;&amp; </span>
<span class="lineNum">     410 </span><span class="lineCov">              2 :                 active_opline-&gt;lineno == 0 &amp;&amp; EG(opline_before_exception)) {</span>
<span class="lineNum">     411 </span><span class="lineCov">              1 :                 return EG(opline_before_exception)-&gt;lineno;</span>
<span class="lineNum">     412 </span>                :         }
<span class="lineNum">     413 </span><span class="lineCov">           1351 :         if (EG(opline_ptr)) {</span>
<span class="lineNum">     414 </span><span class="lineCov">           1351 :                 return active_opline-&gt;lineno;</span>
<span class="lineNum">     415 </span>                :         } else {
<span class="lineNum">     416 </span><span class="lineNoCov">              0 :                 return 0;</span>
<span class="lineNum">     417 </span>                :         }
<span class="lineNum">     418 </span>                : }
<a name="419"><span class="lineNum">     419 </span>                : /* }}} */</a>
<span class="lineNum">     420 </span>                : 
<span class="lineNum">     421 </span><span class="lineCov">           3159 : ZEND_API zend_bool zend_is_executing(TSRMLS_D) /* {{{ */</span>
<span class="lineNum">     422 </span>                : {
<span class="lineNum">     423 </span><span class="lineCov">           3159 :         return EG(in_execution);</span>
<span class="lineNum">     424 </span>                : }
<a name="425"><span class="lineNum">     425 </span>                : /* }}} */</a>
<span class="lineNum">     426 </span>                : 
<span class="lineNum">     427 </span><span class="lineCov">          77602 : ZEND_API void _zval_ptr_dtor(zval **zval_ptr ZEND_FILE_LINE_DC) /* {{{ */</span>
<span class="lineNum">     428 </span>                : {
<span class="lineNum">     429 </span>                : #if DEBUG_ZEND&gt;=2
<span class="lineNum">     430 </span>                :         printf(&quot;Reducing refcount for %x (%x): %d-&gt;%d\n&quot;, *zval_ptr, zval_ptr, Z_REFCOUNT_PP(zval_ptr), Z_REFCOUNT_PP(zval_ptr) - 1);
<span class="lineNum">     431 </span>                : #endif
<span class="lineNum">     432 </span><span class="lineCov">          77602 :         Z_DELREF_PP(zval_ptr);</span>
<span class="lineNum">     433 </span><span class="lineCov">         155204 :         if (Z_REFCOUNT_PP(zval_ptr) == 0) {</span>
<span class="lineNum">     434 </span>                :                 TSRMLS_FETCH();
<span class="lineNum">     435 </span>                : 
<span class="lineNum">     436 </span><span class="lineCov">          49174 :                 if (*zval_ptr != &amp;EG(uninitialized_zval)) {</span>
<span class="lineNum">     437 </span><span class="lineCov">          49174 :                         GC_REMOVE_ZVAL_FROM_BUFFER(*zval_ptr);</span>
<span class="lineNum">     438 </span><span class="lineCov">          49174 :                         zval_dtor(*zval_ptr);</span>
<span class="lineNum">     439 </span><span class="lineCov">          49174 :                         efree_rel(*zval_ptr);</span>
<span class="lineNum">     440 </span>                :                 }
<span class="lineNum">     441 </span>                :         } else {
<span class="lineNum">     442 </span>                :                 TSRMLS_FETCH();
<span class="lineNum">     443 </span>                : 
<span class="lineNum">     444 </span><span class="lineCov">          56856 :                 if (Z_REFCOUNT_PP(zval_ptr) == 1) {</span>
<span class="lineNum">     445 </span><span class="lineCov">          13818 :                         Z_UNSET_ISREF_PP(zval_ptr);</span>
<span class="lineNum">     446 </span>                :                 }
<span class="lineNum">     447 </span>                : 
<span class="lineNum">     448 </span><span class="lineCov">          28428 :                 GC_ZVAL_CHECK_POSSIBLE_ROOT(*zval_ptr);</span>
<span class="lineNum">     449 </span>                :         }
<span class="lineNum">     450 </span><span class="lineCov">          77602 : }</span>
<a name="451"><span class="lineNum">     451 </span>                : /* }}} */</a>
<span class="lineNum">     452 </span>                : 
<span class="lineNum">     453 </span><span class="lineCov">          18192 : ZEND_API void _zval_internal_ptr_dtor(zval **zval_ptr ZEND_FILE_LINE_DC) /* {{{ */</span>
<span class="lineNum">     454 </span>                : {
<span class="lineNum">     455 </span>                : #if DEBUG_ZEND&gt;=2
<span class="lineNum">     456 </span>                :         printf(&quot;Reducing refcount for %x (%x): %d-&gt;%d\n&quot;, *zval_ptr, zval_ptr, Z_REFCOUNT_PP(zval_ptr), Z_REFCOUNT_PP(zval_ptr) - 1);
<span class="lineNum">     457 </span>                : #endif
<span class="lineNum">     458 </span><span class="lineCov">          18192 :         Z_DELREF_PP(zval_ptr);</span>
<span class="lineNum">     459 </span><span class="lineCov">          36384 :         if (Z_REFCOUNT_PP(zval_ptr) == 0) {</span>
<span class="lineNum">     460 </span><span class="lineCov">           8352 :                 zval_internal_dtor(*zval_ptr);</span>
<span class="lineNum">     461 </span><span class="lineCov">           8352 :                 free(*zval_ptr);</span>
<span class="lineNum">     462 </span><span class="lineCov">          19680 :         } else if (Z_REFCOUNT_PP(zval_ptr) == 1) {</span>
<span class="lineNum">     463 </span><span class="lineCov">           2688 :                 Z_UNSET_ISREF_PP(zval_ptr);</span>
<span class="lineNum">     464 </span>                :         }
<span class="lineNum">     465 </span><span class="lineCov">          18192 : }</span>
<a name="466"><span class="lineNum">     466 </span>                : /* }}} */</a>
<span class="lineNum">     467 </span>                : 
<span class="lineNum">     468 </span><span class="lineCov">              4 : ZEND_API int zend_is_true(zval *op) /* {{{ */</span>
<span class="lineNum">     469 </span>                : {
<span class="lineNum">     470 </span><span class="lineCov">              4 :         return i_zend_is_true(op);</span>
<span class="lineNum">     471 </span>                : }
<span class="lineNum">     472 </span>                : /* }}} */
<span class="lineNum">     473 </span>                : 
<span class="lineNum">     474 </span>                : #include &quot;../TSRM/tsrm_strtok_r.h&quot;
<span class="lineNum">     475 </span>                : 
<span class="lineNum">     476 </span>                : #define IS_VISITED_CONSTANT                     IS_CONSTANT_INDEX
<span class="lineNum">     477 </span>                : #define IS_CONSTANT_VISITED(p)          (Z_TYPE_P(p) &amp; IS_VISITED_CONSTANT)
<span class="lineNum">     478 </span>                : #define Z_REAL_TYPE_P(p)                        (Z_TYPE_P(p) &amp; ~IS_VISITED_CONSTANT)
<a name="479"><span class="lineNum">     479 </span>                : #define MARK_CONSTANT_VISITED(p)        Z_TYPE_P(p) |= IS_VISITED_CONSTANT</a>
<span class="lineNum">     480 </span>                : 
<span class="lineNum">     481 </span><span class="lineNoCov">              0 : static void zval_deep_copy(zval **p)</span>
<span class="lineNum">     482 </span>                : {
<span class="lineNum">     483 </span>                :         zval *value;
<span class="lineNum">     484 </span>                : 
<span class="lineNum">     485 </span><span class="lineNoCov">              0 :         ALLOC_ZVAL(value);</span>
<span class="lineNum">     486 </span><span class="lineNoCov">              0 :         *value = **p;</span>
<span class="lineNum">     487 </span><span class="lineNoCov">              0 :         Z_TYPE_P(value) &amp;= ~IS_CONSTANT_INDEX;</span>
<span class="lineNum">     488 </span>                :         zval_copy_ctor(value);
<span class="lineNum">     489 </span><span class="lineNoCov">              0 :         Z_TYPE_P(value) = Z_TYPE_PP(p);</span>
<span class="lineNum">     490 </span><span class="lineNoCov">              0 :         INIT_PZVAL(value);</span>
<span class="lineNum">     491 </span><span class="lineNoCov">              0 :         *p = value;</span>
<a name="492"><span class="lineNum">     492 </span><span class="lineNoCov">              0 : }</span></a>
<span class="lineNum">     493 </span>                : 
<span class="lineNum">     494 </span><span class="lineCov">            870 : ZEND_API int zval_update_constant_ex(zval **pp, void *arg, zend_class_entry *scope TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">     495 </span>                : {
<span class="lineNum">     496 </span><span class="lineCov">            870 :         zval *p = *pp;</span>
<span class="lineNum">     497 </span><span class="lineCov">            870 :         zend_bool inline_change = (zend_bool) (zend_uintptr_t) arg;</span>
<span class="lineNum">     498 </span>                :         zval const_value;
<span class="lineNum">     499 </span>                :         char *colon;
<span class="lineNum">     500 </span>                : 
<span class="lineNum">     501 </span><span class="lineCov">            870 :         if (IS_CONSTANT_VISITED(p)) {</span>
<span class="lineNum">     502 </span><span class="lineNoCov">              0 :                 zend_error(E_ERROR, &quot;Cannot declare self-referencing constant '%s'&quot;, Z_STRVAL_P(p));</span>
<span class="lineNum">     503 </span><span class="lineCov">            870 :         } else if ((Z_TYPE_P(p) &amp; IS_CONSTANT_TYPE_MASK) == IS_CONSTANT) {</span>
<span class="lineNum">     504 </span>                :                 int refcount;
<span class="lineNum">     505 </span>                :                 zend_uchar is_ref;
<span class="lineNum">     506 </span>                : 
<span class="lineNum">     507 </span><span class="lineNoCov">              0 :                 SEPARATE_ZVAL_IF_NOT_REF(pp);</span>
<span class="lineNum">     508 </span><span class="lineNoCov">              0 :                 p = *pp;</span>
<span class="lineNum">     509 </span>                : 
<span class="lineNum">     510 </span><span class="lineNoCov">              0 :                 MARK_CONSTANT_VISITED(p);</span>
<span class="lineNum">     511 </span>                : 
<span class="lineNum">     512 </span><span class="lineNoCov">              0 :                 refcount = Z_REFCOUNT_P(p);</span>
<span class="lineNum">     513 </span><span class="lineNoCov">              0 :                 is_ref = Z_ISREF_P(p);</span>
<span class="lineNum">     514 </span>                : 
<span class="lineNum">     515 </span><span class="lineNoCov">              0 :                 if (!zend_get_constant_ex(p-&gt;value.str.val, p-&gt;value.str.len, &amp;const_value, scope, Z_REAL_TYPE_P(p) TSRMLS_CC)) {</span>
<span class="lineNum">     516 </span><span class="lineNoCov">              0 :                         char *actual = Z_STRVAL_P(p);</span>
<span class="lineNum">     517 </span>                : 
<span class="lineNum">     518 </span><span class="lineNoCov">              0 :                         if ((colon = (char*)zend_memrchr(Z_STRVAL_P(p), ':', Z_STRLEN_P(p)))) {</span>
<span class="lineNum">     519 </span><span class="lineNoCov">              0 :                                 zend_error(E_ERROR, &quot;Undefined class constant '%s'&quot;, Z_STRVAL_P(p));</span>
<span class="lineNum">     520 </span><span class="lineNoCov">              0 :                                 Z_STRLEN_P(p) -= ((colon - Z_STRVAL_P(p)) + 1);</span>
<span class="lineNum">     521 </span><span class="lineNoCov">              0 :                                 if (inline_change) {</span>
<span class="lineNum">     522 </span><span class="lineNoCov">              0 :                                         colon = estrndup(colon, Z_STRLEN_P(p));</span>
<span class="lineNum">     523 </span><span class="lineNoCov">              0 :                                         str_efree(Z_STRVAL_P(p));</span>
<span class="lineNum">     524 </span><span class="lineNoCov">              0 :                                         Z_STRVAL_P(p) = colon;</span>
<span class="lineNum">     525 </span>                :                                 } else {
<span class="lineNum">     526 </span><span class="lineNoCov">              0 :                                         Z_STRVAL_P(p) = colon + 1;</span>
<span class="lineNum">     527 </span>                :                                 }
<span class="lineNum">     528 </span>                :                         } else {
<span class="lineNum">     529 </span><span class="lineNoCov">              0 :                                 char *save = actual, *slash;</span>
<span class="lineNum">     530 </span><span class="lineNoCov">              0 :                                 int actual_len = Z_STRLEN_P(p);</span>
<span class="lineNum">     531 </span><span class="lineNoCov">              0 :                                 if ((Z_TYPE_P(p) &amp; IS_CONSTANT_UNQUALIFIED) &amp;&amp; (slash = (char *)zend_memrchr(actual, '\\', actual_len))) {</span>
<span class="lineNum">     532 </span><span class="lineNoCov">              0 :                                         actual = slash + 1;</span>
<span class="lineNum">     533 </span><span class="lineNoCov">              0 :                                         actual_len -= (actual - Z_STRVAL_P(p));</span>
<span class="lineNum">     534 </span><span class="lineNoCov">              0 :                                         if (inline_change) {</span>
<span class="lineNum">     535 </span><span class="lineNoCov">              0 :                                                 actual = estrndup(actual, actual_len);</span>
<span class="lineNum">     536 </span><span class="lineNoCov">              0 :                                                 Z_STRVAL_P(p) = actual;</span>
<span class="lineNum">     537 </span><span class="lineNoCov">              0 :                                                 Z_STRLEN_P(p) = actual_len;</span>
<span class="lineNum">     538 </span>                :                                         }
<span class="lineNum">     539 </span>                :                                 }
<span class="lineNum">     540 </span><span class="lineNoCov">              0 :                                 if (actual[0] == '\\') {</span>
<span class="lineNum">     541 </span><span class="lineNoCov">              0 :                                         if (inline_change) {</span>
<span class="lineNum">     542 </span><span class="lineNoCov">              0 :                                                 memmove(Z_STRVAL_P(p), Z_STRVAL_P(p)+1, Z_STRLEN_P(p));</span>
<span class="lineNum">     543 </span><span class="lineNoCov">              0 :                                                 --Z_STRLEN_P(p);</span>
<span class="lineNum">     544 </span>                :                                         } else {
<span class="lineNum">     545 </span><span class="lineNoCov">              0 :                                                 ++actual;</span>
<span class="lineNum">     546 </span>                :                                         }
<span class="lineNum">     547 </span><span class="lineNoCov">              0 :                                         --actual_len;</span>
<span class="lineNum">     548 </span>                :                                 }
<span class="lineNum">     549 </span><span class="lineNoCov">              0 :                                 if ((Z_TYPE_P(p) &amp; IS_CONSTANT_UNQUALIFIED) == 0) {</span>
<span class="lineNum">     550 </span><span class="lineNoCov">              0 :                                         int fix_save = 0;</span>
<span class="lineNum">     551 </span><span class="lineNoCov">              0 :                                         if (save[0] == '\\') {</span>
<span class="lineNum">     552 </span><span class="lineNoCov">              0 :                                                 save++;</span>
<span class="lineNum">     553 </span><span class="lineNoCov">              0 :                                                 fix_save = 1;</span>
<span class="lineNum">     554 </span>                :                                         }
<span class="lineNum">     555 </span><span class="lineNoCov">              0 :                                         zend_error(E_ERROR, &quot;Undefined constant '%s'&quot;, save);</span>
<span class="lineNum">     556 </span><span class="lineNoCov">              0 :                                         if (fix_save) {</span>
<span class="lineNum">     557 </span><span class="lineNoCov">              0 :                                                 save--;</span>
<span class="lineNum">     558 </span>                :                                         }
<span class="lineNum">     559 </span><span class="lineNoCov">              0 :                                         if (inline_change &amp;&amp; !IS_INTERNED(save)) {</span>
<span class="lineNum">     560 </span><span class="lineNoCov">              0 :                                                 efree(save);</span>
<span class="lineNum">     561 </span>                :                                         }
<span class="lineNum">     562 </span><span class="lineNoCov">              0 :                                         save = NULL;</span>
<span class="lineNum">     563 </span>                :                                 }
<span class="lineNum">     564 </span><span class="lineNoCov">              0 :                                 if (inline_change &amp;&amp; save &amp;&amp; save != actual &amp;&amp; !IS_INTERNED(save)) {</span>
<span class="lineNum">     565 </span><span class="lineNoCov">              0 :                                         efree(save);</span>
<span class="lineNum">     566 </span>                :                                 }
<span class="lineNum">     567 </span><span class="lineNoCov">              0 :                                 zend_error(E_NOTICE, &quot;Use of undefined constant %s - assumed '%s'&quot;,  actual,  actual);</span>
<span class="lineNum">     568 </span><span class="lineNoCov">              0 :                                 p-&gt;type = IS_STRING;</span>
<span class="lineNum">     569 </span><span class="lineNoCov">              0 :                                 if (!inline_change) {</span>
<span class="lineNum">     570 </span><span class="lineNoCov">              0 :                                         Z_STRVAL_P(p) = actual;</span>
<span class="lineNum">     571 </span><span class="lineNoCov">              0 :                                         Z_STRLEN_P(p) = actual_len;</span>
<span class="lineNum">     572 </span>                :                                         zval_copy_ctor(p);
<span class="lineNum">     573 </span>                :                                 }
<span class="lineNum">     574 </span>                :                         }
<span class="lineNum">     575 </span>                :                 } else {
<span class="lineNum">     576 </span><span class="lineNoCov">              0 :                         if (inline_change) {</span>
<span class="lineNum">     577 </span><span class="lineNoCov">              0 :                                 STR_FREE(Z_STRVAL_P(p));</span>
<span class="lineNum">     578 </span>                :                         }
<span class="lineNum">     579 </span><span class="lineNoCov">              0 :                         *p = const_value;</span>
<span class="lineNum">     580 </span>                :                 }
<span class="lineNum">     581 </span>                : 
<span class="lineNum">     582 </span><span class="lineNoCov">              0 :                 Z_SET_REFCOUNT_P(p, refcount);</span>
<span class="lineNum">     583 </span><span class="lineNoCov">              0 :                 Z_SET_ISREF_TO_P(p, is_ref);</span>
<span class="lineNum">     584 </span><span class="lineCov">            870 :         } else if (Z_TYPE_P(p) == IS_CONSTANT_ARRAY) {</span>
<span class="lineNum">     585 </span>                :                 zval **element, *new_val;
<span class="lineNum">     586 </span>                :                 char *str_index;
<span class="lineNum">     587 </span>                :                 uint str_index_len;
<span class="lineNum">     588 </span>                :                 ulong num_index;
<span class="lineNum">     589 </span>                :                 int ret;
<span class="lineNum">     590 </span>                : 
<span class="lineNum">     591 </span><span class="lineNoCov">              0 :                 SEPARATE_ZVAL_IF_NOT_REF(pp);</span>
<span class="lineNum">     592 </span><span class="lineNoCov">              0 :                 p = *pp;</span>
<span class="lineNum">     593 </span><span class="lineNoCov">              0 :                 Z_TYPE_P(p) = IS_ARRAY;</span>
<span class="lineNum">     594 </span>                : 
<span class="lineNum">     595 </span><span class="lineNoCov">              0 :                 if (!inline_change) {</span>
<span class="lineNum">     596 </span>                :                         zval *tmp;
<span class="lineNum">     597 </span><span class="lineNoCov">              0 :                         HashTable *tmp_ht = NULL;</span>
<span class="lineNum">     598 </span>                : 
<span class="lineNum">     599 </span><span class="lineNoCov">              0 :                         ALLOC_HASHTABLE(tmp_ht);</span>
<span class="lineNum">     600 </span><span class="lineNoCov">              0 :                         zend_hash_init(tmp_ht, zend_hash_num_elements(Z_ARRVAL_P(p)), NULL, ZVAL_PTR_DTOR, 0);</span>
<span class="lineNum">     601 </span><span class="lineNoCov">              0 :                         zend_hash_copy(tmp_ht, Z_ARRVAL_P(p), (copy_ctor_func_t) zval_deep_copy, (void *) &amp;tmp, sizeof(zval *));</span>
<span class="lineNum">     602 </span><span class="lineNoCov">              0 :                         Z_ARRVAL_P(p) = tmp_ht;</span>
<span class="lineNum">     603 </span>                :                 } 
<span class="lineNum">     604 </span>                : 
<span class="lineNum">     605 </span>                :                 /* First go over the array and see if there are any constant indices */
<span class="lineNum">     606 </span><span class="lineNoCov">              0 :                 zend_hash_internal_pointer_reset(Z_ARRVAL_P(p));</span>
<span class="lineNum">     607 </span><span class="lineNoCov">              0 :                 while (zend_hash_get_current_data(Z_ARRVAL_P(p), (void **) &amp;element) == SUCCESS) {</span>
<span class="lineNum">     608 </span><span class="lineNoCov">              0 :                         if (!(Z_TYPE_PP(element) &amp; IS_CONSTANT_INDEX)) {</span>
<span class="lineNum">     609 </span><span class="lineNoCov">              0 :                                 zend_hash_move_forward(Z_ARRVAL_P(p));</span>
<span class="lineNum">     610 </span><span class="lineNoCov">              0 :                                 continue;</span>
<span class="lineNum">     611 </span>                :                         }
<span class="lineNum">     612 </span><span class="lineNoCov">              0 :                         Z_TYPE_PP(element) &amp;= ~IS_CONSTANT_INDEX;</span>
<span class="lineNum">     613 </span><span class="lineNoCov">              0 :                         if (zend_hash_get_current_key_ex(Z_ARRVAL_P(p), &amp;str_index, &amp;str_index_len, &amp;num_index, 0, NULL) != HASH_KEY_IS_STRING) {</span>
<span class="lineNum">     614 </span><span class="lineNoCov">              0 :                                 zend_hash_move_forward(Z_ARRVAL_P(p));</span>
<span class="lineNum">     615 </span><span class="lineNoCov">              0 :                                 continue;</span>
<span class="lineNum">     616 </span>                :                         }
<span class="lineNum">     617 </span><span class="lineNoCov">              0 :                         if (!zend_get_constant_ex(str_index, str_index_len - 3, &amp;const_value, scope, str_index[str_index_len - 2] TSRMLS_CC)) {</span>
<span class="lineNum">     618 </span>                :                                 char *actual;
<span class="lineNum">     619 </span><span class="lineNoCov">              0 :                                 const char *save = str_index;</span>
<span class="lineNum">     620 </span><span class="lineNoCov">              0 :                                 if ((colon = (char*)zend_memrchr(str_index, ':', str_index_len - 3))) {</span>
<span class="lineNum">     621 </span><span class="lineNoCov">              0 :                                         zend_error(E_ERROR, &quot;Undefined class constant '%s'&quot;, str_index);</span>
<span class="lineNum">     622 </span><span class="lineNoCov">              0 :                                         str_index_len -= ((colon - str_index) + 1);</span>
<span class="lineNum">     623 </span><span class="lineNoCov">              0 :                                         str_index = colon;</span>
<span class="lineNum">     624 </span>                :                                 } else {
<span class="lineNum">     625 </span><span class="lineNoCov">              0 :                                         if (str_index[str_index_len - 2] &amp; IS_CONSTANT_UNQUALIFIED) {</span>
<span class="lineNum">     626 </span><span class="lineNoCov">              0 :                                                 if ((actual = (char *)zend_memrchr(str_index, '\\', str_index_len - 3))) {</span>
<span class="lineNum">     627 </span><span class="lineNoCov">              0 :                                                         actual++;</span>
<span class="lineNum">     628 </span><span class="lineNoCov">              0 :                                                         str_index_len -= (actual - str_index);</span>
<span class="lineNum">     629 </span><span class="lineNoCov">              0 :                                                         str_index = actual;</span>
<span class="lineNum">     630 </span>                :                                                 }
<span class="lineNum">     631 </span>                :                                         }
<span class="lineNum">     632 </span><span class="lineNoCov">              0 :                                         if (str_index[0] == '\\') {</span>
<span class="lineNum">     633 </span><span class="lineNoCov">              0 :                                                 ++str_index;</span>
<span class="lineNum">     634 </span><span class="lineNoCov">              0 :                                                 --str_index_len;</span>
<span class="lineNum">     635 </span>                :                                         }
<span class="lineNum">     636 </span><span class="lineNoCov">              0 :                                         if (save[0] == '\\') {</span>
<span class="lineNum">     637 </span><span class="lineNoCov">              0 :                                                 ++save;</span>
<span class="lineNum">     638 </span>                :                                         }
<span class="lineNum">     639 </span><span class="lineNoCov">              0 :                                         if ((str_index[str_index_len - 2] &amp; IS_CONSTANT_UNQUALIFIED) == 0) {</span>
<span class="lineNum">     640 </span><span class="lineNoCov">              0 :                                                 zend_error(E_ERROR, &quot;Undefined constant '%s'&quot;, save);</span>
<span class="lineNum">     641 </span>                :                                         }
<span class="lineNum">     642 </span><span class="lineNoCov">              0 :                                         zend_error(E_NOTICE, &quot;Use of undefined constant %s - assumed '%s'&quot;,   str_index, str_index);</span>
<span class="lineNum">     643 </span>                :                                 }
<span class="lineNum">     644 </span><span class="lineNoCov">              0 :                                 ZVAL_STRINGL(&amp;const_value, str_index, str_index_len-3, 1);</span>
<span class="lineNum">     645 </span>                :                         }
<span class="lineNum">     646 </span>                : 
<span class="lineNum">     647 </span><span class="lineNoCov">              0 :                         if (Z_REFCOUNT_PP(element) &gt; 1) {</span>
<span class="lineNum">     648 </span><span class="lineNoCov">              0 :                                 ALLOC_ZVAL(new_val);</span>
<span class="lineNum">     649 </span><span class="lineNoCov">              0 :                                 *new_val = **element;</span>
<span class="lineNum">     650 </span>                :                                 zval_copy_ctor(new_val);
<span class="lineNum">     651 </span>                :                                 Z_SET_REFCOUNT_P(new_val, 1);
<span class="lineNum">     652 </span>                :                                 Z_UNSET_ISREF_P(new_val);
<span class="lineNum">     653 </span>                : 
<span class="lineNum">     654 </span>                :                                 /* preserve this bit for inheritance */
<span class="lineNum">     655 </span><span class="lineNoCov">              0 :                                 Z_TYPE_PP(element) |= IS_CONSTANT_INDEX;</span>
<span class="lineNum">     656 </span><span class="lineNoCov">              0 :                                 zval_ptr_dtor(element);</span>
<span class="lineNum">     657 </span><span class="lineNoCov">              0 :                                 *element = new_val;</span>
<span class="lineNum">     658 </span>                :                         }
<span class="lineNum">     659 </span>                : 
<span class="lineNum">     660 </span><span class="lineNoCov">              0 :                         switch (Z_TYPE(const_value)) {</span>
<span class="lineNum">     661 </span>                :                                 case IS_STRING:
<span class="lineNum">     662 </span><span class="lineNoCov">              0 :                                         ret = zend_symtable_update_current_key(Z_ARRVAL_P(p), Z_STRVAL(const_value), Z_STRLEN(const_value) + 1, HASH_UPDATE_KEY_IF_BEFORE);</span>
<span class="lineNum">     663 </span><span class="lineNoCov">              0 :                                         break;</span>
<span class="lineNum">     664 </span>                :                                 case IS_BOOL:
<span class="lineNum">     665 </span>                :                                 case IS_LONG:
<span class="lineNum">     666 </span><span class="lineNoCov">              0 :                                         ret = zend_hash_update_current_key_ex(Z_ARRVAL_P(p), HASH_KEY_IS_LONG, NULL, 0, Z_LVAL(const_value), HASH_UPDATE_KEY_IF_BEFORE, NULL);</span>
<span class="lineNum">     667 </span><span class="lineNoCov">              0 :                                         break;</span>
<span class="lineNum">     668 </span>                :                                 case IS_DOUBLE:
<span class="lineNum">     669 </span><span class="lineNoCov">              0 :                                         ret = zend_hash_update_current_key_ex(Z_ARRVAL_P(p), HASH_KEY_IS_LONG, NULL, 0, zend_dval_to_lval(Z_DVAL(const_value)), HASH_UPDATE_KEY_IF_BEFORE, NULL);</span>
<span class="lineNum">     670 </span><span class="lineNoCov">              0 :                                         break;</span>
<span class="lineNum">     671 </span>                :                                 case IS_NULL:
<span class="lineNum">     672 </span><span class="lineNoCov">              0 :                                         ret = zend_hash_update_current_key_ex(Z_ARRVAL_P(p), HASH_KEY_IS_STRING, &quot;&quot;, 1, 0, HASH_UPDATE_KEY_IF_BEFORE, NULL);</span>
<span class="lineNum">     673 </span><span class="lineNoCov">              0 :                                         break;</span>
<span class="lineNum">     674 </span>                :                                 default:
<span class="lineNum">     675 </span><span class="lineNoCov">              0 :                                         ret = SUCCESS;</span>
<span class="lineNum">     676 </span>                :                                         break;
<span class="lineNum">     677 </span>                :                         }
<span class="lineNum">     678 </span><span class="lineNoCov">              0 :                         if (ret == SUCCESS) {</span>
<span class="lineNum">     679 </span><span class="lineNoCov">              0 :                                 zend_hash_move_forward(Z_ARRVAL_P(p));</span>
<span class="lineNum">     680 </span>                :                         }
<span class="lineNum">     681 </span>                :                         zval_dtor(&amp;const_value);
<span class="lineNum">     682 </span>                :                 }
<span class="lineNum">     683 </span><span class="lineNoCov">              0 :                 zend_hash_apply_with_argument(Z_ARRVAL_P(p), (apply_func_arg_t) zval_update_constant_inline_change, (void *) scope TSRMLS_CC);</span>
<span class="lineNum">     684 </span><span class="lineNoCov">              0 :                 zend_hash_internal_pointer_reset(Z_ARRVAL_P(p));</span>
<span class="lineNum">     685 </span>                :         }
<span class="lineNum">     686 </span><span class="lineCov">            870 :         return 0;</span>
<span class="lineNum">     687 </span>                : }
<a name="688"><span class="lineNum">     688 </span>                : /* }}} */</a>
<span class="lineNum">     689 </span>                : 
<span class="lineNum">     690 </span><span class="lineNoCov">              0 : ZEND_API int zval_update_constant_inline_change(zval **pp, void *scope TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">     691 </span>                : {
<span class="lineNum">     692 </span><span class="lineNoCov">              0 :         return zval_update_constant_ex(pp, (void*)1, scope TSRMLS_CC);</span>
<span class="lineNum">     693 </span>                : }
<a name="694"><span class="lineNum">     694 </span>                : /* }}} */</a>
<span class="lineNum">     695 </span>                : 
<span class="lineNum">     696 </span><span class="lineNoCov">              0 : ZEND_API int zval_update_constant_no_inline_change(zval **pp, void *scope TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">     697 </span>                : {
<span class="lineNum">     698 </span><span class="lineNoCov">              0 :         return zval_update_constant_ex(pp, (void*)0, scope TSRMLS_CC);</span>
<span class="lineNum">     699 </span>                : }
<a name="700"><span class="lineNum">     700 </span>                : /* }}} */</a>
<span class="lineNum">     701 </span>                : 
<span class="lineNum">     702 </span><span class="lineCov">            870 : ZEND_API int zval_update_constant(zval **pp, void *arg TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">     703 </span>                : {
<span class="lineNum">     704 </span><span class="lineCov">            870 :         return zval_update_constant_ex(pp, arg, NULL TSRMLS_CC);</span>
<span class="lineNum">     705 </span>                : }
<a name="706"><span class="lineNum">     706 </span>                : /* }}} */</a>
<span class="lineNum">     707 </span>                : 
<span class="lineNum">     708 </span><span class="lineNoCov">              0 : int call_user_function(HashTable *function_table, zval **object_pp, zval *function_name, zval *retval_ptr, zend_uint param_count, zval *params[] TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">     709 </span>                : {
<span class="lineNum">     710 </span>                :         zval ***params_array;
<span class="lineNum">     711 </span>                :         zend_uint i;
<span class="lineNum">     712 </span>                :         int ex_retval;
<span class="lineNum">     713 </span><span class="lineNoCov">              0 :         zval *local_retval_ptr = NULL;</span>
<span class="lineNum">     714 </span>                : 
<span class="lineNum">     715 </span><span class="lineNoCov">              0 :         if (param_count) {</span>
<span class="lineNum">     716 </span><span class="lineNoCov">              0 :                 params_array = (zval ***) emalloc(sizeof(zval **)*param_count);</span>
<span class="lineNum">     717 </span><span class="lineNoCov">              0 :                 for (i=0; i&lt;param_count; i++) {</span>
<span class="lineNum">     718 </span><span class="lineNoCov">              0 :                         params_array[i] = &amp;params[i];</span>
<span class="lineNum">     719 </span>                :                 }
<span class="lineNum">     720 </span>                :         } else {
<span class="lineNum">     721 </span><span class="lineNoCov">              0 :                 params_array = NULL;</span>
<span class="lineNum">     722 </span>                :         }
<span class="lineNum">     723 </span><span class="lineNoCov">              0 :         ex_retval = call_user_function_ex(function_table, object_pp, function_name, &amp;local_retval_ptr, param_count, params_array, 1, NULL TSRMLS_CC);</span>
<span class="lineNum">     724 </span><span class="lineNoCov">              0 :         if (local_retval_ptr) {</span>
<span class="lineNum">     725 </span><span class="lineNoCov">              0 :                 COPY_PZVAL_TO_ZVAL(*retval_ptr, local_retval_ptr);</span>
<span class="lineNum">     726 </span>                :         } else {
<span class="lineNum">     727 </span><span class="lineNoCov">              0 :                 INIT_ZVAL(*retval_ptr);</span>
<span class="lineNum">     728 </span>                :         }
<span class="lineNum">     729 </span><span class="lineNoCov">              0 :         if (params_array) {</span>
<span class="lineNum">     730 </span><span class="lineNoCov">              0 :                 efree(params_array);</span>
<span class="lineNum">     731 </span>                :         }
<span class="lineNum">     732 </span><span class="lineNoCov">              0 :         return ex_retval;</span>
<span class="lineNum">     733 </span>                : }
<a name="734"><span class="lineNum">     734 </span>                : /* }}} */</a>
<span class="lineNum">     735 </span>                : 
<span class="lineNum">     736 </span><span class="lineCov">             18 : int call_user_function_ex(HashTable *function_table, zval **object_pp, zval *function_name, zval **retval_ptr_ptr, zend_uint param_count, zval **params[], int no_separation, HashTable *symbol_table TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">     737 </span>                : {
<span class="lineNum">     738 </span>                :         zend_fcall_info fci;
<span class="lineNum">     739 </span>                : 
<span class="lineNum">     740 </span><span class="lineCov">             18 :         fci.size = sizeof(fci);</span>
<span class="lineNum">     741 </span><span class="lineCov">             18 :         fci.function_table = function_table;</span>
<span class="lineNum">     742 </span><span class="lineCov">             18 :         fci.object_ptr = object_pp ? *object_pp : NULL;</span>
<span class="lineNum">     743 </span><span class="lineCov">             18 :         fci.function_name = function_name;</span>
<span class="lineNum">     744 </span><span class="lineCov">             18 :         fci.retval_ptr_ptr = retval_ptr_ptr;</span>
<span class="lineNum">     745 </span><span class="lineCov">             18 :         fci.param_count = param_count;</span>
<span class="lineNum">     746 </span><span class="lineCov">             18 :         fci.params = params;</span>
<span class="lineNum">     747 </span><span class="lineCov">             18 :         fci.no_separation = (zend_bool) no_separation;</span>
<span class="lineNum">     748 </span><span class="lineCov">             18 :         fci.symbol_table = symbol_table;</span>
<span class="lineNum">     749 </span>                : 
<span class="lineNum">     750 </span><span class="lineCov">             18 :         return zend_call_function(&amp;fci, NULL TSRMLS_CC);</span>
<span class="lineNum">     751 </span>                : }
<a name="752"><span class="lineNum">     752 </span>                : /* }}} */</a>
<span class="lineNum">     753 </span>                : 
<span class="lineNum">     754 </span><span class="lineCov">           1348 : int zend_call_function(zend_fcall_info *fci, zend_fcall_info_cache *fci_cache TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">     755 </span>                : {
<span class="lineNum">     756 </span>                :         zend_uint i;
<span class="lineNum">     757 </span>                :         zval **original_return_value;
<span class="lineNum">     758 </span>                :         HashTable *calling_symbol_table;
<span class="lineNum">     759 </span>                :         zend_op_array *original_op_array;
<span class="lineNum">     760 </span>                :         zend_op **original_opline_ptr;
<span class="lineNum">     761 </span>                :         zend_class_entry *current_scope;
<span class="lineNum">     762 </span>                :         zend_class_entry *current_called_scope;
<span class="lineNum">     763 </span><span class="lineCov">           1348 :         zend_class_entry *calling_scope = NULL;</span>
<span class="lineNum">     764 </span><span class="lineCov">           1348 :         zend_class_entry *called_scope = NULL;</span>
<span class="lineNum">     765 </span>                :         zval *current_this;
<span class="lineNum">     766 </span>                :         zend_execute_data execute_data;
<span class="lineNum">     767 </span>                :         zend_fcall_info_cache fci_cache_local;
<span class="lineNum">     768 </span>                : 
<span class="lineNum">     769 </span><span class="lineCov">           1348 :         *fci-&gt;retval_ptr_ptr = NULL;</span>
<span class="lineNum">     770 </span>                : 
<span class="lineNum">     771 </span><span class="lineCov">           1348 :         if (!EG(active)) {</span>
<span class="lineNum">     772 </span><span class="lineNoCov">              0 :                 return FAILURE; /* executor is already inactive */</span>
<span class="lineNum">     773 </span>                :         }
<span class="lineNum">     774 </span>                : 
<span class="lineNum">     775 </span><span class="lineCov">           1348 :         if (EG(exception)) {</span>
<span class="lineNum">     776 </span><span class="lineNoCov">              0 :                 return FAILURE; /* we would result in an instable executor otherwise */</span>
<span class="lineNum">     777 </span>                :         }
<span class="lineNum">     778 </span>                : 
<span class="lineNum">     779 </span><span class="lineCov">           1348 :         switch (fci-&gt;size) {</span>
<span class="lineNum">     780 </span>                :                 case sizeof(zend_fcall_info):
<span class="lineNum">     781 </span><span class="lineCov">           1348 :                         break; /* nothing to do currently */</span>
<span class="lineNum">     782 </span>                :                 default:
<span class="lineNum">     783 </span><span class="lineNoCov">              0 :                         zend_error(E_ERROR, &quot;Corrupted fcall_info provided to zend_call_function()&quot;);</span>
<span class="lineNum">     784 </span>                :                         break;
<span class="lineNum">     785 </span>                :         }
<span class="lineNum">     786 </span>                : 
<span class="lineNum">     787 </span>                :         /* Initialize execute_data */
<span class="lineNum">     788 </span><span class="lineCov">           1348 :         if (EG(current_execute_data)) {</span>
<span class="lineNum">     789 </span><span class="lineCov">           1344 :                 execute_data = *EG(current_execute_data);</span>
<span class="lineNum">     790 </span><span class="lineCov">           1344 :                 EX(op_array) = NULL;</span>
<span class="lineNum">     791 </span><span class="lineCov">           1344 :                 EX(opline) = NULL;</span>
<span class="lineNum">     792 </span><span class="lineCov">           1344 :                 EX(object) = NULL;</span>
<span class="lineNum">     793 </span>                :         } else {
<span class="lineNum">     794 </span>                :                 /* This only happens when we're called outside any execute()'s
<span class="lineNum">     795 </span>                :                  * It shouldn't be strictly necessary to NULL execute_data out,
<span class="lineNum">     796 </span>                :                  * but it may make bugs easier to spot
<span class="lineNum">     797 </span>                :                  */
<span class="lineNum">     798 </span><span class="lineCov">              4 :                 memset(&amp;execute_data, 0, sizeof(zend_execute_data));</span>
<span class="lineNum">     799 </span>                :         }
<span class="lineNum">     800 </span>                : 
<span class="lineNum">     801 </span><span class="lineCov">           1348 :         if (!fci_cache || !fci_cache-&gt;initialized) {</span>
<span class="lineNum">     802 </span>                :                 char *callable_name;
<span class="lineNum">     803 </span><span class="lineCov">            223 :                 char *error = NULL;</span>
<span class="lineNum">     804 </span>                : 
<span class="lineNum">     805 </span><span class="lineCov">            223 :                 if (!fci_cache) {</span>
<span class="lineNum">     806 </span><span class="lineCov">             21 :                         fci_cache = &amp;fci_cache_local;</span>
<span class="lineNum">     807 </span>                :                 }
<span class="lineNum">     808 </span>                : 
<span class="lineNum">     809 </span><span class="lineCov">            223 :                 if (!zend_is_callable_ex(fci-&gt;function_name, fci-&gt;object_ptr, IS_CALLABLE_CHECK_SILENT, &amp;callable_name, NULL, fci_cache, &amp;error TSRMLS_CC)) {</span>
<span class="lineNum">     810 </span><span class="lineNoCov">              0 :                         if (error) {</span>
<span class="lineNum">     811 </span><span class="lineNoCov">              0 :                                 zend_error(E_WARNING, &quot;Invalid callback %s, %s&quot;, callable_name, error);</span>
<span class="lineNum">     812 </span><span class="lineNoCov">              0 :                                 efree(error);</span>
<span class="lineNum">     813 </span>                :                         }
<span class="lineNum">     814 </span><span class="lineNoCov">              0 :                         if (callable_name) {</span>
<span class="lineNum">     815 </span><span class="lineNoCov">              0 :                                 efree(callable_name);</span>
<span class="lineNum">     816 </span>                :                         }
<span class="lineNum">     817 </span><span class="lineNoCov">              0 :                         return FAILURE;</span>
<span class="lineNum">     818 </span><span class="lineCov">            223 :                 } else if (error) {</span>
<span class="lineNum">     819 </span>                :                         /* Capitalize the first latter of the error message */
<span class="lineNum">     820 </span><span class="lineNoCov">              0 :                         if (error[0] &gt;= 'a' &amp;&amp; error[0] &lt;= 'z') {</span>
<span class="lineNum">     821 </span><span class="lineNoCov">              0 :                                 error[0] += ('A' - 'a');</span>
<span class="lineNum">     822 </span>                :                         }
<span class="lineNum">     823 </span><span class="lineNoCov">              0 :                         zend_error(E_STRICT, &quot;%s&quot;, error);</span>
<span class="lineNum">     824 </span><span class="lineNoCov">              0 :                         efree(error);</span>
<span class="lineNum">     825 </span>                :                 }
<span class="lineNum">     826 </span><span class="lineCov">            223 :                 efree(callable_name);</span>
<span class="lineNum">     827 </span>                :         }
<span class="lineNum">     828 </span>                : 
<span class="lineNum">     829 </span><span class="lineCov">           1348 :         EX(function_state).function = fci_cache-&gt;function_handler;</span>
<span class="lineNum">     830 </span><span class="lineCov">           1348 :         calling_scope = fci_cache-&gt;calling_scope;</span>
<span class="lineNum">     831 </span><span class="lineCov">           1348 :         called_scope = fci_cache-&gt;called_scope;</span>
<span class="lineNum">     832 </span><span class="lineCov">           1348 :         fci-&gt;object_ptr = fci_cache-&gt;object_ptr;</span>
<span class="lineNum">     833 </span><span class="lineCov">           1348 :         EX(object) = fci-&gt;object_ptr;</span>
<span class="lineNum">     834 </span><span class="lineCov">           3604 :         if (fci-&gt;object_ptr &amp;&amp; Z_TYPE_P(fci-&gt;object_ptr) == IS_OBJECT &amp;&amp;</span>
<span class="lineNum">     835 </span><span class="lineCov">           2256 :             (!EG(objects_store).object_buckets || !EG(objects_store).object_buckets[Z_OBJ_HANDLE_P(fci-&gt;object_ptr)].valid)) {</span>
<span class="lineNum">     836 </span><span class="lineNoCov">              0 :                 return FAILURE;</span>
<span class="lineNum">     837 </span>                :         }
<span class="lineNum">     838 </span>                : 
<span class="lineNum">     839 </span><span class="lineCov">           1348 :         if (EX(function_state).function-&gt;common.fn_flags &amp; (ZEND_ACC_ABSTRACT|ZEND_ACC_DEPRECATED)) {</span>
<span class="lineNum">     840 </span><span class="lineNoCov">              0 :                 if (EX(function_state).function-&gt;common.fn_flags &amp; ZEND_ACC_ABSTRACT) {</span>
<span class="lineNum">     841 </span><span class="lineNoCov">              0 :                         zend_error_noreturn(E_ERROR, &quot;Cannot call abstract method %s::%s()&quot;, EX(function_state).function-&gt;common.scope-&gt;name, EX(function_state).function-&gt;common.function_name);</span>
<span class="lineNum">     842 </span>                :                 }
<span class="lineNum">     843 </span><span class="lineNoCov">              0 :                 if (EX(function_state).function-&gt;common.fn_flags &amp; ZEND_ACC_DEPRECATED) {</span>
<span class="lineNum">     844 </span><span class="lineNoCov">              0 :                         zend_error(E_DEPRECATED, &quot;Function %s%s%s() is deprecated&quot;,</span>
<span class="lineNum">     845 </span><span class="lineNoCov">              0 :                                 EX(function_state).function-&gt;common.scope ? EX(function_state).function-&gt;common.scope-&gt;name : &quot;&quot;,</span>
<span class="lineNum">     846 </span><span class="lineNoCov">              0 :                                 EX(function_state).function-&gt;common.scope ? &quot;::&quot; : &quot;&quot;,</span>
<span class="lineNum">     847 </span><span class="lineNoCov">              0 :                                 EX(function_state).function-&gt;common.function_name);</span>
<span class="lineNum">     848 </span>                :                 }
<span class="lineNum">     849 </span>                :         }
<span class="lineNum">     850 </span>                : 
<span class="lineNum">     851 </span><span class="lineCov">           1348 :         ZEND_VM_STACK_GROW_IF_NEEDED(fci-&gt;param_count + 1);</span>
<span class="lineNum">     852 </span>                : 
<span class="lineNum">     853 </span><span class="lineCov">           2856 :         for (i=0; i&lt;fci-&gt;param_count; i++) {</span>
<span class="lineNum">     854 </span>                :                 zval *param;
<span class="lineNum">     855 </span>                : 
<span class="lineNum">     856 </span><span class="lineCov">           1508 :                 if (ARG_SHOULD_BE_SENT_BY_REF(EX(function_state).function, i + 1)) {</span>
<span class="lineNum">     857 </span><span class="lineNoCov">              0 :                         if (!PZVAL_IS_REF(*fci-&gt;params[i]) &amp;&amp; Z_REFCOUNT_PP(fci-&gt;params[i]) &gt; 1) {</span>
<span class="lineNum">     858 </span>                :                                 zval *new_zval;
<span class="lineNum">     859 </span>                : 
<span class="lineNum">     860 </span><span class="lineNoCov">              0 :                                 if (fci-&gt;no_separation &amp;&amp;</span>
<span class="lineNum">     861 </span><span class="lineNoCov">              0 :                                     !ARG_MAY_BE_SENT_BY_REF(EX(function_state).function, i + 1)) {</span>
<span class="lineNum">     862 </span><span class="lineNoCov">              0 :                                         if (i || UNEXPECTED(ZEND_VM_STACK_ELEMETS(EG(argument_stack)) == (EG(argument_stack)-&gt;top))) {</span>
<span class="lineNum">     863 </span>                :                                                 /* hack to clean up the stack */
<span class="lineNum">     864 </span><span class="lineNoCov">              0 :                                                 zend_vm_stack_push_nocheck((void *) (zend_uintptr_t)i TSRMLS_CC);</span>
<span class="lineNum">     865 </span>                :                                                 zend_vm_stack_clear_multiple(TSRMLS_C);
<span class="lineNum">     866 </span>                :                                         }
<span class="lineNum">     867 </span>                : 
<span class="lineNum">     868 </span><span class="lineNoCov">              0 :                                         zend_error(E_WARNING, &quot;Parameter %d to %s%s%s() expected to be a reference, value given&quot;,</span>
<span class="lineNum">     869 </span>                :                                                 i+1,
<span class="lineNum">     870 </span><span class="lineNoCov">              0 :                                                 EX(function_state).function-&gt;common.scope ? EX(function_state).function-&gt;common.scope-&gt;name : &quot;&quot;,</span>
<span class="lineNum">     871 </span><span class="lineNoCov">              0 :                                                 EX(function_state).function-&gt;common.scope ? &quot;::&quot; : &quot;&quot;,</span>
<span class="lineNum">     872 </span><span class="lineNoCov">              0 :                                                 EX(function_state).function-&gt;common.function_name);</span>
<span class="lineNum">     873 </span><span class="lineNoCov">              0 :                                         return FAILURE;</span>
<span class="lineNum">     874 </span>                :                                 }
<span class="lineNum">     875 </span>                : 
<span class="lineNum">     876 </span><span class="lineNoCov">              0 :                                 ALLOC_ZVAL(new_zval);</span>
<span class="lineNum">     877 </span><span class="lineNoCov">              0 :                                 *new_zval = **fci-&gt;params[i];</span>
<span class="lineNum">     878 </span>                :                                 zval_copy_ctor(new_zval);
<span class="lineNum">     879 </span>                :                                 Z_SET_REFCOUNT_P(new_zval, 1);
<span class="lineNum">     880 </span><span class="lineNoCov">              0 :                                 Z_DELREF_PP(fci-&gt;params[i]);</span>
<span class="lineNum">     881 </span><span class="lineNoCov">              0 :                                 *fci-&gt;params[i] = new_zval;</span>
<span class="lineNum">     882 </span>                :                         }
<span class="lineNum">     883 </span><span class="lineNoCov">              0 :                         Z_ADDREF_PP(fci-&gt;params[i]);</span>
<span class="lineNum">     884 </span><span class="lineNoCov">              0 :                         Z_SET_ISREF_PP(fci-&gt;params[i]);</span>
<span class="lineNum">     885 </span><span class="lineNoCov">              0 :                         param = *fci-&gt;params[i];</span>
<span class="lineNum">     886 </span><span class="lineCov">           3016 :                 } else if (PZVAL_IS_REF(*fci-&gt;params[i]) &amp;&amp;</span>
<span class="lineNum">     887 </span>                :                            /* don't separate references for __call */
<span class="lineNum">     888 </span><span class="lineNoCov">              0 :                            (EX(function_state).function-&gt;common.fn_flags &amp; ZEND_ACC_CALL_VIA_HANDLER) == 0 ) {</span>
<span class="lineNum">     889 </span><span class="lineNoCov">              0 :                         ALLOC_ZVAL(param);</span>
<span class="lineNum">     890 </span><span class="lineNoCov">              0 :                         *param = **(fci-&gt;params[i]);</span>
<span class="lineNum">     891 </span><span class="lineNoCov">              0 :                         INIT_PZVAL(param);</span>
<span class="lineNum">     892 </span>                :                         zval_copy_ctor(param);
<span class="lineNum">     893 </span><span class="lineCov">           1508 :                 } else if (*fci-&gt;params[i] != &amp;EG(uninitialized_zval)) {</span>
<span class="lineNum">     894 </span><span class="lineCov">           1508 :                         Z_ADDREF_PP(fci-&gt;params[i]);</span>
<span class="lineNum">     895 </span><span class="lineCov">           1508 :                         param = *fci-&gt;params[i];</span>
<span class="lineNum">     896 </span>                :                 } else {
<span class="lineNum">     897 </span><span class="lineNoCov">              0 :                         ALLOC_ZVAL(param);</span>
<span class="lineNum">     898 </span><span class="lineNoCov">              0 :                         *param = **(fci-&gt;params[i]);</span>
<span class="lineNum">     899 </span><span class="lineNoCov">              0 :                         INIT_PZVAL(param);</span>
<span class="lineNum">     900 </span>                :                 }
<span class="lineNum">     901 </span>                :                 zend_vm_stack_push_nocheck(param TSRMLS_CC);
<span class="lineNum">     902 </span>                :         }
<span class="lineNum">     903 </span>                : 
<span class="lineNum">     904 </span><span class="lineCov">           1348 :         EX(function_state).arguments = zend_vm_stack_top(TSRMLS_C);</span>
<span class="lineNum">     905 </span><span class="lineCov">           1348 :         zend_vm_stack_push_nocheck((void*)(zend_uintptr_t)fci-&gt;param_count TSRMLS_CC);</span>
<span class="lineNum">     906 </span>                : 
<span class="lineNum">     907 </span><span class="lineCov">           1348 :         current_scope = EG(scope);</span>
<span class="lineNum">     908 </span><span class="lineCov">           1348 :         EG(scope) = calling_scope;</span>
<span class="lineNum">     909 </span>                : 
<span class="lineNum">     910 </span><span class="lineCov">           1348 :         current_this = EG(This);</span>
<span class="lineNum">     911 </span>                : 
<span class="lineNum">     912 </span><span class="lineCov">           1348 :         current_called_scope = EG(called_scope);</span>
<span class="lineNum">     913 </span><span class="lineCov">           1348 :         if (called_scope) {</span>
<span class="lineNum">     914 </span><span class="lineCov">           1128 :                 EG(called_scope) = called_scope;</span>
<span class="lineNum">     915 </span><span class="lineCov">            220 :         } else if (EX(function_state).function-&gt;type != ZEND_INTERNAL_FUNCTION) {</span>
<span class="lineNum">     916 </span><span class="lineCov">            220 :                 EG(called_scope) = NULL;</span>
<span class="lineNum">     917 </span>                :         }
<span class="lineNum">     918 </span>                : 
<span class="lineNum">     919 </span><span class="lineCov">           1348 :         if (fci-&gt;object_ptr) {</span>
<span class="lineNum">     920 </span><span class="lineCov">           1128 :                 if ((EX(function_state).function-&gt;common.fn_flags &amp; ZEND_ACC_STATIC)) {</span>
<span class="lineNum">     921 </span><span class="lineNoCov">              0 :                         EG(This) = NULL;</span>
<span class="lineNum">     922 </span>                :                 } else {
<span class="lineNum">     923 </span><span class="lineCov">           1128 :                         EG(This) = fci-&gt;object_ptr;</span>
<span class="lineNum">     924 </span>                : 
<span class="lineNum">     925 </span><span class="lineCov">           2256 :                         if (!PZVAL_IS_REF(EG(This))) {</span>
<span class="lineNum">     926 </span><span class="lineCov">           1128 :                                 Z_ADDREF_P(EG(This)); /* For $this pointer */</span>
<span class="lineNum">     927 </span>                :                         } else {
<span class="lineNum">     928 </span>                :                                 zval *this_ptr;
<span class="lineNum">     929 </span>                : 
<span class="lineNum">     930 </span><span class="lineNoCov">              0 :                                 ALLOC_ZVAL(this_ptr);</span>
<span class="lineNum">     931 </span><span class="lineNoCov">              0 :                                 *this_ptr = *EG(This);</span>
<span class="lineNum">     932 </span><span class="lineNoCov">              0 :                                 INIT_PZVAL(this_ptr);</span>
<span class="lineNum">     933 </span>                :                                 zval_copy_ctor(this_ptr);
<span class="lineNum">     934 </span><span class="lineNoCov">              0 :                                 EG(This) = this_ptr;</span>
<span class="lineNum">     935 </span>                :                         }
<span class="lineNum">     936 </span>                :                 }
<span class="lineNum">     937 </span>                :         } else {
<span class="lineNum">     938 </span><span class="lineCov">            220 :                 EG(This) = NULL;</span>
<span class="lineNum">     939 </span>                :         }
<span class="lineNum">     940 </span>                : 
<span class="lineNum">     941 </span><span class="lineCov">           1348 :         EX(prev_execute_data) = EG(current_execute_data);</span>
<span class="lineNum">     942 </span><span class="lineCov">           1348 :         EG(current_execute_data) = &amp;execute_data;</span>
<span class="lineNum">     943 </span>                : 
<span class="lineNum">     944 </span><span class="lineCov">           1348 :         if (EX(function_state).function-&gt;type == ZEND_USER_FUNCTION) {</span>
<span class="lineNum">     945 </span><span class="lineCov">            222 :                 calling_symbol_table = EG(active_symbol_table);</span>
<span class="lineNum">     946 </span><span class="lineCov">            222 :                 EG(scope) = EX(function_state).function-&gt;common.scope;</span>
<span class="lineNum">     947 </span><span class="lineCov">            222 :                 if (fci-&gt;symbol_table) {</span>
<span class="lineNum">     948 </span><span class="lineNoCov">              0 :                         EG(active_symbol_table) = fci-&gt;symbol_table;</span>
<span class="lineNum">     949 </span>                :                 } else {
<span class="lineNum">     950 </span><span class="lineCov">            222 :                         EG(active_symbol_table) = NULL;</span>
<span class="lineNum">     951 </span>                :                 }
<span class="lineNum">     952 </span>                : 
<span class="lineNum">     953 </span><span class="lineCov">            222 :                 original_return_value = EG(return_value_ptr_ptr);</span>
<span class="lineNum">     954 </span><span class="lineCov">            222 :                 original_op_array = EG(active_op_array);</span>
<span class="lineNum">     955 </span><span class="lineCov">            222 :                 EG(return_value_ptr_ptr) = fci-&gt;retval_ptr_ptr;</span>
<span class="lineNum">     956 </span><span class="lineCov">            222 :                 EG(active_op_array) = (zend_op_array *) EX(function_state).function;</span>
<span class="lineNum">     957 </span><span class="lineCov">            222 :                 original_opline_ptr = EG(opline_ptr);</span>
<span class="lineNum">     958 </span><span class="lineCov">            222 :                 zend_execute(EG(active_op_array) TSRMLS_CC);</span>
<span class="lineNum">     959 </span><span class="lineCov">            222 :                 if (!fci-&gt;symbol_table &amp;&amp; EG(active_symbol_table)) {</span>
<span class="lineNum">     960 </span><span class="lineNoCov">              0 :                         if (EG(symtable_cache_ptr)&gt;=EG(symtable_cache_limit)) {</span>
<span class="lineNum">     961 </span><span class="lineNoCov">              0 :                                 zend_hash_destroy(EG(active_symbol_table));</span>
<span class="lineNum">     962 </span><span class="lineNoCov">              0 :                                 FREE_HASHTABLE(EG(active_symbol_table));</span>
<span class="lineNum">     963 </span>                :                         } else {
<span class="lineNum">     964 </span>                :                                 /* clean before putting into the cache, since clean
<span class="lineNum">     965 </span>                :                                    could call dtors, which could use cached hash */
<span class="lineNum">     966 </span><span class="lineNoCov">              0 :                                 zend_hash_clean(EG(active_symbol_table));</span>
<span class="lineNum">     967 </span><span class="lineNoCov">              0 :                                 *(++EG(symtable_cache_ptr)) = EG(active_symbol_table);</span>
<span class="lineNum">     968 </span>                :                         }
<span class="lineNum">     969 </span>                :                 }
<span class="lineNum">     970 </span><span class="lineCov">            222 :                 EG(active_symbol_table) = calling_symbol_table;</span>
<span class="lineNum">     971 </span><span class="lineCov">            222 :                 EG(active_op_array) = original_op_array;</span>
<span class="lineNum">     972 </span><span class="lineCov">            222 :                 EG(return_value_ptr_ptr)=original_return_value;</span>
<span class="lineNum">     973 </span><span class="lineCov">            222 :                 EG(opline_ptr) = original_opline_ptr;</span>
<span class="lineNum">     974 </span><span class="lineCov">           1126 :         } else if (EX(function_state).function-&gt;type == ZEND_INTERNAL_FUNCTION) {</span>
<span class="lineNum">     975 </span><span class="lineCov">           1126 :                 int call_via_handler = (EX(function_state).function-&gt;common.fn_flags &amp; ZEND_ACC_CALL_VIA_HANDLER) != 0;</span>
<span class="lineNum">     976 </span><span class="lineCov">           1126 :                 ALLOC_INIT_ZVAL(*fci-&gt;retval_ptr_ptr);</span>
<span class="lineNum">     977 </span><span class="lineCov">           1126 :                 if (EX(function_state).function-&gt;common.scope) {</span>
<span class="lineNum">     978 </span><span class="lineCov">           1126 :                         EG(scope) = EX(function_state).function-&gt;common.scope;</span>
<span class="lineNum">     979 </span>                :                 }
<span class="lineNum">     980 </span><span class="lineCov">           1126 :                 ((zend_internal_function *) EX(function_state).function)-&gt;handler(fci-&gt;param_count, *fci-&gt;retval_ptr_ptr, fci-&gt;retval_ptr_ptr, fci-&gt;object_ptr, 1 TSRMLS_CC);</span>
<span class="lineNum">     981 </span>                :                 /*  We shouldn't fix bad extensions here,
<span class="lineNum">     982 </span>                :                         because it can break proper ones (Bug #34045)
<span class="lineNum">     983 </span>                :                 if (!EX(function_state).function-&gt;common.return_reference)
<span class="lineNum">     984 </span>                :                 {
<span class="lineNum">     985 </span>                :                         INIT_PZVAL(*fci-&gt;retval_ptr_ptr);
<span class="lineNum">     986 </span>                :                 }*/
<span class="lineNum">     987 </span><span class="lineCov">           1126 :                 if (EG(exception) &amp;&amp; fci-&gt;retval_ptr_ptr) {</span>
<span class="lineNum">     988 </span><span class="lineCov">              2 :                         zval_ptr_dtor(fci-&gt;retval_ptr_ptr);</span>
<span class="lineNum">     989 </span><span class="lineCov">              2 :                         *fci-&gt;retval_ptr_ptr = NULL;</span>
<span class="lineNum">     990 </span>                :                 }
<span class="lineNum">     991 </span>                : 
<span class="lineNum">     992 </span><span class="lineCov">           1126 :                 if (call_via_handler) {</span>
<span class="lineNum">     993 </span>                :                         /* We must re-initialize function again */
<span class="lineNum">     994 </span><span class="lineNoCov">              0 :                         fci_cache-&gt;initialized = 0;</span>
<span class="lineNum">     995 </span>                :                 }
<span class="lineNum">     996 </span>                :         } else { /* ZEND_OVERLOADED_FUNCTION */
<span class="lineNum">     997 </span><span class="lineNoCov">              0 :                 ALLOC_INIT_ZVAL(*fci-&gt;retval_ptr_ptr);</span>
<span class="lineNum">     998 </span>                : 
<span class="lineNum">     999 </span>                :                 /* Not sure what should be done here if it's a static method */
<span class="lineNum">    1000 </span><span class="lineNoCov">              0 :                 if (fci-&gt;object_ptr) {</span>
<span class="lineNum">    1001 </span><span class="lineNoCov">              0 :                         Z_OBJ_HT_P(fci-&gt;object_ptr)-&gt;call_method(EX(function_state).function-&gt;common.function_name, fci-&gt;param_count, *fci-&gt;retval_ptr_ptr, fci-&gt;retval_ptr_ptr, fci-&gt;object_ptr, 1 TSRMLS_CC);</span>
<span class="lineNum">    1002 </span>                :                 } else {
<span class="lineNum">    1003 </span><span class="lineNoCov">              0 :                         zend_error_noreturn(E_ERROR, &quot;Cannot call overloaded function for non-object&quot;);</span>
<span class="lineNum">    1004 </span>                :                 }
<span class="lineNum">    1005 </span>                : 
<span class="lineNum">    1006 </span><span class="lineNoCov">              0 :                 if (EX(function_state).function-&gt;type == ZEND_OVERLOADED_FUNCTION_TEMPORARY) {</span>
<span class="lineNum">    1007 </span><span class="lineNoCov">              0 :                         efree((char*)EX(function_state).function-&gt;common.function_name);</span>
<span class="lineNum">    1008 </span>                :                 }
<span class="lineNum">    1009 </span><span class="lineNoCov">              0 :                 efree(EX(function_state).function);</span>
<span class="lineNum">    1010 </span>                : 
<span class="lineNum">    1011 </span><span class="lineNoCov">              0 :                 if (EG(exception) &amp;&amp; fci-&gt;retval_ptr_ptr) {</span>
<span class="lineNum">    1012 </span><span class="lineNoCov">              0 :                         zval_ptr_dtor(fci-&gt;retval_ptr_ptr);</span>
<span class="lineNum">    1013 </span><span class="lineNoCov">              0 :                         *fci-&gt;retval_ptr_ptr = NULL;</span>
<span class="lineNum">    1014 </span>                :                 }
<span class="lineNum">    1015 </span>                :         }
<span class="lineNum">    1016 </span>                :         zend_vm_stack_clear_multiple(TSRMLS_C);
<span class="lineNum">    1017 </span>                : 
<span class="lineNum">    1018 </span><span class="lineCov">           1348 :         if (EG(This)) {</span>
<span class="lineNum">    1019 </span><span class="lineCov">           1128 :                 zval_ptr_dtor(&amp;EG(This));</span>
<span class="lineNum">    1020 </span>                :         }
<span class="lineNum">    1021 </span><span class="lineCov">           1348 :         EG(called_scope) = current_called_scope;</span>
<span class="lineNum">    1022 </span><span class="lineCov">           1348 :         EG(scope) = current_scope;</span>
<span class="lineNum">    1023 </span><span class="lineCov">           1348 :         EG(This) = current_this;</span>
<span class="lineNum">    1024 </span><span class="lineCov">           1348 :         EG(current_execute_data) = EX(prev_execute_data);</span>
<span class="lineNum">    1025 </span>                : 
<span class="lineNum">    1026 </span><span class="lineCov">           1348 :         if (EG(exception)) {</span>
<span class="lineNum">    1027 </span><span class="lineCov">              2 :                 zend_throw_exception_internal(NULL TSRMLS_CC);</span>
<span class="lineNum">    1028 </span>                :         }
<span class="lineNum">    1029 </span><span class="lineCov">           1348 :         return SUCCESS;</span>
<span class="lineNum">    1030 </span>                : }
<a name="1031"><span class="lineNum">    1031 </span>                : /* }}} */</a>
<span class="lineNum">    1032 </span>                : 
<span class="lineNum">    1033 </span><span class="lineCov">            125 : ZEND_API int zend_lookup_class_ex(const char *name, int name_length, const zend_literal *key, int use_autoload, zend_class_entry ***ce TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">    1034 </span>                : {
<span class="lineNum">    1035 </span>                :         zval **args[1];
<span class="lineNum">    1036 </span>                :         zval autoload_function;
<span class="lineNum">    1037 </span>                :         zval *class_name_ptr;
<span class="lineNum">    1038 </span><span class="lineCov">            125 :         zval *retval_ptr = NULL;</span>
<span class="lineNum">    1039 </span>                :         int retval, lc_length;
<span class="lineNum">    1040 </span>                :         char *lc_name;
<span class="lineNum">    1041 </span>                :         char *lc_free;
<span class="lineNum">    1042 </span>                :         zend_fcall_info fcall_info;
<span class="lineNum">    1043 </span>                :         zend_fcall_info_cache fcall_cache;
<span class="lineNum">    1044 </span><span class="lineCov">            125 :         char dummy = 1;</span>
<span class="lineNum">    1045 </span>                :         ulong hash;
<span class="lineNum">    1046 </span>                :         ALLOCA_FLAG(use_heap)
<span class="lineNum">    1047 </span>                : 
<span class="lineNum">    1048 </span><span class="lineCov">            125 :         if (key) {</span>
<span class="lineNum">    1049 </span><span class="lineCov">            120 :                 lc_name = Z_STRVAL(key-&gt;constant);</span>
<span class="lineNum">    1050 </span><span class="lineCov">            120 :                 lc_length = Z_STRLEN(key-&gt;constant) + 1;</span>
<span class="lineNum">    1051 </span><span class="lineCov">            120 :                 hash = key-&gt;hash_value;</span>
<span class="lineNum">    1052 </span>                :         } else {
<span class="lineNum">    1053 </span><span class="lineCov">              5 :                 if (name == NULL || !name_length) {</span>
<span class="lineNum">    1054 </span><span class="lineNoCov">              0 :                         return FAILURE;</span>
<span class="lineNum">    1055 </span>                :                 }
<span class="lineNum">    1056 </span>                : 
<span class="lineNum">    1057 </span><span class="lineCov">              5 :                 lc_free = lc_name = do_alloca(name_length + 1, use_heap);</span>
<span class="lineNum">    1058 </span><span class="lineCov">              5 :                 zend_str_tolower_copy(lc_name, name, name_length);</span>
<span class="lineNum">    1059 </span><span class="lineCov">              5 :                 lc_length = name_length + 1;</span>
<span class="lineNum">    1060 </span>                : 
<span class="lineNum">    1061 </span><span class="lineCov">              5 :                 if (lc_name[0] == '\\') {</span>
<span class="lineNum">    1062 </span><span class="lineNoCov">              0 :                         lc_name += 1;</span>
<span class="lineNum">    1063 </span><span class="lineNoCov">              0 :                         lc_length -= 1;</span>
<span class="lineNum">    1064 </span>                :                 }
<span class="lineNum">    1065 </span>                : 
<span class="lineNum">    1066 </span><span class="lineCov">              5 :                 hash = zend_inline_hash_func(lc_name, lc_length);</span>
<span class="lineNum">    1067 </span>                :         }
<span class="lineNum">    1068 </span>                : 
<span class="lineNum">    1069 </span><span class="lineCov">            125 :         if (zend_hash_quick_find(EG(class_table), lc_name, lc_length, hash, (void **) ce) == SUCCESS) {</span>
<span class="lineNum">    1070 </span><span class="lineCov">            125 :                 if (!key) {</span>
<span class="lineNum">    1071 </span><span class="lineCov">              5 :                         free_alloca(lc_free, use_heap);</span>
<span class="lineNum">    1072 </span>                :                 }
<span class="lineNum">    1073 </span><span class="lineCov">            125 :                 return SUCCESS;</span>
<span class="lineNum">    1074 </span>                :         }
<span class="lineNum">    1075 </span>                : 
<span class="lineNum">    1076 </span>                :         /* The compiler is not-reentrant. Make sure we __autoload() only during run-time
<span class="lineNum">    1077 </span>                :          * (doesn't impact fuctionality of __autoload()
<span class="lineNum">    1078 </span>                :         */
<span class="lineNum">    1079 </span><span class="lineNoCov">              0 :         if (!use_autoload || zend_is_compiling(TSRMLS_C)) {</span>
<span class="lineNum">    1080 </span><span class="lineNoCov">              0 :                 if (!key) {</span>
<span class="lineNum">    1081 </span><span class="lineNoCov">              0 :                         free_alloca(lc_free, use_heap);</span>
<span class="lineNum">    1082 </span>                :                 }
<span class="lineNum">    1083 </span><span class="lineNoCov">              0 :                 return FAILURE;</span>
<span class="lineNum">    1084 </span>                :         }
<span class="lineNum">    1085 </span>                : 
<span class="lineNum">    1086 </span><span class="lineNoCov">              0 :         if (EG(in_autoload) == NULL) {</span>
<span class="lineNum">    1087 </span><span class="lineNoCov">              0 :                 ALLOC_HASHTABLE(EG(in_autoload));</span>
<span class="lineNum">    1088 </span><span class="lineNoCov">              0 :                 zend_hash_init(EG(in_autoload), 0, NULL, NULL, 0);</span>
<span class="lineNum">    1089 </span>                :         }
<span class="lineNum">    1090 </span>                : 
<span class="lineNum">    1091 </span><span class="lineNoCov">              0 :         if (zend_hash_quick_add(EG(in_autoload), lc_name, lc_length, hash, (void**)&amp;dummy, sizeof(char), NULL) == FAILURE) {</span>
<span class="lineNum">    1092 </span><span class="lineNoCov">              0 :                 if (!key) {</span>
<span class="lineNum">    1093 </span><span class="lineNoCov">              0 :                         free_alloca(lc_free, use_heap);</span>
<span class="lineNum">    1094 </span>                :                 }
<span class="lineNum">    1095 </span><span class="lineNoCov">              0 :                 return FAILURE;</span>
<span class="lineNum">    1096 </span>                :         }
<span class="lineNum">    1097 </span>                : 
<span class="lineNum">    1098 </span><span class="lineNoCov">              0 :         ZVAL_STRINGL(&amp;autoload_function, ZEND_AUTOLOAD_FUNC_NAME, sizeof(ZEND_AUTOLOAD_FUNC_NAME) - 1, 0);</span>
<span class="lineNum">    1099 </span>                : 
<span class="lineNum">    1100 </span><span class="lineNoCov">              0 :         ALLOC_ZVAL(class_name_ptr);</span>
<span class="lineNum">    1101 </span><span class="lineNoCov">              0 :         INIT_PZVAL(class_name_ptr);</span>
<span class="lineNum">    1102 </span><span class="lineNoCov">              0 :         if (name[0] == '\\') {</span>
<span class="lineNum">    1103 </span><span class="lineNoCov">              0 :                 ZVAL_STRINGL(class_name_ptr, name+1, name_length-1, 1);</span>
<span class="lineNum">    1104 </span>                :         } else {
<span class="lineNum">    1105 </span><span class="lineNoCov">              0 :                 ZVAL_STRINGL(class_name_ptr, name, name_length, 1);</span>
<span class="lineNum">    1106 </span>                :         }
<span class="lineNum">    1107 </span>                : 
<span class="lineNum">    1108 </span><span class="lineNoCov">              0 :         args[0] = &amp;class_name_ptr;</span>
<span class="lineNum">    1109 </span>                : 
<span class="lineNum">    1110 </span><span class="lineNoCov">              0 :         fcall_info.size = sizeof(fcall_info);</span>
<span class="lineNum">    1111 </span><span class="lineNoCov">              0 :         fcall_info.function_table = EG(function_table);</span>
<span class="lineNum">    1112 </span><span class="lineNoCov">              0 :         fcall_info.function_name = &amp;autoload_function;</span>
<span class="lineNum">    1113 </span><span class="lineNoCov">              0 :         fcall_info.symbol_table = NULL;</span>
<span class="lineNum">    1114 </span><span class="lineNoCov">              0 :         fcall_info.retval_ptr_ptr = &amp;retval_ptr;</span>
<span class="lineNum">    1115 </span><span class="lineNoCov">              0 :         fcall_info.param_count = 1;</span>
<span class="lineNum">    1116 </span><span class="lineNoCov">              0 :         fcall_info.params = args;</span>
<span class="lineNum">    1117 </span><span class="lineNoCov">              0 :         fcall_info.object_ptr = NULL;</span>
<span class="lineNum">    1118 </span><span class="lineNoCov">              0 :         fcall_info.no_separation = 1;</span>
<span class="lineNum">    1119 </span>                : 
<span class="lineNum">    1120 </span><span class="lineNoCov">              0 :         fcall_cache.initialized = EG(autoload_func) ? 1 : 0;</span>
<span class="lineNum">    1121 </span><span class="lineNoCov">              0 :         fcall_cache.function_handler = EG(autoload_func);</span>
<span class="lineNum">    1122 </span><span class="lineNoCov">              0 :         fcall_cache.calling_scope = NULL;</span>
<span class="lineNum">    1123 </span><span class="lineNoCov">              0 :         fcall_cache.called_scope = NULL;</span>
<span class="lineNum">    1124 </span><span class="lineNoCov">              0 :         fcall_cache.object_ptr = NULL;</span>
<span class="lineNum">    1125 </span>                : 
<span class="lineNum">    1126 </span><span class="lineNoCov">              0 :         zend_exception_save(TSRMLS_C);</span>
<span class="lineNum">    1127 </span><span class="lineNoCov">              0 :         retval = zend_call_function(&amp;fcall_info, &amp;fcall_cache TSRMLS_CC);</span>
<span class="lineNum">    1128 </span><span class="lineNoCov">              0 :         zend_exception_restore(TSRMLS_C);</span>
<span class="lineNum">    1129 </span>                : 
<span class="lineNum">    1130 </span><span class="lineNoCov">              0 :         EG(autoload_func) = fcall_cache.function_handler;</span>
<span class="lineNum">    1131 </span>                : 
<span class="lineNum">    1132 </span><span class="lineNoCov">              0 :         zval_ptr_dtor(&amp;class_name_ptr);</span>
<span class="lineNum">    1133 </span>                : 
<span class="lineNum">    1134 </span><span class="lineNoCov">              0 :         zend_hash_quick_del(EG(in_autoload), lc_name, lc_length, hash);</span>
<span class="lineNum">    1135 </span>                : 
<span class="lineNum">    1136 </span><span class="lineNoCov">              0 :         if (retval_ptr) {</span>
<span class="lineNum">    1137 </span><span class="lineNoCov">              0 :                 zval_ptr_dtor(&amp;retval_ptr);</span>
<span class="lineNum">    1138 </span>                :         }
<span class="lineNum">    1139 </span>                : 
<span class="lineNum">    1140 </span><span class="lineNoCov">              0 :         if (retval == SUCCESS) {</span>
<span class="lineNum">    1141 </span><span class="lineNoCov">              0 :                 retval = zend_hash_quick_find(EG(class_table), lc_name, lc_length, hash, (void **) ce);</span>
<span class="lineNum">    1142 </span>                :         }
<span class="lineNum">    1143 </span><span class="lineNoCov">              0 :         if (!key) {</span>
<span class="lineNum">    1144 </span><span class="lineNoCov">              0 :                 free_alloca(lc_free, use_heap);</span>
<span class="lineNum">    1145 </span>                :         }
<span class="lineNum">    1146 </span><span class="lineNoCov">              0 :         return retval;</span>
<span class="lineNum">    1147 </span>                : }
<a name="1148"><span class="lineNum">    1148 </span>                : /* }}} */</a>
<span class="lineNum">    1149 </span>                : 
<span class="lineNum">    1150 </span><span class="lineCov">              1 : ZEND_API int zend_lookup_class(const char *name, int name_length, zend_class_entry ***ce TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">    1151 </span>                : {
<span class="lineNum">    1152 </span><span class="lineCov">              1 :         return zend_lookup_class_ex(name, name_length, NULL, 1, ce TSRMLS_CC);</span>
<span class="lineNum">    1153 </span>                : }
<a name="1154"><span class="lineNum">    1154 </span>                : /* }}} */</a>
<span class="lineNum">    1155 </span>                : 
<span class="lineNum">    1156 </span><span class="lineCov">              3 : ZEND_API int zend_eval_stringl(char *str, int str_len, zval *retval_ptr, char *string_name TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">    1157 </span>                : {
<span class="lineNum">    1158 </span>                :         zval pv;
<span class="lineNum">    1159 </span>                :         zend_op_array *new_op_array;
<span class="lineNum">    1160 </span><span class="lineCov">              3 :         zend_op_array *original_active_op_array = EG(active_op_array);</span>
<span class="lineNum">    1161 </span>                :         zend_uint original_compiler_options;
<span class="lineNum">    1162 </span>                :         int retval;
<span class="lineNum">    1163 </span>                : 
<span class="lineNum">    1164 </span><span class="lineCov">              3 :         if (retval_ptr) {</span>
<span class="lineNum">    1165 </span><span class="lineNoCov">              0 :                 Z_STRLEN(pv) = str_len + sizeof(&quot;return ;&quot;) - 1;</span>
<span class="lineNum">    1166 </span><span class="lineNoCov">              0 :                 Z_STRVAL(pv) = emalloc(Z_STRLEN(pv) + 1);</span>
<span class="lineNum">    1167 </span><span class="lineNoCov">              0 :                 memcpy(Z_STRVAL(pv), &quot;return &quot;, sizeof(&quot;return &quot;) - 1);</span>
<span class="lineNum">    1168 </span><span class="lineNoCov">              0 :                 memcpy(Z_STRVAL(pv) + sizeof(&quot;return &quot;) - 1, str, str_len);</span>
<span class="lineNum">    1169 </span><span class="lineNoCov">              0 :                 Z_STRVAL(pv)[Z_STRLEN(pv) - 1] = ';';</span>
<span class="lineNum">    1170 </span><span class="lineNoCov">              0 :                 Z_STRVAL(pv)[Z_STRLEN(pv)] = '\0';</span>
<span class="lineNum">    1171 </span>                :         } else {
<span class="lineNum">    1172 </span><span class="lineCov">              3 :                 Z_STRLEN(pv) = str_len;</span>
<span class="lineNum">    1173 </span><span class="lineCov">              3 :                 Z_STRVAL(pv) = str;</span>
<span class="lineNum">    1174 </span>                :         }
<span class="lineNum">    1175 </span><span class="lineCov">              3 :         Z_TYPE(pv) = IS_STRING;</span>
<span class="lineNum">    1176 </span>                : 
<span class="lineNum">    1177 </span>                :         /*printf(&quot;Evaluating '%s'\n&quot;, pv.value.str.val);*/
<span class="lineNum">    1178 </span>                : 
<span class="lineNum">    1179 </span><span class="lineCov">              3 :         original_compiler_options = CG(compiler_options);</span>
<span class="lineNum">    1180 </span><span class="lineCov">              3 :         CG(compiler_options) = ZEND_COMPILE_DEFAULT_FOR_EVAL;</span>
<span class="lineNum">    1181 </span><span class="lineCov">              3 :         new_op_array = zend_compile_string(&amp;pv, string_name TSRMLS_CC);</span>
<span class="lineNum">    1182 </span><span class="lineCov">              3 :         CG(compiler_options) = original_compiler_options;</span>
<span class="lineNum">    1183 </span>                : 
<span class="lineNum">    1184 </span><span class="lineCov">              3 :         if (new_op_array) {</span>
<span class="lineNum">    1185 </span><span class="lineCov">              3 :                 zval *local_retval_ptr=NULL;</span>
<span class="lineNum">    1186 </span><span class="lineCov">              3 :                 zval **original_return_value_ptr_ptr = EG(return_value_ptr_ptr);</span>
<span class="lineNum">    1187 </span><span class="lineCov">              3 :                 zend_op **original_opline_ptr = EG(opline_ptr);</span>
<span class="lineNum">    1188 </span><span class="lineCov">              3 :                 int orig_interactive = CG(interactive);</span>
<span class="lineNum">    1189 </span>                : 
<span class="lineNum">    1190 </span><span class="lineCov">              3 :                 EG(return_value_ptr_ptr) = &amp;local_retval_ptr;</span>
<span class="lineNum">    1191 </span><span class="lineCov">              3 :                 EG(active_op_array) = new_op_array;</span>
<span class="lineNum">    1192 </span><span class="lineCov">              3 :                 EG(no_extensions)=1;</span>
<span class="lineNum">    1193 </span><span class="lineCov">              3 :                 if (!EG(active_symbol_table)) {</span>
<span class="lineNum">    1194 </span><span class="lineNoCov">              0 :                         zend_rebuild_symbol_table(TSRMLS_C);</span>
<span class="lineNum">    1195 </span>                :                 }
<span class="lineNum">    1196 </span><span class="lineCov">              3 :                 CG(interactive) = 0;</span>
<span class="lineNum">    1197 </span>                : 
<span class="lineNum">    1198 </span><span class="lineCov">              3 :                 zend_try {</span>
<span class="lineNum">    1199 </span><span class="lineCov">              3 :                         zend_execute(new_op_array TSRMLS_CC);</span>
<span class="lineNum">    1200 </span><span class="lineNoCov">              0 :                 } zend_catch {</span>
<span class="lineNum">    1201 </span><span class="lineNoCov">              0 :                         destroy_op_array(new_op_array TSRMLS_CC);</span>
<span class="lineNum">    1202 </span><span class="lineNoCov">              0 :                         efree(new_op_array);</span>
<span class="lineNum">    1203 </span><span class="lineNoCov">              0 :                         zend_bailout();</span>
<span class="lineNum">    1204 </span><span class="lineCov">              3 :                 } zend_end_try();</span>
<span class="lineNum">    1205 </span>                : 
<span class="lineNum">    1206 </span><span class="lineCov">              3 :                 CG(interactive) = orig_interactive;</span>
<span class="lineNum">    1207 </span><span class="lineCov">              3 :                 if (local_retval_ptr) {</span>
<span class="lineNum">    1208 </span><span class="lineCov">              3 :                         if (retval_ptr) {</span>
<span class="lineNum">    1209 </span><span class="lineNoCov">              0 :                                 COPY_PZVAL_TO_ZVAL(*retval_ptr, local_retval_ptr);</span>
<span class="lineNum">    1210 </span>                :                         } else {
<span class="lineNum">    1211 </span><span class="lineCov">              3 :                                 zval_ptr_dtor(&amp;local_retval_ptr);</span>
<span class="lineNum">    1212 </span>                :                         }
<span class="lineNum">    1213 </span>                :                 } else {
<span class="lineNum">    1214 </span><span class="lineNoCov">              0 :                         if (retval_ptr) {</span>
<span class="lineNum">    1215 </span><span class="lineNoCov">              0 :                                 INIT_ZVAL(*retval_ptr);</span>
<span class="lineNum">    1216 </span>                :                         }
<span class="lineNum">    1217 </span>                :                 }
<span class="lineNum">    1218 </span>                : 
<span class="lineNum">    1219 </span><span class="lineCov">              3 :                 EG(no_extensions)=0;</span>
<span class="lineNum">    1220 </span><span class="lineCov">              3 :                 EG(opline_ptr) = original_opline_ptr;</span>
<span class="lineNum">    1221 </span><span class="lineCov">              3 :                 EG(active_op_array) = original_active_op_array;</span>
<span class="lineNum">    1222 </span><span class="lineCov">              3 :                 destroy_op_array(new_op_array TSRMLS_CC);</span>
<span class="lineNum">    1223 </span><span class="lineCov">              3 :                 efree(new_op_array);</span>
<span class="lineNum">    1224 </span><span class="lineCov">              3 :                 EG(return_value_ptr_ptr) = original_return_value_ptr_ptr;</span>
<span class="lineNum">    1225 </span><span class="lineCov">              3 :                 retval = SUCCESS;</span>
<span class="lineNum">    1226 </span>                :         } else {
<span class="lineNum">    1227 </span><span class="lineNoCov">              0 :                 retval = FAILURE;</span>
<span class="lineNum">    1228 </span>                :         }
<span class="lineNum">    1229 </span><span class="lineCov">              3 :         if (retval_ptr) {</span>
<span class="lineNum">    1230 </span>                :                 zval_dtor(&amp;pv);
<span class="lineNum">    1231 </span>                :         }
<span class="lineNum">    1232 </span><span class="lineCov">              3 :         return retval;</span>
<span class="lineNum">    1233 </span>                : }
<a name="1234"><span class="lineNum">    1234 </span>                : /* }}} */</a>
<span class="lineNum">    1235 </span>                : 
<span class="lineNum">    1236 </span><span class="lineNoCov">              0 : ZEND_API int zend_eval_string(char *str, zval *retval_ptr, char *string_name TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">    1237 </span>                : {
<span class="lineNum">    1238 </span><span class="lineNoCov">              0 :         return zend_eval_stringl(str, strlen(str), retval_ptr, string_name TSRMLS_CC);</span>
<span class="lineNum">    1239 </span>                : }
<a name="1240"><span class="lineNum">    1240 </span>                : /* }}} */</a>
<span class="lineNum">    1241 </span>                : 
<span class="lineNum">    1242 </span><span class="lineCov">              3 : ZEND_API int zend_eval_stringl_ex(char *str, int str_len, zval *retval_ptr, char *string_name, int handle_exceptions TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">    1243 </span>                : {
<span class="lineNum">    1244 </span>                :         int result;
<span class="lineNum">    1245 </span>                : 
<span class="lineNum">    1246 </span><span class="lineCov">              3 :         result = zend_eval_stringl(str, str_len, retval_ptr, string_name TSRMLS_CC);</span>
<span class="lineNum">    1247 </span><span class="lineCov">              3 :         if (handle_exceptions &amp;&amp; EG(exception)) {</span>
<span class="lineNum">    1248 </span><span class="lineNoCov">              0 :                 zend_exception_error(EG(exception), E_ERROR TSRMLS_CC);</span>
<span class="lineNum">    1249 </span><span class="lineNoCov">              0 :                 result = FAILURE;</span>
<span class="lineNum">    1250 </span>                :         }
<span class="lineNum">    1251 </span><span class="lineCov">              3 :         return result;</span>
<span class="lineNum">    1252 </span>                : }
<a name="1253"><span class="lineNum">    1253 </span>                : /* }}} */</a>
<span class="lineNum">    1254 </span>                : 
<span class="lineNum">    1255 </span><span class="lineCov">              3 : ZEND_API int zend_eval_string_ex(char *str, zval *retval_ptr, char *string_name, int handle_exceptions TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">    1256 </span>                : {
<span class="lineNum">    1257 </span><span class="lineCov">              3 :         return zend_eval_stringl_ex(str, strlen(str), retval_ptr, string_name, handle_exceptions TSRMLS_CC);</span>
<span class="lineNum">    1258 </span>                : }
<a name="1259"><span class="lineNum">    1259 </span>                : /* }}} */</a>
<span class="lineNum">    1260 </span>                : 
<span class="lineNum">    1261 </span><span class="lineNoCov">              0 : void execute_new_code(TSRMLS_D) /* {{{ */</span>
<span class="lineNum">    1262 </span>                : {
<span class="lineNum">    1263 </span>                :         zend_op *opline, *end;
<span class="lineNum">    1264 </span>                :         zend_op *ret_opline;
<span class="lineNum">    1265 </span>                :         int orig_interactive;
<span class="lineNum">    1266 </span>                : 
<span class="lineNum">    1267 </span><span class="lineNoCov">              0 :         if (!(CG(active_op_array)-&gt;fn_flags &amp; ZEND_ACC_INTERACTIVE)</span>
<span class="lineNum">    1268 </span>                :                 || CG(context).backpatch_count&gt;0
<span class="lineNum">    1269 </span><span class="lineNoCov">              0 :                 || CG(active_op_array)-&gt;function_name</span>
<span class="lineNum">    1270 </span><span class="lineNoCov">              0 :                 || CG(active_op_array)-&gt;type!=ZEND_USER_FUNCTION) {</span>
<span class="lineNum">    1271 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">    1272 </span>                :         }
<span class="lineNum">    1273 </span>                : 
<span class="lineNum">    1274 </span><span class="lineNoCov">              0 :         ret_opline = get_next_op(CG(active_op_array) TSRMLS_CC);</span>
<span class="lineNum">    1275 </span><span class="lineNoCov">              0 :         ret_opline-&gt;opcode = ZEND_RETURN;</span>
<span class="lineNum">    1276 </span><span class="lineNoCov">              0 :         ret_opline-&gt;op1_type = IS_CONST;</span>
<span class="lineNum">    1277 </span><span class="lineNoCov">              0 :         ret_opline-&gt;op1.constant = zend_add_literal(CG(active_op_array), &amp;EG(uninitialized_zval) TSRMLS_CC);</span>
<span class="lineNum">    1278 </span><span class="lineNoCov">              0 :         SET_UNUSED(ret_opline-&gt;op2);</span>
<span class="lineNum">    1279 </span>                : 
<span class="lineNum">    1280 </span><span class="lineNoCov">              0 :         if (!EG(start_op)) {</span>
<span class="lineNum">    1281 </span><span class="lineNoCov">              0 :                 EG(start_op) = CG(active_op_array)-&gt;opcodes;</span>
<span class="lineNum">    1282 </span>                :         }
<span class="lineNum">    1283 </span>                : 
<span class="lineNum">    1284 </span><span class="lineNoCov">              0 :         opline=EG(start_op);</span>
<span class="lineNum">    1285 </span><span class="lineNoCov">              0 :         end=CG(active_op_array)-&gt;opcodes+CG(active_op_array)-&gt;last;</span>
<span class="lineNum">    1286 </span>                : 
<span class="lineNum">    1287 </span><span class="lineNoCov">              0 :         while (opline&lt;end) {</span>
<span class="lineNum">    1288 </span><span class="lineNoCov">              0 :                 if (opline-&gt;op1_type == IS_CONST) {</span>
<span class="lineNum">    1289 </span><span class="lineNoCov">              0 :                         opline-&gt;op1.zv = &amp;CG(active_op_array)-&gt;literals[opline-&gt;op1.constant].constant;</span>
<span class="lineNum">    1290 </span>                :                 }
<span class="lineNum">    1291 </span><span class="lineNoCov">              0 :                 if (opline-&gt;op2_type == IS_CONST) {</span>
<span class="lineNum">    1292 </span><span class="lineNoCov">              0 :                         opline-&gt;op2.zv = &amp;CG(active_op_array)-&gt;literals[opline-&gt;op2.constant].constant;</span>
<span class="lineNum">    1293 </span>                :                 }
<span class="lineNum">    1294 </span><span class="lineNoCov">              0 :                 switch (opline-&gt;opcode) {</span>
<span class="lineNum">    1295 </span>                :                         case ZEND_GOTO:
<span class="lineNum">    1296 </span><span class="lineNoCov">              0 :                                 if (Z_TYPE_P(opline-&gt;op2.zv) != IS_LONG) {</span>
<span class="lineNum">    1297 </span><span class="lineNoCov">              0 :                                         zend_resolve_goto_label(CG(active_op_array), opline, 1 TSRMLS_CC);</span>
<span class="lineNum">    1298 </span>                :                                 }
<span class="lineNum">    1299 </span>                :                                 /* break omitted intentionally */
<span class="lineNum">    1300 </span>                :                         case ZEND_JMP:
<span class="lineNum">    1301 </span><span class="lineNoCov">              0 :                                 opline-&gt;op1.jmp_addr = &amp;CG(active_op_array)-&gt;opcodes[opline-&gt;op1.opline_num];</span>
<span class="lineNum">    1302 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    1303 </span>                :                         case ZEND_JMPZ:
<span class="lineNum">    1304 </span>                :                         case ZEND_JMPNZ:
<span class="lineNum">    1305 </span>                :                         case ZEND_JMPZ_EX:
<span class="lineNum">    1306 </span>                :                         case ZEND_JMPNZ_EX:
<span class="lineNum">    1307 </span>                :                         case ZEND_JMP_SET:
<span class="lineNum">    1308 </span>                :                         case ZEND_JMP_SET_VAR:
<span class="lineNum">    1309 </span><span class="lineNoCov">              0 :                                 opline-&gt;op2.jmp_addr = &amp;CG(active_op_array)-&gt;opcodes[opline-&gt;op2.opline_num];</span>
<span class="lineNum">    1310 </span>                :                                 break;
<span class="lineNum">    1311 </span>                :                 }
<span class="lineNum">    1312 </span><span class="lineNoCov">              0 :                 ZEND_VM_SET_OPCODE_HANDLER(opline);</span>
<span class="lineNum">    1313 </span><span class="lineNoCov">              0 :                 opline++;</span>
<span class="lineNum">    1314 </span>                :         }
<span class="lineNum">    1315 </span>                :         
<span class="lineNum">    1316 </span><span class="lineNoCov">              0 :         zend_release_labels(TSRMLS_C);</span>
<span class="lineNum">    1317 </span>                :         
<span class="lineNum">    1318 </span><span class="lineNoCov">              0 :         EG(return_value_ptr_ptr) = NULL;</span>
<span class="lineNum">    1319 </span><span class="lineNoCov">              0 :         EG(active_op_array) = CG(active_op_array);</span>
<span class="lineNum">    1320 </span><span class="lineNoCov">              0 :         orig_interactive = CG(interactive);</span>
<span class="lineNum">    1321 </span><span class="lineNoCov">              0 :         CG(interactive) = 0;</span>
<span class="lineNum">    1322 </span><span class="lineNoCov">              0 :         zend_execute(CG(active_op_array) TSRMLS_CC);</span>
<span class="lineNum">    1323 </span><span class="lineNoCov">              0 :         CG(interactive) = orig_interactive;</span>
<span class="lineNum">    1324 </span>                : 
<span class="lineNum">    1325 </span><span class="lineNoCov">              0 :         if (EG(exception)) {</span>
<span class="lineNum">    1326 </span><span class="lineNoCov">              0 :                 zend_exception_error(EG(exception), E_ERROR TSRMLS_CC);</span>
<span class="lineNum">    1327 </span>                :         }
<span class="lineNum">    1328 </span>                : 
<span class="lineNum">    1329 </span><span class="lineNoCov">              0 :         CG(active_op_array)-&gt;last -= 1;      /* get rid of that ZEND_RETURN */</span>
<span class="lineNum">    1330 </span><span class="lineNoCov">              0 :         EG(start_op) = CG(active_op_array)-&gt;opcodes+CG(active_op_array)-&gt;last;</span>
<span class="lineNum">    1331 </span>                : }
<a name="1332"><span class="lineNum">    1332 </span>                : /* }}} */</a>
<span class="lineNum">    1333 </span>                : 
<span class="lineNum">    1334 </span><span class="lineNoCov">              0 : ZEND_API void zend_timeout(int dummy) /* {{{ */</span>
<span class="lineNum">    1335 </span>                : {
<span class="lineNum">    1336 </span>                :         TSRMLS_FETCH();
<span class="lineNum">    1337 </span>                : 
<span class="lineNum">    1338 </span><span class="lineNoCov">              0 :         if (zend_on_timeout) {</span>
<span class="lineNum">    1339 </span>                : #ifdef ZEND_SIGNALS
<span class="lineNum">    1340 </span>                :                 /* 
<span class="lineNum">    1341 </span>                :                    We got here because we got a timeout signal, so we are in a signal handler
<span class="lineNum">    1342 </span>                :                    at this point. However, we want to be able to timeout any user-supplied
<span class="lineNum">    1343 </span>                :                    shutdown functions, so pretend we are not in a signal handler while we are
<span class="lineNum">    1344 </span>                :                    calling these 
<span class="lineNum">    1345 </span>                :                 */
<span class="lineNum">    1346 </span>                :                 SIGG(running) = 0;
<span class="lineNum">    1347 </span>                : #endif
<span class="lineNum">    1348 </span><span class="lineNoCov">              0 :                 zend_on_timeout(EG(timeout_seconds) TSRMLS_CC);</span>
<span class="lineNum">    1349 </span>                :         }
<span class="lineNum">    1350 </span>                : 
<span class="lineNum">    1351 </span><span class="lineNoCov">              0 :         zend_error(E_ERROR, &quot;Maximum execution time of %d second%s exceeded&quot;, EG(timeout_seconds), EG(timeout_seconds) == 1 ? &quot;&quot; : &quot;s&quot;);</span>
<span class="lineNum">    1352 </span><span class="lineNoCov">              0 : }</span>
<span class="lineNum">    1353 </span>                : /* }}} */
<span class="lineNum">    1354 </span>                : 
<span class="lineNum">    1355 </span>                : #ifdef ZEND_WIN32
<span class="lineNum">    1356 </span>                : static LRESULT CALLBACK zend_timeout_WndProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam) /* {{{ */
<span class="lineNum">    1357 </span>                : {
<span class="lineNum">    1358 </span>                :         switch (message) {
<span class="lineNum">    1359 </span>                :                 case WM_DESTROY:
<span class="lineNum">    1360 </span>                :                         PostQuitMessage(0);
<span class="lineNum">    1361 </span>                :                         break;
<span class="lineNum">    1362 </span>                :                 case WM_REGISTER_ZEND_TIMEOUT:
<span class="lineNum">    1363 </span>                :                         /* wParam is the thread id pointer, lParam is the timeout amount in seconds */
<span class="lineNum">    1364 </span>                :                         if (lParam == 0) {
<span class="lineNum">    1365 </span>                :                                 KillTimer(timeout_window, wParam);
<span class="lineNum">    1366 </span>                :                         } else {
<span class="lineNum">    1367 </span>                : #ifdef ZTS
<span class="lineNum">    1368 </span>                :                                 void ***tsrm_ls;
<span class="lineNum">    1369 </span>                : #endif
<span class="lineNum">    1370 </span>                :                                 SetTimer(timeout_window, wParam, lParam*1000, NULL);
<span class="lineNum">    1371 </span>                : #ifdef ZTS
<span class="lineNum">    1372 </span>                :                                 tsrm_ls = ts_resource_ex(0, &amp;wParam);
<span class="lineNum">    1373 </span>                :                                 if (!tsrm_ls) {
<span class="lineNum">    1374 </span>                :                                         /* shouldn't normally happen */
<span class="lineNum">    1375 </span>                :                                         break;
<span class="lineNum">    1376 </span>                :                                 }
<span class="lineNum">    1377 </span>                : #endif
<span class="lineNum">    1378 </span>                :                                 EG(timed_out) = 0;
<span class="lineNum">    1379 </span>                :                         }
<span class="lineNum">    1380 </span>                :                         break;
<span class="lineNum">    1381 </span>                :                 case WM_UNREGISTER_ZEND_TIMEOUT:
<span class="lineNum">    1382 </span>                :                         /* wParam is the thread id pointer */
<span class="lineNum">    1383 </span>                :                         KillTimer(timeout_window, wParam);
<span class="lineNum">    1384 </span>                :                         break;
<span class="lineNum">    1385 </span>                :                 case WM_TIMER: {
<span class="lineNum">    1386 </span>                : #ifdef ZTS
<span class="lineNum">    1387 </span>                :                                 void ***tsrm_ls;
<span class="lineNum">    1388 </span>                : 
<span class="lineNum">    1389 </span>                :                                 tsrm_ls = ts_resource_ex(0, &amp;wParam);
<span class="lineNum">    1390 </span>                :                                 if (!tsrm_ls) {
<span class="lineNum">    1391 </span>                :                                         /* Thread died before receiving its timeout? */
<span class="lineNum">    1392 </span>                :                                         break;
<span class="lineNum">    1393 </span>                :                                 }
<span class="lineNum">    1394 </span>                : #endif
<span class="lineNum">    1395 </span>                :                                 KillTimer(timeout_window, wParam);
<span class="lineNum">    1396 </span>                :                                 EG(timed_out) = 1;
<span class="lineNum">    1397 </span>                :                         }
<span class="lineNum">    1398 </span>                :                         break;
<span class="lineNum">    1399 </span>                :                 default:
<span class="lineNum">    1400 </span>                :                         return DefWindowProc(hWnd, message, wParam, lParam);
<span class="lineNum">    1401 </span>                :         }
<span class="lineNum">    1402 </span>                :         return 0;
<span class="lineNum">    1403 </span>                : }
<span class="lineNum">    1404 </span>                : /* }}} */
<span class="lineNum">    1405 </span>                : 
<span class="lineNum">    1406 </span>                : static unsigned __stdcall timeout_thread_proc(void *pArgs) /* {{{ */
<span class="lineNum">    1407 </span>                : {
<span class="lineNum">    1408 </span>                :         MSG message;
<span class="lineNum">    1409 </span>                : 
<span class="lineNum">    1410 </span>                :         wc.style=0;
<span class="lineNum">    1411 </span>                :         wc.lpfnWndProc = zend_timeout_WndProc;
<span class="lineNum">    1412 </span>                :         wc.cbClsExtra=0;
<span class="lineNum">    1413 </span>                :         wc.cbWndExtra=0;
<span class="lineNum">    1414 </span>                :         wc.hInstance=NULL;
<span class="lineNum">    1415 </span>                :         wc.hIcon=NULL;
<span class="lineNum">    1416 </span>                :         wc.hCursor=NULL;
<span class="lineNum">    1417 </span>                :         wc.hbrBackground=(HBRUSH)(COLOR_BACKGROUND + 5);
<span class="lineNum">    1418 </span>                :         wc.lpszMenuName=NULL;
<span class="lineNum">    1419 </span>                :         wc.lpszClassName = &quot;Zend Timeout Window&quot;;
<span class="lineNum">    1420 </span>                :         if (!RegisterClass(&amp;wc)) {
<span class="lineNum">    1421 </span>                :                 return -1;
<span class="lineNum">    1422 </span>                :         }
<span class="lineNum">    1423 </span>                :         timeout_window = CreateWindow(wc.lpszClassName, wc.lpszClassName, 0, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, NULL, NULL, NULL, NULL);
<span class="lineNum">    1424 </span>                :         SetEvent(timeout_thread_event);
<span class="lineNum">    1425 </span>                :         while (GetMessage(&amp;message, NULL, 0, 0)) {
<span class="lineNum">    1426 </span>                :                 SendMessage(timeout_window, message.message, message.wParam, message.lParam);
<span class="lineNum">    1427 </span>                :                 if (message.message == WM_QUIT) {
<span class="lineNum">    1428 </span>                :                         break;
<span class="lineNum">    1429 </span>                :                 }
<span class="lineNum">    1430 </span>                :         }
<span class="lineNum">    1431 </span>                :         DestroyWindow(timeout_window);
<span class="lineNum">    1432 </span>                :         UnregisterClass(wc.lpszClassName, NULL);
<span class="lineNum">    1433 </span>                :         SetEvent(timeout_thread_handle);
<span class="lineNum">    1434 </span>                :         return 0;
<span class="lineNum">    1435 </span>                : }
<span class="lineNum">    1436 </span>                : /* }}} */
<span class="lineNum">    1437 </span>                : 
<span class="lineNum">    1438 </span>                : void zend_init_timeout_thread(void) /* {{{ */
<span class="lineNum">    1439 </span>                : {
<span class="lineNum">    1440 </span>                :         timeout_thread_event = CreateEvent(NULL, FALSE, FALSE, NULL);
<span class="lineNum">    1441 </span>                :         timeout_thread_handle = CreateEvent(NULL, FALSE, FALSE, NULL);
<span class="lineNum">    1442 </span>                :         _beginthreadex(NULL, 0, timeout_thread_proc, NULL, 0, &amp;timeout_thread_id);
<span class="lineNum">    1443 </span>                :         WaitForSingleObject(timeout_thread_event, INFINITE);
<span class="lineNum">    1444 </span>                : }
<span class="lineNum">    1445 </span>                : /* }}} */
<span class="lineNum">    1446 </span>                : 
<span class="lineNum">    1447 </span>                : void zend_shutdown_timeout_thread(void) /* {{{ */
<span class="lineNum">    1448 </span>                : {
<span class="lineNum">    1449 </span>                :         if (!timeout_thread_initialized) {
<span class="lineNum">    1450 </span>                :                 return;
<span class="lineNum">    1451 </span>                :         }
<span class="lineNum">    1452 </span>                :         PostThreadMessage(timeout_thread_id, WM_QUIT, 0, 0);
<span class="lineNum">    1453 </span>                : 
<span class="lineNum">    1454 </span>                :         /* Wait for thread termination */
<span class="lineNum">    1455 </span>                :         WaitForSingleObject(timeout_thread_handle, 5000);
<span class="lineNum">    1456 </span>                :         CloseHandle(timeout_thread_handle);
<span class="lineNum">    1457 </span>                :         timeout_thread_initialized = 0;
<span class="lineNum">    1458 </span>                : }
<span class="lineNum">    1459 </span>                : /* }}} */
<span class="lineNum">    1460 </span>                : 
<span class="lineNum">    1461 </span>                : #endif
<span class="lineNum">    1462 </span>                : 
<span class="lineNum">    1463 </span>                : /* This one doesn't exists on QNX */
<span class="lineNum">    1464 </span>                : #ifndef SIGPROF
<span class="lineNum">    1465 </span>                : #define SIGPROF 27
<a name="1466"><span class="lineNum">    1466 </span>                : #endif</a>
<span class="lineNum">    1467 </span>                : 
<span class="lineNum">    1468 </span><span class="lineCov">             50 : void zend_set_timeout(long seconds, int reset_signals) /* {{{ */</span>
<span class="lineNum">    1469 </span>                : {
<span class="lineNum">    1470 </span>                :         TSRMLS_FETCH();
<span class="lineNum">    1471 </span>                : 
<span class="lineNum">    1472 </span><span class="lineCov">             50 :         EG(timeout_seconds) = seconds;</span>
<span class="lineNum">    1473 </span>                : 
<span class="lineNum">    1474 </span>                : #ifdef ZEND_WIN32
<span class="lineNum">    1475 </span>                :         if(!seconds) {
<span class="lineNum">    1476 </span>                :                 return;
<span class="lineNum">    1477 </span>                :         }
<span class="lineNum">    1478 </span>                :         if (timeout_thread_initialized == 0 &amp;&amp; InterlockedIncrement(&amp;timeout_thread_initialized) == 1) {
<span class="lineNum">    1479 </span>                :                 /* We start up this process-wide thread here and not in zend_startup(), because if Zend
<span class="lineNum">    1480 </span>                :                  * is initialized inside a DllMain(), you're not supposed to start threads from it.
<span class="lineNum">    1481 </span>                :                  */
<span class="lineNum">    1482 </span>                :                 zend_init_timeout_thread();
<span class="lineNum">    1483 </span>                :         }
<span class="lineNum">    1484 </span>                :         PostThreadMessage(timeout_thread_id, WM_REGISTER_ZEND_TIMEOUT, (WPARAM) GetCurrentThreadId(), (LPARAM) seconds);
<span class="lineNum">    1485 </span>                : #else
<span class="lineNum">    1486 </span>                : #       ifdef HAVE_SETITIMER
<span class="lineNum">    1487 </span>                :         {
<span class="lineNum">    1488 </span>                :                 struct itimerval t_r;           /* timeout requested */
<span class="lineNum">    1489 </span>                :                 int signo;
<span class="lineNum">    1490 </span>                : 
<span class="lineNum">    1491 </span><span class="lineCov">             50 :                 if(seconds) {</span>
<span class="lineNum">    1492 </span><span class="lineNoCov">              0 :                         t_r.it_value.tv_sec = seconds;</span>
<span class="lineNum">    1493 </span><span class="lineNoCov">              0 :                         t_r.it_value.tv_usec = t_r.it_interval.tv_sec = t_r.it_interval.tv_usec = 0;</span>
<span class="lineNum">    1494 </span>                : 
<span class="lineNum">    1495 </span>                : #       ifdef __CYGWIN__
<span class="lineNum">    1496 </span>                :                         setitimer(ITIMER_REAL, &amp;t_r, NULL);
<span class="lineNum">    1497 </span>                :                 }
<span class="lineNum">    1498 </span>                :                 signo = SIGALRM;
<span class="lineNum">    1499 </span>                : #       else
<span class="lineNum">    1500 </span><span class="lineNoCov">              0 :                         setitimer(ITIMER_PROF, &amp;t_r, NULL);</span>
<span class="lineNum">    1501 </span>                :                 }
<span class="lineNum">    1502 </span><span class="lineCov">             50 :                 signo = SIGPROF;</span>
<span class="lineNum">    1503 </span>                : #       endif
<span class="lineNum">    1504 </span>                : 
<span class="lineNum">    1505 </span><span class="lineCov">             50 :                 if (reset_signals) {</span>
<span class="lineNum">    1506 </span>                : #       ifdef ZEND_SIGNALS
<span class="lineNum">    1507 </span>                :                         zend_signal(signo, zend_timeout TSRMLS_CC);
<span class="lineNum">    1508 </span>                : #       else
<span class="lineNum">    1509 </span>                :                         sigset_t sigset;
<span class="lineNum">    1510 </span>                : 
<span class="lineNum">    1511 </span><span class="lineCov">             48 :                         signal(signo, zend_timeout);</span>
<span class="lineNum">    1512 </span><span class="lineCov">             48 :                         sigemptyset(&amp;sigset);</span>
<span class="lineNum">    1513 </span><span class="lineCov">             48 :                         sigaddset(&amp;sigset, signo);</span>
<span class="lineNum">    1514 </span><span class="lineCov">             48 :                         sigprocmask(SIG_UNBLOCK, &amp;sigset, NULL);</span>
<span class="lineNum">    1515 </span>                : #       endif
<span class="lineNum">    1516 </span>                :                 }
<span class="lineNum">    1517 </span>                :         }
<span class="lineNum">    1518 </span>                : #       endif /* HAVE_SETITIMER */
<span class="lineNum">    1519 </span>                : #endif
<span class="lineNum">    1520 </span><span class="lineCov">             50 : }</span>
<a name="1521"><span class="lineNum">    1521 </span>                : /* }}} */</a>
<span class="lineNum">    1522 </span>                : 
<span class="lineNum">    1523 </span><span class="lineCov">             98 : void zend_unset_timeout(TSRMLS_D) /* {{{ */</span>
<span class="lineNum">    1524 </span>                : {
<span class="lineNum">    1525 </span>                : #ifdef ZEND_WIN32
<span class="lineNum">    1526 </span>                :         if(timeout_thread_initialized) {
<span class="lineNum">    1527 </span>                :                 PostThreadMessage(timeout_thread_id, WM_UNREGISTER_ZEND_TIMEOUT, (WPARAM) GetCurrentThreadId(), (LPARAM) 0);
<span class="lineNum">    1528 </span>                :         }
<span class="lineNum">    1529 </span>                : #else
<span class="lineNum">    1530 </span>                : #       ifdef HAVE_SETITIMER
<span class="lineNum">    1531 </span><span class="lineCov">             98 :         if (EG(timeout_seconds)) {</span>
<span class="lineNum">    1532 </span>                :                 struct itimerval no_timeout;
<span class="lineNum">    1533 </span>                : 
<span class="lineNum">    1534 </span><span class="lineNoCov">              0 :                 no_timeout.it_value.tv_sec = no_timeout.it_value.tv_usec = no_timeout.it_interval.tv_sec = no_timeout.it_interval.tv_usec = 0;</span>
<span class="lineNum">    1535 </span>                : 
<span class="lineNum">    1536 </span>                : #ifdef __CYGWIN__
<span class="lineNum">    1537 </span>                :                 setitimer(ITIMER_REAL, &amp;no_timeout, NULL);
<span class="lineNum">    1538 </span>                : #else
<span class="lineNum">    1539 </span><span class="lineNoCov">              0 :                 setitimer(ITIMER_PROF, &amp;no_timeout, NULL);</span>
<span class="lineNum">    1540 </span>                : #endif
<span class="lineNum">    1541 </span>                :         }
<span class="lineNum">    1542 </span>                : #       endif
<span class="lineNum">    1543 </span>                : #endif
<span class="lineNum">    1544 </span><span class="lineCov">             98 : }</span>
<a name="1545"><span class="lineNum">    1545 </span>                : /* }}} */</a>
<span class="lineNum">    1546 </span>                : 
<span class="lineNum">    1547 </span><span class="lineCov">             12 : zend_class_entry *zend_fetch_class(const char *class_name, uint class_name_len, int fetch_type TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">    1548 </span>                : {
<span class="lineNum">    1549 </span>                :         zend_class_entry **pce;
<span class="lineNum">    1550 </span><span class="lineCov">             12 :         int use_autoload = (fetch_type &amp; ZEND_FETCH_CLASS_NO_AUTOLOAD) == 0;</span>
<span class="lineNum">    1551 </span><span class="lineCov">             12 :         int silent       = (fetch_type &amp; ZEND_FETCH_CLASS_SILENT) != 0;</span>
<span class="lineNum">    1552 </span>                : 
<span class="lineNum">    1553 </span><span class="lineCov">             12 :         fetch_type &amp;= ZEND_FETCH_CLASS_MASK;</span>
<span class="lineNum">    1554 </span>                : 
<span class="lineNum">    1555 </span>                : check_fetch_type:
<span class="lineNum">    1556 </span><span class="lineCov">             12 :         switch (fetch_type) {</span>
<span class="lineNum">    1557 </span>                :                 case ZEND_FETCH_CLASS_SELF:
<span class="lineNum">    1558 </span><span class="lineNoCov">              0 :                         if (!EG(scope)) {</span>
<span class="lineNum">    1559 </span><span class="lineNoCov">              0 :                                 zend_error(E_ERROR, &quot;Cannot access self:: when no class scope is active&quot;);</span>
<span class="lineNum">    1560 </span>                :                         }
<span class="lineNum">    1561 </span><span class="lineNoCov">              0 :                         return EG(scope);</span>
<span class="lineNum">    1562 </span>                :                 case ZEND_FETCH_CLASS_PARENT:
<span class="lineNum">    1563 </span><span class="lineCov">              8 :                         if (!EG(scope)) {</span>
<span class="lineNum">    1564 </span><span class="lineNoCov">              0 :                                 zend_error(E_ERROR, &quot;Cannot access parent:: when no class scope is active&quot;);</span>
<span class="lineNum">    1565 </span>                :                         }
<span class="lineNum">    1566 </span><span class="lineCov">              8 :                         if (!EG(scope)-&gt;parent) {</span>
<span class="lineNum">    1567 </span><span class="lineNoCov">              0 :                                 zend_error(E_ERROR, &quot;Cannot access parent:: when current class scope has no parent&quot;);</span>
<span class="lineNum">    1568 </span>                :                         }
<span class="lineNum">    1569 </span><span class="lineCov">              8 :                         return EG(scope)-&gt;parent;</span>
<span class="lineNum">    1570 </span>                :                 case ZEND_FETCH_CLASS_STATIC:
<span class="lineNum">    1571 </span><span class="lineNoCov">              0 :                         if (!EG(called_scope)) {</span>
<span class="lineNum">    1572 </span><span class="lineNoCov">              0 :                                 zend_error(E_ERROR, &quot;Cannot access static:: when no class scope is active&quot;);</span>
<span class="lineNum">    1573 </span>                :                         }
<span class="lineNum">    1574 </span><span class="lineNoCov">              0 :                         return EG(called_scope);</span>
<span class="lineNum">    1575 </span>                :                 case ZEND_FETCH_CLASS_AUTO: {
<span class="lineNum">    1576 </span><span class="lineCov">              4 :                                 fetch_type = zend_get_class_fetch_type(class_name, class_name_len);</span>
<span class="lineNum">    1577 </span><span class="lineCov">              4 :                                 if (fetch_type!=ZEND_FETCH_CLASS_DEFAULT) {</span>
<span class="lineNum">    1578 </span><span class="lineNoCov">              0 :                                         goto check_fetch_type;</span>
<span class="lineNum">    1579 </span>                :                                 }
<span class="lineNum">    1580 </span>                :                         }
<span class="lineNum">    1581 </span>                :                         break;
<span class="lineNum">    1582 </span>                :         }
<span class="lineNum">    1583 </span>                : 
<span class="lineNum">    1584 </span><span class="lineCov">              4 :         if (zend_lookup_class_ex(class_name, class_name_len, NULL, use_autoload, &amp;pce TSRMLS_CC) == FAILURE) {</span>
<span class="lineNum">    1585 </span><span class="lineNoCov">              0 :                 if (use_autoload) {</span>
<span class="lineNum">    1586 </span><span class="lineNoCov">              0 :                         if (!silent &amp;&amp; !EG(exception)) {</span>
<span class="lineNum">    1587 </span><span class="lineNoCov">              0 :                                 if (fetch_type == ZEND_FETCH_CLASS_INTERFACE) {</span>
<span class="lineNum">    1588 </span><span class="lineNoCov">              0 :                                         zend_error(E_ERROR, &quot;Interface '%s' not found&quot;, class_name);</span>
<span class="lineNum">    1589 </span><span class="lineNoCov">              0 :                                 } else if (fetch_type == ZEND_FETCH_CLASS_TRAIT) {</span>
<span class="lineNum">    1590 </span><span class="lineNoCov">              0 :                         zend_error(E_ERROR, &quot;Trait '%s' not found&quot;, class_name);</span>
<span class="lineNum">    1591 </span>                :                 } else {
<span class="lineNum">    1592 </span><span class="lineNoCov">              0 :                                         zend_error(E_ERROR, &quot;Class '%s' not found&quot;, class_name);</span>
<span class="lineNum">    1593 </span>                :                                 }       
<span class="lineNum">    1594 </span>                :                         }
<span class="lineNum">    1595 </span>                :                 }
<span class="lineNum">    1596 </span><span class="lineNoCov">              0 :                 return NULL;</span>
<span class="lineNum">    1597 </span>                :         }
<span class="lineNum">    1598 </span><span class="lineCov">              4 :         return *pce;</span>
<span class="lineNum">    1599 </span>                : }
<a name="1600"><span class="lineNum">    1600 </span>                : /* }}} */</a>
<span class="lineNum">    1601 </span>                : 
<span class="lineNum">    1602 </span><span class="lineCov">            120 : zend_class_entry *zend_fetch_class_by_name(const char *class_name, uint class_name_len, const zend_literal *key, int fetch_type TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">    1603 </span>                : {
<span class="lineNum">    1604 </span>                :         zend_class_entry **pce;
<span class="lineNum">    1605 </span><span class="lineCov">            120 :         int use_autoload = (fetch_type &amp; ZEND_FETCH_CLASS_NO_AUTOLOAD) == 0;</span>
<span class="lineNum">    1606 </span>                : 
<span class="lineNum">    1607 </span><span class="lineCov">            120 :         if (zend_lookup_class_ex(class_name, class_name_len, key, use_autoload, &amp;pce TSRMLS_CC) == FAILURE) {</span>
<span class="lineNum">    1608 </span><span class="lineNoCov">              0 :                 if (use_autoload) {</span>
<span class="lineNum">    1609 </span><span class="lineNoCov">              0 :                         if ((fetch_type &amp; ZEND_FETCH_CLASS_SILENT) == 0 &amp;&amp; !EG(exception)) {</span>
<span class="lineNum">    1610 </span><span class="lineNoCov">              0 :                                 if ((fetch_type &amp; ZEND_FETCH_CLASS_MASK) == ZEND_FETCH_CLASS_INTERFACE) {</span>
<span class="lineNum">    1611 </span><span class="lineNoCov">              0 :                                         zend_error(E_ERROR, &quot;Interface '%s' not found&quot;, class_name);</span>
<span class="lineNum">    1612 </span><span class="lineNoCov">              0 :                                 } else if ((fetch_type &amp; ZEND_FETCH_CLASS_MASK) == ZEND_FETCH_CLASS_TRAIT) {</span>
<span class="lineNum">    1613 </span><span class="lineNoCov">              0 :                                         zend_error(E_ERROR, &quot;Trait '%s' not found&quot;, class_name);</span>
<span class="lineNum">    1614 </span>                :                                 } else {
<span class="lineNum">    1615 </span><span class="lineNoCov">              0 :                                         zend_error(E_ERROR, &quot;Class '%s' not found&quot;, class_name);</span>
<span class="lineNum">    1616 </span>                :                                 }       
<span class="lineNum">    1617 </span>                :                         }
<span class="lineNum">    1618 </span>                :                 }
<span class="lineNum">    1619 </span><span class="lineNoCov">              0 :                 return NULL;</span>
<span class="lineNum">    1620 </span>                :         }
<span class="lineNum">    1621 </span><span class="lineCov">            120 :         return *pce;</span>
<span class="lineNum">    1622 </span>                : }
<span class="lineNum">    1623 </span>                : /* }}} */
<span class="lineNum">    1624 </span>                : 
<span class="lineNum">    1625 </span>                : #define MAX_ABSTRACT_INFO_CNT 3
<span class="lineNum">    1626 </span>                : #define MAX_ABSTRACT_INFO_FMT &quot;%s%s%s%s&quot;
<span class="lineNum">    1627 </span>                : #define DISPLAY_ABSTRACT_FN(idx) \
<span class="lineNum">    1628 </span>                :         ai.afn[idx] ? ZEND_FN_SCOPE_NAME(ai.afn[idx]) : &quot;&quot;, \
<span class="lineNum">    1629 </span>                :         ai.afn[idx] ? &quot;::&quot; : &quot;&quot;, \
<span class="lineNum">    1630 </span>                :         ai.afn[idx] ? ai.afn[idx]-&gt;common.function_name : &quot;&quot;, \
<span class="lineNum">    1631 </span>                :         ai.afn[idx] &amp;&amp; ai.afn[idx + 1] ? &quot;, &quot; : (ai.afn[idx] &amp;&amp; ai.cnt &gt; MAX_ABSTRACT_INFO_CNT ? &quot;, ...&quot; : &quot;&quot;)
<span class="lineNum">    1632 </span>                : 
<span class="lineNum">    1633 </span>                : typedef struct _zend_abstract_info {
<span class="lineNum">    1634 </span>                :         zend_function *afn[MAX_ABSTRACT_INFO_CNT + 1];
<span class="lineNum">    1635 </span>                :         int cnt;
<span class="lineNum">    1636 </span>                :         int ctor;
<a name="1637"><span class="lineNum">    1637 </span>                : } zend_abstract_info;</a>
<span class="lineNum">    1638 </span>                : 
<span class="lineNum">    1639 </span><span class="lineNoCov">              0 : static int zend_verify_abstract_class_function(zend_function *fn, zend_abstract_info *ai TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">    1640 </span>                : {
<span class="lineNum">    1641 </span><span class="lineNoCov">              0 :         if (fn-&gt;common.fn_flags &amp; ZEND_ACC_ABSTRACT) {</span>
<span class="lineNum">    1642 </span><span class="lineNoCov">              0 :                 if (ai-&gt;cnt &lt; MAX_ABSTRACT_INFO_CNT) {</span>
<span class="lineNum">    1643 </span><span class="lineNoCov">              0 :                         ai-&gt;afn[ai-&gt;cnt] = fn;</span>
<span class="lineNum">    1644 </span>                :                 }
<span class="lineNum">    1645 </span><span class="lineNoCov">              0 :                 if (fn-&gt;common.fn_flags &amp; ZEND_ACC_CTOR) {</span>
<span class="lineNum">    1646 </span><span class="lineNoCov">              0 :                         if (!ai-&gt;ctor) {</span>
<span class="lineNum">    1647 </span><span class="lineNoCov">              0 :                                 ai-&gt;cnt++;</span>
<span class="lineNum">    1648 </span><span class="lineNoCov">              0 :                                 ai-&gt;ctor = 1;</span>
<span class="lineNum">    1649 </span>                :                         } else {
<span class="lineNum">    1650 </span><span class="lineNoCov">              0 :                                 ai-&gt;afn[ai-&gt;cnt] = NULL;</span>
<span class="lineNum">    1651 </span>                :                         }
<span class="lineNum">    1652 </span>                :                 } else {
<span class="lineNum">    1653 </span><span class="lineNoCov">              0 :                         ai-&gt;cnt++;</span>
<span class="lineNum">    1654 </span>                :                 }
<span class="lineNum">    1655 </span>                :         }
<span class="lineNum">    1656 </span><span class="lineNoCov">              0 :         return 0;</span>
<span class="lineNum">    1657 </span>                : }
<a name="1658"><span class="lineNum">    1658 </span>                : /* }}} */</a>
<span class="lineNum">    1659 </span>                : 
<span class="lineNum">    1660 </span><span class="lineCov">           2308 : void zend_verify_abstract_class(zend_class_entry *ce TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">    1661 </span>                : {
<span class="lineNum">    1662 </span>                :         zend_abstract_info ai;
<span class="lineNum">    1663 </span>                : 
<span class="lineNum">    1664 </span><span class="lineCov">           2308 :         if ((ce-&gt;ce_flags &amp; ZEND_ACC_IMPLICIT_ABSTRACT_CLASS) &amp;&amp; !(ce-&gt;ce_flags &amp; ZEND_ACC_EXPLICIT_ABSTRACT_CLASS)) {</span>
<span class="lineNum">    1665 </span><span class="lineNoCov">              0 :                 memset(&amp;ai, 0, sizeof(ai));</span>
<span class="lineNum">    1666 </span>                : 
<span class="lineNum">    1667 </span><span class="lineNoCov">              0 :                 zend_hash_apply_with_argument(&amp;ce-&gt;function_table, (apply_func_arg_t) zend_verify_abstract_class_function, &amp;ai TSRMLS_CC);</span>
<span class="lineNum">    1668 </span>                : 
<span class="lineNum">    1669 </span><span class="lineNoCov">              0 :                 if (ai.cnt) {</span>
<span class="lineNum">    1670 </span><span class="lineNoCov">              0 :                         zend_error(E_ERROR, &quot;Class %s contains %d abstract method%s and must therefore be declared abstract or implement the remaining methods (&quot; MAX_ABSTRACT_INFO_FMT MAX_ABSTRACT_INFO_FMT MAX_ABSTRACT_INFO_FMT &quot;)&quot;,</span>
<span class="lineNum">    1671 </span>                :                                 ce-&gt;name, ai.cnt,
<span class="lineNum">    1672 </span><span class="lineNoCov">              0 :                                 ai.cnt &gt; 1 ? &quot;s&quot; : &quot;&quot;,</span>
<span class="lineNum">    1673 </span><span class="lineNoCov">              0 :                                 DISPLAY_ABSTRACT_FN(0),</span>
<span class="lineNum">    1674 </span><span class="lineNoCov">              0 :                                 DISPLAY_ABSTRACT_FN(1),</span>
<span class="lineNum">    1675 </span><span class="lineNoCov">              0 :                                 DISPLAY_ABSTRACT_FN(2)</span>
<span class="lineNum">    1676 </span>                :                                 );
<span class="lineNum">    1677 </span>                :                 }
<span class="lineNum">    1678 </span>                :         }
<span class="lineNum">    1679 </span><span class="lineCov">           2308 : }</span>
<a name="1680"><span class="lineNum">    1680 </span>                : /* }}} */</a>
<span class="lineNum">    1681 </span>                : 
<span class="lineNum">    1682 </span><span class="lineNoCov">              0 : ZEND_API void zend_reset_all_cv(HashTable *symbol_table TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">    1683 </span>                : {
<span class="lineNum">    1684 </span>                :         zend_execute_data *ex;
<span class="lineNum">    1685 </span>                :         int i;
<span class="lineNum">    1686 </span>                : 
<span class="lineNum">    1687 </span><span class="lineNoCov">              0 :         for (ex = EG(current_execute_data); ex; ex = ex-&gt;prev_execute_data) {</span>
<span class="lineNum">    1688 </span><span class="lineNoCov">              0 :                 if (ex-&gt;op_array &amp;&amp; ex-&gt;symbol_table == symbol_table) {</span>
<span class="lineNum">    1689 </span><span class="lineNoCov">              0 :                         for (i = 0; i &lt; ex-&gt;op_array-&gt;last_var; i++) {</span>
<span class="lineNum">    1690 </span><span class="lineNoCov">              0 :                                 ex-&gt;CVs[i] = NULL;</span>
<span class="lineNum">    1691 </span>                :                         }
<span class="lineNum">    1692 </span>                :                 }
<span class="lineNum">    1693 </span>                :         }
<span class="lineNum">    1694 </span><span class="lineNoCov">              0 : }</span>
<a name="1695"><span class="lineNum">    1695 </span>                : /* }}} */</a>
<span class="lineNum">    1696 </span>                : 
<span class="lineNum">    1697 </span><span class="lineNoCov">              0 : ZEND_API void zend_delete_variable(zend_execute_data *ex, HashTable *ht, const char *name, int name_len, ulong hash_value TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">    1698 </span>                : {
<span class="lineNum">    1699 </span><span class="lineNoCov">              0 :         if (zend_hash_quick_del(ht, name, name_len, hash_value) == SUCCESS) {</span>
<span class="lineNum">    1700 </span><span class="lineNoCov">              0 :                 name_len--;</span>
<span class="lineNum">    1701 </span><span class="lineNoCov">              0 :                 while (ex &amp;&amp; ex-&gt;symbol_table == ht) {</span>
<span class="lineNum">    1702 </span>                :                         int i;
<span class="lineNum">    1703 </span>                : 
<span class="lineNum">    1704 </span><span class="lineNoCov">              0 :                         if (ex-&gt;op_array) {</span>
<span class="lineNum">    1705 </span><span class="lineNoCov">              0 :                                 for (i = 0; i &lt; ex-&gt;op_array-&gt;last_var; i++) {</span>
<span class="lineNum">    1706 </span><span class="lineNoCov">              0 :                                         if (ex-&gt;op_array-&gt;vars[i].hash_value == hash_value &amp;&amp;</span>
<span class="lineNum">    1707 </span><span class="lineNoCov">              0 :                                                 ex-&gt;op_array-&gt;vars[i].name_len == name_len &amp;&amp;</span>
<span class="lineNum">    1708 </span><span class="lineNoCov">              0 :                                                 !memcmp(ex-&gt;op_array-&gt;vars[i].name, name, name_len)) {</span>
<span class="lineNum">    1709 </span><span class="lineNoCov">              0 :                                                 ex-&gt;CVs[i] = NULL;</span>
<span class="lineNum">    1710 </span><span class="lineNoCov">              0 :                                                 break;</span>
<span class="lineNum">    1711 </span>                :                                         }
<span class="lineNum">    1712 </span>                :                                 }
<span class="lineNum">    1713 </span>                :                         }
<span class="lineNum">    1714 </span><span class="lineNoCov">              0 :                         ex = ex-&gt;prev_execute_data;</span>
<span class="lineNum">    1715 </span>                :                 }
<span class="lineNum">    1716 </span>                :         }
<span class="lineNum">    1717 </span><span class="lineNoCov">              0 : }</span>
<a name="1718"><span class="lineNum">    1718 </span>                : /* }}} */</a>
<span class="lineNum">    1719 </span>                : 
<span class="lineNum">    1720 </span><span class="lineNoCov">              0 : ZEND_API int zend_delete_global_variable_ex(const char *name, int name_len, ulong hash_value TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">    1721 </span>                : {
<span class="lineNum">    1722 </span>                :         zend_execute_data *ex;
<span class="lineNum">    1723 </span>                : 
<span class="lineNum">    1724 </span><span class="lineNoCov">              0 :         if (zend_hash_quick_exists(&amp;EG(symbol_table), name, name_len + 1, hash_value)) {</span>
<span class="lineNum">    1725 </span><span class="lineNoCov">              0 :                 for (ex = EG(current_execute_data); ex; ex = ex-&gt;prev_execute_data) {</span>
<span class="lineNum">    1726 </span><span class="lineNoCov">              0 :                         if (ex-&gt;op_array &amp;&amp; ex-&gt;symbol_table == &amp;EG(symbol_table)) {</span>
<span class="lineNum">    1727 </span>                :                                 int i;
<span class="lineNum">    1728 </span><span class="lineNoCov">              0 :                                 for (i = 0; i &lt; ex-&gt;op_array-&gt;last_var; i++) {</span>
<span class="lineNum">    1729 </span><span class="lineNoCov">              0 :                                         if (ex-&gt;op_array-&gt;vars[i].hash_value == hash_value &amp;&amp;</span>
<span class="lineNum">    1730 </span><span class="lineNoCov">              0 :                                                 ex-&gt;op_array-&gt;vars[i].name_len == name_len &amp;&amp;</span>
<span class="lineNum">    1731 </span><span class="lineNoCov">              0 :                                                 !memcmp(ex-&gt;op_array-&gt;vars[i].name, name, name_len)</span>
<span class="lineNum">    1732 </span>                :                                         ) {
<span class="lineNum">    1733 </span><span class="lineNoCov">              0 :                                                 ex-&gt;CVs[i] = NULL;</span>
<span class="lineNum">    1734 </span><span class="lineNoCov">              0 :                                                 break;</span>
<span class="lineNum">    1735 </span>                :                                         }
<span class="lineNum">    1736 </span>                :                                 }
<span class="lineNum">    1737 </span>                :                         }
<span class="lineNum">    1738 </span>                :                 }
<span class="lineNum">    1739 </span><span class="lineNoCov">              0 :                 return zend_hash_quick_del(&amp;EG(symbol_table), name, name_len + 1, hash_value);</span>
<span class="lineNum">    1740 </span>                :         }
<span class="lineNum">    1741 </span><span class="lineNoCov">              0 :         return FAILURE;</span>
<span class="lineNum">    1742 </span>                : }
<a name="1743"><span class="lineNum">    1743 </span>                : /* }}} */</a>
<span class="lineNum">    1744 </span>                : 
<span class="lineNum">    1745 </span><span class="lineNoCov">              0 : ZEND_API int zend_delete_global_variable(const char *name, int name_len TSRMLS_DC) /* {{{ */</span>
<span class="lineNum">    1746 </span>                : {
<span class="lineNum">    1747 </span><span class="lineNoCov">              0 :         return zend_delete_global_variable_ex(name, name_len, zend_inline_hash_func(name, name_len + 1) TSRMLS_CC);</span>
<span class="lineNum">    1748 </span>                : }
<a name="1749"><span class="lineNum">    1749 </span>                : /* }}} */</a>
<span class="lineNum">    1750 </span>                : 
<span class="lineNum">    1751 </span><span class="lineCov">             96 : ZEND_API void zend_rebuild_symbol_table(TSRMLS_D) /* {{{ */</span>
<span class="lineNum">    1752 </span>                : {
<span class="lineNum">    1753 </span>                :         zend_uint i;
<span class="lineNum">    1754 </span>                :         zend_execute_data *ex;
<span class="lineNum">    1755 </span>                : 
<span class="lineNum">    1756 </span><span class="lineCov">             96 :         if (!EG(active_symbol_table)) {</span>
<span class="lineNum">    1757 </span>                :                 
<span class="lineNum">    1758 </span>                :                 /* Search for last called user function */
<span class="lineNum">    1759 </span><span class="lineCov">             96 :                 ex = EG(current_execute_data);</span>
<span class="lineNum">    1760 </span><span class="lineCov">            192 :                 while (ex &amp;&amp; !ex-&gt;op_array) {</span>
<span class="lineNum">    1761 </span><span class="lineNoCov">              0 :                         ex = ex-&gt;prev_execute_data;</span>
<span class="lineNum">    1762 </span>                :                 }
<span class="lineNum">    1763 </span><span class="lineCov">             96 :                 if (ex &amp;&amp; ex-&gt;symbol_table) {</span>
<span class="lineNum">    1764 </span><span class="lineNoCov">              0 :                         EG(active_symbol_table) = ex-&gt;symbol_table;</span>
<span class="lineNum">    1765 </span><span class="lineNoCov">              0 :                         return;</span>
<span class="lineNum">    1766 </span>                :                 }
<span class="lineNum">    1767 </span>                : 
<span class="lineNum">    1768 </span><span class="lineCov">             96 :                 if (ex &amp;&amp; ex-&gt;op_array) {</span>
<span class="lineNum">    1769 </span><span class="lineCov">             96 :                         if (EG(symtable_cache_ptr)&gt;=EG(symtable_cache)) {</span>
<span class="lineNum">    1770 </span>                :                                 /*printf(&quot;Cache hit!  Reusing %x\n&quot;, symtable_cache[symtable_cache_ptr]);*/
<span class="lineNum">    1771 </span><span class="lineCov">             94 :                                 EG(active_symbol_table) = *(EG(symtable_cache_ptr)--);</span>
<span class="lineNum">    1772 </span>                :                         } else {
<span class="lineNum">    1773 </span><span class="lineCov">              2 :                                 ALLOC_HASHTABLE(EG(active_symbol_table));</span>
<span class="lineNum">    1774 </span><span class="lineCov">              2 :                                 zend_hash_init(EG(active_symbol_table), ex-&gt;op_array-&gt;last_var, NULL, ZVAL_PTR_DTOR, 0);</span>
<span class="lineNum">    1775 </span>                :                                 /*printf(&quot;Cache miss!  Initialized %x\n&quot;, EG(active_symbol_table));*/
<span class="lineNum">    1776 </span>                :                         }
<span class="lineNum">    1777 </span><span class="lineCov">             96 :                         ex-&gt;symbol_table = EG(active_symbol_table);</span>
<span class="lineNum">    1778 </span>                : 
<span class="lineNum">    1779 </span><span class="lineCov">             96 :                         if (ex-&gt;op_array-&gt;this_var != -1 &amp;&amp;</span>
<span class="lineNum">    1780 </span><span class="lineNoCov">              0 :                             !ex-&gt;CVs[ex-&gt;op_array-&gt;this_var] &amp;&amp;</span>
<span class="lineNum">    1781 </span><span class="lineNoCov">              0 :                             EG(This)) {</span>
<span class="lineNum">    1782 </span><span class="lineNoCov">              0 :                                 ex-&gt;CVs[ex-&gt;op_array-&gt;this_var] = (zval**)ex-&gt;CVs + ex-&gt;op_array-&gt;last_var + ex-&gt;op_array-&gt;this_var;</span>
<span class="lineNum">    1783 </span><span class="lineNoCov">              0 :                                 *ex-&gt;CVs[ex-&gt;op_array-&gt;this_var] = EG(This);</span>
<span class="lineNum">    1784 </span>                :                         }
<span class="lineNum">    1785 </span><span class="lineCov">           5502 :                         for (i = 0; i &lt; ex-&gt;op_array-&gt;last_var; i++) {</span>
<span class="lineNum">    1786 </span><span class="lineCov">           5406 :                                 if (ex-&gt;CVs[i]) {</span>
<span class="lineNum">    1787 </span><span class="lineCov">           2052 :                                         zend_hash_quick_update(EG(active_symbol_table),</span>
<span class="lineNum">    1788 </span>                :                                                 ex-&gt;op_array-&gt;vars[i].name,
<span class="lineNum">    1789 </span>                :                                                 ex-&gt;op_array-&gt;vars[i].name_len + 1,
<span class="lineNum">    1790 </span>                :                                                 ex-&gt;op_array-&gt;vars[i].hash_value,
<span class="lineNum">    1791 </span>                :                                                 (void**)ex-&gt;CVs[i],
<span class="lineNum">    1792 </span>                :                                                 sizeof(zval*),
<span class="lineNum">    1793 </span>                :                                                 (void**)&amp;ex-&gt;CVs[i]);
<span class="lineNum">    1794 </span>                :                                 }
<span class="lineNum">    1795 </span>                :                         }
<span class="lineNum">    1796 </span>                :                 }
<span class="lineNum">    1797 </span>                :         }
<span class="lineNum">    1798 </span>                : }
<span class="lineNum">    1799 </span>                : /* }}} */
<span class="lineNum">    1800 </span>                : 
<span class="lineNum">    1801 </span>                : /*
<span class="lineNum">    1802 </span>                :  * Local variables:
<span class="lineNum">    1803 </span>                :  * tab-width: 4
<span class="lineNum">    1804 </span>                :  * c-basic-offset: 4
<span class="lineNum">    1805 </span>                :  * indent-tabs-mode: t
<span class="lineNum">    1806 </span>                :  * End:
<span class="lineNum">    1807 </span>                :  */
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
  <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.7</a></td></tr>
  </table>
  <br>

</body>
</html>
