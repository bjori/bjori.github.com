<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <title>LCOV - PHP Code Coverage - lcov_data/ext/date/lib/parse_date.re</title>
  <link rel="stylesheet" type="text/css" href="../../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
        <tr>
          <td width="5%"></td>
          <td width="10%" class="headerItem">Current view:</td>
          <td width="35%" class="headerValue"><a href="../../../../index.html">directory</a> - <a href="index.html">lcov_data/ext/date/lib</a> - parse_date.re (source / <a href="parse_date.re.func.html">functions</a>)</td>
          <td width="10%"></td>
          <td width="10%" class="headerCovTableHead">Found</td>
          <td width="10%" class="headerCovTableHead">Hit</td>
          <td width="15%" class="headerCovTableHead">Coverage</td>
          <td width="5%"></td>
        </tr>
        <tr>
          <td></td>
          <td class="headerItem">Test:</td>
          <td class="headerValue">PHP Code Coverage</td>
          <td class="headerItem">Lines:</td>
          <td class="headerCovTableEntry">1029</td>
          <td class="headerCovTableEntry">0</td>
          <td class="headerCovTableEntryLo">0.0 %</td>
        </tr>
        <tr>
          <td></td>
          <td class="headerItem">Date:</td>
          <td class="headerValue">2012-06-19</td>
          <td class="headerItem">Functions:</td>
          <td class="headerCovTableEntry">32</td>
          <td class="headerCovTableEntry">0</td>
          <td class="headerCovTableEntryLo">0.0 %</td>
        </tr>
        <tr>
          <td></td>
          <td class="headerItem">Colors:</td>
          <td class="headerValueLeg" colspan=5>
            <span class="coverLegendNoCov">not hit</span>
            <span class="coverLegendCov">hit</span>
          </td>
        </tr>
                <tr><td><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>
    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td><pre class="source">
<a name="1"><span class="lineNum">       1 </span>                : /*</a>
<span class="lineNum">       2 </span>                :    +----------------------------------------------------------------------+
<span class="lineNum">       3 </span>                :    | PHP Version 5                                                        |
<span class="lineNum">       4 </span>                :    +----------------------------------------------------------------------+
<span class="lineNum">       5 </span>                :    | Copyright (c) 1997-2010 The PHP Group                                |
<span class="lineNum">       6 </span>                :    +----------------------------------------------------------------------+
<span class="lineNum">       7 </span>                :    | This source file is subject to version 3.01 of the PHP license,      |
<span class="lineNum">       8 </span>                :    | that is bundled with this package in the file LICENSE, and is        |
<span class="lineNum">       9 </span>                :    | available through the world-wide-web at the following url:           |
<span class="lineNum">      10 </span>                :    | http://www.php.net/license/3_01.txt                                  |
<span class="lineNum">      11 </span>                :    | If you did not receive a copy of the PHP license and are unable to   |
<span class="lineNum">      12 </span>                :    | obtain it through the world-wide-web, please send a note to          |
<span class="lineNum">      13 </span>                :    | license@php.net so we can mail you a copy immediately.               |
<span class="lineNum">      14 </span>                :    +----------------------------------------------------------------------+
<span class="lineNum">      15 </span>                :    | Authors: Derick Rethans &lt;derick@derickrethans.nl&gt;                    |
<span class="lineNum">      16 </span>                :    +----------------------------------------------------------------------+
<span class="lineNum">      17 </span>                :  */
<span class="lineNum">      18 </span>                : 
<span class="lineNum">      19 </span>                : /* $Id$ */
<span class="lineNum">      20 </span>                : 
<span class="lineNum">      21 </span>                : #include &quot;timelib.h&quot;
<span class="lineNum">      22 </span>                : 
<span class="lineNum">      23 </span>                : #include &lt;stdio.h&gt;
<span class="lineNum">      24 </span>                : #include &lt;ctype.h&gt;
<span class="lineNum">      25 </span>                : #include &lt;math.h&gt;
<span class="lineNum">      26 </span>                : #include &lt;assert.h&gt;
<span class="lineNum">      27 </span>                : 
<span class="lineNum">      28 </span>                : #ifdef HAVE_STDLIB_H
<span class="lineNum">      29 </span>                : #include &lt;stdlib.h&gt;
<span class="lineNum">      30 </span>                : #endif
<span class="lineNum">      31 </span>                : #ifdef HAVE_STRING_H
<span class="lineNum">      32 </span>                : #include &lt;string.h&gt;
<span class="lineNum">      33 </span>                : #else
<span class="lineNum">      34 </span>                : #include &lt;strings.h&gt;
<span class="lineNum">      35 </span>                : #endif
<span class="lineNum">      36 </span>                : 
<span class="lineNum">      37 </span>                : #if defined(_MSC_VER)
<span class="lineNum">      38 </span>                : # define strtoll(s, f, b) _atoi64(s)
<span class="lineNum">      39 </span>                : #elif !defined(HAVE_STRTOLL)
<span class="lineNum">      40 </span>                : # if defined(HAVE_ATOLL)
<span class="lineNum">      41 </span>                : #  define strtoll(s, f, b) atoll(s)
<span class="lineNum">      42 </span>                : # else
<span class="lineNum">      43 </span>                : #  define strtoll(s, f, b) strtol(s, f, b)
<span class="lineNum">      44 </span>                : # endif
<span class="lineNum">      45 </span>                : #endif
<span class="lineNum">      46 </span>                : 
<span class="lineNum">      47 </span>                : #define TIMELIB_UNSET   -99999
<span class="lineNum">      48 </span>                : 
<span class="lineNum">      49 </span>                : #define TIMELIB_SECOND  1
<span class="lineNum">      50 </span>                : #define TIMELIB_MINUTE  2
<span class="lineNum">      51 </span>                : #define TIMELIB_HOUR    3
<span class="lineNum">      52 </span>                : #define TIMELIB_DAY     4
<span class="lineNum">      53 </span>                : #define TIMELIB_MONTH   5
<span class="lineNum">      54 </span>                : #define TIMELIB_YEAR    6
<span class="lineNum">      55 </span>                : #define TIMELIB_WEEKDAY 7
<span class="lineNum">      56 </span>                : #define TIMELIB_SPECIAL 8
<span class="lineNum">      57 </span>                : 
<span class="lineNum">      58 </span>                : #define EOI      257
<span class="lineNum">      59 </span>                : #define TIME     258
<span class="lineNum">      60 </span>                : #define DATE     259
<span class="lineNum">      61 </span>                : 
<span class="lineNum">      62 </span>                : #define TIMELIB_XMLRPC_SOAP    260
<span class="lineNum">      63 </span>                : #define TIMELIB_TIME12         261
<span class="lineNum">      64 </span>                : #define TIMELIB_TIME24         262
<span class="lineNum">      65 </span>                : #define TIMELIB_GNU_NOCOLON    263
<span class="lineNum">      66 </span>                : #define TIMELIB_GNU_NOCOLON_TZ 264
<span class="lineNum">      67 </span>                : #define TIMELIB_ISO_NOCOLON    265
<span class="lineNum">      68 </span>                : 
<span class="lineNum">      69 </span>                : #define TIMELIB_AMERICAN       266
<span class="lineNum">      70 </span>                : #define TIMELIB_ISO_DATE       267
<span class="lineNum">      71 </span>                : #define TIMELIB_DATE_FULL      268
<span class="lineNum">      72 </span>                : #define TIMELIB_DATE_TEXT      269
<span class="lineNum">      73 </span>                : #define TIMELIB_DATE_NOCOLON   270
<span class="lineNum">      74 </span>                : #define TIMELIB_PG_YEARDAY     271
<span class="lineNum">      75 </span>                : #define TIMELIB_PG_TEXT        272
<span class="lineNum">      76 </span>                : #define TIMELIB_PG_REVERSE     273
<span class="lineNum">      77 </span>                : #define TIMELIB_CLF            274
<span class="lineNum">      78 </span>                : #define TIMELIB_DATE_NO_DAY    275
<span class="lineNum">      79 </span>                : #define TIMELIB_SHORTDATE_WITH_TIME 276
<span class="lineNum">      80 </span>                : #define TIMELIB_DATE_FULL_POINTED 277
<span class="lineNum">      81 </span>                : #define TIMELIB_TIME24_WITH_ZONE 278
<span class="lineNum">      82 </span>                : #define TIMELIB_ISO_WEEK       279
<span class="lineNum">      83 </span>                : #define TIMELIB_LF_DAY_OF_MONTH 280
<span class="lineNum">      84 </span>                : #define TIMELIB_WEEK_DAY_OF_MONTH 281
<span class="lineNum">      85 </span>                : 
<span class="lineNum">      86 </span>                : #define TIMELIB_TIMEZONE       300
<span class="lineNum">      87 </span>                : #define TIMELIB_AGO            301
<span class="lineNum">      88 </span>                : 
<span class="lineNum">      89 </span>                : #define TIMELIB_RELATIVE       310
<span class="lineNum">      90 </span>                : 
<span class="lineNum">      91 </span>                : #define TIMELIB_ERROR          999
<span class="lineNum">      92 </span>                : 
<span class="lineNum">      93 </span>                : /* Some compilers like AIX, defines uchar in sys/types.h */
<span class="lineNum">      94 </span>                : #undef uchar
<span class="lineNum">      95 </span>                : typedef unsigned char uchar;
<span class="lineNum">      96 </span>                : 
<span class="lineNum">      97 </span>                : #define   BSIZE    8192
<span class="lineNum">      98 </span>                : 
<span class="lineNum">      99 </span>                : #define   YYCTYPE      uchar
<span class="lineNum">     100 </span>                : #define   YYCURSOR     cursor
<span class="lineNum">     101 </span>                : #define   YYLIMIT      s-&gt;lim
<span class="lineNum">     102 </span>                : #define   YYMARKER     s-&gt;ptr
<span class="lineNum">     103 </span>                : #define   YYFILL(n)    return EOI;
<span class="lineNum">     104 </span>                : 
<span class="lineNum">     105 </span>                : #define   RET(i)       {s-&gt;cur = cursor; return i;}
<span class="lineNum">     106 </span>                : 
<span class="lineNum">     107 </span>                : #define timelib_string_free free
<span class="lineNum">     108 </span>                : 
<span class="lineNum">     109 </span>                : #define TIMELIB_HAVE_TIME() { if (s-&gt;time-&gt;have_time) { add_error(s, &quot;Double time specification&quot;); timelib_string_free(str); return TIMELIB_ERROR; } else { s-&gt;time-&gt;have_time = 1; s-&gt;time-&gt;h = 0; s-&gt;time-&gt;i = 0; s-&gt;time-&gt;s = 0; s-&gt;time-&gt;f = 0; } }
<span class="lineNum">     110 </span>                : #define TIMELIB_UNHAVE_TIME() { s-&gt;time-&gt;have_time = 0; s-&gt;time-&gt;h = 0; s-&gt;time-&gt;i = 0; s-&gt;time-&gt;s = 0; s-&gt;time-&gt;f = 0; }
<span class="lineNum">     111 </span>                : #define TIMELIB_HAVE_DATE() { if (s-&gt;time-&gt;have_date) { add_error(s, &quot;Double date specification&quot;); timelib_string_free(str); return TIMELIB_ERROR; } else { s-&gt;time-&gt;have_date = 1; } }
<span class="lineNum">     112 </span>                : #define TIMELIB_UNHAVE_DATE() { s-&gt;time-&gt;have_date = 0; s-&gt;time-&gt;d = 0; s-&gt;time-&gt;m = 0; s-&gt;time-&gt;y = 0; }
<span class="lineNum">     113 </span>                : #define TIMELIB_HAVE_RELATIVE() { s-&gt;time-&gt;have_relative = 1; }
<span class="lineNum">     114 </span>                : #define TIMELIB_HAVE_WEEKDAY_RELATIVE() { s-&gt;time-&gt;have_relative = 1; s-&gt;time-&gt;relative.have_weekday_relative = 1; }
<span class="lineNum">     115 </span>                : #define TIMELIB_HAVE_SPECIAL_RELATIVE() { s-&gt;time-&gt;have_relative = 1; s-&gt;time-&gt;relative.have_special_relative = 1; }
<span class="lineNum">     116 </span>                : #define TIMELIB_HAVE_TZ() { s-&gt;cur = cursor; if (s-&gt;time-&gt;have_zone) { s-&gt;time-&gt;have_zone &gt; 1 ? add_error(s, &quot;Double timezone specification&quot;) : add_warning(s, &quot;Double timezone specification&quot;); timelib_string_free(str); s-&gt;time-&gt;have_zone++; return TIMELIB_ERROR; } else { s-&gt;time-&gt;have_zone++; } }
<span class="lineNum">     117 </span>                : 
<span class="lineNum">     118 </span>                : #define TIMELIB_INIT  s-&gt;cur = cursor; str = timelib_string(s); ptr = str
<span class="lineNum">     119 </span>                : #define TIMELIB_DEINIT timelib_string_free(str)
<span class="lineNum">     120 </span>                : #define TIMELIB_ADJUST_RELATIVE_WEEKDAY() if (in-&gt;time.have_weekday_relative &amp;&amp; (in.rel.d &gt; 0)) { in.rel.d -= 7; }
<span class="lineNum">     121 </span>                : 
<span class="lineNum">     122 </span>                : #define TIMELIB_PROCESS_YEAR(x, l) { \
<span class="lineNum">     123 </span>                :         if (((x) == TIMELIB_UNSET) || ((l) &gt;= 4)) { \
<span class="lineNum">     124 </span>                :         /*      (x) = 0; */          \
<span class="lineNum">     125 </span>                :         } else if ((x) &lt; 100) {  \
<span class="lineNum">     126 </span>                :                 if ((x) &lt; 70) {      \
<span class="lineNum">     127 </span>                :                         (x) += 2000;     \
<span class="lineNum">     128 </span>                :                 } else {             \
<span class="lineNum">     129 </span>                :                         (x) += 1900;     \
<span class="lineNum">     130 </span>                :                 }                    \
<span class="lineNum">     131 </span>                :         }                        \
<span class="lineNum">     132 </span>                : }
<span class="lineNum">     133 </span>                : 
<span class="lineNum">     134 </span>                : #ifdef DEBUG_PARSER
<span class="lineNum">     135 </span>                : #define DEBUG_OUTPUT(s) printf(&quot;%s\n&quot;, s);
<span class="lineNum">     136 </span>                : #define YYDEBUG(s,c) { if (s != -1) { printf(&quot;state: %d &quot;, s); printf(&quot;[%c]\n&quot;, c); } }
<span class="lineNum">     137 </span>                : #else
<span class="lineNum">     138 </span>                : #define DEBUG_OUTPUT(s)
<span class="lineNum">     139 </span>                : #define YYDEBUG(s,c)
<span class="lineNum">     140 </span>                : #endif
<span class="lineNum">     141 </span>                : 
<span class="lineNum">     142 </span>                : #include &quot;timelib_structs.h&quot;
<span class="lineNum">     143 </span>                : 
<span class="lineNum">     144 </span>                : typedef struct timelib_elems {
<span class="lineNum">     145 </span>                :         unsigned int   c; /* Number of elements */
<span class="lineNum">     146 </span>                :         char         **v; /* Values */
<span class="lineNum">     147 </span>                : } timelib_elems;
<span class="lineNum">     148 </span>                : 
<span class="lineNum">     149 </span>                : typedef struct Scanner {
<span class="lineNum">     150 </span>                :         int           fd;
<span class="lineNum">     151 </span>                :         uchar        *lim, *str, *ptr, *cur, *tok, *pos;
<span class="lineNum">     152 </span>                :         unsigned int  line, len;
<span class="lineNum">     153 </span>                :         struct timelib_error_container *errors;
<span class="lineNum">     154 </span>                : 
<span class="lineNum">     155 </span>                :         struct timelib_time *time;
<span class="lineNum">     156 </span>                :         const timelib_tzdb  *tzdb;
<span class="lineNum">     157 </span>                : } Scanner;
<span class="lineNum">     158 </span>                : 
<span class="lineNum">     159 </span>                : typedef struct _timelib_lookup_table {
<span class="lineNum">     160 </span>                :     const char *name;
<span class="lineNum">     161 </span>                :     int         type;
<span class="lineNum">     162 </span>                :     int         value;
<span class="lineNum">     163 </span>                : } timelib_lookup_table;
<span class="lineNum">     164 </span>                : 
<span class="lineNum">     165 </span>                : typedef struct _timelib_relunit {
<span class="lineNum">     166 </span>                :         const char *name;
<span class="lineNum">     167 </span>                :         int         unit;
<span class="lineNum">     168 </span>                :         int         multiplier;
<span class="lineNum">     169 </span>                : } timelib_relunit;
<span class="lineNum">     170 </span>                : 
<span class="lineNum">     171 </span>                : #define HOUR(a) (int)(a * 60)
<span class="lineNum">     172 </span>                : 
<span class="lineNum">     173 </span>                : /* The timezone table. */
<span class="lineNum">     174 </span>                : const static timelib_tz_lookup_table timelib_timezone_lookup[] = {
<span class="lineNum">     175 </span>                : #include &quot;timezonemap.h&quot;
<span class="lineNum">     176 </span>                :         { NULL, 0, 0, NULL },
<span class="lineNum">     177 </span>                : };
<span class="lineNum">     178 </span>                : 
<span class="lineNum">     179 </span>                : const static timelib_tz_lookup_table timelib_timezone_fallbackmap[] = {
<span class="lineNum">     180 </span>                : #include &quot;fallbackmap.h&quot;
<span class="lineNum">     181 </span>                :         { NULL, 0, 0, NULL },
<span class="lineNum">     182 </span>                : };
<span class="lineNum">     183 </span>                : 
<span class="lineNum">     184 </span>                : const static timelib_tz_lookup_table timelib_timezone_utc[] = {
<span class="lineNum">     185 </span>                :         { &quot;utc&quot;, 0, 0, &quot;UTC&quot; },
<span class="lineNum">     186 </span>                : };
<span class="lineNum">     187 </span>                : 
<span class="lineNum">     188 </span>                : static timelib_relunit const timelib_relunit_lookup[] = {
<span class="lineNum">     189 </span>                :         { &quot;sec&quot;,         TIMELIB_SECOND,  1 },
<span class="lineNum">     190 </span>                :         { &quot;secs&quot;,        TIMELIB_SECOND,  1 },
<span class="lineNum">     191 </span>                :         { &quot;second&quot;,      TIMELIB_SECOND,  1 },
<span class="lineNum">     192 </span>                :         { &quot;seconds&quot;,     TIMELIB_SECOND,  1 },
<span class="lineNum">     193 </span>                :         { &quot;min&quot;,         TIMELIB_MINUTE,  1 },
<span class="lineNum">     194 </span>                :         { &quot;mins&quot;,        TIMELIB_MINUTE,  1 },
<span class="lineNum">     195 </span>                :         { &quot;minute&quot;,      TIMELIB_MINUTE,  1 },
<span class="lineNum">     196 </span>                :         { &quot;minutes&quot;,     TIMELIB_MINUTE,  1 },
<span class="lineNum">     197 </span>                :         { &quot;hour&quot;,        TIMELIB_HOUR,    1 },
<span class="lineNum">     198 </span>                :         { &quot;hours&quot;,       TIMELIB_HOUR,    1 },
<span class="lineNum">     199 </span>                :         { &quot;day&quot;,         TIMELIB_DAY,     1 },
<span class="lineNum">     200 </span>                :         { &quot;days&quot;,        TIMELIB_DAY,     1 },
<span class="lineNum">     201 </span>                :         { &quot;week&quot;,        TIMELIB_DAY,     7 },
<span class="lineNum">     202 </span>                :         { &quot;weeks&quot;,       TIMELIB_DAY,     7 },
<span class="lineNum">     203 </span>                :         { &quot;fortnight&quot;,   TIMELIB_DAY,    14 },
<span class="lineNum">     204 </span>                :         { &quot;fortnights&quot;,  TIMELIB_DAY,    14 },
<span class="lineNum">     205 </span>                :         { &quot;forthnight&quot;,  TIMELIB_DAY,    14 },
<span class="lineNum">     206 </span>                :         { &quot;forthnights&quot;, TIMELIB_DAY,    14 },
<span class="lineNum">     207 </span>                :         { &quot;month&quot;,       TIMELIB_MONTH,   1 },
<span class="lineNum">     208 </span>                :         { &quot;months&quot;,      TIMELIB_MONTH,   1 },
<span class="lineNum">     209 </span>                :         { &quot;year&quot;,        TIMELIB_YEAR,    1 },
<span class="lineNum">     210 </span>                :         { &quot;years&quot;,       TIMELIB_YEAR,    1 },
<span class="lineNum">     211 </span>                : 
<span class="lineNum">     212 </span>                :         { &quot;monday&quot;,      TIMELIB_WEEKDAY, 1 },
<span class="lineNum">     213 </span>                :         { &quot;mon&quot;,         TIMELIB_WEEKDAY, 1 },
<span class="lineNum">     214 </span>                :         { &quot;tuesday&quot;,     TIMELIB_WEEKDAY, 2 },
<span class="lineNum">     215 </span>                :         { &quot;tue&quot;,         TIMELIB_WEEKDAY, 2 },
<span class="lineNum">     216 </span>                :         { &quot;wednesday&quot;,   TIMELIB_WEEKDAY, 3 },
<span class="lineNum">     217 </span>                :         { &quot;wed&quot;,         TIMELIB_WEEKDAY, 3 },
<span class="lineNum">     218 </span>                :         { &quot;thursday&quot;,    TIMELIB_WEEKDAY, 4 },
<span class="lineNum">     219 </span>                :         { &quot;thu&quot;,         TIMELIB_WEEKDAY, 4 },
<span class="lineNum">     220 </span>                :         { &quot;friday&quot;,      TIMELIB_WEEKDAY, 5 },
<span class="lineNum">     221 </span>                :         { &quot;fri&quot;,         TIMELIB_WEEKDAY, 5 },
<span class="lineNum">     222 </span>                :         { &quot;saturday&quot;,    TIMELIB_WEEKDAY, 6 },
<span class="lineNum">     223 </span>                :         { &quot;sat&quot;,         TIMELIB_WEEKDAY, 6 },
<span class="lineNum">     224 </span>                :         { &quot;sunday&quot;,      TIMELIB_WEEKDAY, 0 },
<span class="lineNum">     225 </span>                :         { &quot;sun&quot;,         TIMELIB_WEEKDAY, 0 },
<span class="lineNum">     226 </span>                : 
<span class="lineNum">     227 </span>                :         { &quot;weekday&quot;,     TIMELIB_SPECIAL, TIMELIB_SPECIAL_WEEKDAY },
<span class="lineNum">     228 </span>                :         { &quot;weekdays&quot;,    TIMELIB_SPECIAL, TIMELIB_SPECIAL_WEEKDAY },
<span class="lineNum">     229 </span>                :         { NULL,          0,          0 }
<span class="lineNum">     230 </span>                : };
<span class="lineNum">     231 </span>                : 
<span class="lineNum">     232 </span>                : /* The relative text table. */
<span class="lineNum">     233 </span>                : static timelib_lookup_table const timelib_reltext_lookup[] = {
<span class="lineNum">     234 </span>                :         { &quot;first&quot;,    0,  1 },
<span class="lineNum">     235 </span>                :         { &quot;next&quot;,     0,  1 },
<span class="lineNum">     236 </span>                :         { &quot;second&quot;,   0,  2 },
<span class="lineNum">     237 </span>                :         { &quot;third&quot;,    0,  3 },
<span class="lineNum">     238 </span>                :         { &quot;fourth&quot;,   0,  4 },
<span class="lineNum">     239 </span>                :         { &quot;fifth&quot;,    0,  5 },
<span class="lineNum">     240 </span>                :         { &quot;sixth&quot;,    0,  6 },
<span class="lineNum">     241 </span>                :         { &quot;seventh&quot;,  0,  7 },
<span class="lineNum">     242 </span>                :         { &quot;eight&quot;,    0,  8 },
<span class="lineNum">     243 </span>                :         { &quot;eighth&quot;,   0,  8 },
<span class="lineNum">     244 </span>                :         { &quot;ninth&quot;,    0,  9 },
<span class="lineNum">     245 </span>                :         { &quot;tenth&quot;,    0, 10 },
<span class="lineNum">     246 </span>                :         { &quot;eleventh&quot;, 0, 11 },
<span class="lineNum">     247 </span>                :         { &quot;twelfth&quot;,  0, 12 },
<span class="lineNum">     248 </span>                :         { &quot;last&quot;,     0, -1 },
<span class="lineNum">     249 </span>                :         { &quot;previous&quot;, 0, -1 },
<span class="lineNum">     250 </span>                :         { &quot;this&quot;,     1,  0 },
<span class="lineNum">     251 </span>                :         { NULL,       1,  0 }
<span class="lineNum">     252 </span>                : };
<span class="lineNum">     253 </span>                : 
<span class="lineNum">     254 </span>                : /* The month table. */
<span class="lineNum">     255 </span>                : static timelib_lookup_table const timelib_month_lookup[] = {
<span class="lineNum">     256 </span>                :         { &quot;jan&quot;,  0,  1 },
<span class="lineNum">     257 </span>                :         { &quot;feb&quot;,  0,  2 },
<span class="lineNum">     258 </span>                :         { &quot;mar&quot;,  0,  3 },
<span class="lineNum">     259 </span>                :         { &quot;apr&quot;,  0,  4 },
<span class="lineNum">     260 </span>                :         { &quot;may&quot;,  0,  5 },
<span class="lineNum">     261 </span>                :         { &quot;jun&quot;,  0,  6 },
<span class="lineNum">     262 </span>                :         { &quot;jul&quot;,  0,  7 },
<span class="lineNum">     263 </span>                :         { &quot;aug&quot;,  0,  8 },
<span class="lineNum">     264 </span>                :         { &quot;sep&quot;,  0,  9 },
<span class="lineNum">     265 </span>                :         { &quot;sept&quot;, 0,  9 },
<span class="lineNum">     266 </span>                :         { &quot;oct&quot;,  0, 10 },
<span class="lineNum">     267 </span>                :         { &quot;nov&quot;,  0, 11 },
<span class="lineNum">     268 </span>                :         { &quot;dec&quot;,  0, 12 },
<span class="lineNum">     269 </span>                :         { &quot;i&quot;,    0,  1 },
<span class="lineNum">     270 </span>                :         { &quot;ii&quot;,   0,  2 },
<span class="lineNum">     271 </span>                :         { &quot;iii&quot;,  0,  3 },
<span class="lineNum">     272 </span>                :         { &quot;iv&quot;,   0,  4 },
<span class="lineNum">     273 </span>                :         { &quot;v&quot;,    0,  5 },
<span class="lineNum">     274 </span>                :         { &quot;vi&quot;,   0,  6 },
<span class="lineNum">     275 </span>                :         { &quot;vii&quot;,  0,  7 },
<span class="lineNum">     276 </span>                :         { &quot;viii&quot;, 0,  8 },
<span class="lineNum">     277 </span>                :         { &quot;ix&quot;,   0,  9 },
<span class="lineNum">     278 </span>                :         { &quot;x&quot;,    0, 10 },
<span class="lineNum">     279 </span>                :         { &quot;xi&quot;,   0, 11 },
<span class="lineNum">     280 </span>                :         { &quot;xii&quot;,  0, 12 },
<span class="lineNum">     281 </span>                : 
<span class="lineNum">     282 </span>                :         { &quot;january&quot;,   0,  1 },
<span class="lineNum">     283 </span>                :         { &quot;february&quot;,  0,  2 },
<span class="lineNum">     284 </span>                :         { &quot;march&quot;,     0,  3 },
<span class="lineNum">     285 </span>                :         { &quot;april&quot;,     0,  4 },
<span class="lineNum">     286 </span>                :         { &quot;may&quot;,       0,  5 },
<span class="lineNum">     287 </span>                :         { &quot;june&quot;,      0,  6 },
<span class="lineNum">     288 </span>                :         { &quot;july&quot;,      0,  7 },
<span class="lineNum">     289 </span>                :         { &quot;august&quot;,    0,  8 },
<span class="lineNum">     290 </span>                :         { &quot;september&quot;, 0,  9 },
<span class="lineNum">     291 </span>                :         { &quot;october&quot;,   0, 10 },
<span class="lineNum">     292 </span>                :         { &quot;november&quot;,  0, 11 },
<span class="lineNum">     293 </span>                :         { &quot;december&quot;,  0, 12 },
<span class="lineNum">     294 </span>                :         {  NULL,       0,  0 }
<span class="lineNum">     295 </span>                : };
<span class="lineNum">     296 </span>                : 
<span class="lineNum">     297 </span>                : #if 0
<span class="lineNum">     298 </span>                : static char* timelib_ltrim(char *s)
<span class="lineNum">     299 </span>                : {
<span class="lineNum">     300 </span>                :         char *ptr = s;
<span class="lineNum">     301 </span>                :         while (ptr[0] == ' ' || ptr[0] == '\t') {
<span class="lineNum">     302 </span>                :                 ptr++;
<span class="lineNum">     303 </span>                :         }
<span class="lineNum">     304 </span>                :         return ptr;
<span class="lineNum">     305 </span>                : }
<span class="lineNum">     306 </span>                : #endif
<span class="lineNum">     307 </span>                : 
<span class="lineNum">     308 </span>                : #if 0
<span class="lineNum">     309 </span>                : uchar *fill(Scanner *s, uchar *cursor){
<span class="lineNum">     310 </span>                :         if(!s-&gt;eof){
<span class="lineNum">     311 </span>                :                 unsigned int cnt = s-&gt;tok - s-&gt;bot;
<span class="lineNum">     312 </span>                :                 if(cnt){
<span class="lineNum">     313 </span>                :                         memcpy(s-&gt;bot, s-&gt;tok, s-&gt;lim - s-&gt;tok);
<span class="lineNum">     314 </span>                :                         s-&gt;tok = s-&gt;bot;
<span class="lineNum">     315 </span>                :                         s-&gt;ptr -= cnt;
<span class="lineNum">     316 </span>                :                         cursor -= cnt;
<span class="lineNum">     317 </span>                :                         s-&gt;pos -= cnt;
<span class="lineNum">     318 </span>                :                         s-&gt;lim -= cnt;
<span class="lineNum">     319 </span>                :                 }
<span class="lineNum">     320 </span>                :                 if((s-&gt;top - s-&gt;lim) &lt; BSIZE){
<span class="lineNum">     321 </span>                :                         uchar *buf = (uchar*) malloc(((s-&gt;lim - s-&gt;bot) + BSIZE)*sizeof(uchar));
<span class="lineNum">     322 </span>                :                         memcpy(buf, s-&gt;tok, s-&gt;lim - s-&gt;tok);
<span class="lineNum">     323 </span>                :                         s-&gt;tok = buf;
<span class="lineNum">     324 </span>                :                         s-&gt;ptr = &amp;buf[s-&gt;ptr - s-&gt;bot];
<span class="lineNum">     325 </span>                :                         cursor = &amp;buf[cursor - s-&gt;bot];
<span class="lineNum">     326 </span>                :                         s-&gt;pos = &amp;buf[s-&gt;pos - s-&gt;bot];
<span class="lineNum">     327 </span>                :                         s-&gt;lim = &amp;buf[s-&gt;lim - s-&gt;bot];
<span class="lineNum">     328 </span>                :                         s-&gt;top = &amp;s-&gt;lim[BSIZE];
<span class="lineNum">     329 </span>                :                         free(s-&gt;bot);
<span class="lineNum">     330 </span>                :                         s-&gt;bot = buf;
<span class="lineNum">     331 </span>                :                 }
<span class="lineNum">     332 </span>                :                 if((cnt = read(s-&gt;fd, (char*) s-&gt;lim, BSIZE)) != BSIZE){
<span class="lineNum">     333 </span>                :                         s-&gt;eof = &amp;s-&gt;lim[cnt]; *(s-&gt;eof)++ = '\n';
<span class="lineNum">     334 </span>                :                 }
<span class="lineNum">     335 </span>                :                 s-&gt;lim += cnt;
<span class="lineNum">     336 </span>                :         }
<span class="lineNum">     337 </span>                :         return cursor;
<span class="lineNum">     338 </span>                : }
<a name="339"><span class="lineNum">     339 </span>                : #endif</a>
<span class="lineNum">     340 </span>                : 
<span class="lineNum">     341 </span><span class="lineNoCov">              0 : static void add_warning(Scanner *s, char *error)</span>
<span class="lineNum">     342 </span>                : {
<span class="lineNum">     343 </span><span class="lineNoCov">              0 :         s-&gt;errors-&gt;warning_count++;</span>
<span class="lineNum">     344 </span><span class="lineNoCov">              0 :         s-&gt;errors-&gt;warning_messages = realloc(s-&gt;errors-&gt;warning_messages, s-&gt;errors-&gt;warning_count * sizeof(timelib_error_message));</span>
<span class="lineNum">     345 </span><span class="lineNoCov">              0 :         s-&gt;errors-&gt;warning_messages[s-&gt;errors-&gt;warning_count - 1].position = s-&gt;tok ? s-&gt;tok - s-&gt;str : 0;</span>
<span class="lineNum">     346 </span><span class="lineNoCov">              0 :         s-&gt;errors-&gt;warning_messages[s-&gt;errors-&gt;warning_count - 1].character = s-&gt;tok ? *s-&gt;tok : 0;</span>
<span class="lineNum">     347 </span><span class="lineNoCov">              0 :         s-&gt;errors-&gt;warning_messages[s-&gt;errors-&gt;warning_count - 1].message = strdup(error);</span>
<a name="348"><span class="lineNum">     348 </span><span class="lineNoCov">              0 : }</span></a>
<span class="lineNum">     349 </span>                : 
<span class="lineNum">     350 </span><span class="lineNoCov">              0 : static void add_error(Scanner *s, char *error)</span>
<span class="lineNum">     351 </span>                : {
<span class="lineNum">     352 </span><span class="lineNoCov">              0 :         s-&gt;errors-&gt;error_count++;</span>
<span class="lineNum">     353 </span><span class="lineNoCov">              0 :         s-&gt;errors-&gt;error_messages = realloc(s-&gt;errors-&gt;error_messages, s-&gt;errors-&gt;error_count * sizeof(timelib_error_message));</span>
<span class="lineNum">     354 </span><span class="lineNoCov">              0 :         s-&gt;errors-&gt;error_messages[s-&gt;errors-&gt;error_count - 1].position = s-&gt;tok ? s-&gt;tok - s-&gt;str : 0;</span>
<span class="lineNum">     355 </span><span class="lineNoCov">              0 :         s-&gt;errors-&gt;error_messages[s-&gt;errors-&gt;error_count - 1].character = s-&gt;tok ? *s-&gt;tok : 0;</span>
<span class="lineNum">     356 </span><span class="lineNoCov">              0 :         s-&gt;errors-&gt;error_messages[s-&gt;errors-&gt;error_count - 1].message = strdup(error);</span>
<a name="357"><span class="lineNum">     357 </span><span class="lineNoCov">              0 : }</span></a>
<span class="lineNum">     358 </span>                : 
<span class="lineNum">     359 </span><span class="lineNoCov">              0 : static void add_pbf_warning(Scanner *s, char *error, char *sptr, char *cptr)</span>
<span class="lineNum">     360 </span>                : {
<span class="lineNum">     361 </span><span class="lineNoCov">              0 :         s-&gt;errors-&gt;warning_count++;</span>
<span class="lineNum">     362 </span><span class="lineNoCov">              0 :         s-&gt;errors-&gt;warning_messages = realloc(s-&gt;errors-&gt;warning_messages, s-&gt;errors-&gt;warning_count * sizeof(timelib_error_message));</span>
<span class="lineNum">     363 </span><span class="lineNoCov">              0 :         s-&gt;errors-&gt;warning_messages[s-&gt;errors-&gt;warning_count - 1].position = cptr - sptr;</span>
<span class="lineNum">     364 </span><span class="lineNoCov">              0 :         s-&gt;errors-&gt;warning_messages[s-&gt;errors-&gt;warning_count - 1].character = *cptr;</span>
<span class="lineNum">     365 </span><span class="lineNoCov">              0 :         s-&gt;errors-&gt;warning_messages[s-&gt;errors-&gt;warning_count - 1].message = strdup(error);</span>
<a name="366"><span class="lineNum">     366 </span><span class="lineNoCov">              0 : }</span></a>
<span class="lineNum">     367 </span>                : 
<span class="lineNum">     368 </span><span class="lineNoCov">              0 : static void add_pbf_error(Scanner *s, char *error, char *sptr, char *cptr)</span>
<span class="lineNum">     369 </span>                : {
<span class="lineNum">     370 </span><span class="lineNoCov">              0 :         s-&gt;errors-&gt;error_count++;</span>
<span class="lineNum">     371 </span><span class="lineNoCov">              0 :         s-&gt;errors-&gt;error_messages = realloc(s-&gt;errors-&gt;error_messages, s-&gt;errors-&gt;error_count * sizeof(timelib_error_message));</span>
<span class="lineNum">     372 </span><span class="lineNoCov">              0 :         s-&gt;errors-&gt;error_messages[s-&gt;errors-&gt;error_count - 1].position = cptr - sptr;</span>
<span class="lineNum">     373 </span><span class="lineNoCov">              0 :         s-&gt;errors-&gt;error_messages[s-&gt;errors-&gt;error_count - 1].character = *cptr;</span>
<span class="lineNum">     374 </span><span class="lineNoCov">              0 :         s-&gt;errors-&gt;error_messages[s-&gt;errors-&gt;error_count - 1].message = strdup(error);</span>
<a name="375"><span class="lineNum">     375 </span><span class="lineNoCov">              0 : }</span></a>
<span class="lineNum">     376 </span>                : 
<span class="lineNum">     377 </span><span class="lineNoCov">              0 : static timelib_sll timelib_meridian(char **ptr, timelib_sll h)</span>
<span class="lineNum">     378 </span>                : {
<span class="lineNum">     379 </span><span class="lineNoCov">              0 :         timelib_sll retval = 0;</span>
<span class="lineNum">     380 </span>                : 
<span class="lineNum">     381 </span><span class="lineNoCov">              0 :         while (!strchr(&quot;AaPp&quot;, **ptr)) {</span>
<span class="lineNum">     382 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     383 </span>                :         }
<span class="lineNum">     384 </span><span class="lineNoCov">              0 :         if (**ptr == 'a' || **ptr == 'A') {</span>
<span class="lineNum">     385 </span><span class="lineNoCov">              0 :                 if (h == 12) {</span>
<span class="lineNum">     386 </span><span class="lineNoCov">              0 :                         retval = -12;</span>
<span class="lineNum">     387 </span>                :                 }
<span class="lineNum">     388 </span><span class="lineNoCov">              0 :         } else if (h != 12) {</span>
<span class="lineNum">     389 </span><span class="lineNoCov">              0 :                 retval = 12;</span>
<span class="lineNum">     390 </span>                :         }
<span class="lineNum">     391 </span><span class="lineNoCov">              0 :         ++*ptr;</span>
<span class="lineNum">     392 </span><span class="lineNoCov">              0 :         if (**ptr == '.') {</span>
<span class="lineNum">     393 </span><span class="lineNoCov">              0 :                 *ptr += 3;</span>
<span class="lineNum">     394 </span>                :         } else {
<span class="lineNum">     395 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     396 </span>                :         }
<span class="lineNum">     397 </span><span class="lineNoCov">              0 :         return retval;</span>
<a name="398"><span class="lineNum">     398 </span>                : }</a>
<span class="lineNum">     399 </span>                : 
<span class="lineNum">     400 </span><span class="lineNoCov">              0 : static timelib_sll timelib_meridian_with_check(char **ptr, timelib_sll h)</span>
<span class="lineNum">     401 </span>                : {
<span class="lineNum">     402 </span><span class="lineNoCov">              0 :         timelib_sll retval = 0;</span>
<span class="lineNum">     403 </span>                : 
<span class="lineNum">     404 </span><span class="lineNoCov">              0 :         while (!strchr(&quot;AaPp&quot;, **ptr)) {</span>
<span class="lineNum">     405 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     406 </span>                :         }
<span class="lineNum">     407 </span><span class="lineNoCov">              0 :         if (**ptr == 'a' || **ptr == 'A') {</span>
<span class="lineNum">     408 </span><span class="lineNoCov">              0 :                 if (h == 12) {</span>
<span class="lineNum">     409 </span><span class="lineNoCov">              0 :                         retval = -12;</span>
<span class="lineNum">     410 </span>                :                 }
<span class="lineNum">     411 </span><span class="lineNoCov">              0 :         } else if (h != 12) {</span>
<span class="lineNum">     412 </span><span class="lineNoCov">              0 :                 retval = 12;</span>
<span class="lineNum">     413 </span>                :         }
<span class="lineNum">     414 </span><span class="lineNoCov">              0 :         ++*ptr;</span>
<span class="lineNum">     415 </span><span class="lineNoCov">              0 :         if (**ptr == '.') {</span>
<span class="lineNum">     416 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     417 </span><span class="lineNoCov">              0 :                 if (**ptr != 'm' &amp;&amp; **ptr != 'M') {</span>
<span class="lineNum">     418 </span><span class="lineNoCov">              0 :                         return TIMELIB_UNSET;</span>
<span class="lineNum">     419 </span>                :                 }
<span class="lineNum">     420 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     421 </span><span class="lineNoCov">              0 :                 if (**ptr != '.' ) {</span>
<span class="lineNum">     422 </span><span class="lineNoCov">              0 :                         return TIMELIB_UNSET;</span>
<span class="lineNum">     423 </span>                :                 }
<span class="lineNum">     424 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     425 </span><span class="lineNoCov">              0 :         } else if (**ptr == 'm' || **ptr == 'M') {</span>
<span class="lineNum">     426 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     427 </span>                :         } else {
<span class="lineNum">     428 </span><span class="lineNoCov">              0 :                 return TIMELIB_UNSET;</span>
<span class="lineNum">     429 </span>                :         }
<span class="lineNum">     430 </span><span class="lineNoCov">              0 :         return retval;</span>
<a name="431"><span class="lineNum">     431 </span>                : }</a>
<span class="lineNum">     432 </span>                : 
<span class="lineNum">     433 </span><span class="lineNoCov">              0 : static char *timelib_string(Scanner *s)</span>
<span class="lineNum">     434 </span>                : {
<span class="lineNum">     435 </span><span class="lineNoCov">              0 :         char *tmp = calloc(1, s-&gt;cur - s-&gt;tok + 1);</span>
<span class="lineNum">     436 </span><span class="lineNoCov">              0 :         memcpy(tmp, s-&gt;tok, s-&gt;cur - s-&gt;tok);</span>
<span class="lineNum">     437 </span>                : 
<span class="lineNum">     438 </span><span class="lineNoCov">              0 :         return tmp;</span>
<a name="439"><span class="lineNum">     439 </span>                : }</a>
<span class="lineNum">     440 </span>                : 
<span class="lineNum">     441 </span><span class="lineNoCov">              0 : static timelib_sll timelib_get_nr_ex(char **ptr, int max_length, int *scanned_length)</span>
<span class="lineNum">     442 </span>                : {
<span class="lineNum">     443 </span>                :         char *begin, *end, *str;
<span class="lineNum">     444 </span><span class="lineNoCov">              0 :         timelib_sll tmp_nr = TIMELIB_UNSET;</span>
<span class="lineNum">     445 </span><span class="lineNoCov">              0 :         int len = 0;</span>
<span class="lineNum">     446 </span>                : 
<span class="lineNum">     447 </span><span class="lineNoCov">              0 :         while ((**ptr &lt; '0') || (**ptr &gt; '9')) {</span>
<span class="lineNum">     448 </span><span class="lineNoCov">              0 :                 if (**ptr == '\0') {</span>
<span class="lineNum">     449 </span><span class="lineNoCov">              0 :                         return TIMELIB_UNSET;</span>
<span class="lineNum">     450 </span>                :                 }
<span class="lineNum">     451 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     452 </span>                :         }
<span class="lineNum">     453 </span><span class="lineNoCov">              0 :         begin = *ptr;</span>
<span class="lineNum">     454 </span><span class="lineNoCov">              0 :         while ((**ptr &gt;= '0') &amp;&amp; (**ptr &lt;= '9') &amp;&amp; len &lt; max_length) {</span>
<span class="lineNum">     455 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     456 </span><span class="lineNoCov">              0 :                 ++len;</span>
<span class="lineNum">     457 </span>                :         }
<span class="lineNum">     458 </span><span class="lineNoCov">              0 :         end = *ptr;</span>
<span class="lineNum">     459 </span><span class="lineNoCov">              0 :         if (scanned_length) {</span>
<span class="lineNum">     460 </span><span class="lineNoCov">              0 :                 *scanned_length = end - begin;</span>
<span class="lineNum">     461 </span>                :         }
<span class="lineNum">     462 </span><span class="lineNoCov">              0 :         str = calloc(1, end - begin + 1);</span>
<span class="lineNum">     463 </span><span class="lineNoCov">              0 :         memcpy(str, begin, end - begin);</span>
<span class="lineNum">     464 </span><span class="lineNoCov">              0 :         tmp_nr = strtoll(str, NULL, 10);</span>
<span class="lineNum">     465 </span><span class="lineNoCov">              0 :         free(str);</span>
<span class="lineNum">     466 </span><span class="lineNoCov">              0 :         return tmp_nr;</span>
<a name="467"><span class="lineNum">     467 </span>                : }</a>
<span class="lineNum">     468 </span>                : 
<span class="lineNum">     469 </span><span class="lineNoCov">              0 : static timelib_sll timelib_get_nr(char **ptr, int max_length)</span>
<span class="lineNum">     470 </span>                : {
<span class="lineNum">     471 </span><span class="lineNoCov">              0 :         return timelib_get_nr_ex(ptr, max_length, NULL);</span>
<a name="472"><span class="lineNum">     472 </span>                : }</a>
<span class="lineNum">     473 </span>                : 
<span class="lineNum">     474 </span><span class="lineNoCov">              0 : static void timelib_skip_day_suffix(char **ptr)</span>
<span class="lineNum">     475 </span>                : {
<span class="lineNum">     476 </span><span class="lineNoCov">              0 :         if (isspace(**ptr)) {</span>
<span class="lineNum">     477 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">     478 </span>                :         }
<span class="lineNum">     479 </span><span class="lineNoCov">              0 :         if (!strncasecmp(*ptr, &quot;nd&quot;, 2) || !strncasecmp(*ptr, &quot;rd&quot;, 2) ||!strncasecmp(*ptr, &quot;st&quot;, 2) || !strncasecmp(*ptr, &quot;th&quot;, 2)) {</span>
<span class="lineNum">     480 </span><span class="lineNoCov">              0 :                 *ptr += 2;</span>
<span class="lineNum">     481 </span>                :         }
<a name="482"><span class="lineNum">     482 </span>                : }</a>
<span class="lineNum">     483 </span>                : 
<span class="lineNum">     484 </span><span class="lineNoCov">              0 : static double timelib_get_frac_nr(char **ptr, int max_length)</span>
<span class="lineNum">     485 </span>                : {
<span class="lineNum">     486 </span>                :         char *begin, *end, *str;
<span class="lineNum">     487 </span><span class="lineNoCov">              0 :         double tmp_nr = TIMELIB_UNSET;</span>
<span class="lineNum">     488 </span><span class="lineNoCov">              0 :         int len = 0;</span>
<span class="lineNum">     489 </span>                : 
<span class="lineNum">     490 </span><span class="lineNoCov">              0 :         while ((**ptr != '.') &amp;&amp; (**ptr != ':') &amp;&amp; ((**ptr &lt; '0') || (**ptr &gt; '9'))) {</span>
<span class="lineNum">     491 </span><span class="lineNoCov">              0 :                 if (**ptr == '\0') {</span>
<span class="lineNum">     492 </span><span class="lineNoCov">              0 :                         return TIMELIB_UNSET;</span>
<span class="lineNum">     493 </span>                :                 }
<span class="lineNum">     494 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     495 </span>                :         }
<span class="lineNum">     496 </span><span class="lineNoCov">              0 :         begin = *ptr;</span>
<span class="lineNum">     497 </span><span class="lineNoCov">              0 :         while (((**ptr == '.') || (**ptr == ':') || ((**ptr &gt;= '0') &amp;&amp; (**ptr &lt;= '9'))) &amp;&amp; len &lt; max_length) {</span>
<span class="lineNum">     498 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     499 </span><span class="lineNoCov">              0 :                 ++len;</span>
<span class="lineNum">     500 </span>                :         }
<span class="lineNum">     501 </span><span class="lineNoCov">              0 :         end = *ptr;</span>
<span class="lineNum">     502 </span><span class="lineNoCov">              0 :         str = calloc(1, end - begin + 1);</span>
<span class="lineNum">     503 </span><span class="lineNoCov">              0 :         memcpy(str, begin, end - begin);</span>
<span class="lineNum">     504 </span><span class="lineNoCov">              0 :         if (str[0] == ':') {</span>
<span class="lineNum">     505 </span><span class="lineNoCov">              0 :                 str[0] = '.';</span>
<span class="lineNum">     506 </span>                :         }
<span class="lineNum">     507 </span><span class="lineNoCov">              0 :         tmp_nr = strtod(str, NULL);</span>
<span class="lineNum">     508 </span><span class="lineNoCov">              0 :         free(str);</span>
<span class="lineNum">     509 </span><span class="lineNoCov">              0 :         return tmp_nr;</span>
<a name="510"><span class="lineNum">     510 </span>                : }</a>
<span class="lineNum">     511 </span>                : 
<span class="lineNum">     512 </span><span class="lineNoCov">              0 : static timelib_ull timelib_get_unsigned_nr(char **ptr, int max_length)</span>
<span class="lineNum">     513 </span>                : {
<span class="lineNum">     514 </span><span class="lineNoCov">              0 :         timelib_ull dir = 1;</span>
<span class="lineNum">     515 </span>                : 
<span class="lineNum">     516 </span><span class="lineNoCov">              0 :         while (((**ptr &lt; '0') || (**ptr &gt; '9')) &amp;&amp; (**ptr != '+') &amp;&amp; (**ptr != '-')) {</span>
<span class="lineNum">     517 </span><span class="lineNoCov">              0 :                 if (**ptr == '\0') {</span>
<span class="lineNum">     518 </span><span class="lineNoCov">              0 :                         return TIMELIB_UNSET;</span>
<span class="lineNum">     519 </span>                :                 }
<span class="lineNum">     520 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     521 </span>                :         }
<span class="lineNum">     522 </span>                : 
<span class="lineNum">     523 </span><span class="lineNoCov">              0 :         while (**ptr == '+' || **ptr == '-')</span>
<span class="lineNum">     524 </span>                :         {
<span class="lineNum">     525 </span><span class="lineNoCov">              0 :                 if (**ptr == '-') {</span>
<span class="lineNum">     526 </span><span class="lineNoCov">              0 :                         dir *= -1;</span>
<span class="lineNum">     527 </span>                :                 }
<span class="lineNum">     528 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     529 </span>                :         }
<span class="lineNum">     530 </span><span class="lineNoCov">              0 :         return dir * timelib_get_nr(ptr, max_length);</span>
<a name="531"><span class="lineNum">     531 </span>                : }</a>
<span class="lineNum">     532 </span>                : 
<span class="lineNum">     533 </span><span class="lineNoCov">              0 : static long timelib_parse_tz_cor(char **ptr)</span>
<span class="lineNum">     534 </span>                : {
<span class="lineNum">     535 </span><span class="lineNoCov">              0 :         char *begin = *ptr, *end;</span>
<span class="lineNum">     536 </span>                :         long  tmp;
<span class="lineNum">     537 </span>                : 
<span class="lineNum">     538 </span><span class="lineNoCov">              0 :         while (isdigit(**ptr) || **ptr == ':') {</span>
<span class="lineNum">     539 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     540 </span>                :         }
<span class="lineNum">     541 </span><span class="lineNoCov">              0 :         end = *ptr;</span>
<span class="lineNum">     542 </span><span class="lineNoCov">              0 :         switch (end - begin) {</span>
<span class="lineNum">     543 </span>                :                 case 1:
<span class="lineNum">     544 </span>                :                 case 2:
<span class="lineNum">     545 </span><span class="lineNoCov">              0 :                         return HOUR(strtol(begin, NULL, 10));</span>
<span class="lineNum">     546 </span>                :                         break;
<span class="lineNum">     547 </span>                :                 case 3:
<span class="lineNum">     548 </span>                :                 case 4:
<span class="lineNum">     549 </span><span class="lineNoCov">              0 :                         if (begin[1] == ':') {</span>
<span class="lineNum">     550 </span><span class="lineNoCov">              0 :                                 tmp = HOUR(strtol(begin, NULL, 10)) + strtol(begin + 2, NULL, 10);</span>
<span class="lineNum">     551 </span><span class="lineNoCov">              0 :                                 return tmp;</span>
<span class="lineNum">     552 </span><span class="lineNoCov">              0 :                         } else if (begin[2] == ':') {</span>
<span class="lineNum">     553 </span><span class="lineNoCov">              0 :                                 tmp = HOUR(strtol(begin, NULL, 10)) + strtol(begin + 3, NULL, 10);</span>
<span class="lineNum">     554 </span><span class="lineNoCov">              0 :                                 return tmp;</span>
<span class="lineNum">     555 </span>                :                         } else {
<span class="lineNum">     556 </span><span class="lineNoCov">              0 :                                 tmp = strtol(begin, NULL, 10);</span>
<span class="lineNum">     557 </span><span class="lineNoCov">              0 :                                 return HOUR(tmp / 100) + tmp % 100;</span>
<span class="lineNum">     558 </span>                :                         }
<span class="lineNum">     559 </span>                :                 case 5:
<span class="lineNum">     560 </span><span class="lineNoCov">              0 :                         tmp = HOUR(strtol(begin, NULL, 10)) + strtol(begin + 3, NULL, 10);</span>
<span class="lineNum">     561 </span><span class="lineNoCov">              0 :                         return tmp;</span>
<span class="lineNum">     562 </span>                :         }
<span class="lineNum">     563 </span><span class="lineNoCov">              0 :         return 0;</span>
<a name="564"><span class="lineNum">     564 </span>                : }</a>
<span class="lineNum">     565 </span>                : 
<span class="lineNum">     566 </span><span class="lineNoCov">              0 : static timelib_sll timelib_lookup_relative_text(char **ptr, int *behavior)</span>
<span class="lineNum">     567 </span>                : {
<span class="lineNum">     568 </span>                :         char *word;
<span class="lineNum">     569 </span><span class="lineNoCov">              0 :         char *begin = *ptr, *end;</span>
<span class="lineNum">     570 </span><span class="lineNoCov">              0 :         timelib_sll  value = 0;</span>
<span class="lineNum">     571 </span>                :         const timelib_lookup_table *tp;
<span class="lineNum">     572 </span>                : 
<span class="lineNum">     573 </span><span class="lineNoCov">              0 :         while ((**ptr &gt;= 'A' &amp;&amp; **ptr &lt;= 'Z') || (**ptr &gt;= 'a' &amp;&amp; **ptr &lt;= 'z')) {</span>
<span class="lineNum">     574 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     575 </span>                :         }
<span class="lineNum">     576 </span><span class="lineNoCov">              0 :         end = *ptr;</span>
<span class="lineNum">     577 </span><span class="lineNoCov">              0 :         word = calloc(1, end - begin + 1);</span>
<span class="lineNum">     578 </span><span class="lineNoCov">              0 :         memcpy(word, begin, end - begin);</span>
<span class="lineNum">     579 </span>                : 
<span class="lineNum">     580 </span><span class="lineNoCov">              0 :         for (tp = timelib_reltext_lookup; tp-&gt;name; tp++) {</span>
<span class="lineNum">     581 </span><span class="lineNoCov">              0 :                 if (strcasecmp(word, tp-&gt;name) == 0) {</span>
<span class="lineNum">     582 </span><span class="lineNoCov">              0 :                         value = tp-&gt;value;</span>
<span class="lineNum">     583 </span><span class="lineNoCov">              0 :                         *behavior = tp-&gt;type;</span>
<span class="lineNum">     584 </span>                :                 }
<span class="lineNum">     585 </span>                :         }
<span class="lineNum">     586 </span>                : 
<span class="lineNum">     587 </span><span class="lineNoCov">              0 :         free(word);</span>
<span class="lineNum">     588 </span><span class="lineNoCov">              0 :         return value;</span>
<a name="589"><span class="lineNum">     589 </span>                : }</a>
<span class="lineNum">     590 </span>                : 
<span class="lineNum">     591 </span><span class="lineNoCov">              0 : static timelib_sll timelib_get_relative_text(char **ptr, int *behavior)</span>
<span class="lineNum">     592 </span>                : {
<span class="lineNum">     593 </span><span class="lineNoCov">              0 :         while (**ptr == ' ' || **ptr == '\t' || **ptr == '-' || **ptr == '/') {</span>
<span class="lineNum">     594 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     595 </span>                :         }
<span class="lineNum">     596 </span><span class="lineNoCov">              0 :         return timelib_lookup_relative_text(ptr, behavior);</span>
<a name="597"><span class="lineNum">     597 </span>                : }</a>
<span class="lineNum">     598 </span>                : 
<span class="lineNum">     599 </span><span class="lineNoCov">              0 : static long timelib_lookup_month(char **ptr)</span>
<span class="lineNum">     600 </span>                : {
<span class="lineNum">     601 </span>                :         char *word;
<span class="lineNum">     602 </span><span class="lineNoCov">              0 :         char *begin = *ptr, *end;</span>
<span class="lineNum">     603 </span><span class="lineNoCov">              0 :         long  value = 0;</span>
<span class="lineNum">     604 </span>                :         const timelib_lookup_table *tp;
<span class="lineNum">     605 </span>                : 
<span class="lineNum">     606 </span><span class="lineNoCov">              0 :         while ((**ptr &gt;= 'A' &amp;&amp; **ptr &lt;= 'Z') || (**ptr &gt;= 'a' &amp;&amp; **ptr &lt;= 'z')) {</span>
<span class="lineNum">     607 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     608 </span>                :         }
<span class="lineNum">     609 </span><span class="lineNoCov">              0 :         end = *ptr;</span>
<span class="lineNum">     610 </span><span class="lineNoCov">              0 :         word = calloc(1, end - begin + 1);</span>
<span class="lineNum">     611 </span><span class="lineNoCov">              0 :         memcpy(word, begin, end - begin);</span>
<span class="lineNum">     612 </span>                : 
<span class="lineNum">     613 </span><span class="lineNoCov">              0 :         for (tp = timelib_month_lookup; tp-&gt;name; tp++) {</span>
<span class="lineNum">     614 </span><span class="lineNoCov">              0 :                 if (strcasecmp(word, tp-&gt;name) == 0) {</span>
<span class="lineNum">     615 </span><span class="lineNoCov">              0 :                         value = tp-&gt;value;</span>
<span class="lineNum">     616 </span>                :                 }
<span class="lineNum">     617 </span>                :         }
<span class="lineNum">     618 </span>                : 
<span class="lineNum">     619 </span><span class="lineNoCov">              0 :         free(word);</span>
<span class="lineNum">     620 </span><span class="lineNoCov">              0 :         return value;</span>
<a name="621"><span class="lineNum">     621 </span>                : }</a>
<span class="lineNum">     622 </span>                : 
<span class="lineNum">     623 </span><span class="lineNoCov">              0 : static long timelib_get_month(char **ptr)</span>
<span class="lineNum">     624 </span>                : {
<span class="lineNum">     625 </span><span class="lineNoCov">              0 :         while (**ptr == ' ' || **ptr == '\t' || **ptr == '-' || **ptr == '.' || **ptr == '/') {</span>
<span class="lineNum">     626 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     627 </span>                :         }
<span class="lineNum">     628 </span><span class="lineNoCov">              0 :         return timelib_lookup_month(ptr);</span>
<a name="629"><span class="lineNum">     629 </span>                : }</a>
<span class="lineNum">     630 </span>                : 
<span class="lineNum">     631 </span><span class="lineNoCov">              0 : static void timelib_eat_spaces(char **ptr)</span>
<span class="lineNum">     632 </span>                : {
<span class="lineNum">     633 </span><span class="lineNoCov">              0 :         while (**ptr == ' ' || **ptr == '\t') {</span>
<span class="lineNum">     634 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     635 </span>                :         }
<a name="636"><span class="lineNum">     636 </span><span class="lineNoCov">              0 : }</span></a>
<span class="lineNum">     637 </span>                : 
<span class="lineNum">     638 </span><span class="lineNoCov">              0 : static void timelib_eat_until_separator(char **ptr)</span>
<span class="lineNum">     639 </span>                : {
<span class="lineNum">     640 </span><span class="lineNoCov">              0 :         ++*ptr;</span>
<span class="lineNum">     641 </span><span class="lineNoCov">              0 :         while (strchr(&quot; \t.,:;/-0123456789&quot;, **ptr) == NULL) {</span>
<span class="lineNum">     642 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     643 </span>                :         }
<a name="644"><span class="lineNum">     644 </span><span class="lineNoCov">              0 : }</span></a>
<span class="lineNum">     645 </span>                : 
<span class="lineNum">     646 </span><span class="lineNoCov">              0 : static const timelib_relunit* timelib_lookup_relunit(char **ptr)</span>
<span class="lineNum">     647 </span>                : {
<span class="lineNum">     648 </span>                :         char *word;
<span class="lineNum">     649 </span><span class="lineNoCov">              0 :         char *begin = *ptr, *end;</span>
<span class="lineNum">     650 </span><span class="lineNoCov">              0 :         const timelib_relunit *tp, *value = NULL;</span>
<span class="lineNum">     651 </span>                : 
<span class="lineNum">     652 </span><span class="lineNoCov">              0 :         while (**ptr != '\0' &amp;&amp; **ptr != ' ' &amp;&amp; **ptr != ',' &amp;&amp; **ptr != '\t') {</span>
<span class="lineNum">     653 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     654 </span>                :         }
<span class="lineNum">     655 </span><span class="lineNoCov">              0 :         end = *ptr;</span>
<span class="lineNum">     656 </span><span class="lineNoCov">              0 :         word = calloc(1, end - begin + 1);</span>
<span class="lineNum">     657 </span><span class="lineNoCov">              0 :         memcpy(word, begin, end - begin);</span>
<span class="lineNum">     658 </span>                : 
<span class="lineNum">     659 </span><span class="lineNoCov">              0 :         for (tp = timelib_relunit_lookup; tp-&gt;name; tp++) {</span>
<span class="lineNum">     660 </span><span class="lineNoCov">              0 :                 if (strcasecmp(word, tp-&gt;name) == 0) {</span>
<span class="lineNum">     661 </span><span class="lineNoCov">              0 :                         value = tp;</span>
<span class="lineNum">     662 </span><span class="lineNoCov">              0 :                         break;</span>
<span class="lineNum">     663 </span>                :                 }
<span class="lineNum">     664 </span>                :         }
<span class="lineNum">     665 </span>                : 
<span class="lineNum">     666 </span><span class="lineNoCov">              0 :         free(word);</span>
<span class="lineNum">     667 </span><span class="lineNoCov">              0 :         return value;</span>
<a name="668"><span class="lineNum">     668 </span>                : }</a>
<span class="lineNum">     669 </span>                : 
<span class="lineNum">     670 </span><span class="lineNoCov">              0 : static void timelib_set_relative(char **ptr, timelib_sll amount, int behavior, Scanner *s)</span>
<span class="lineNum">     671 </span>                : {
<span class="lineNum">     672 </span>                :         const timelib_relunit* relunit;
<span class="lineNum">     673 </span>                : 
<span class="lineNum">     674 </span><span class="lineNoCov">              0 :         if (!(relunit = timelib_lookup_relunit(ptr))) {</span>
<span class="lineNum">     675 </span><span class="lineNoCov">              0 :                 return;</span>
<span class="lineNum">     676 </span>                :         }
<span class="lineNum">     677 </span>                : 
<span class="lineNum">     678 </span><span class="lineNoCov">              0 :         switch (relunit-&gt;unit) {</span>
<span class="lineNum">     679 </span><span class="lineNoCov">              0 :                 case TIMELIB_SECOND: s-&gt;time-&gt;relative.s += amount * relunit-&gt;multiplier; break;</span>
<span class="lineNum">     680 </span><span class="lineNoCov">              0 :                 case TIMELIB_MINUTE: s-&gt;time-&gt;relative.i += amount * relunit-&gt;multiplier; break;</span>
<span class="lineNum">     681 </span><span class="lineNoCov">              0 :                 case TIMELIB_HOUR:   s-&gt;time-&gt;relative.h += amount * relunit-&gt;multiplier; break;</span>
<span class="lineNum">     682 </span><span class="lineNoCov">              0 :                 case TIMELIB_DAY:    s-&gt;time-&gt;relative.d += amount * relunit-&gt;multiplier; break;</span>
<span class="lineNum">     683 </span><span class="lineNoCov">              0 :                 case TIMELIB_MONTH:  s-&gt;time-&gt;relative.m += amount * relunit-&gt;multiplier; break;</span>
<span class="lineNum">     684 </span><span class="lineNoCov">              0 :                 case TIMELIB_YEAR:   s-&gt;time-&gt;relative.y += amount * relunit-&gt;multiplier; break;</span>
<span class="lineNum">     685 </span>                : 
<span class="lineNum">     686 </span>                :                 case TIMELIB_WEEKDAY:
<span class="lineNum">     687 </span><span class="lineNoCov">              0 :                         TIMELIB_HAVE_WEEKDAY_RELATIVE();</span>
<span class="lineNum">     688 </span><span class="lineNoCov">              0 :                         TIMELIB_UNHAVE_TIME();</span>
<span class="lineNum">     689 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;relative.d += (amount &gt; 0 ? amount - 1 : amount) * 7;</span>
<span class="lineNum">     690 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;relative.weekday = relunit-&gt;multiplier;</span>
<span class="lineNum">     691 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;relative.weekday_behavior = behavior;</span>
<span class="lineNum">     692 </span><span class="lineNoCov">              0 :                         break;</span>
<span class="lineNum">     693 </span>                : 
<span class="lineNum">     694 </span>                :                 case TIMELIB_SPECIAL:
<span class="lineNum">     695 </span><span class="lineNoCov">              0 :                         TIMELIB_HAVE_SPECIAL_RELATIVE();</span>
<span class="lineNum">     696 </span><span class="lineNoCov">              0 :                         TIMELIB_UNHAVE_TIME();</span>
<span class="lineNum">     697 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;relative.special.type = relunit-&gt;multiplier;</span>
<span class="lineNum">     698 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;relative.special.amount = amount;</span>
<span class="lineNum">     699 </span>                :         }
<a name="700"><span class="lineNum">     700 </span>                : }</a>
<span class="lineNum">     701 </span>                : 
<span class="lineNum">     702 </span><span class="lineNoCov">              0 : const static timelib_tz_lookup_table* zone_search(const char *word, long gmtoffset, int isdst)</span>
<span class="lineNum">     703 </span>                : {
<span class="lineNum">     704 </span><span class="lineNoCov">              0 :         int first_found = 0;</span>
<span class="lineNum">     705 </span><span class="lineNoCov">              0 :         const timelib_tz_lookup_table  *tp, *first_found_elem = NULL;</span>
<span class="lineNum">     706 </span>                :         const timelib_tz_lookup_table  *fmp;
<span class="lineNum">     707 </span>                : 
<span class="lineNum">     708 </span><span class="lineNoCov">              0 :         if (strcasecmp(&quot;utc&quot;, word) == 0 || strcasecmp(&quot;gmt&quot;, word) == 0) {</span>
<span class="lineNum">     709 </span><span class="lineNoCov">              0 :                 return timelib_timezone_utc;</span>
<span class="lineNum">     710 </span>                :         }
<span class="lineNum">     711 </span>                :         
<span class="lineNum">     712 </span><span class="lineNoCov">              0 :         for (tp = timelib_timezone_lookup; tp-&gt;name; tp++) {</span>
<span class="lineNum">     713 </span><span class="lineNoCov">              0 :                 if (strcasecmp(word, tp-&gt;name) == 0) {</span>
<span class="lineNum">     714 </span><span class="lineNoCov">              0 :                         if (!first_found) {</span>
<span class="lineNum">     715 </span><span class="lineNoCov">              0 :                                 first_found = 1;</span>
<span class="lineNum">     716 </span><span class="lineNoCov">              0 :                                 first_found_elem = tp;</span>
<span class="lineNum">     717 </span><span class="lineNoCov">              0 :                                 if (gmtoffset == -1) {</span>
<span class="lineNum">     718 </span><span class="lineNoCov">              0 :                                         return tp;</span>
<span class="lineNum">     719 </span>                :                                 }
<span class="lineNum">     720 </span>                :                         }
<span class="lineNum">     721 </span><span class="lineNoCov">              0 :                         if (tp-&gt;gmtoffset == gmtoffset) {</span>
<span class="lineNum">     722 </span><span class="lineNoCov">              0 :                                 return tp;</span>
<span class="lineNum">     723 </span>                :                         }
<span class="lineNum">     724 </span>                :                 }
<span class="lineNum">     725 </span>                :         }
<span class="lineNum">     726 </span><span class="lineNoCov">              0 :         if (first_found) {</span>
<span class="lineNum">     727 </span><span class="lineNoCov">              0 :                 return first_found_elem;</span>
<span class="lineNum">     728 </span>                :         }
<span class="lineNum">     729 </span>                : 
<span class="lineNum">     730 </span><span class="lineNoCov">              0 :         for (tp = timelib_timezone_lookup; tp-&gt;name; tp++) {</span>
<span class="lineNum">     731 </span><span class="lineNoCov">              0 :                 if (tp-&gt;full_tz_name &amp;&amp; strcasecmp(word, tp-&gt;full_tz_name) == 0) {</span>
<span class="lineNum">     732 </span><span class="lineNoCov">              0 :                         if (!first_found) {</span>
<span class="lineNum">     733 </span><span class="lineNoCov">              0 :                                 first_found = 1;</span>
<span class="lineNum">     734 </span><span class="lineNoCov">              0 :                                 first_found_elem = tp;</span>
<span class="lineNum">     735 </span><span class="lineNoCov">              0 :                                 if (gmtoffset == -1) {</span>
<span class="lineNum">     736 </span><span class="lineNoCov">              0 :                                         return tp;</span>
<span class="lineNum">     737 </span>                :                                 }
<span class="lineNum">     738 </span>                :                         }
<span class="lineNum">     739 </span><span class="lineNoCov">              0 :                         if (tp-&gt;gmtoffset == gmtoffset) {</span>
<span class="lineNum">     740 </span><span class="lineNoCov">              0 :                                 return tp;</span>
<span class="lineNum">     741 </span>                :                         }
<span class="lineNum">     742 </span>                :                 }
<span class="lineNum">     743 </span>                :         }
<span class="lineNum">     744 </span><span class="lineNoCov">              0 :         if (first_found) {</span>
<span class="lineNum">     745 </span><span class="lineNoCov">              0 :                 return first_found_elem;</span>
<span class="lineNum">     746 </span>                :         }
<span class="lineNum">     747 </span>                : 
<span class="lineNum">     748 </span>                : 
<span class="lineNum">     749 </span>                :         /* Still didn't find anything, let's find the zone solely based on
<span class="lineNum">     750 </span>                :          * offset/isdst then */
<span class="lineNum">     751 </span><span class="lineNoCov">              0 :         for (fmp = timelib_timezone_fallbackmap; fmp-&gt;name; fmp++) {</span>
<span class="lineNum">     752 </span><span class="lineNoCov">              0 :                 if ((fmp-&gt;gmtoffset * 3600) == gmtoffset &amp;&amp; fmp-&gt;type == isdst) {</span>
<span class="lineNum">     753 </span><span class="lineNoCov">              0 :                         return fmp;</span>
<span class="lineNum">     754 </span>                :                 }
<span class="lineNum">     755 </span>                :         }
<span class="lineNum">     756 </span><span class="lineNoCov">              0 :         return NULL;</span>
<a name="757"><span class="lineNum">     757 </span>                : }</a>
<span class="lineNum">     758 </span>                : 
<span class="lineNum">     759 </span><span class="lineNoCov">              0 : static long timelib_lookup_zone(char **ptr, int *dst, char **tz_abbr, int *found)</span>
<span class="lineNum">     760 </span>                : {
<span class="lineNum">     761 </span>                :         char *word;
<span class="lineNum">     762 </span><span class="lineNoCov">              0 :         char *begin = *ptr, *end;</span>
<span class="lineNum">     763 </span><span class="lineNoCov">              0 :         long  value = 0;</span>
<span class="lineNum">     764 </span>                :         const timelib_tz_lookup_table *tp;
<span class="lineNum">     765 </span>                : 
<span class="lineNum">     766 </span><span class="lineNoCov">              0 :         while (**ptr != '\0' &amp;&amp; **ptr != ')' &amp;&amp; **ptr != ' ') {</span>
<span class="lineNum">     767 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     768 </span>                :         }
<span class="lineNum">     769 </span><span class="lineNoCov">              0 :         end = *ptr;</span>
<span class="lineNum">     770 </span><span class="lineNoCov">              0 :         word = calloc(1, end - begin + 1);</span>
<span class="lineNum">     771 </span><span class="lineNoCov">              0 :         memcpy(word, begin, end - begin);</span>
<span class="lineNum">     772 </span>                : 
<span class="lineNum">     773 </span><span class="lineNoCov">              0 :         if ((tp = zone_search(word, -1, 0))) {</span>
<span class="lineNum">     774 </span><span class="lineNoCov">              0 :                 value = -tp-&gt;gmtoffset / 60;</span>
<span class="lineNum">     775 </span><span class="lineNoCov">              0 :                 *dst = tp-&gt;type;</span>
<span class="lineNum">     776 </span><span class="lineNoCov">              0 :                 value += tp-&gt;type * 60;</span>
<span class="lineNum">     777 </span><span class="lineNoCov">              0 :                 *found = 1;</span>
<span class="lineNum">     778 </span>                :         } else {
<span class="lineNum">     779 </span><span class="lineNoCov">              0 :                 *found = 0;</span>
<span class="lineNum">     780 </span>                :         }
<span class="lineNum">     781 </span>                : 
<span class="lineNum">     782 </span><span class="lineNoCov">              0 :         *tz_abbr = word;</span>
<span class="lineNum">     783 </span><span class="lineNoCov">              0 :         return value;</span>
<a name="784"><span class="lineNum">     784 </span>                : }</a>
<span class="lineNum">     785 </span>                : 
<span class="lineNum">     786 </span><span class="lineNoCov">              0 : static long timelib_get_zone(char **ptr, int *dst, timelib_time *t, int *tz_not_found, const timelib_tzdb *tzdb, timelib_tz_get_wrapper tz_wrapper)</span>
<span class="lineNum">     787 </span>                : {
<span class="lineNum">     788 </span>                :         timelib_tzinfo *res;
<span class="lineNum">     789 </span><span class="lineNoCov">              0 :         long            retval = 0;</span>
<span class="lineNum">     790 </span>                : 
<span class="lineNum">     791 </span><span class="lineNoCov">              0 :         *tz_not_found = 0;</span>
<span class="lineNum">     792 </span>                : 
<span class="lineNum">     793 </span><span class="lineNoCov">              0 :         while (**ptr == ' ' || **ptr == '\t' || **ptr == '(') {</span>
<span class="lineNum">     794 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     795 </span>                :         }
<span class="lineNum">     796 </span><span class="lineNoCov">              0 :         if ((*ptr)[0] == 'G' &amp;&amp; (*ptr)[1] == 'M' &amp;&amp; (*ptr)[2] == 'T' &amp;&amp; ((*ptr)[3] == '+' || (*ptr)[3] == '-')) {</span>
<span class="lineNum">     797 </span><span class="lineNoCov">              0 :                 *ptr += 3;</span>
<span class="lineNum">     798 </span>                :         }
<span class="lineNum">     799 </span><span class="lineNoCov">              0 :         if (**ptr == '+') {</span>
<span class="lineNum">     800 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     801 </span><span class="lineNoCov">              0 :                 t-&gt;is_localtime = 1;</span>
<span class="lineNum">     802 </span><span class="lineNoCov">              0 :                 t-&gt;zone_type = TIMELIB_ZONETYPE_OFFSET;</span>
<span class="lineNum">     803 </span><span class="lineNoCov">              0 :                 *tz_not_found = 0;</span>
<span class="lineNum">     804 </span><span class="lineNoCov">              0 :                 t-&gt;dst = 0;</span>
<span class="lineNum">     805 </span>                : 
<span class="lineNum">     806 </span><span class="lineNoCov">              0 :                 retval = -1 * timelib_parse_tz_cor(ptr);</span>
<span class="lineNum">     807 </span><span class="lineNoCov">              0 :         } else if (**ptr == '-') {</span>
<span class="lineNum">     808 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     809 </span><span class="lineNoCov">              0 :                 t-&gt;is_localtime = 1;</span>
<span class="lineNum">     810 </span><span class="lineNoCov">              0 :                 t-&gt;zone_type = TIMELIB_ZONETYPE_OFFSET;</span>
<span class="lineNum">     811 </span><span class="lineNoCov">              0 :                 *tz_not_found = 0;</span>
<span class="lineNum">     812 </span><span class="lineNoCov">              0 :                 t-&gt;dst = 0;</span>
<span class="lineNum">     813 </span>                : 
<span class="lineNum">     814 </span><span class="lineNoCov">              0 :                 retval = timelib_parse_tz_cor(ptr);</span>
<span class="lineNum">     815 </span>                :         } else {
<span class="lineNum">     816 </span><span class="lineNoCov">              0 :                 int found = 0;</span>
<span class="lineNum">     817 </span>                :                 long offset;
<span class="lineNum">     818 </span>                :                 char *tz_abbr;
<span class="lineNum">     819 </span>                : 
<span class="lineNum">     820 </span><span class="lineNoCov">              0 :                 t-&gt;is_localtime = 1;</span>
<span class="lineNum">     821 </span>                : 
<span class="lineNum">     822 </span><span class="lineNoCov">              0 :                 offset = timelib_lookup_zone(ptr, dst, &amp;tz_abbr, &amp;found);</span>
<span class="lineNum">     823 </span><span class="lineNoCov">              0 :                 if (found) {</span>
<span class="lineNum">     824 </span><span class="lineNoCov">              0 :                         t-&gt;zone_type = TIMELIB_ZONETYPE_ABBR;</span>
<span class="lineNum">     825 </span>                :                 }
<span class="lineNum">     826 </span>                : #if 0
<span class="lineNum">     827 </span>                :                 /* If we found a TimeZone identifier, use it */
<span class="lineNum">     828 </span>                :                 if (tz_name) {
<span class="lineNum">     829 </span>                :                         t-&gt;tz_info = timelib_parse_tzfile(tz_name);
<span class="lineNum">     830 </span>                :                         t-&gt;zone_type = TIMELIB_ZONETYPE_ID;
<span class="lineNum">     831 </span>                :                 }
<span class="lineNum">     832 </span>                : #endif
<span class="lineNum">     833 </span>                :                 /* If we have a TimeZone identifier to start with, use it */
<span class="lineNum">     834 </span><span class="lineNoCov">              0 :                 if (strstr(tz_abbr, &quot;/&quot;) || strcmp(tz_abbr, &quot;UTC&quot;) == 0) {</span>
<span class="lineNum">     835 </span><span class="lineNoCov">              0 :                         if ((res = tz_wrapper(tz_abbr, tzdb)) != NULL) {</span>
<span class="lineNum">     836 </span><span class="lineNoCov">              0 :                                 t-&gt;tz_info = res;</span>
<span class="lineNum">     837 </span><span class="lineNoCov">              0 :                                 t-&gt;zone_type = TIMELIB_ZONETYPE_ID;</span>
<span class="lineNum">     838 </span><span class="lineNoCov">              0 :                                 found++;</span>
<span class="lineNum">     839 </span>                :                         }
<span class="lineNum">     840 </span>                :                 }
<span class="lineNum">     841 </span><span class="lineNoCov">              0 :                 if (found &amp;&amp; t-&gt;zone_type != TIMELIB_ZONETYPE_ID) {</span>
<span class="lineNum">     842 </span><span class="lineNoCov">              0 :                         timelib_time_tz_abbr_update(t, tz_abbr);</span>
<span class="lineNum">     843 </span>                :                 }
<span class="lineNum">     844 </span><span class="lineNoCov">              0 :                 free(tz_abbr);</span>
<span class="lineNum">     845 </span><span class="lineNoCov">              0 :                 *tz_not_found = (found == 0);</span>
<span class="lineNum">     846 </span><span class="lineNoCov">              0 :                 retval = offset;</span>
<span class="lineNum">     847 </span>                :         }
<span class="lineNum">     848 </span><span class="lineNoCov">              0 :         while (**ptr == ')') {</span>
<span class="lineNum">     849 </span><span class="lineNoCov">              0 :                 ++*ptr;</span>
<span class="lineNum">     850 </span>                :         }
<span class="lineNum">     851 </span><span class="lineNoCov">              0 :         return retval;</span>
<span class="lineNum">     852 </span>                : }
<span class="lineNum">     853 </span>                : 
<span class="lineNum">     854 </span>                : #define timelib_split_free(arg) {       \
<span class="lineNum">     855 </span>                :         int i;                         \
<span class="lineNum">     856 </span>                :         for (i = 0; i &lt; arg.c; i++) {  \
<span class="lineNum">     857 </span>                :                 free(arg.v[i]);            \
<span class="lineNum">     858 </span>                :         }                              \
<span class="lineNum">     859 </span>                :         if (arg.v) {                   \
<span class="lineNum">     860 </span>                :                 free(arg.v);               \
<span class="lineNum">     861 </span>                :         }                              \
<a name="862"><span class="lineNum">     862 </span>                : }</a>
<span class="lineNum">     863 </span>                : 
<span class="lineNum">     864 </span><span class="lineNoCov">              0 : static int scan(Scanner *s, timelib_tz_get_wrapper tz_get_wrapper)</span>
<span class="lineNum">     865 </span>                : {
<span class="lineNum">     866 </span><span class="lineNoCov">              0 :         uchar *cursor = s-&gt;cur;</span>
<span class="lineNum">     867 </span><span class="lineNoCov">              0 :         char *str, *ptr = NULL;</span>
<span class="lineNum">     868 </span>                :                 
<span class="lineNum">     869 </span>                : std:
<span class="lineNum">     870 </span><span class="lineNoCov">              0 :         s-&gt;tok = cursor;</span>
<span class="lineNum">     871 </span><span class="lineNoCov">              0 :         s-&gt;len = 0;</span>
<span class="lineNum">     872 </span>                : /*!re2c
<span class="lineNum">     873 </span>                : any = [\000-\377];
<span class="lineNum">     874 </span>                : 
<span class="lineNum">     875 </span>                : space = [ \t]+;
<span class="lineNum">     876 </span>                : frac = &quot;.&quot;[0-9]+;
<span class="lineNum">     877 </span>                : 
<span class="lineNum">     878 </span>                : ago = 'ago';
<span class="lineNum">     879 </span>                : 
<span class="lineNum">     880 </span>                : hour24 = [01]?[0-9] | &quot;2&quot;[0-4];
<span class="lineNum">     881 </span>                : hour24lz = [01][0-9] | &quot;2&quot;[0-4];
<span class="lineNum">     882 </span>                : hour12 = &quot;0&quot;?[1-9] | &quot;1&quot;[0-2];
<span class="lineNum">     883 </span>                : minute = [0-5]?[0-9];
<span class="lineNum">     884 </span>                : minutelz = [0-5][0-9];
<span class="lineNum">     885 </span>                : second = minute | &quot;60&quot;;
<span class="lineNum">     886 </span>                : secondlz = minutelz | &quot;60&quot;;
<span class="lineNum">     887 </span>                : meridian = ([AaPp] &quot;.&quot;? [Mm] &quot;.&quot;?) [\000\t ];
<span class="lineNum">     888 </span>                : tz = &quot;(&quot;? [A-Za-z]{1,6} &quot;)&quot;? | [A-Z][a-z]+([_/-][A-Za-z]+)+;
<span class="lineNum">     889 </span>                : tzcorrection = &quot;GMT&quot;? [+-] hour24 &quot;:&quot;? minute?;
<span class="lineNum">     890 </span>                : 
<span class="lineNum">     891 </span>                : daysuf = &quot;st&quot; | &quot;nd&quot; | &quot;rd&quot; | &quot;th&quot;;
<span class="lineNum">     892 </span>                : 
<span class="lineNum">     893 </span>                : month = &quot;0&quot;? [0-9] | &quot;1&quot;[0-2];
<span class="lineNum">     894 </span>                : day   = (([0-2]?[0-9]) | (&quot;3&quot;[01])) daysuf?;
<span class="lineNum">     895 </span>                : year  = [0-9]{1,4};
<span class="lineNum">     896 </span>                : year2 = [0-9]{2};
<span class="lineNum">     897 </span>                : year4 = [0-9]{4};
<span class="lineNum">     898 </span>                : year4withsign = [+-]? [0-9]{4};
<span class="lineNum">     899 </span>                : 
<span class="lineNum">     900 </span>                : dayofyear = &quot;00&quot;[1-9] | &quot;0&quot;[1-9][0-9] | [1-2][0-9][0-9] | &quot;3&quot;[0-5][0-9] | &quot;36&quot;[0-6];
<span class="lineNum">     901 </span>                : weekofyear = &quot;0&quot;[1-9] | [1-4][0-9] | &quot;5&quot;[0-3];
<span class="lineNum">     902 </span>                : 
<span class="lineNum">     903 </span>                : monthlz = &quot;0&quot; [0-9] | &quot;1&quot; [0-2];
<span class="lineNum">     904 </span>                : daylz   = &quot;0&quot; [0-9] | [1-2][0-9] | &quot;3&quot; [01];
<span class="lineNum">     905 </span>                : 
<span class="lineNum">     906 </span>                : dayfull = 'sunday' | 'monday' | 'tuesday' | 'wednesday' | 'thursday' | 'friday' | 'saturday';
<span class="lineNum">     907 </span>                : dayabbr = 'sun' | 'mon' | 'tue' | 'wed' | 'thu' | 'fri' | 'sat' | 'sun';
<span class="lineNum">     908 </span>                : dayspecial = 'weekday' | 'weekdays';
<span class="lineNum">     909 </span>                : daytext = dayfull | dayabbr | dayspecial;
<span class="lineNum">     910 </span>                : 
<span class="lineNum">     911 </span>                : monthfull = 'january' | 'february' | 'march' | 'april' | 'may' | 'june' | 'july' | 'august' | 'september' | 'october' | 'november' | 'december';
<span class="lineNum">     912 </span>                : monthabbr = 'jan' | 'feb' | 'mar' | 'apr' | 'may' | 'jun' | 'jul' | 'aug' | 'sep' | 'sept' | 'oct' | 'nov' | 'dec';
<span class="lineNum">     913 </span>                : monthroman = &quot;I&quot; | &quot;II&quot; | &quot;III&quot; | &quot;IV&quot; | &quot;V&quot; | &quot;VI&quot; | &quot;VII&quot; | &quot;VIII&quot; | &quot;IX&quot; | &quot;X&quot; | &quot;XI&quot; | &quot;XII&quot;;
<span class="lineNum">     914 </span>                : monthtext = monthfull | monthabbr | monthroman;
<span class="lineNum">     915 </span>                : 
<span class="lineNum">     916 </span>                : /* Time formats */
<span class="lineNum">     917 </span>                : timetiny12 = hour12 space? meridian;
<span class="lineNum">     918 </span>                : timeshort12 = hour12[:.]minutelz space? meridian;
<span class="lineNum">     919 </span>                : timelong12 = hour12[:.]minute[:.]secondlz space? meridian;
<span class="lineNum">     920 </span>                : 
<span class="lineNum">     921 </span>                : timeshort24 = 't'? hour24[:.]minute;
<span class="lineNum">     922 </span>                : timelong24 =  't'? hour24[:.]minute[:.]second;
<span class="lineNum">     923 </span>                : iso8601long =  't'? hour24 [:.] minute [:.] second frac;
<span class="lineNum">     924 </span>                : 
<span class="lineNum">     925 </span>                : /* iso8601shorttz = hour24 [:] minutelz space? (tzcorrection | tz); */
<span class="lineNum">     926 </span>                : iso8601normtz =  't'? hour24 [:.] minute [:.] secondlz space? (tzcorrection | tz);
<span class="lineNum">     927 </span>                : /* iso8601longtz =  hour24 [:] minute [:] secondlz frac space? (tzcorrection | tz); */
<span class="lineNum">     928 </span>                : 
<span class="lineNum">     929 </span>                : gnunocolon       = 't'? hour24lz minutelz;
<span class="lineNum">     930 </span>                : /* gnunocolontz     = hour24lz minutelz space? (tzcorrection | tz); */
<span class="lineNum">     931 </span>                : iso8601nocolon   = 't'? hour24lz minutelz secondlz; 
<span class="lineNum">     932 </span>                : /* iso8601nocolontz = hour24lz minutelz secondlz space? (tzcorrection | tz); */
<span class="lineNum">     933 </span>                : 
<span class="lineNum">     934 </span>                : /* Date formats */
<span class="lineNum">     935 </span>                : americanshort    = month &quot;/&quot; day;
<span class="lineNum">     936 </span>                : american         = month &quot;/&quot; day &quot;/&quot; year;
<span class="lineNum">     937 </span>                : iso8601dateslash = year4 &quot;/&quot; monthlz &quot;/&quot; daylz &quot;/&quot;?;
<span class="lineNum">     938 </span>                : dateslash        = year4 &quot;/&quot; month &quot;/&quot; day;
<span class="lineNum">     939 </span>                : iso8601date4     = year4withsign &quot;-&quot; monthlz &quot;-&quot; daylz;
<span class="lineNum">     940 </span>                : iso8601date2     = year2 &quot;-&quot; monthlz &quot;-&quot; daylz;
<span class="lineNum">     941 </span>                : gnudateshorter   = year4 &quot;-&quot; month;
<span class="lineNum">     942 </span>                : gnudateshort     = year &quot;-&quot; month &quot;-&quot; day;
<span class="lineNum">     943 </span>                : pointeddate4     = day [.\t-] month [.-] year4;
<span class="lineNum">     944 </span>                : pointeddate2     = day [.\t] month &quot;.&quot; year2;
<span class="lineNum">     945 </span>                : datefull         = day ([ \t.-])* monthtext ([ \t.-])* year;
<span class="lineNum">     946 </span>                : datenoday        = monthtext ([ .\t-])* year4;
<span class="lineNum">     947 </span>                : datenodayrev     = year4 ([ .\t-])* monthtext;
<span class="lineNum">     948 </span>                : datetextual      = monthtext ([ .\t-])* day [,.stndrh\t ]+ year;
<span class="lineNum">     949 </span>                : datenoyear       = monthtext ([ .\t-])* day [,.stndrh\t ]*;
<span class="lineNum">     950 </span>                : datenoyearrev    = day ([ .\t-])* monthtext;
<span class="lineNum">     951 </span>                : datenocolon      = year4 monthlz daylz;
<span class="lineNum">     952 </span>                : 
<span class="lineNum">     953 </span>                : /* Special formats */
<span class="lineNum">     954 </span>                : soap             = year4 &quot;-&quot; monthlz &quot;-&quot; daylz &quot;T&quot; hour24lz &quot;:&quot; minutelz &quot;:&quot; secondlz frac tzcorrection?;
<span class="lineNum">     955 </span>                : xmlrpc           = year4 monthlz daylz &quot;T&quot; hour24 &quot;:&quot; minutelz &quot;:&quot; secondlz;
<span class="lineNum">     956 </span>                : xmlrpcnocolon    = year4 monthlz daylz 't' hour24 minutelz secondlz;
<span class="lineNum">     957 </span>                : wddx             = year4 &quot;-&quot; month &quot;-&quot; day &quot;T&quot; hour24 &quot;:&quot; minute &quot;:&quot; second;
<span class="lineNum">     958 </span>                : pgydotd          = year4 &quot;.&quot;? dayofyear;
<span class="lineNum">     959 </span>                : pgtextshort      = monthabbr &quot;-&quot; daylz &quot;-&quot; year;
<span class="lineNum">     960 </span>                : pgtextreverse    = year &quot;-&quot; monthabbr &quot;-&quot; daylz;
<span class="lineNum">     961 </span>                : mssqltime        = hour12 &quot;:&quot; minutelz &quot;:&quot; secondlz [:.] [0-9]+ meridian;
<span class="lineNum">     962 </span>                : isoweekday       = year4 &quot;-&quot;? &quot;W&quot; weekofyear &quot;-&quot;? [0-7];
<span class="lineNum">     963 </span>                : isoweek          = year4 &quot;-&quot;? &quot;W&quot; weekofyear;
<span class="lineNum">     964 </span>                : exif             = year4 &quot;:&quot; monthlz &quot;:&quot; daylz &quot; &quot; hour24lz &quot;:&quot; minutelz &quot;:&quot; secondlz;
<span class="lineNum">     965 </span>                : firstdayof       = 'first day of'?;
<span class="lineNum">     966 </span>                : lastdayof        = 'last day of'?;
<span class="lineNum">     967 </span>                : backof           = 'back of ' hour24 space? meridian?;
<span class="lineNum">     968 </span>                : frontof          = 'front of ' hour24 space? meridian?;
<span class="lineNum">     969 </span>                : 
<span class="lineNum">     970 </span>                : /* Common Log Format: 10/Oct/2000:13:55:36 -0700 */
<span class="lineNum">     971 </span>                : clf              = day &quot;/&quot; monthabbr &quot;/&quot; year4 &quot;:&quot; hour24lz &quot;:&quot; minutelz &quot;:&quot; secondlz space tzcorrection;
<span class="lineNum">     972 </span>                : 
<span class="lineNum">     973 </span>                : /* Timestamp format: @1126396800 */
<span class="lineNum">     974 </span>                : timestamp        = &quot;@&quot; &quot;-&quot;? [0-9]+;
<span class="lineNum">     975 </span>                : 
<span class="lineNum">     976 </span>                : /* To fix some ambiguities */
<span class="lineNum">     977 </span>                : dateshortwithtimeshort12  = datenoyear timeshort12;
<span class="lineNum">     978 </span>                : dateshortwithtimelong12   = datenoyear timelong12;
<span class="lineNum">     979 </span>                : dateshortwithtimeshort  = datenoyear timeshort24;
<span class="lineNum">     980 </span>                : dateshortwithtimelong   = datenoyear timelong24;
<span class="lineNum">     981 </span>                : dateshortwithtimelongtz = datenoyear iso8601normtz;
<span class="lineNum">     982 </span>                : 
<span class="lineNum">     983 </span>                : /*
<span class="lineNum">     984 </span>                :  * Relative regexps
<span class="lineNum">     985 </span>                :  */
<span class="lineNum">     986 </span>                : reltextnumber = 'first'|'second'|'third'|'fourth'|'fifth'|'sixth'|'seventh'|'eight'|'eighth'|'ninth'|'tenth'|'eleventh'|'twelfth';
<span class="lineNum">     987 </span>                : reltexttext = 'next'|'last'|'previous'|'this';
<span class="lineNum">     988 </span>                : reltextunit = (('sec'|'second'|'min'|'minute'|'hour'|'day'|'fortnight'|'forthnight'|'month'|'year') 's'?) | 'weeks' | daytext;
<span class="lineNum">     989 </span>                : 
<span class="lineNum">     990 </span>                : relnumber = ([+-]*[ \t]*[0-9]+);
<span class="lineNum">     991 </span>                : relative = relnumber space? (reltextunit | 'week' );
<span class="lineNum">     992 </span>                : relativetext = (reltextnumber|reltexttext) space reltextunit;
<span class="lineNum">     993 </span>                : relativetextweek = reltexttext space 'week';
<span class="lineNum">     994 </span>                : 
<span class="lineNum">     995 </span>                : weekdayof        = (reltextnumber|reltexttext) space (dayfull|dayabbr) space 'of';
<span class="lineNum">     996 </span>                : 
<span class="lineNum">     997 </span>                : */
<span class="lineNum">     998 </span>                : 
<span class="lineNum">     999 </span>                : /*!re2c
<span class="lineNum">    1000 </span>                :         /* so that vim highlights correctly */
<span class="lineNum">    1001 </span>                :         'yesterday'
<span class="lineNum">    1002 </span>                :         {
<span class="lineNum">    1003 </span>                :                 DEBUG_OUTPUT(&quot;yesterday&quot;);
<span class="lineNum">    1004 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1005 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_RELATIVE();</span>
<span class="lineNum">    1006 </span><span class="lineNoCov">              0 :                 TIMELIB_UNHAVE_TIME();</span>
<span class="lineNum">    1007 </span>                : 
<span class="lineNum">    1008 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;relative.d = -1;</span>
<span class="lineNum">    1009 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1010 </span><span class="lineNoCov">              0 :                 return TIMELIB_RELATIVE;</span>
<span class="lineNum">    1011 </span>                :         }
<span class="lineNum">    1012 </span>                : 
<span class="lineNum">    1013 </span>                :         'now'
<span class="lineNum">    1014 </span>                :         {
<span class="lineNum">    1015 </span>                :                 DEBUG_OUTPUT(&quot;now&quot;);
<span class="lineNum">    1016 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1017 </span>                : 
<span class="lineNum">    1018 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1019 </span><span class="lineNoCov">              0 :                 return TIMELIB_RELATIVE;</span>
<span class="lineNum">    1020 </span>                :         }
<span class="lineNum">    1021 </span>                : 
<span class="lineNum">    1022 </span>                :         'noon'
<span class="lineNum">    1023 </span>                :         {
<span class="lineNum">    1024 </span>                :                 DEBUG_OUTPUT(&quot;noon&quot;);
<span class="lineNum">    1025 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1026 </span><span class="lineNoCov">              0 :                 TIMELIB_UNHAVE_TIME();</span>
<span class="lineNum">    1027 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_TIME();</span>
<span class="lineNum">    1028 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;h = 12;</span>
<span class="lineNum">    1029 </span>                : 
<span class="lineNum">    1030 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1031 </span><span class="lineNoCov">              0 :                 return TIMELIB_RELATIVE;</span>
<span class="lineNum">    1032 </span>                :         }
<span class="lineNum">    1033 </span>                : 
<span class="lineNum">    1034 </span>                :         'midnight' | 'today'
<span class="lineNum">    1035 </span>                :         {
<span class="lineNum">    1036 </span>                :                 DEBUG_OUTPUT(&quot;midnight | today&quot;);
<span class="lineNum">    1037 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1038 </span><span class="lineNoCov">              0 :                 TIMELIB_UNHAVE_TIME();</span>
<span class="lineNum">    1039 </span>                : 
<span class="lineNum">    1040 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1041 </span><span class="lineNoCov">              0 :                 return TIMELIB_RELATIVE;</span>
<span class="lineNum">    1042 </span>                :         }
<span class="lineNum">    1043 </span>                : 
<span class="lineNum">    1044 </span>                :         'tomorrow'
<span class="lineNum">    1045 </span>                :         {
<span class="lineNum">    1046 </span>                :                 DEBUG_OUTPUT(&quot;tomorrow&quot;);
<span class="lineNum">    1047 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1048 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_RELATIVE();</span>
<span class="lineNum">    1049 </span><span class="lineNoCov">              0 :                 TIMELIB_UNHAVE_TIME();</span>
<span class="lineNum">    1050 </span>                : 
<span class="lineNum">    1051 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;relative.d = 1;</span>
<span class="lineNum">    1052 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1053 </span><span class="lineNoCov">              0 :                 return TIMELIB_RELATIVE;</span>
<span class="lineNum">    1054 </span>                :         }
<span class="lineNum">    1055 </span>                : 
<span class="lineNum">    1056 </span>                :         timestamp
<span class="lineNum">    1057 </span>                :         {
<span class="lineNum">    1058 </span>                :                 timelib_ull i;
<span class="lineNum">    1059 </span>                : 
<span class="lineNum">    1060 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1061 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_RELATIVE();</span>
<span class="lineNum">    1062 </span><span class="lineNoCov">              0 :                 TIMELIB_UNHAVE_DATE();</span>
<span class="lineNum">    1063 </span><span class="lineNoCov">              0 :                 TIMELIB_UNHAVE_TIME();</span>
<span class="lineNum">    1064 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_TZ();</span>
<span class="lineNum">    1065 </span>                : 
<span class="lineNum">    1066 </span><span class="lineNoCov">              0 :                 i = timelib_get_unsigned_nr((char **) &amp;ptr, 24);</span>
<span class="lineNum">    1067 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;y = 1970;</span>
<span class="lineNum">    1068 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = 1;</span>
<span class="lineNum">    1069 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = 1;</span>
<span class="lineNum">    1070 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;h = s-&gt;time-&gt;i = s-&gt;time-&gt;s = 0;</span>
<span class="lineNum">    1071 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;f = 0.0;</span>
<span class="lineNum">    1072 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;relative.s += i;</span>
<span class="lineNum">    1073 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;is_localtime = 1;</span>
<span class="lineNum">    1074 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;zone_type = TIMELIB_ZONETYPE_OFFSET;</span>
<span class="lineNum">    1075 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;z = 0;</span>
<span class="lineNum">    1076 </span>                : 
<span class="lineNum">    1077 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1078 </span><span class="lineNoCov">              0 :                 return TIMELIB_RELATIVE;</span>
<span class="lineNum">    1079 </span>                :         }
<span class="lineNum">    1080 </span>                : 
<span class="lineNum">    1081 </span>                :         firstdayof | lastdayof
<span class="lineNum">    1082 </span>                :         {
<span class="lineNum">    1083 </span>                :                 DEBUG_OUTPUT(&quot;firstdayof | lastdayof&quot;);
<span class="lineNum">    1084 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1085 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_RELATIVE();</span>
<span class="lineNum">    1086 </span>                : 
<span class="lineNum">    1087 </span>                :                 /* skip &quot;last day of&quot; or &quot;first day of&quot; */
<span class="lineNum">    1088 </span><span class="lineNoCov">              0 :                 if (*ptr == 'l') {</span>
<span class="lineNum">    1089 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;relative.first_last_day_of = 2;</span>
<span class="lineNum">    1090 </span>                :                 } else {
<span class="lineNum">    1091 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;relative.first_last_day_of = 1;</span>
<span class="lineNum">    1092 </span>                :                 }
<span class="lineNum">    1093 </span>                : 
<span class="lineNum">    1094 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1095 </span><span class="lineNoCov">              0 :                 return TIMELIB_LF_DAY_OF_MONTH;</span>
<span class="lineNum">    1096 </span>                :         }
<span class="lineNum">    1097 </span>                : 
<span class="lineNum">    1098 </span>                :         backof | frontof
<span class="lineNum">    1099 </span>                :         {
<span class="lineNum">    1100 </span>                :                 DEBUG_OUTPUT(&quot;backof | frontof&quot;);
<span class="lineNum">    1101 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1102 </span><span class="lineNoCov">              0 :                 TIMELIB_UNHAVE_TIME();</span>
<span class="lineNum">    1103 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_TIME();</span>
<span class="lineNum">    1104 </span>                : 
<span class="lineNum">    1105 </span><span class="lineNoCov">              0 :                 if (*ptr == 'b') {</span>
<span class="lineNum">    1106 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;h = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1107 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;i = 15;</span>
<span class="lineNum">    1108 </span>                :                 } else {
<span class="lineNum">    1109 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;h = timelib_get_nr((char **) &amp;ptr, 2) - 1;</span>
<span class="lineNum">    1110 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;i = 45;</span>
<span class="lineNum">    1111 </span>                :                 }
<span class="lineNum">    1112 </span><span class="lineNoCov">              0 :                 if (*ptr != '\0' ) {</span>
<span class="lineNum">    1113 </span><span class="lineNoCov">              0 :                         timelib_eat_spaces((char **) &amp;ptr);</span>
<span class="lineNum">    1114 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;h += timelib_meridian((char **) &amp;ptr, s-&gt;time-&gt;h);</span>
<span class="lineNum">    1115 </span>                :                 }
<span class="lineNum">    1116 </span>                : 
<span class="lineNum">    1117 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1118 </span><span class="lineNoCov">              0 :                 return TIMELIB_LF_DAY_OF_MONTH;</span>
<span class="lineNum">    1119 </span>                :         }
<span class="lineNum">    1120 </span>                : 
<span class="lineNum">    1121 </span>                :         weekdayof
<span class="lineNum">    1122 </span>                :         {
<span class="lineNum">    1123 </span>                :                 timelib_sll i;
<span class="lineNum">    1124 </span><span class="lineNoCov">              0 :                 int         behavior = 0;</span>
<span class="lineNum">    1125 </span>                :                 DEBUG_OUTPUT(&quot;weekdayof&quot;);
<span class="lineNum">    1126 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1127 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_RELATIVE();</span>
<span class="lineNum">    1128 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_SPECIAL_RELATIVE();</span>
<span class="lineNum">    1129 </span>                : 
<span class="lineNum">    1130 </span><span class="lineNoCov">              0 :                 i = timelib_get_relative_text((char **) &amp;ptr, &amp;behavior);</span>
<span class="lineNum">    1131 </span><span class="lineNoCov">              0 :                 timelib_eat_spaces((char **) &amp;ptr);</span>
<span class="lineNum">    1132 </span><span class="lineNoCov">              0 :                 if (i &gt; 0) { /* first, second... etc */</span>
<span class="lineNum">    1133 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;relative.special.type = TIMELIB_SPECIAL_DAY_OF_WEEK_IN_MONTH;</span>
<span class="lineNum">    1134 </span><span class="lineNoCov">              0 :                         timelib_set_relative((char **) &amp;ptr, i, 1, s);</span>
<span class="lineNum">    1135 </span>                :                 } else { /* last */
<span class="lineNum">    1136 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;relative.special.type = TIMELIB_SPECIAL_LAST_DAY_OF_WEEK_IN_MONTH;</span>
<span class="lineNum">    1137 </span><span class="lineNoCov">              0 :                         timelib_set_relative((char **) &amp;ptr, i, behavior, s);</span>
<span class="lineNum">    1138 </span>                :                 }
<span class="lineNum">    1139 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1140 </span><span class="lineNoCov">              0 :                 return TIMELIB_WEEK_DAY_OF_MONTH;</span>
<span class="lineNum">    1141 </span>                :         }
<span class="lineNum">    1142 </span>                : 
<span class="lineNum">    1143 </span>                :         timetiny12 | timeshort12 | timelong12
<span class="lineNum">    1144 </span>                :         {
<span class="lineNum">    1145 </span>                :                 DEBUG_OUTPUT(&quot;timetiny12 | timeshort12 | timelong12&quot;);
<span class="lineNum">    1146 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1147 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_TIME();</span>
<span class="lineNum">    1148 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;h = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1149 </span><span class="lineNoCov">              0 :                 if (*ptr == ':' || *ptr == '.') {</span>
<span class="lineNum">    1150 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;i = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1151 </span><span class="lineNoCov">              0 :                         if (*ptr == ':' || *ptr == '.') {</span>
<span class="lineNum">    1152 </span><span class="lineNoCov">              0 :                                 s-&gt;time-&gt;s = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1153 </span>                :                         }
<span class="lineNum">    1154 </span>                :                 }
<span class="lineNum">    1155 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;h += timelib_meridian((char **) &amp;ptr, s-&gt;time-&gt;h);</span>
<span class="lineNum">    1156 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1157 </span><span class="lineNoCov">              0 :                 return TIMELIB_TIME12;</span>
<span class="lineNum">    1158 </span>                :         }
<span class="lineNum">    1159 </span>                : 
<span class="lineNum">    1160 </span>                :         mssqltime
<span class="lineNum">    1161 </span>                :         {
<span class="lineNum">    1162 </span>                :                 DEBUG_OUTPUT(&quot;mssqltime&quot;);
<span class="lineNum">    1163 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1164 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_TIME();</span>
<span class="lineNum">    1165 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;h = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1166 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;i = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1167 </span><span class="lineNoCov">              0 :                 if (*ptr == ':' || *ptr == '.') {</span>
<span class="lineNum">    1168 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;s = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1169 </span>                : 
<span class="lineNum">    1170 </span><span class="lineNoCov">              0 :                         if (*ptr == ':' || *ptr == '.') {</span>
<span class="lineNum">    1171 </span><span class="lineNoCov">              0 :                                 s-&gt;time-&gt;f = timelib_get_frac_nr((char **) &amp;ptr, 8);</span>
<span class="lineNum">    1172 </span>                :                         }
<span class="lineNum">    1173 </span>                :                 }
<span class="lineNum">    1174 </span><span class="lineNoCov">              0 :                 timelib_eat_spaces((char **) &amp;ptr);</span>
<span class="lineNum">    1175 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;h += timelib_meridian((char **) &amp;ptr, s-&gt;time-&gt;h);</span>
<span class="lineNum">    1176 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1177 </span><span class="lineNoCov">              0 :                 return TIMELIB_TIME24_WITH_ZONE;</span>
<span class="lineNum">    1178 </span>                :         }
<span class="lineNum">    1179 </span>                : 
<span class="lineNum">    1180 </span>                :         timeshort24 | timelong24 /* | iso8601short | iso8601norm */ | iso8601long /*| iso8601shorttz | iso8601normtz | iso8601longtz*/
<span class="lineNum">    1181 </span>                :         {
<span class="lineNum">    1182 </span>                :                 int tz_not_found;
<span class="lineNum">    1183 </span>                :                 DEBUG_OUTPUT(&quot;timeshort24 | timelong24 | iso8601long&quot;);
<span class="lineNum">    1184 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1185 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_TIME();</span>
<span class="lineNum">    1186 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;h = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1187 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;i = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1188 </span><span class="lineNoCov">              0 :                 if (*ptr == ':' || *ptr == '.') {</span>
<span class="lineNum">    1189 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;s = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1190 </span>                : 
<span class="lineNum">    1191 </span><span class="lineNoCov">              0 :                         if (*ptr == '.') {</span>
<span class="lineNum">    1192 </span><span class="lineNoCov">              0 :                                 s-&gt;time-&gt;f = timelib_get_frac_nr((char **) &amp;ptr, 8);</span>
<span class="lineNum">    1193 </span>                :                         }
<span class="lineNum">    1194 </span>                :                 }
<span class="lineNum">    1195 </span>                : 
<span class="lineNum">    1196 </span><span class="lineNoCov">              0 :                 if (*ptr != '\0') {</span>
<span class="lineNum">    1197 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;z = timelib_get_zone((char **) &amp;ptr, &amp;s-&gt;time-&gt;dst, s-&gt;time, &amp;tz_not_found, s-&gt;tzdb, tz_get_wrapper);</span>
<span class="lineNum">    1198 </span><span class="lineNoCov">              0 :                         if (tz_not_found) {</span>
<span class="lineNum">    1199 </span><span class="lineNoCov">              0 :                                 add_error(s, &quot;The timezone could not be found in the database&quot;);</span>
<span class="lineNum">    1200 </span>                :                         }
<span class="lineNum">    1201 </span>                :                 }
<span class="lineNum">    1202 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1203 </span><span class="lineNoCov">              0 :                 return TIMELIB_TIME24_WITH_ZONE;</span>
<span class="lineNum">    1204 </span>                :         }
<span class="lineNum">    1205 </span>                : 
<span class="lineNum">    1206 </span>                :         gnunocolon
<span class="lineNum">    1207 </span>                :         {
<span class="lineNum">    1208 </span>                :                 DEBUG_OUTPUT(&quot;gnunocolon&quot;);
<span class="lineNum">    1209 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1210 </span><span class="lineNoCov">              0 :                 switch (s-&gt;time-&gt;have_time) {</span>
<span class="lineNum">    1211 </span>                :                         case 0:
<span class="lineNum">    1212 </span><span class="lineNoCov">              0 :                                 s-&gt;time-&gt;h = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1213 </span><span class="lineNoCov">              0 :                                 s-&gt;time-&gt;i = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1214 </span><span class="lineNoCov">              0 :                                 s-&gt;time-&gt;s = 0;</span>
<span class="lineNum">    1215 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    1216 </span>                :                         case 1:
<span class="lineNum">    1217 </span><span class="lineNoCov">              0 :                                 s-&gt;time-&gt;y = timelib_get_nr((char **) &amp;ptr, 4);</span>
<span class="lineNum">    1218 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    1219 </span>                :                         default:
<span class="lineNum">    1220 </span><span class="lineNoCov">              0 :                                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1221 </span><span class="lineNoCov">              0 :                                 add_error(s, &quot;Double time specification&quot;);</span>
<span class="lineNum">    1222 </span><span class="lineNoCov">              0 :                                 return TIMELIB_ERROR;</span>
<span class="lineNum">    1223 </span>                :                 }
<span class="lineNum">    1224 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;have_time++;</span>
<span class="lineNum">    1225 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1226 </span><span class="lineNoCov">              0 :                 return TIMELIB_GNU_NOCOLON;</span>
<span class="lineNum">    1227 </span>                :         }
<span class="lineNum">    1228 </span>                : /*
<span class="lineNum">    1229 </span>                :         gnunocolontz
<span class="lineNum">    1230 </span>                :         {
<span class="lineNum">    1231 </span>                :                 DEBUG_OUTPUT(&quot;gnunocolontz&quot;);
<span class="lineNum">    1232 </span>                :                 TIMELIB_INIT;
<span class="lineNum">    1233 </span>                :                 switch (s-&gt;time-&gt;have_time) {
<span class="lineNum">    1234 </span>                :                         case 0:
<span class="lineNum">    1235 </span>                :                                 s-&gt;time-&gt;h = timelib_get_nr((char **) &amp;ptr, 2);
<span class="lineNum">    1236 </span>                :                                 s-&gt;time-&gt;i = timelib_get_nr((char **) &amp;ptr, 2);
<span class="lineNum">    1237 </span>                :                                 s-&gt;time-&gt;s = 0;
<span class="lineNum">    1238 </span>                :                                 s-&gt;time-&gt;z = timelib_get_zone((char **) &amp;ptr, &amp;s-&gt;time-&gt;dst, s-&gt;time, s-&gt;tzdb, tz_get_wrapper);
<span class="lineNum">    1239 </span>                :                                 break;
<span class="lineNum">    1240 </span>                :                         case 1:
<span class="lineNum">    1241 </span>                :                                 s-&gt;time-&gt;y = timelib_get_nr((char **) &amp;ptr, 4);
<span class="lineNum">    1242 </span>                :                                 break;
<span class="lineNum">    1243 </span>                :                         default:
<span class="lineNum">    1244 </span>                :                                 TIMELIB_DEINIT;
<span class="lineNum">    1245 </span>                :                                 return TIMELIB_ERROR;
<span class="lineNum">    1246 </span>                :                 }
<span class="lineNum">    1247 </span>                :                 s-&gt;time-&gt;have_time++;
<span class="lineNum">    1248 </span>                :                 TIMELIB_DEINIT;
<span class="lineNum">    1249 </span>                :                 return TIMELIB_GNU_NOCOLON_TZ;
<span class="lineNum">    1250 </span>                :         }
<span class="lineNum">    1251 </span>                : */
<span class="lineNum">    1252 </span>                :         iso8601nocolon /*| iso8601nocolontz*/
<span class="lineNum">    1253 </span>                :         {
<span class="lineNum">    1254 </span>                :                 int tz_not_found;
<span class="lineNum">    1255 </span>                :                 DEBUG_OUTPUT(&quot;iso8601nocolon&quot;);
<span class="lineNum">    1256 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1257 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_TIME();</span>
<span class="lineNum">    1258 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;h = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1259 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;i = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1260 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;s = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1261 </span>                : 
<span class="lineNum">    1262 </span><span class="lineNoCov">              0 :                 if (*ptr != '\0') {</span>
<span class="lineNum">    1263 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;z = timelib_get_zone((char **) &amp;ptr, &amp;s-&gt;time-&gt;dst, s-&gt;time, &amp;tz_not_found, s-&gt;tzdb, tz_get_wrapper);</span>
<span class="lineNum">    1264 </span><span class="lineNoCov">              0 :                         if (tz_not_found) {</span>
<span class="lineNum">    1265 </span><span class="lineNoCov">              0 :                                 add_error(s, &quot;The timezone could not be found in the database&quot;);</span>
<span class="lineNum">    1266 </span>                :                         }
<span class="lineNum">    1267 </span>                :                 }
<span class="lineNum">    1268 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1269 </span><span class="lineNoCov">              0 :                 return TIMELIB_ISO_NOCOLON;</span>
<span class="lineNum">    1270 </span>                :         }
<span class="lineNum">    1271 </span>                : 
<span class="lineNum">    1272 </span>                :         americanshort | american
<span class="lineNum">    1273 </span>                :         {
<span class="lineNum">    1274 </span><span class="lineNoCov">              0 :                 int length = 0;</span>
<span class="lineNum">    1275 </span>                :                 DEBUG_OUTPUT(&quot;americanshort | american&quot;);
<span class="lineNum">    1276 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1277 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1278 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1279 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1280 </span><span class="lineNoCov">              0 :                 if (*ptr == '/') {</span>
<span class="lineNum">    1281 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;y = timelib_get_nr_ex((char **) &amp;ptr, 4, &amp;length);</span>
<span class="lineNum">    1282 </span><span class="lineNoCov">              0 :                         TIMELIB_PROCESS_YEAR(s-&gt;time-&gt;y, length);</span>
<span class="lineNum">    1283 </span>                :                 }
<span class="lineNum">    1284 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1285 </span><span class="lineNoCov">              0 :                 return TIMELIB_AMERICAN;</span>
<span class="lineNum">    1286 </span>                :         }
<span class="lineNum">    1287 </span>                : 
<span class="lineNum">    1288 </span>                :         iso8601date4 | iso8601dateslash | dateslash
<span class="lineNum">    1289 </span>                :         {
<span class="lineNum">    1290 </span>                :                 DEBUG_OUTPUT(&quot;iso8601date4 | iso8601date2 | iso8601dateslash | dateslash&quot;);
<span class="lineNum">    1291 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1292 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1293 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;y = timelib_get_unsigned_nr((char **) &amp;ptr, 4);</span>
<span class="lineNum">    1294 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1295 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1296 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1297 </span><span class="lineNoCov">              0 :                 return TIMELIB_ISO_DATE;</span>
<span class="lineNum">    1298 </span>                :         }
<span class="lineNum">    1299 </span>                : 
<span class="lineNum">    1300 </span>                :         iso8601date2
<span class="lineNum">    1301 </span>                :         {
<span class="lineNum">    1302 </span><span class="lineNoCov">              0 :                 int length = 0;</span>
<span class="lineNum">    1303 </span>                :                 DEBUG_OUTPUT(&quot;iso8601date2&quot;);
<span class="lineNum">    1304 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1305 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1306 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;y = timelib_get_nr_ex((char **) &amp;ptr, 4, &amp;length);</span>
<span class="lineNum">    1307 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1308 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1309 </span><span class="lineNoCov">              0 :                 TIMELIB_PROCESS_YEAR(s-&gt;time-&gt;y, length);</span>
<span class="lineNum">    1310 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1311 </span><span class="lineNoCov">              0 :                 return TIMELIB_ISO_DATE;</span>
<span class="lineNum">    1312 </span>                :         }
<span class="lineNum">    1313 </span>                : 
<span class="lineNum">    1314 </span>                :         gnudateshorter
<span class="lineNum">    1315 </span>                :         {
<span class="lineNum">    1316 </span><span class="lineNoCov">              0 :                 int length = 0;</span>
<span class="lineNum">    1317 </span>                :                 DEBUG_OUTPUT(&quot;gnudateshorter&quot;);
<span class="lineNum">    1318 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1319 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1320 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;y = timelib_get_nr_ex((char **) &amp;ptr, 4, &amp;length);</span>
<span class="lineNum">    1321 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1322 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = 1;</span>
<span class="lineNum">    1323 </span><span class="lineNoCov">              0 :                 TIMELIB_PROCESS_YEAR(s-&gt;time-&gt;y, length);</span>
<span class="lineNum">    1324 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1325 </span><span class="lineNoCov">              0 :                 return TIMELIB_ISO_DATE;</span>
<span class="lineNum">    1326 </span>                :         }
<span class="lineNum">    1327 </span>                : 
<span class="lineNum">    1328 </span>                :         gnudateshort
<span class="lineNum">    1329 </span>                :         {
<span class="lineNum">    1330 </span><span class="lineNoCov">              0 :                 int length = 0;</span>
<span class="lineNum">    1331 </span>                :                 DEBUG_OUTPUT(&quot;gnudateshort&quot;);
<span class="lineNum">    1332 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1333 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1334 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;y = timelib_get_nr_ex((char **) &amp;ptr, 4, &amp;length);</span>
<span class="lineNum">    1335 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1336 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1337 </span><span class="lineNoCov">              0 :                 TIMELIB_PROCESS_YEAR(s-&gt;time-&gt;y, length);</span>
<span class="lineNum">    1338 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1339 </span><span class="lineNoCov">              0 :                 return TIMELIB_ISO_DATE;</span>
<span class="lineNum">    1340 </span>                :         }
<span class="lineNum">    1341 </span>                : 
<span class="lineNum">    1342 </span>                :         datefull
<span class="lineNum">    1343 </span>                :         {
<span class="lineNum">    1344 </span><span class="lineNoCov">              0 :                 int length = 0;</span>
<span class="lineNum">    1345 </span>                :                 DEBUG_OUTPUT(&quot;datefull&quot;);
<span class="lineNum">    1346 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1347 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1348 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1349 </span><span class="lineNoCov">              0 :                 timelib_skip_day_suffix((char **) &amp;ptr);</span>
<span class="lineNum">    1350 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = timelib_get_month((char **) &amp;ptr);</span>
<span class="lineNum">    1351 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;y = timelib_get_nr_ex((char **) &amp;ptr, 4, &amp;length);</span>
<span class="lineNum">    1352 </span><span class="lineNoCov">              0 :                 TIMELIB_PROCESS_YEAR(s-&gt;time-&gt;y, length);</span>
<span class="lineNum">    1353 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1354 </span><span class="lineNoCov">              0 :                 return TIMELIB_DATE_FULL;</span>
<span class="lineNum">    1355 </span>                :         }
<span class="lineNum">    1356 </span>                : 
<span class="lineNum">    1357 </span>                :         pointeddate4
<span class="lineNum">    1358 </span>                :         {
<span class="lineNum">    1359 </span>                :                 DEBUG_OUTPUT(&quot;pointed date YYYY&quot;);
<span class="lineNum">    1360 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1361 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1362 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1363 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1364 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;y = timelib_get_nr((char **) &amp;ptr, 4);</span>
<span class="lineNum">    1365 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1366 </span><span class="lineNoCov">              0 :                 return TIMELIB_DATE_FULL_POINTED;</span>
<span class="lineNum">    1367 </span>                :         }
<span class="lineNum">    1368 </span>                : 
<span class="lineNum">    1369 </span>                :         pointeddate2
<span class="lineNum">    1370 </span>                :         {
<span class="lineNum">    1371 </span><span class="lineNoCov">              0 :                 int length = 0;</span>
<span class="lineNum">    1372 </span>                :                 DEBUG_OUTPUT(&quot;pointed date YY&quot;);
<span class="lineNum">    1373 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1374 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1375 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1376 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1377 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;y = timelib_get_nr_ex((char **) &amp;ptr, 2, &amp;length);</span>
<span class="lineNum">    1378 </span><span class="lineNoCov">              0 :                 TIMELIB_PROCESS_YEAR(s-&gt;time-&gt;y, length);</span>
<span class="lineNum">    1379 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1380 </span><span class="lineNoCov">              0 :                 return TIMELIB_DATE_FULL_POINTED;</span>
<span class="lineNum">    1381 </span>                :         }
<span class="lineNum">    1382 </span>                : 
<span class="lineNum">    1383 </span>                :         datenoday
<span class="lineNum">    1384 </span>                :         {
<span class="lineNum">    1385 </span><span class="lineNoCov">              0 :                 int length = 0;</span>
<span class="lineNum">    1386 </span>                :                 DEBUG_OUTPUT(&quot;datenoday&quot;);
<span class="lineNum">    1387 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1388 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1389 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = timelib_get_month((char **) &amp;ptr);</span>
<span class="lineNum">    1390 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;y = timelib_get_nr_ex((char **) &amp;ptr, 4, &amp;length);</span>
<span class="lineNum">    1391 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = 1;</span>
<span class="lineNum">    1392 </span><span class="lineNoCov">              0 :                 TIMELIB_PROCESS_YEAR(s-&gt;time-&gt;y, length);</span>
<span class="lineNum">    1393 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1394 </span><span class="lineNoCov">              0 :                 return TIMELIB_DATE_NO_DAY;</span>
<span class="lineNum">    1395 </span>                :         }
<span class="lineNum">    1396 </span>                : 
<span class="lineNum">    1397 </span>                :         datenodayrev
<span class="lineNum">    1398 </span>                :         {
<span class="lineNum">    1399 </span><span class="lineNoCov">              0 :                 int length = 0;</span>
<span class="lineNum">    1400 </span>                :                 DEBUG_OUTPUT(&quot;datenodayrev&quot;);
<span class="lineNum">    1401 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1402 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1403 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;y = timelib_get_nr_ex((char **) &amp;ptr, 4, &amp;length);</span>
<span class="lineNum">    1404 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = timelib_get_month((char **) &amp;ptr);</span>
<span class="lineNum">    1405 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = 1;</span>
<span class="lineNum">    1406 </span><span class="lineNoCov">              0 :                 TIMELIB_PROCESS_YEAR(s-&gt;time-&gt;y, length);</span>
<span class="lineNum">    1407 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1408 </span><span class="lineNoCov">              0 :                 return TIMELIB_DATE_NO_DAY;</span>
<span class="lineNum">    1409 </span>                :         }
<span class="lineNum">    1410 </span>                : 
<span class="lineNum">    1411 </span>                :         datetextual | datenoyear
<span class="lineNum">    1412 </span>                :         {
<span class="lineNum">    1413 </span><span class="lineNoCov">              0 :                 int length = 0;</span>
<span class="lineNum">    1414 </span>                :                 DEBUG_OUTPUT(&quot;datetextual | datenoyear&quot;);
<span class="lineNum">    1415 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1416 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1417 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = timelib_get_month((char **) &amp;ptr);</span>
<span class="lineNum">    1418 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1419 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;y = timelib_get_nr_ex((char **) &amp;ptr, 4, &amp;length);</span>
<span class="lineNum">    1420 </span><span class="lineNoCov">              0 :                 TIMELIB_PROCESS_YEAR(s-&gt;time-&gt;y, length);</span>
<span class="lineNum">    1421 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1422 </span><span class="lineNoCov">              0 :                 return TIMELIB_DATE_TEXT;</span>
<span class="lineNum">    1423 </span>                :         }
<span class="lineNum">    1424 </span>                : 
<span class="lineNum">    1425 </span>                :         datenoyearrev
<span class="lineNum">    1426 </span>                :         {
<span class="lineNum">    1427 </span>                :                 DEBUG_OUTPUT(&quot;datenoyearrev&quot;);
<span class="lineNum">    1428 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1429 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1430 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1431 </span><span class="lineNoCov">              0 :                 timelib_skip_day_suffix((char **) &amp;ptr);</span>
<span class="lineNum">    1432 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = timelib_get_month((char **) &amp;ptr);</span>
<span class="lineNum">    1433 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1434 </span><span class="lineNoCov">              0 :                 return TIMELIB_DATE_TEXT;</span>
<span class="lineNum">    1435 </span>                :         }
<span class="lineNum">    1436 </span>                : 
<span class="lineNum">    1437 </span>                :         datenocolon
<span class="lineNum">    1438 </span>                :         {
<span class="lineNum">    1439 </span>                :                 DEBUG_OUTPUT(&quot;datenocolon&quot;);
<span class="lineNum">    1440 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1441 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1442 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;y = timelib_get_nr((char **) &amp;ptr, 4);</span>
<span class="lineNum">    1443 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1444 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1445 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1446 </span><span class="lineNoCov">              0 :                 return TIMELIB_DATE_NOCOLON;</span>
<span class="lineNum">    1447 </span>                :         }
<span class="lineNum">    1448 </span>                : 
<span class="lineNum">    1449 </span>                :         xmlrpc | xmlrpcnocolon | soap | wddx | exif
<span class="lineNum">    1450 </span>                :         {
<span class="lineNum">    1451 </span>                :                 int tz_not_found;
<span class="lineNum">    1452 </span>                :                 DEBUG_OUTPUT(&quot;xmlrpc | xmlrpcnocolon | soap | wddx | exif&quot;);
<span class="lineNum">    1453 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1454 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_TIME();</span>
<span class="lineNum">    1455 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1456 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;y = timelib_get_nr((char **) &amp;ptr, 4);</span>
<span class="lineNum">    1457 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1458 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1459 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;h = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1460 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;i = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1461 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;s = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1462 </span><span class="lineNoCov">              0 :                 if (*ptr == '.') {</span>
<span class="lineNum">    1463 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;f = timelib_get_frac_nr((char **) &amp;ptr, 9);</span>
<span class="lineNum">    1464 </span><span class="lineNoCov">              0 :                         if (*ptr) { /* timezone is optional */</span>
<span class="lineNum">    1465 </span><span class="lineNoCov">              0 :                                 s-&gt;time-&gt;z = timelib_get_zone((char **) &amp;ptr, &amp;s-&gt;time-&gt;dst, s-&gt;time, &amp;tz_not_found, s-&gt;tzdb, tz_get_wrapper);</span>
<span class="lineNum">    1466 </span><span class="lineNoCov">              0 :                                 if (tz_not_found) {</span>
<span class="lineNum">    1467 </span><span class="lineNoCov">              0 :                                         add_error(s, &quot;The timezone could not be found in the database&quot;);</span>
<span class="lineNum">    1468 </span>                :                                 }
<span class="lineNum">    1469 </span>                :                         }
<span class="lineNum">    1470 </span>                :                 }
<span class="lineNum">    1471 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1472 </span><span class="lineNoCov">              0 :                 return TIMELIB_XMLRPC_SOAP;</span>
<span class="lineNum">    1473 </span>                :         }
<span class="lineNum">    1474 </span>                : 
<span class="lineNum">    1475 </span>                :         pgydotd
<span class="lineNum">    1476 </span>                :         {
<span class="lineNum">    1477 </span><span class="lineNoCov">              0 :                 int length = 0;</span>
<span class="lineNum">    1478 </span>                :                 DEBUG_OUTPUT(&quot;pgydotd&quot;);
<span class="lineNum">    1479 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1480 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1481 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;y = timelib_get_nr_ex((char **) &amp;ptr, 4, &amp;length);</span>
<span class="lineNum">    1482 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = timelib_get_nr((char **) &amp;ptr, 3);</span>
<span class="lineNum">    1483 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = 1;</span>
<span class="lineNum">    1484 </span><span class="lineNoCov">              0 :                 TIMELIB_PROCESS_YEAR(s-&gt;time-&gt;y, length);</span>
<span class="lineNum">    1485 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1486 </span><span class="lineNoCov">              0 :                 return TIMELIB_PG_YEARDAY;</span>
<span class="lineNum">    1487 </span>                :         }
<span class="lineNum">    1488 </span>                : 
<span class="lineNum">    1489 </span>                :         isoweekday
<span class="lineNum">    1490 </span>                :         {
<span class="lineNum">    1491 </span>                :                 timelib_sll w, d;
<span class="lineNum">    1492 </span>                :                 DEBUG_OUTPUT(&quot;isoweekday&quot;);
<span class="lineNum">    1493 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1494 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1495 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_RELATIVE();</span>
<span class="lineNum">    1496 </span>                :                 
<span class="lineNum">    1497 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;y = timelib_get_nr((char **) &amp;ptr, 4);</span>
<span class="lineNum">    1498 </span><span class="lineNoCov">              0 :                 w = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1499 </span><span class="lineNoCov">              0 :                 d = timelib_get_nr((char **) &amp;ptr, 1);</span>
<span class="lineNum">    1500 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = 1;</span>
<span class="lineNum">    1501 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = 1;</span>
<span class="lineNum">    1502 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;relative.d = timelib_daynr_from_weeknr(s-&gt;time-&gt;y, w, d);</span>
<span class="lineNum">    1503 </span>                : 
<span class="lineNum">    1504 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1505 </span><span class="lineNoCov">              0 :                 return TIMELIB_ISO_WEEK;</span>
<span class="lineNum">    1506 </span>                :         }
<span class="lineNum">    1507 </span>                : 
<span class="lineNum">    1508 </span>                :         isoweek
<span class="lineNum">    1509 </span>                :         {
<span class="lineNum">    1510 </span>                :                 timelib_sll w, d;
<span class="lineNum">    1511 </span>                :                 DEBUG_OUTPUT(&quot;isoweek&quot;);
<span class="lineNum">    1512 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1513 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1514 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_RELATIVE();</span>
<span class="lineNum">    1515 </span>                :                 
<span class="lineNum">    1516 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;y = timelib_get_nr((char **) &amp;ptr, 4);</span>
<span class="lineNum">    1517 </span><span class="lineNoCov">              0 :                 w = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1518 </span><span class="lineNoCov">              0 :                 d = 1;</span>
<span class="lineNum">    1519 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = 1;</span>
<span class="lineNum">    1520 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = 1;</span>
<span class="lineNum">    1521 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;relative.d = timelib_daynr_from_weeknr(s-&gt;time-&gt;y, w, d);</span>
<span class="lineNum">    1522 </span>                : 
<span class="lineNum">    1523 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1524 </span><span class="lineNoCov">              0 :                 return TIMELIB_ISO_WEEK;</span>
<span class="lineNum">    1525 </span>                :         }
<span class="lineNum">    1526 </span>                : 
<span class="lineNum">    1527 </span>                :         pgtextshort
<span class="lineNum">    1528 </span>                :         {
<span class="lineNum">    1529 </span><span class="lineNoCov">              0 :                 int length = 0;</span>
<span class="lineNum">    1530 </span>                :                 DEBUG_OUTPUT(&quot;pgtextshort&quot;);
<span class="lineNum">    1531 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1532 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1533 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = timelib_get_month((char **) &amp;ptr);</span>
<span class="lineNum">    1534 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1535 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;y = timelib_get_nr_ex((char **) &amp;ptr, 4, &amp;length);</span>
<span class="lineNum">    1536 </span><span class="lineNoCov">              0 :                 TIMELIB_PROCESS_YEAR(s-&gt;time-&gt;y, length);</span>
<span class="lineNum">    1537 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1538 </span><span class="lineNoCov">              0 :                 return TIMELIB_PG_TEXT;</span>
<span class="lineNum">    1539 </span>                :         }
<span class="lineNum">    1540 </span>                : 
<span class="lineNum">    1541 </span>                :         pgtextreverse
<span class="lineNum">    1542 </span>                :         {
<span class="lineNum">    1543 </span><span class="lineNoCov">              0 :                 int length = 0;</span>
<span class="lineNum">    1544 </span>                :                 DEBUG_OUTPUT(&quot;pgtextreverse&quot;);
<span class="lineNum">    1545 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1546 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1547 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;y = timelib_get_nr_ex((char **) &amp;ptr, 4, &amp;length);</span>
<span class="lineNum">    1548 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = timelib_get_month((char **) &amp;ptr);</span>
<span class="lineNum">    1549 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1550 </span><span class="lineNoCov">              0 :                 TIMELIB_PROCESS_YEAR(s-&gt;time-&gt;y, length);</span>
<span class="lineNum">    1551 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1552 </span><span class="lineNoCov">              0 :                 return TIMELIB_PG_TEXT;</span>
<span class="lineNum">    1553 </span>                :         }
<span class="lineNum">    1554 </span>                : 
<span class="lineNum">    1555 </span>                :         clf
<span class="lineNum">    1556 </span>                :         {
<span class="lineNum">    1557 </span>                :                 int tz_not_found;
<span class="lineNum">    1558 </span>                :                 DEBUG_OUTPUT(&quot;clf&quot;);
<span class="lineNum">    1559 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1560 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_TIME();</span>
<span class="lineNum">    1561 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1562 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1563 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = timelib_get_month((char **) &amp;ptr);</span>
<span class="lineNum">    1564 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;y = timelib_get_nr((char **) &amp;ptr, 4);</span>
<span class="lineNum">    1565 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;h = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1566 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;i = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1567 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;s = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1568 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;z = timelib_get_zone((char **) &amp;ptr, &amp;s-&gt;time-&gt;dst, s-&gt;time, &amp;tz_not_found, s-&gt;tzdb, tz_get_wrapper);</span>
<span class="lineNum">    1569 </span><span class="lineNoCov">              0 :                 if (tz_not_found) {</span>
<span class="lineNum">    1570 </span><span class="lineNoCov">              0 :                         add_error(s, &quot;The timezone could not be found in the database&quot;);</span>
<span class="lineNum">    1571 </span>                :                 }
<span class="lineNum">    1572 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1573 </span><span class="lineNoCov">              0 :                 return TIMELIB_CLF;</span>
<span class="lineNum">    1574 </span>                :         }
<span class="lineNum">    1575 </span>                : 
<span class="lineNum">    1576 </span>                :         year4
<span class="lineNum">    1577 </span>                :         {
<span class="lineNum">    1578 </span>                :                 DEBUG_OUTPUT(&quot;year4&quot;);
<span class="lineNum">    1579 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1580 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;y = timelib_get_nr((char **) &amp;ptr, 4);</span>
<span class="lineNum">    1581 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1582 </span><span class="lineNoCov">              0 :                 return TIMELIB_CLF;</span>
<span class="lineNum">    1583 </span>                :         }
<span class="lineNum">    1584 </span>                : 
<span class="lineNum">    1585 </span>                :         ago
<span class="lineNum">    1586 </span>                :         {
<span class="lineNum">    1587 </span>                :                 DEBUG_OUTPUT(&quot;ago&quot;);
<span class="lineNum">    1588 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1589 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;relative.y = 0 - s-&gt;time-&gt;relative.y;</span>
<span class="lineNum">    1590 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;relative.m = 0 - s-&gt;time-&gt;relative.m;</span>
<span class="lineNum">    1591 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;relative.d = 0 - s-&gt;time-&gt;relative.d;</span>
<span class="lineNum">    1592 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;relative.h = 0 - s-&gt;time-&gt;relative.h;</span>
<span class="lineNum">    1593 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;relative.i = 0 - s-&gt;time-&gt;relative.i;</span>
<span class="lineNum">    1594 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;relative.s = 0 - s-&gt;time-&gt;relative.s;</span>
<span class="lineNum">    1595 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;relative.weekday = 0 - s-&gt;time-&gt;relative.weekday;</span>
<span class="lineNum">    1596 </span><span class="lineNoCov">              0 :                 if (s-&gt;time-&gt;relative.weekday == 0) {</span>
<span class="lineNum">    1597 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;relative.weekday = -7;</span>
<span class="lineNum">    1598 </span>                :                 }
<span class="lineNum">    1599 </span><span class="lineNoCov">              0 :                 if (s-&gt;time-&gt;relative.have_special_relative &amp;&amp; s-&gt;time-&gt;relative.special.type == TIMELIB_SPECIAL_WEEKDAY) {</span>
<span class="lineNum">    1600 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;relative.special.amount = 0 - s-&gt;time-&gt;relative.special.amount;</span>
<span class="lineNum">    1601 </span>                :                 }
<span class="lineNum">    1602 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1603 </span><span class="lineNoCov">              0 :                 return TIMELIB_AGO;</span>
<span class="lineNum">    1604 </span>                :         }
<span class="lineNum">    1605 </span>                : 
<span class="lineNum">    1606 </span>                :         daytext
<span class="lineNum">    1607 </span>                :         {
<span class="lineNum">    1608 </span>                :                 const timelib_relunit* relunit;
<span class="lineNum">    1609 </span>                :                 DEBUG_OUTPUT(&quot;daytext&quot;);
<span class="lineNum">    1610 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1611 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_RELATIVE();</span>
<span class="lineNum">    1612 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_WEEKDAY_RELATIVE();</span>
<span class="lineNum">    1613 </span><span class="lineNoCov">              0 :                 TIMELIB_UNHAVE_TIME();</span>
<span class="lineNum">    1614 </span><span class="lineNoCov">              0 :                 relunit = timelib_lookup_relunit((char**) &amp;ptr);</span>
<span class="lineNum">    1615 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;relative.weekday = relunit-&gt;multiplier;</span>
<span class="lineNum">    1616 </span><span class="lineNoCov">              0 :                 if (s-&gt;time-&gt;relative.weekday_behavior != 2) {</span>
<span class="lineNum">    1617 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;relative.weekday_behavior = 1;</span>
<span class="lineNum">    1618 </span>                :                 }
<span class="lineNum">    1619 </span>                :                 
<span class="lineNum">    1620 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1621 </span><span class="lineNoCov">              0 :                 return TIMELIB_WEEKDAY;</span>
<span class="lineNum">    1622 </span>                :         }
<span class="lineNum">    1623 </span>                : 
<span class="lineNum">    1624 </span>                :         relativetextweek
<span class="lineNum">    1625 </span>                :         {
<span class="lineNum">    1626 </span>                :                 timelib_sll i;
<span class="lineNum">    1627 </span><span class="lineNoCov">              0 :                 int         behavior = 0;</span>
<span class="lineNum">    1628 </span>                :                 DEBUG_OUTPUT(&quot;relativetextweek&quot;);
<span class="lineNum">    1629 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1630 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_RELATIVE();</span>
<span class="lineNum">    1631 </span>                : 
<span class="lineNum">    1632 </span><span class="lineNoCov">              0 :                 while(*ptr) {</span>
<span class="lineNum">    1633 </span><span class="lineNoCov">              0 :                         i = timelib_get_relative_text((char **) &amp;ptr, &amp;behavior);</span>
<span class="lineNum">    1634 </span><span class="lineNoCov">              0 :                         timelib_eat_spaces((char **) &amp;ptr);</span>
<span class="lineNum">    1635 </span><span class="lineNoCov">              0 :                         timelib_set_relative((char **) &amp;ptr, i, behavior, s);</span>
<span class="lineNum">    1636 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;relative.weekday_behavior = 2;</span>
<span class="lineNum">    1637 </span>                : 
<span class="lineNum">    1638 </span>                :                         /* to handle the format weekday + last/this/next week */
<span class="lineNum">    1639 </span><span class="lineNoCov">              0 :                         if (s-&gt;time-&gt;relative.have_weekday_relative == 0) {</span>
<span class="lineNum">    1640 </span><span class="lineNoCov">              0 :                                 TIMELIB_HAVE_WEEKDAY_RELATIVE();</span>
<span class="lineNum">    1641 </span><span class="lineNoCov">              0 :                                 s-&gt;time-&gt;relative.weekday = 1;</span>
<span class="lineNum">    1642 </span>                :                         }
<span class="lineNum">    1643 </span>                :                 }
<span class="lineNum">    1644 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1645 </span><span class="lineNoCov">              0 :                 return TIMELIB_RELATIVE;</span>
<span class="lineNum">    1646 </span>                :         }
<span class="lineNum">    1647 </span>                : 
<span class="lineNum">    1648 </span>                :         relativetext
<span class="lineNum">    1649 </span>                :         {
<span class="lineNum">    1650 </span>                :                 timelib_sll i;
<span class="lineNum">    1651 </span><span class="lineNoCov">              0 :                 int         behavior = 0;</span>
<span class="lineNum">    1652 </span>                :                 DEBUG_OUTPUT(&quot;relativetext&quot;);
<span class="lineNum">    1653 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1654 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_RELATIVE();</span>
<span class="lineNum">    1655 </span>                : 
<span class="lineNum">    1656 </span><span class="lineNoCov">              0 :                 while(*ptr) {</span>
<span class="lineNum">    1657 </span><span class="lineNoCov">              0 :                         i = timelib_get_relative_text((char **) &amp;ptr, &amp;behavior);</span>
<span class="lineNum">    1658 </span><span class="lineNoCov">              0 :                         timelib_eat_spaces((char **) &amp;ptr);</span>
<span class="lineNum">    1659 </span><span class="lineNoCov">              0 :                         timelib_set_relative((char **) &amp;ptr, i, behavior, s);</span>
<span class="lineNum">    1660 </span>                :                 }
<span class="lineNum">    1661 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1662 </span><span class="lineNoCov">              0 :                 return TIMELIB_RELATIVE;</span>
<span class="lineNum">    1663 </span>                :         }
<span class="lineNum">    1664 </span>                : 
<span class="lineNum">    1665 </span>                :         monthfull | monthabbr
<span class="lineNum">    1666 </span>                :         {
<span class="lineNum">    1667 </span>                :                 DEBUG_OUTPUT(&quot;monthtext&quot;);
<span class="lineNum">    1668 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1669 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1670 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = timelib_lookup_month((char **) &amp;ptr);</span>
<span class="lineNum">    1671 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1672 </span><span class="lineNoCov">              0 :                 return TIMELIB_DATE_TEXT;</span>
<span class="lineNum">    1673 </span>                :         }
<span class="lineNum">    1674 </span>                : 
<span class="lineNum">    1675 </span>                :         tzcorrection | tz
<span class="lineNum">    1676 </span>                :         {
<span class="lineNum">    1677 </span>                :                 int tz_not_found;
<span class="lineNum">    1678 </span>                :                 DEBUG_OUTPUT(&quot;tzcorrection | tz&quot;);
<span class="lineNum">    1679 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1680 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_TZ();</span>
<span class="lineNum">    1681 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;z = timelib_get_zone((char **) &amp;ptr, &amp;s-&gt;time-&gt;dst, s-&gt;time, &amp;tz_not_found, s-&gt;tzdb, tz_get_wrapper);</span>
<span class="lineNum">    1682 </span><span class="lineNoCov">              0 :                 if (tz_not_found) {</span>
<span class="lineNum">    1683 </span><span class="lineNoCov">              0 :                         add_error(s, &quot;The timezone could not be found in the database&quot;);</span>
<span class="lineNum">    1684 </span>                :                 }
<span class="lineNum">    1685 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1686 </span><span class="lineNoCov">              0 :                 return TIMELIB_TIMEZONE;</span>
<span class="lineNum">    1687 </span>                :         }
<span class="lineNum">    1688 </span>                : 
<span class="lineNum">    1689 </span>                :         dateshortwithtimeshort12 | dateshortwithtimelong12
<span class="lineNum">    1690 </span>                :         {
<span class="lineNum">    1691 </span>                :                 DEBUG_OUTPUT(&quot;dateshortwithtimeshort12 | dateshortwithtimelong12&quot;);
<span class="lineNum">    1692 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1693 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1694 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = timelib_get_month((char **) &amp;ptr);</span>
<span class="lineNum">    1695 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1696 </span>                : 
<span class="lineNum">    1697 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_TIME();</span>
<span class="lineNum">    1698 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;h = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1699 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;i = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1700 </span><span class="lineNoCov">              0 :                 if (*ptr == ':' || *ptr == '.') {</span>
<span class="lineNum">    1701 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;s = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1702 </span>                : 
<span class="lineNum">    1703 </span><span class="lineNoCov">              0 :                         if (*ptr == '.') {</span>
<span class="lineNum">    1704 </span><span class="lineNoCov">              0 :                                 s-&gt;time-&gt;f = timelib_get_frac_nr((char **) &amp;ptr, 8);</span>
<span class="lineNum">    1705 </span>                :                         }
<span class="lineNum">    1706 </span>                :                 }
<span class="lineNum">    1707 </span>                : 
<span class="lineNum">    1708 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;h += timelib_meridian((char **) &amp;ptr, s-&gt;time-&gt;h);</span>
<span class="lineNum">    1709 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1710 </span><span class="lineNoCov">              0 :                 return TIMELIB_SHORTDATE_WITH_TIME;</span>
<span class="lineNum">    1711 </span>                :         }
<span class="lineNum">    1712 </span>                : 
<span class="lineNum">    1713 </span>                :         dateshortwithtimeshort | dateshortwithtimelong | dateshortwithtimelongtz
<span class="lineNum">    1714 </span>                :         {
<span class="lineNum">    1715 </span>                :                 int tz_not_found;
<span class="lineNum">    1716 </span>                :                 DEBUG_OUTPUT(&quot;dateshortwithtimeshort | dateshortwithtimelong | dateshortwithtimelongtz&quot;);
<span class="lineNum">    1717 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1718 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_DATE();</span>
<span class="lineNum">    1719 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;m = timelib_get_month((char **) &amp;ptr);</span>
<span class="lineNum">    1720 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1721 </span>                : 
<span class="lineNum">    1722 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_TIME();</span>
<span class="lineNum">    1723 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;h = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1724 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;i = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1725 </span><span class="lineNoCov">              0 :                 if (*ptr == ':') {</span>
<span class="lineNum">    1726 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;s = timelib_get_nr((char **) &amp;ptr, 2);</span>
<span class="lineNum">    1727 </span>                : 
<span class="lineNum">    1728 </span><span class="lineNoCov">              0 :                         if (*ptr == '.') {</span>
<span class="lineNum">    1729 </span><span class="lineNoCov">              0 :                                 s-&gt;time-&gt;f = timelib_get_frac_nr((char **) &amp;ptr, 8);</span>
<span class="lineNum">    1730 </span>                :                         }
<span class="lineNum">    1731 </span>                :                 }
<span class="lineNum">    1732 </span>                : 
<span class="lineNum">    1733 </span><span class="lineNoCov">              0 :                 if (*ptr != '\0') {</span>
<span class="lineNum">    1734 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;z = timelib_get_zone((char **) &amp;ptr, &amp;s-&gt;time-&gt;dst, s-&gt;time, &amp;tz_not_found, s-&gt;tzdb, tz_get_wrapper);</span>
<span class="lineNum">    1735 </span><span class="lineNoCov">              0 :                         if (tz_not_found) {</span>
<span class="lineNum">    1736 </span><span class="lineNoCov">              0 :                                 add_error(s, &quot;The timezone could not be found in the database&quot;);</span>
<span class="lineNum">    1737 </span>                :                         }
<span class="lineNum">    1738 </span>                :                 }
<span class="lineNum">    1739 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1740 </span><span class="lineNoCov">              0 :                 return TIMELIB_SHORTDATE_WITH_TIME;</span>
<span class="lineNum">    1741 </span>                :         }
<span class="lineNum">    1742 </span>                : 
<span class="lineNum">    1743 </span>                :         relative
<span class="lineNum">    1744 </span>                :         {
<span class="lineNum">    1745 </span>                :                 timelib_ull i;
<span class="lineNum">    1746 </span>                :                 DEBUG_OUTPUT(&quot;relative&quot;);
<span class="lineNum">    1747 </span><span class="lineNoCov">              0 :                 TIMELIB_INIT;</span>
<span class="lineNum">    1748 </span><span class="lineNoCov">              0 :                 TIMELIB_HAVE_RELATIVE();</span>
<span class="lineNum">    1749 </span>                : 
<span class="lineNum">    1750 </span><span class="lineNoCov">              0 :                 while(*ptr) {</span>
<span class="lineNum">    1751 </span><span class="lineNoCov">              0 :                         i = timelib_get_unsigned_nr((char **) &amp;ptr, 24);</span>
<span class="lineNum">    1752 </span><span class="lineNoCov">              0 :                         timelib_eat_spaces((char **) &amp;ptr);</span>
<span class="lineNum">    1753 </span><span class="lineNoCov">              0 :                         timelib_set_relative((char **) &amp;ptr, i, 1, s);</span>
<span class="lineNum">    1754 </span>                :                 }
<span class="lineNum">    1755 </span><span class="lineNoCov">              0 :                 TIMELIB_DEINIT;</span>
<span class="lineNum">    1756 </span><span class="lineNoCov">              0 :                 return TIMELIB_RELATIVE;</span>
<span class="lineNum">    1757 </span>                :         }
<span class="lineNum">    1758 </span>                : 
<span class="lineNum">    1759 </span>                :         [ .,\t]
<span class="lineNum">    1760 </span>                :         {
<span class="lineNum">    1761 </span><span class="lineNoCov">              0 :                 goto std;</span>
<span class="lineNum">    1762 </span>                :         }
<span class="lineNum">    1763 </span>                : 
<span class="lineNum">    1764 </span>                :         &quot;\000&quot;|&quot;\n&quot;
<span class="lineNum">    1765 </span>                :         {
<span class="lineNum">    1766 </span><span class="lineNoCov">              0 :                 s-&gt;pos = cursor; s-&gt;line++;</span>
<span class="lineNum">    1767 </span><span class="lineNoCov">              0 :                 goto std;</span>
<span class="lineNum">    1768 </span>                :         }
<span class="lineNum">    1769 </span>                : 
<span class="lineNum">    1770 </span>                :         any
<span class="lineNum">    1771 </span>                :         {
<span class="lineNum">    1772 </span><span class="lineNoCov">              0 :                 add_error(s, &quot;Unexpected character&quot;);</span>
<span class="lineNum">    1773 </span><span class="lineNoCov">              0 :                 goto std;</span>
<span class="lineNum">    1774 </span>                :         }
<span class="lineNum">    1775 </span>                : */
<span class="lineNum">    1776 </span>                : }
<span class="lineNum">    1777 </span>                : 
<a name="1778"><span class="lineNum">    1778 </span>                : /*!max:re2c */</a>
<span class="lineNum">    1779 </span>                : 
<span class="lineNum">    1780 </span><span class="lineNoCov">              0 : timelib_time* timelib_strtotime(char *s, int len, struct timelib_error_container **errors, const timelib_tzdb *tzdb, timelib_tz_get_wrapper tz_get_wrapper)</span>
<span class="lineNum">    1781 </span>                : {
<span class="lineNum">    1782 </span>                :         Scanner in;
<span class="lineNum">    1783 </span>                :         int t;
<span class="lineNum">    1784 </span><span class="lineNoCov">              0 :         char *e = s + len - 1;</span>
<span class="lineNum">    1785 </span>                : 
<span class="lineNum">    1786 </span><span class="lineNoCov">              0 :         memset(&amp;in, 0, sizeof(in));</span>
<span class="lineNum">    1787 </span><span class="lineNoCov">              0 :         in.errors = malloc(sizeof(struct timelib_error_container));</span>
<span class="lineNum">    1788 </span><span class="lineNoCov">              0 :         in.errors-&gt;warning_count = 0;</span>
<span class="lineNum">    1789 </span><span class="lineNoCov">              0 :         in.errors-&gt;warning_messages = NULL;</span>
<span class="lineNum">    1790 </span><span class="lineNoCov">              0 :         in.errors-&gt;error_count = 0;</span>
<span class="lineNum">    1791 </span><span class="lineNoCov">              0 :         in.errors-&gt;error_messages = NULL;</span>
<span class="lineNum">    1792 </span>                : 
<span class="lineNum">    1793 </span><span class="lineNoCov">              0 :         if (len &gt; 0) {</span>
<span class="lineNum">    1794 </span><span class="lineNoCov">              0 :                 while (isspace(*s) &amp;&amp; s &lt; e) {</span>
<span class="lineNum">    1795 </span><span class="lineNoCov">              0 :                         s++;</span>
<span class="lineNum">    1796 </span>                :                 }
<span class="lineNum">    1797 </span><span class="lineNoCov">              0 :                 while (isspace(*e) &amp;&amp; e &gt; s) {</span>
<span class="lineNum">    1798 </span><span class="lineNoCov">              0 :                         e--;</span>
<span class="lineNum">    1799 </span>                :                 }
<span class="lineNum">    1800 </span>                :         }
<span class="lineNum">    1801 </span><span class="lineNoCov">              0 :         if (e - s &lt; 0) {</span>
<span class="lineNum">    1802 </span><span class="lineNoCov">              0 :                 in.time = timelib_time_ctor();</span>
<span class="lineNum">    1803 </span><span class="lineNoCov">              0 :                 add_error(&amp;in, &quot;Empty string&quot;);</span>
<span class="lineNum">    1804 </span><span class="lineNoCov">              0 :                 if (errors) {</span>
<span class="lineNum">    1805 </span><span class="lineNoCov">              0 :                         *errors = in.errors;</span>
<span class="lineNum">    1806 </span>                :                 } else {
<span class="lineNum">    1807 </span><span class="lineNoCov">              0 :                         timelib_error_container_dtor(in.errors);</span>
<span class="lineNum">    1808 </span>                :                 }
<span class="lineNum">    1809 </span><span class="lineNoCov">              0 :                 in.time-&gt;y = in.time-&gt;d = in.time-&gt;m = in.time-&gt;h = in.time-&gt;i = in.time-&gt;s = in.time-&gt;f = in.time-&gt;dst = in.time-&gt;z = TIMELIB_UNSET;</span>
<span class="lineNum">    1810 </span><span class="lineNoCov">              0 :                 in.time-&gt;is_localtime = in.time-&gt;zone_type = 0;</span>
<span class="lineNum">    1811 </span><span class="lineNoCov">              0 :                 return in.time;</span>
<span class="lineNum">    1812 </span>                :         }
<span class="lineNum">    1813 </span><span class="lineNoCov">              0 :         e++;</span>
<span class="lineNum">    1814 </span>                : 
<span class="lineNum">    1815 </span><span class="lineNoCov">              0 :         in.str = malloc((e - s) + YYMAXFILL);</span>
<span class="lineNum">    1816 </span><span class="lineNoCov">              0 :         memset(in.str, 0, (e - s) + YYMAXFILL);</span>
<span class="lineNum">    1817 </span><span class="lineNoCov">              0 :         memcpy(in.str, s, (e - s));</span>
<span class="lineNum">    1818 </span><span class="lineNoCov">              0 :         in.lim = in.str + (e - s) + YYMAXFILL;</span>
<span class="lineNum">    1819 </span><span class="lineNoCov">              0 :         in.cur = in.str;</span>
<span class="lineNum">    1820 </span><span class="lineNoCov">              0 :         in.time = timelib_time_ctor();</span>
<span class="lineNum">    1821 </span><span class="lineNoCov">              0 :         in.time-&gt;y = TIMELIB_UNSET;</span>
<span class="lineNum">    1822 </span><span class="lineNoCov">              0 :         in.time-&gt;d = TIMELIB_UNSET;</span>
<span class="lineNum">    1823 </span><span class="lineNoCov">              0 :         in.time-&gt;m = TIMELIB_UNSET;</span>
<span class="lineNum">    1824 </span><span class="lineNoCov">              0 :         in.time-&gt;h = TIMELIB_UNSET;</span>
<span class="lineNum">    1825 </span><span class="lineNoCov">              0 :         in.time-&gt;i = TIMELIB_UNSET;</span>
<span class="lineNum">    1826 </span><span class="lineNoCov">              0 :         in.time-&gt;s = TIMELIB_UNSET;</span>
<span class="lineNum">    1827 </span><span class="lineNoCov">              0 :         in.time-&gt;f = TIMELIB_UNSET;</span>
<span class="lineNum">    1828 </span><span class="lineNoCov">              0 :         in.time-&gt;z = TIMELIB_UNSET;</span>
<span class="lineNum">    1829 </span><span class="lineNoCov">              0 :         in.time-&gt;dst = TIMELIB_UNSET;</span>
<span class="lineNum">    1830 </span><span class="lineNoCov">              0 :         in.tzdb = tzdb;</span>
<span class="lineNum">    1831 </span><span class="lineNoCov">              0 :         in.time-&gt;is_localtime = 0;</span>
<span class="lineNum">    1832 </span><span class="lineNoCov">              0 :         in.time-&gt;zone_type = 0;</span>
<span class="lineNum">    1833 </span>                : 
<span class="lineNum">    1834 </span>                :         do {
<span class="lineNum">    1835 </span><span class="lineNoCov">              0 :                 t = scan(&amp;in, tz_get_wrapper);</span>
<span class="lineNum">    1836 </span>                : #ifdef DEBUG_PARSER
<span class="lineNum">    1837 </span>                :                 printf(&quot;%d\n&quot;, t);
<span class="lineNum">    1838 </span>                : #endif
<span class="lineNum">    1839 </span><span class="lineNoCov">              0 :         } while(t != EOI);</span>
<span class="lineNum">    1840 </span>                : 
<span class="lineNum">    1841 </span>                :         /* do funky checking whether the parsed time was valid time */
<span class="lineNum">    1842 </span><span class="lineNoCov">              0 :         if (in.time-&gt;have_time &amp;&amp; !timelib_valid_time( in.time-&gt;h, in.time-&gt;i, in.time-&gt;s)) {</span>
<span class="lineNum">    1843 </span><span class="lineNoCov">              0 :                 add_warning(&amp;in, &quot;The parsed time was invalid&quot;);</span>
<span class="lineNum">    1844 </span>                :         }
<span class="lineNum">    1845 </span>                :         /* do funky checking whether the parsed date was valid date */
<span class="lineNum">    1846 </span><span class="lineNoCov">              0 :         if (in.time-&gt;have_date &amp;&amp; !timelib_valid_date( in.time-&gt;y, in.time-&gt;m, in.time-&gt;d)) {</span>
<span class="lineNum">    1847 </span><span class="lineNoCov">              0 :                 add_warning(&amp;in, &quot;The parsed date was invalid&quot;);</span>
<span class="lineNum">    1848 </span>                :         }
<span class="lineNum">    1849 </span>                : 
<span class="lineNum">    1850 </span><span class="lineNoCov">              0 :         free(in.str);</span>
<span class="lineNum">    1851 </span><span class="lineNoCov">              0 :         if (errors) {</span>
<span class="lineNum">    1852 </span><span class="lineNoCov">              0 :                 *errors = in.errors;</span>
<span class="lineNum">    1853 </span>                :         } else {
<span class="lineNum">    1854 </span><span class="lineNoCov">              0 :                 timelib_error_container_dtor(in.errors);</span>
<span class="lineNum">    1855 </span>                :         }
<span class="lineNum">    1856 </span><span class="lineNoCov">              0 :         return in.time;</span>
<span class="lineNum">    1857 </span>                : }
<span class="lineNum">    1858 </span>                : 
<span class="lineNum">    1859 </span>                : #define TIMELIB_CHECK_NUMBER                                           \
<span class="lineNum">    1860 </span>                :                 if (strchr(&quot;0123456789&quot;, *ptr) == NULL)                        \
<span class="lineNum">    1861 </span>                :                 {                                                              \
<span class="lineNum">    1862 </span>                :                         add_pbf_error(s, &quot;Unexpected data found.&quot;, string, begin); \
<a name="1863"><span class="lineNum">    1863 </span>                :                 }</a>
<span class="lineNum">    1864 </span>                : 
<span class="lineNum">    1865 </span><span class="lineNoCov">              0 : static void timelib_time_reset_fields(timelib_time *time)</span>
<span class="lineNum">    1866 </span>                : {
<span class="lineNum">    1867 </span><span class="lineNoCov">              0 :         assert(time != NULL);</span>
<span class="lineNum">    1868 </span>                : 
<span class="lineNum">    1869 </span><span class="lineNoCov">              0 :         time-&gt;y = 1970;</span>
<span class="lineNum">    1870 </span><span class="lineNoCov">              0 :         time-&gt;m = 1;</span>
<span class="lineNum">    1871 </span><span class="lineNoCov">              0 :         time-&gt;d = 1;</span>
<span class="lineNum">    1872 </span><span class="lineNoCov">              0 :         time-&gt;h = time-&gt;i = time-&gt;s = 0;</span>
<span class="lineNum">    1873 </span><span class="lineNoCov">              0 :         time-&gt;f = 0.0;</span>
<span class="lineNum">    1874 </span><span class="lineNoCov">              0 :         time-&gt;tz_info = NULL;</span>
<a name="1875"><span class="lineNum">    1875 </span><span class="lineNoCov">              0 : }</span></a>
<span class="lineNum">    1876 </span>                : 
<span class="lineNum">    1877 </span><span class="lineNoCov">              0 : static void timelib_time_reset_unset_fields(timelib_time *time)</span>
<span class="lineNum">    1878 </span>                : {
<span class="lineNum">    1879 </span><span class="lineNoCov">              0 :         assert(time != NULL);</span>
<span class="lineNum">    1880 </span>                : 
<span class="lineNum">    1881 </span><span class="lineNoCov">              0 :         if (time-&gt;y == TIMELIB_UNSET ) time-&gt;y = 1970;</span>
<span class="lineNum">    1882 </span><span class="lineNoCov">              0 :         if (time-&gt;m == TIMELIB_UNSET ) time-&gt;m = 1;</span>
<span class="lineNum">    1883 </span><span class="lineNoCov">              0 :         if (time-&gt;d == TIMELIB_UNSET ) time-&gt;d = 1;</span>
<span class="lineNum">    1884 </span><span class="lineNoCov">              0 :         if (time-&gt;h == TIMELIB_UNSET ) time-&gt;h = 0;</span>
<span class="lineNum">    1885 </span><span class="lineNoCov">              0 :         if (time-&gt;i == TIMELIB_UNSET ) time-&gt;i = 0;</span>
<span class="lineNum">    1886 </span><span class="lineNoCov">              0 :         if (time-&gt;s == TIMELIB_UNSET ) time-&gt;s = 0;</span>
<span class="lineNum">    1887 </span><span class="lineNoCov">              0 :         if (time-&gt;f == TIMELIB_UNSET ) time-&gt;f = 0.0;</span>
<a name="1888"><span class="lineNum">    1888 </span><span class="lineNoCov">              0 : }</span></a>
<span class="lineNum">    1889 </span>                : 
<span class="lineNum">    1890 </span><span class="lineNoCov">              0 : timelib_time *timelib_parse_from_format(char *format, char *string, int len, timelib_error_container **errors, const timelib_tzdb *tzdb, timelib_tz_get_wrapper tz_get_wrapper)</span>
<span class="lineNum">    1891 </span>                : {
<span class="lineNum">    1892 </span><span class="lineNoCov">              0 :         char       *fptr = format;</span>
<span class="lineNum">    1893 </span><span class="lineNoCov">              0 :         char       *ptr = string;</span>
<span class="lineNum">    1894 </span>                :         char       *begin;
<span class="lineNum">    1895 </span>                :         timelib_sll tmp;
<span class="lineNum">    1896 </span>                :         Scanner in;
<span class="lineNum">    1897 </span><span class="lineNoCov">              0 :         Scanner *s = &amp;in;</span>
<span class="lineNum">    1898 </span><span class="lineNoCov">              0 :         int allow_extra = 0;</span>
<span class="lineNum">    1899 </span>                : 
<span class="lineNum">    1900 </span><span class="lineNoCov">              0 :         memset(&amp;in, 0, sizeof(in));</span>
<span class="lineNum">    1901 </span><span class="lineNoCov">              0 :         in.errors = malloc(sizeof(struct timelib_error_container));</span>
<span class="lineNum">    1902 </span><span class="lineNoCov">              0 :         in.errors-&gt;warning_count = 0;</span>
<span class="lineNum">    1903 </span><span class="lineNoCov">              0 :         in.errors-&gt;warning_messages = NULL;</span>
<span class="lineNum">    1904 </span><span class="lineNoCov">              0 :         in.errors-&gt;error_count = 0;</span>
<span class="lineNum">    1905 </span><span class="lineNoCov">              0 :         in.errors-&gt;error_messages = NULL;</span>
<span class="lineNum">    1906 </span>                : 
<span class="lineNum">    1907 </span><span class="lineNoCov">              0 :         in.time = timelib_time_ctor();</span>
<span class="lineNum">    1908 </span><span class="lineNoCov">              0 :         in.time-&gt;y = TIMELIB_UNSET;</span>
<span class="lineNum">    1909 </span><span class="lineNoCov">              0 :         in.time-&gt;d = TIMELIB_UNSET;</span>
<span class="lineNum">    1910 </span><span class="lineNoCov">              0 :         in.time-&gt;m = TIMELIB_UNSET;</span>
<span class="lineNum">    1911 </span><span class="lineNoCov">              0 :         in.time-&gt;h = TIMELIB_UNSET;</span>
<span class="lineNum">    1912 </span><span class="lineNoCov">              0 :         in.time-&gt;i = TIMELIB_UNSET;</span>
<span class="lineNum">    1913 </span><span class="lineNoCov">              0 :         in.time-&gt;s = TIMELIB_UNSET;</span>
<span class="lineNum">    1914 </span><span class="lineNoCov">              0 :         in.time-&gt;f = TIMELIB_UNSET;</span>
<span class="lineNum">    1915 </span><span class="lineNoCov">              0 :         in.time-&gt;z = TIMELIB_UNSET;</span>
<span class="lineNum">    1916 </span><span class="lineNoCov">              0 :         in.time-&gt;dst = TIMELIB_UNSET;</span>
<span class="lineNum">    1917 </span><span class="lineNoCov">              0 :         in.tzdb = tzdb;</span>
<span class="lineNum">    1918 </span><span class="lineNoCov">              0 :         in.time-&gt;is_localtime = 0;</span>
<span class="lineNum">    1919 </span><span class="lineNoCov">              0 :         in.time-&gt;zone_type = 0;</span>
<span class="lineNum">    1920 </span>                : 
<span class="lineNum">    1921 </span>                :         /* Loop over the format string */
<span class="lineNum">    1922 </span><span class="lineNoCov">              0 :         while (*fptr &amp;&amp; *ptr) {</span>
<span class="lineNum">    1923 </span><span class="lineNoCov">              0 :                 begin = ptr;</span>
<span class="lineNum">    1924 </span><span class="lineNoCov">              0 :                 switch (*fptr) {</span>
<span class="lineNum">    1925 </span>                :                         case 'D': /* three letter day */
<span class="lineNum">    1926 </span>                :                         case 'l': /* full day */
<span class="lineNum">    1927 </span>                :                                 {
<span class="lineNum">    1928 </span><span class="lineNoCov">              0 :                                         const timelib_relunit* tmprel = 0;</span>
<span class="lineNum">    1929 </span>                : 
<span class="lineNum">    1930 </span><span class="lineNoCov">              0 :                                         tmprel = timelib_lookup_relunit((char **) &amp;ptr);</span>
<span class="lineNum">    1931 </span><span class="lineNoCov">              0 :                                         if (!tmprel) {</span>
<span class="lineNum">    1932 </span><span class="lineNoCov">              0 :                                                 add_pbf_error(s, &quot;A textual day could not be found&quot;, string, begin);</span>
<span class="lineNum">    1933 </span><span class="lineNoCov">              0 :                                                 break;</span>
<span class="lineNum">    1934 </span>                :                                         } else {
<span class="lineNum">    1935 </span><span class="lineNoCov">              0 :                                                 in.time-&gt;have_relative = 1; </span>
<span class="lineNum">    1936 </span><span class="lineNoCov">              0 :                                                 in.time-&gt;relative.have_weekday_relative = 1;</span>
<span class="lineNum">    1937 </span><span class="lineNoCov">              0 :                                                 in.time-&gt;relative.weekday = tmprel-&gt;multiplier;</span>
<span class="lineNum">    1938 </span><span class="lineNoCov">              0 :                                                 in.time-&gt;relative.weekday_behavior = 1;</span>
<span class="lineNum">    1939 </span>                :                                         }
<span class="lineNum">    1940 </span>                :                                 }
<span class="lineNum">    1941 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    1942 </span>                :                         case 'd': /* two digit day, with leading zero */
<span class="lineNum">    1943 </span>                :                         case 'j': /* two digit day, without leading zero */
<span class="lineNum">    1944 </span><span class="lineNoCov">              0 :                                 TIMELIB_CHECK_NUMBER;</span>
<span class="lineNum">    1945 </span><span class="lineNoCov">              0 :                                 if ((s-&gt;time-&gt;d = timelib_get_nr((char **) &amp;ptr, 2)) == TIMELIB_UNSET) {</span>
<span class="lineNum">    1946 </span><span class="lineNoCov">              0 :                                         add_pbf_error(s, &quot;A two digit day could not be found&quot;, string, begin);</span>
<span class="lineNum">    1947 </span>                :                                 }
<span class="lineNum">    1948 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    1949 </span>                :                         case 'S': /* day suffix, ignored, nor checked */
<span class="lineNum">    1950 </span><span class="lineNoCov">              0 :                                 timelib_skip_day_suffix((char **) &amp;ptr);</span>
<span class="lineNum">    1951 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    1952 </span>                :                         case 'z': /* day of year - resets month (0 based) - also initializes everything else to !TIMELIB_UNSET */
<span class="lineNum">    1953 </span><span class="lineNoCov">              0 :                                 TIMELIB_CHECK_NUMBER;</span>
<span class="lineNum">    1954 </span><span class="lineNoCov">              0 :                                 if ((tmp = timelib_get_nr((char **) &amp;ptr, 3)) == TIMELIB_UNSET) {</span>
<span class="lineNum">    1955 </span><span class="lineNoCov">              0 :                                         add_pbf_error(s, &quot;A three digit day-of-year could not be found&quot;, string, begin);</span>
<span class="lineNum">    1956 </span>                :                                 } else {
<span class="lineNum">    1957 </span><span class="lineNoCov">              0 :                                         s-&gt;time-&gt;m = 1;</span>
<span class="lineNum">    1958 </span><span class="lineNoCov">              0 :                                         s-&gt;time-&gt;d = tmp + 1;</span>
<span class="lineNum">    1959 </span><span class="lineNoCov">              0 :                                         timelib_do_normalize(s-&gt;time);</span>
<span class="lineNum">    1960 </span>                :                                 }
<span class="lineNum">    1961 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    1962 </span>                : 
<span class="lineNum">    1963 </span>                :                         case 'm': /* two digit month, with leading zero */
<span class="lineNum">    1964 </span>                :                         case 'n': /* two digit month, without leading zero */
<span class="lineNum">    1965 </span><span class="lineNoCov">              0 :                                 TIMELIB_CHECK_NUMBER;</span>
<span class="lineNum">    1966 </span><span class="lineNoCov">              0 :                                 if ((s-&gt;time-&gt;m = timelib_get_nr((char **) &amp;ptr, 2)) == TIMELIB_UNSET) {</span>
<span class="lineNum">    1967 </span><span class="lineNoCov">              0 :                                         add_pbf_error(s, &quot;A two digit month could not be found&quot;, string, begin);</span>
<span class="lineNum">    1968 </span>                :                                 }
<span class="lineNum">    1969 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    1970 </span>                :                         case 'M': /* three letter month */
<span class="lineNum">    1971 </span>                :                         case 'F': /* full month */
<span class="lineNum">    1972 </span><span class="lineNoCov">              0 :                                 tmp = timelib_lookup_month((char **) &amp;ptr);</span>
<span class="lineNum">    1973 </span><span class="lineNoCov">              0 :                                 if (!tmp) {</span>
<span class="lineNum">    1974 </span><span class="lineNoCov">              0 :                                         add_pbf_error(s, &quot;A textual month could not be found&quot;, string, begin);</span>
<span class="lineNum">    1975 </span>                :                                 } else {
<span class="lineNum">    1976 </span><span class="lineNoCov">              0 :                                         s-&gt;time-&gt;m = tmp;</span>
<span class="lineNum">    1977 </span>                :                                 }
<span class="lineNum">    1978 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    1979 </span>                :                         case 'y': /* two digit year */
<span class="lineNum">    1980 </span>                :                                 {
<span class="lineNum">    1981 </span><span class="lineNoCov">              0 :                                         int length = 0;</span>
<span class="lineNum">    1982 </span><span class="lineNoCov">              0 :                                         TIMELIB_CHECK_NUMBER;</span>
<span class="lineNum">    1983 </span><span class="lineNoCov">              0 :                                         if ((s-&gt;time-&gt;y = timelib_get_nr_ex((char **) &amp;ptr, 2, &amp;length)) == TIMELIB_UNSET) {</span>
<span class="lineNum">    1984 </span><span class="lineNoCov">              0 :                                                 add_pbf_error(s, &quot;A two digit year could not be found&quot;, string, begin);</span>
<span class="lineNum">    1985 </span>                :                                         }
<span class="lineNum">    1986 </span><span class="lineNoCov">              0 :                                         TIMELIB_PROCESS_YEAR(s-&gt;time-&gt;y, length);</span>
<span class="lineNum">    1987 </span>                :                                 }
<span class="lineNum">    1988 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    1989 </span>                :                         case 'Y': /* four digit year */
<span class="lineNum">    1990 </span><span class="lineNoCov">              0 :                                 TIMELIB_CHECK_NUMBER;</span>
<span class="lineNum">    1991 </span><span class="lineNoCov">              0 :                                 if ((s-&gt;time-&gt;y = timelib_get_nr((char **) &amp;ptr, 4)) == TIMELIB_UNSET) {</span>
<span class="lineNum">    1992 </span><span class="lineNoCov">              0 :                                         add_pbf_error(s, &quot;A four digit year could not be found&quot;, string, begin);</span>
<span class="lineNum">    1993 </span>                :                                 }
<span class="lineNum">    1994 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    1995 </span>                :                         case 'g': /* two digit hour, with leading zero */
<span class="lineNum">    1996 </span>                :                         case 'h': /* two digit hour, without leading zero */
<span class="lineNum">    1997 </span><span class="lineNoCov">              0 :                                 TIMELIB_CHECK_NUMBER;</span>
<span class="lineNum">    1998 </span><span class="lineNoCov">              0 :                                 if ((s-&gt;time-&gt;h = timelib_get_nr((char **) &amp;ptr, 2)) == TIMELIB_UNSET) {</span>
<span class="lineNum">    1999 </span><span class="lineNoCov">              0 :                                         add_pbf_error(s, &quot;A two digit hour could not be found&quot;, string, begin);</span>
<span class="lineNum">    2000 </span>                :                                 }
<span class="lineNum">    2001 </span><span class="lineNoCov">              0 :                                 if (s-&gt;time-&gt;h &gt; 12) {</span>
<span class="lineNum">    2002 </span><span class="lineNoCov">              0 :                                         add_pbf_error(s, &quot;Hour can not be higher than 12&quot;, string, begin);</span>
<span class="lineNum">    2003 </span>                :                                 }
<span class="lineNum">    2004 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    2005 </span>                :                         case 'G': /* two digit hour, with leading zero */
<span class="lineNum">    2006 </span>                :                         case 'H': /* two digit hour, without leading zero */
<span class="lineNum">    2007 </span><span class="lineNoCov">              0 :                                 TIMELIB_CHECK_NUMBER;</span>
<span class="lineNum">    2008 </span><span class="lineNoCov">              0 :                                 if ((s-&gt;time-&gt;h = timelib_get_nr((char **) &amp;ptr, 2)) == TIMELIB_UNSET) {</span>
<span class="lineNum">    2009 </span><span class="lineNoCov">              0 :                                         add_pbf_error(s, &quot;A two digit hour could not be found&quot;, string, begin);</span>
<span class="lineNum">    2010 </span>                :                                 }
<span class="lineNum">    2011 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    2012 </span>                :                         case 'a': /* am/pm/a.m./p.m. */
<span class="lineNum">    2013 </span>                :                         case 'A': /* AM/PM/A.M./P.M. */
<span class="lineNum">    2014 </span><span class="lineNoCov">              0 :                                 if (s-&gt;time-&gt;h == TIMELIB_UNSET) {</span>
<span class="lineNum">    2015 </span><span class="lineNoCov">              0 :                                         add_pbf_error(s, &quot;Meridian can only come after an hour has been found&quot;, string, begin);</span>
<span class="lineNum">    2016 </span><span class="lineNoCov">              0 :                                 } else if ((tmp = timelib_meridian_with_check((char **) &amp;ptr, s-&gt;time-&gt;h)) == TIMELIB_UNSET) {</span>
<span class="lineNum">    2017 </span><span class="lineNoCov">              0 :                                         add_pbf_error(s, &quot;A meridian could not be found&quot;, string, begin);</span>
<span class="lineNum">    2018 </span>                :                                 } else {
<span class="lineNum">    2019 </span><span class="lineNoCov">              0 :                                         s-&gt;time-&gt;h += tmp;</span>
<span class="lineNum">    2020 </span>                :                                 }
<span class="lineNum">    2021 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    2022 </span>                :                         case 'i': /* two digit minute, with leading zero */
<span class="lineNum">    2023 </span>                :                                 {
<span class="lineNum">    2024 </span>                :                                         int length;
<span class="lineNum">    2025 </span>                :                                         timelib_sll min;
<span class="lineNum">    2026 </span>                : 
<span class="lineNum">    2027 </span><span class="lineNoCov">              0 :                                         TIMELIB_CHECK_NUMBER;</span>
<span class="lineNum">    2028 </span><span class="lineNoCov">              0 :                                         min = timelib_get_nr_ex((char **) &amp;ptr, 2, &amp;length);</span>
<span class="lineNum">    2029 </span><span class="lineNoCov">              0 :                                         if (min == TIMELIB_UNSET || length != 2) {</span>
<span class="lineNum">    2030 </span><span class="lineNoCov">              0 :                                                 add_pbf_error(s, &quot;A two digit minute could not be found&quot;, string, begin);</span>
<span class="lineNum">    2031 </span>                :                                         } else {
<span class="lineNum">    2032 </span><span class="lineNoCov">              0 :                                                 s-&gt;time-&gt;i = min;</span>
<span class="lineNum">    2033 </span>                :                                         }
<span class="lineNum">    2034 </span>                :                                 }
<span class="lineNum">    2035 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    2036 </span>                :                         case 's': /* two digit second, with leading zero */
<span class="lineNum">    2037 </span>                :                                 {
<span class="lineNum">    2038 </span>                :                                         int length;
<span class="lineNum">    2039 </span>                :                                         timelib_sll sec;
<span class="lineNum">    2040 </span>                : 
<span class="lineNum">    2041 </span><span class="lineNoCov">              0 :                                         TIMELIB_CHECK_NUMBER;</span>
<span class="lineNum">    2042 </span><span class="lineNoCov">              0 :                                         sec = timelib_get_nr_ex((char **) &amp;ptr, 2, &amp;length);</span>
<span class="lineNum">    2043 </span><span class="lineNoCov">              0 :                                         if (sec == TIMELIB_UNSET || length != 2) {</span>
<span class="lineNum">    2044 </span><span class="lineNoCov">              0 :                                                 add_pbf_error(s, &quot;A two second minute could not be found&quot;, string, begin);</span>
<span class="lineNum">    2045 </span>                :                                         } else {
<span class="lineNum">    2046 </span><span class="lineNoCov">              0 :                                                 s-&gt;time-&gt;s = sec;</span>
<span class="lineNum">    2047 </span>                :                                         }
<span class="lineNum">    2048 </span>                :                                 }
<span class="lineNum">    2049 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    2050 </span>                :                         case 'u': /* up to six digit millisecond */
<span class="lineNum">    2051 </span>                :                                 {
<span class="lineNum">    2052 </span>                :                                         double f;
<span class="lineNum">    2053 </span>                :                                         char *tptr;
<span class="lineNum">    2054 </span>                : 
<span class="lineNum">    2055 </span><span class="lineNoCov">              0 :                                         TIMELIB_CHECK_NUMBER;</span>
<span class="lineNum">    2056 </span><span class="lineNoCov">              0 :                                         tptr = ptr;</span>
<span class="lineNum">    2057 </span><span class="lineNoCov">              0 :                                         if ((f = timelib_get_nr((char **) &amp;ptr, 6)) == TIMELIB_UNSET || (ptr - tptr &lt; 1)) {</span>
<span class="lineNum">    2058 </span><span class="lineNoCov">              0 :                                                 add_pbf_error(s, &quot;A six digit millisecond could not be found&quot;, string, begin);</span>
<span class="lineNum">    2059 </span>                :                                         } else {
<span class="lineNum">    2060 </span><span class="lineNoCov">              0 :                                                 s-&gt;time-&gt;f = (f / pow(10, (ptr - tptr)));</span>
<span class="lineNum">    2061 </span>                :                                         }
<span class="lineNum">    2062 </span>                :                                 }
<span class="lineNum">    2063 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    2064 </span>                :                         case ' ': /* any sort of whitespace (' ' and \t) */
<span class="lineNum">    2065 </span><span class="lineNoCov">              0 :                                 timelib_eat_spaces((char **) &amp;ptr);</span>
<span class="lineNum">    2066 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    2067 </span>                :                         case 'U': /* epoch seconds */
<span class="lineNum">    2068 </span><span class="lineNoCov">              0 :                                 TIMELIB_CHECK_NUMBER;</span>
<span class="lineNum">    2069 </span><span class="lineNoCov">              0 :                                 TIMELIB_HAVE_RELATIVE();</span>
<span class="lineNum">    2070 </span><span class="lineNoCov">              0 :                                 tmp = timelib_get_unsigned_nr((char **) &amp;ptr, 24);</span>
<span class="lineNum">    2071 </span><span class="lineNoCov">              0 :                                 s-&gt;time-&gt;y = 1970;</span>
<span class="lineNum">    2072 </span><span class="lineNoCov">              0 :                                 s-&gt;time-&gt;m = 1;</span>
<span class="lineNum">    2073 </span><span class="lineNoCov">              0 :                                 s-&gt;time-&gt;d = 1;</span>
<span class="lineNum">    2074 </span><span class="lineNoCov">              0 :                                 s-&gt;time-&gt;h = s-&gt;time-&gt;i = s-&gt;time-&gt;s = 0;</span>
<span class="lineNum">    2075 </span><span class="lineNoCov">              0 :                                 s-&gt;time-&gt;f = 0.0;</span>
<span class="lineNum">    2076 </span><span class="lineNoCov">              0 :                                 s-&gt;time-&gt;relative.s += tmp;</span>
<span class="lineNum">    2077 </span><span class="lineNoCov">              0 :                                 s-&gt;time-&gt;is_localtime = 1;</span>
<span class="lineNum">    2078 </span><span class="lineNoCov">              0 :                                 s-&gt;time-&gt;zone_type = TIMELIB_ZONETYPE_OFFSET;</span>
<span class="lineNum">    2079 </span><span class="lineNoCov">              0 :                                 s-&gt;time-&gt;z = 0;</span>
<span class="lineNum">    2080 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    2081 </span>                : 
<span class="lineNum">    2082 </span>                :                         case 'e': /* timezone */
<span class="lineNum">    2083 </span>                :                         case 'P': /* timezone */
<span class="lineNum">    2084 </span>                :                         case 'T': /* timezone */
<span class="lineNum">    2085 </span>                :                         case 'O': /* timezone */
<span class="lineNum">    2086 </span>                :                                 {
<span class="lineNum">    2087 </span>                :                                         int tz_not_found;
<span class="lineNum">    2088 </span><span class="lineNoCov">              0 :                                         s-&gt;time-&gt;z = timelib_get_zone((char **) &amp;ptr, &amp;s-&gt;time-&gt;dst, s-&gt;time, &amp;tz_not_found, s-&gt;tzdb, tz_get_wrapper);</span>
<span class="lineNum">    2089 </span><span class="lineNoCov">              0 :                                         if (tz_not_found) {</span>
<span class="lineNum">    2090 </span><span class="lineNoCov">              0 :                                                 add_pbf_error(s, &quot;The timezone could not be found in the database&quot;, string, begin);</span>
<span class="lineNum">    2091 </span>                :                                         }
<span class="lineNum">    2092 </span>                :                                 }
<span class="lineNum">    2093 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    2094 </span>                : 
<span class="lineNum">    2095 </span>                :                         case '#': /* separation symbol */
<span class="lineNum">    2096 </span><span class="lineNoCov">              0 :                                 if (*ptr == ';' || *ptr == ':' || *ptr == '/' || *ptr == '.' || *ptr == ',' || *ptr == '-' || *ptr == '(' || *ptr == ')') {</span>
<span class="lineNum">    2097 </span><span class="lineNoCov">              0 :                                         ++ptr;</span>
<span class="lineNum">    2098 </span>                :                                 } else {
<span class="lineNum">    2099 </span><span class="lineNoCov">              0 :                                         add_pbf_error(s, &quot;The separation symbol ([;:/.,-]) could not be found&quot;, string, begin);</span>
<span class="lineNum">    2100 </span>                :                                 }
<span class="lineNum">    2101 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    2102 </span>                : 
<span class="lineNum">    2103 </span>                :                         case ';':
<span class="lineNum">    2104 </span>                :                         case ':':
<span class="lineNum">    2105 </span>                :                         case '/':
<span class="lineNum">    2106 </span>                :                         case '.':
<span class="lineNum">    2107 </span>                :                         case ',':
<span class="lineNum">    2108 </span>                :                         case '-':
<span class="lineNum">    2109 </span>                :                         case '(':
<span class="lineNum">    2110 </span>                :                         case ')':
<span class="lineNum">    2111 </span><span class="lineNoCov">              0 :                                 if (*ptr == *fptr) {</span>
<span class="lineNum">    2112 </span><span class="lineNoCov">              0 :                                         ++ptr;</span>
<span class="lineNum">    2113 </span>                :                                 } else {
<span class="lineNum">    2114 </span><span class="lineNoCov">              0 :                                         add_pbf_error(s, &quot;The separation symbol could not be found&quot;, string, begin);</span>
<span class="lineNum">    2115 </span>                :                                 }
<span class="lineNum">    2116 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    2117 </span>                : 
<span class="lineNum">    2118 </span>                :                         case '!': /* reset all fields to default */
<span class="lineNum">    2119 </span><span class="lineNoCov">              0 :                                 timelib_time_reset_fields(s-&gt;time);</span>
<span class="lineNum">    2120 </span><span class="lineNoCov">              0 :                                 break; /* break intentionally not missing */</span>
<span class="lineNum">    2121 </span>                : 
<span class="lineNum">    2122 </span>                :                         case '|': /* reset all fields to default when not set */
<span class="lineNum">    2123 </span><span class="lineNoCov">              0 :                                 timelib_time_reset_unset_fields(s-&gt;time);</span>
<span class="lineNum">    2124 </span><span class="lineNoCov">              0 :                                 break; /* break intentionally not missing */</span>
<span class="lineNum">    2125 </span>                : 
<span class="lineNum">    2126 </span>                :                         case '?': /* random char */
<span class="lineNum">    2127 </span><span class="lineNoCov">              0 :                                 ++ptr;</span>
<span class="lineNum">    2128 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    2129 </span>                : 
<span class="lineNum">    2130 </span>                :                         case '\\': /* escaped char */
<span class="lineNum">    2131 </span><span class="lineNoCov">              0 :                                 *fptr++;</span>
<span class="lineNum">    2132 </span><span class="lineNoCov">              0 :                                 if (*ptr == *fptr) {</span>
<span class="lineNum">    2133 </span><span class="lineNoCov">              0 :                                         ++ptr;</span>
<span class="lineNum">    2134 </span>                :                                 } else {
<span class="lineNum">    2135 </span><span class="lineNoCov">              0 :                                         add_pbf_error(s, &quot;The escaped character could not be found&quot;, string, begin);</span>
<span class="lineNum">    2136 </span>                :                                 }
<span class="lineNum">    2137 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    2138 </span>                : 
<span class="lineNum">    2139 </span>                :                         case '*': /* random chars until a separator or number ([ \t.,:;/-0123456789]) */
<span class="lineNum">    2140 </span><span class="lineNoCov">              0 :                                 timelib_eat_until_separator((char **) &amp;ptr);</span>
<span class="lineNum">    2141 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    2142 </span>                : 
<span class="lineNum">    2143 </span>                :                         case '+': /* allow extra chars in the format */
<span class="lineNum">    2144 </span><span class="lineNoCov">              0 :                                 allow_extra = 1;</span>
<span class="lineNum">    2145 </span><span class="lineNoCov">              0 :                                 break;</span>
<span class="lineNum">    2146 </span>                : 
<span class="lineNum">    2147 </span>                :                         default:
<span class="lineNum">    2148 </span><span class="lineNoCov">              0 :                                 if (*fptr != *ptr) {</span>
<span class="lineNum">    2149 </span><span class="lineNoCov">              0 :                                         add_pbf_error(s, &quot;The format separator does not match&quot;, string, begin);</span>
<span class="lineNum">    2150 </span>                :                                 }
<span class="lineNum">    2151 </span><span class="lineNoCov">              0 :                                 ptr++;</span>
<span class="lineNum">    2152 </span>                :                 }
<span class="lineNum">    2153 </span><span class="lineNoCov">              0 :                 fptr++;</span>
<span class="lineNum">    2154 </span>                :         }
<span class="lineNum">    2155 </span><span class="lineNoCov">              0 :         if (*ptr) {</span>
<span class="lineNum">    2156 </span><span class="lineNoCov">              0 :                 if (allow_extra) {</span>
<span class="lineNum">    2157 </span><span class="lineNoCov">              0 :                         add_pbf_warning(s, &quot;Trailing data&quot;, string, ptr);</span>
<span class="lineNum">    2158 </span>                :                 } else {
<span class="lineNum">    2159 </span><span class="lineNoCov">              0 :                         add_pbf_error(s, &quot;Trailing data&quot;, string, ptr);</span>
<span class="lineNum">    2160 </span>                :                 }
<span class="lineNum">    2161 </span>                :         }
<span class="lineNum">    2162 </span>                :         /* ignore trailing +'s */
<span class="lineNum">    2163 </span><span class="lineNoCov">              0 :         while (*fptr == '+') {</span>
<span class="lineNum">    2164 </span><span class="lineNoCov">              0 :                 fptr++;</span>
<span class="lineNum">    2165 </span>                :         }
<span class="lineNum">    2166 </span><span class="lineNoCov">              0 :         if (*fptr) {</span>
<span class="lineNum">    2167 </span>                :                 /* Trailing | and ! specifiers are valid. */
<span class="lineNum">    2168 </span><span class="lineNoCov">              0 :                 int done = 0;</span>
<span class="lineNum">    2169 </span><span class="lineNoCov">              0 :                 while (*fptr &amp;&amp; !done) {</span>
<span class="lineNum">    2170 </span><span class="lineNoCov">              0 :                         switch (*fptr++) {</span>
<span class="lineNum">    2171 </span>                :                                 case '!': /* reset all fields to default */
<span class="lineNum">    2172 </span><span class="lineNoCov">              0 :                                         timelib_time_reset_fields(s-&gt;time);</span>
<span class="lineNum">    2173 </span><span class="lineNoCov">              0 :                                         break;</span>
<span class="lineNum">    2174 </span>                : 
<span class="lineNum">    2175 </span>                :                                 case '|': /* reset all fields to default when not set */
<span class="lineNum">    2176 </span><span class="lineNoCov">              0 :                                         timelib_time_reset_unset_fields(s-&gt;time);</span>
<span class="lineNum">    2177 </span><span class="lineNoCov">              0 :                                         break;</span>
<span class="lineNum">    2178 </span>                : 
<span class="lineNum">    2179 </span>                :                                 default:
<span class="lineNum">    2180 </span><span class="lineNoCov">              0 :                                         add_pbf_error(s, &quot;Data missing&quot;, string, ptr);</span>
<span class="lineNum">    2181 </span><span class="lineNoCov">              0 :                                         done = 1;</span>
<span class="lineNum">    2182 </span>                :                         }
<span class="lineNum">    2183 </span>                :                 }
<span class="lineNum">    2184 </span>                :         }
<span class="lineNum">    2185 </span>                : 
<span class="lineNum">    2186 </span>                :         /* clean up a bit */
<span class="lineNum">    2187 </span><span class="lineNoCov">              0 :         if (s-&gt;time-&gt;h != TIMELIB_UNSET || s-&gt;time-&gt;i != TIMELIB_UNSET || s-&gt;time-&gt;s != TIMELIB_UNSET) {</span>
<span class="lineNum">    2188 </span><span class="lineNoCov">              0 :                 if (s-&gt;time-&gt;h == TIMELIB_UNSET ) {</span>
<span class="lineNum">    2189 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;h = 0;</span>
<span class="lineNum">    2190 </span>                :                 }
<span class="lineNum">    2191 </span><span class="lineNoCov">              0 :                 if (s-&gt;time-&gt;i == TIMELIB_UNSET ) {</span>
<span class="lineNum">    2192 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;i = 0;</span>
<span class="lineNum">    2193 </span>                :                 }
<span class="lineNum">    2194 </span><span class="lineNoCov">              0 :                 if (s-&gt;time-&gt;s == TIMELIB_UNSET ) {</span>
<span class="lineNum">    2195 </span><span class="lineNoCov">              0 :                         s-&gt;time-&gt;s = 0;</span>
<span class="lineNum">    2196 </span>                :                 }
<span class="lineNum">    2197 </span>                :         }
<span class="lineNum">    2198 </span>                : 
<span class="lineNum">    2199 </span>                :         /* do funky checking whether the parsed time was valid time */
<span class="lineNum">    2200 </span><span class="lineNoCov">              0 :         if (s-&gt;time-&gt;h != TIMELIB_UNSET &amp;&amp; s-&gt;time-&gt;i != TIMELIB_UNSET &amp;&amp;</span>
<span class="lineNum">    2201 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;s != TIMELIB_UNSET &amp;&amp; </span>
<span class="lineNum">    2202 </span><span class="lineNoCov">              0 :                 !timelib_valid_time( s-&gt;time-&gt;h, s-&gt;time-&gt;i, s-&gt;time-&gt;s)) {</span>
<span class="lineNum">    2203 </span><span class="lineNoCov">              0 :                 add_pbf_warning(s, &quot;The parsed time was invalid&quot;, string, ptr);</span>
<span class="lineNum">    2204 </span>                :         }
<span class="lineNum">    2205 </span>                :         /* do funky checking whether the parsed date was valid date */
<span class="lineNum">    2206 </span><span class="lineNoCov">              0 :         if (s-&gt;time-&gt;y != TIMELIB_UNSET &amp;&amp; s-&gt;time-&gt;m != TIMELIB_UNSET &amp;&amp;</span>
<span class="lineNum">    2207 </span><span class="lineNoCov">              0 :                 s-&gt;time-&gt;d != TIMELIB_UNSET &amp;&amp; </span>
<span class="lineNum">    2208 </span><span class="lineNoCov">              0 :                 !timelib_valid_date( s-&gt;time-&gt;y, s-&gt;time-&gt;m, s-&gt;time-&gt;d)) {</span>
<span class="lineNum">    2209 </span><span class="lineNoCov">              0 :                 add_pbf_warning(s, &quot;The parsed date was invalid&quot;, string, ptr);</span>
<span class="lineNum">    2210 </span>                :         }
<span class="lineNum">    2211 </span>                : 
<span class="lineNum">    2212 </span><span class="lineNoCov">              0 :         if (errors) {</span>
<span class="lineNum">    2213 </span><span class="lineNoCov">              0 :                 *errors = in.errors;</span>
<span class="lineNum">    2214 </span>                :         } else {
<span class="lineNum">    2215 </span><span class="lineNoCov">              0 :                 timelib_error_container_dtor(in.errors);</span>
<span class="lineNum">    2216 </span>                :         }
<span class="lineNum">    2217 </span><span class="lineNoCov">              0 :         return in.time;</span>
<a name="2218"><span class="lineNum">    2218 </span>                : }</a>
<span class="lineNum">    2219 </span>                : 
<span class="lineNum">    2220 </span><span class="lineNoCov">              0 : void timelib_fill_holes(timelib_time *parsed, timelib_time *now, int options)</span>
<span class="lineNum">    2221 </span>                : {
<span class="lineNum">    2222 </span><span class="lineNoCov">              0 :         if (!(options &amp; TIMELIB_OVERRIDE_TIME) &amp;&amp; parsed-&gt;have_date &amp;&amp; !parsed-&gt;have_time) {</span>
<span class="lineNum">    2223 </span><span class="lineNoCov">              0 :                 parsed-&gt;h = 0;</span>
<span class="lineNum">    2224 </span><span class="lineNoCov">              0 :                 parsed-&gt;i = 0;</span>
<span class="lineNum">    2225 </span><span class="lineNoCov">              0 :                 parsed-&gt;s = 0;</span>
<span class="lineNum">    2226 </span><span class="lineNoCov">              0 :                 parsed-&gt;f = 0;</span>
<span class="lineNum">    2227 </span>                :         }
<span class="lineNum">    2228 </span><span class="lineNoCov">              0 :         if (parsed-&gt;y == TIMELIB_UNSET) parsed-&gt;y = now-&gt;y != TIMELIB_UNSET ? now-&gt;y : 0;</span>
<span class="lineNum">    2229 </span><span class="lineNoCov">              0 :         if (parsed-&gt;d == TIMELIB_UNSET) parsed-&gt;d = now-&gt;d != TIMELIB_UNSET ? now-&gt;d : 0;</span>
<span class="lineNum">    2230 </span><span class="lineNoCov">              0 :         if (parsed-&gt;m == TIMELIB_UNSET) parsed-&gt;m = now-&gt;m != TIMELIB_UNSET ? now-&gt;m : 0;</span>
<span class="lineNum">    2231 </span><span class="lineNoCov">              0 :         if (parsed-&gt;h == TIMELIB_UNSET) parsed-&gt;h = now-&gt;h != TIMELIB_UNSET ? now-&gt;h : 0;</span>
<span class="lineNum">    2232 </span><span class="lineNoCov">              0 :         if (parsed-&gt;i == TIMELIB_UNSET) parsed-&gt;i = now-&gt;i != TIMELIB_UNSET ? now-&gt;i : 0;</span>
<span class="lineNum">    2233 </span><span class="lineNoCov">              0 :         if (parsed-&gt;s == TIMELIB_UNSET) parsed-&gt;s = now-&gt;s != TIMELIB_UNSET ? now-&gt;s : 0;</span>
<span class="lineNum">    2234 </span><span class="lineNoCov">              0 :         if (parsed-&gt;f == TIMELIB_UNSET) parsed-&gt;f = now-&gt;f != TIMELIB_UNSET ? now-&gt;f : 0;</span>
<span class="lineNum">    2235 </span><span class="lineNoCov">              0 :         if (parsed-&gt;z == TIMELIB_UNSET) parsed-&gt;z = now-&gt;z != TIMELIB_UNSET ? now-&gt;z : 0;</span>
<span class="lineNum">    2236 </span><span class="lineNoCov">              0 :         if (parsed-&gt;dst == TIMELIB_UNSET) parsed-&gt;dst = now-&gt;dst != TIMELIB_UNSET ? now-&gt;dst : 0;</span>
<span class="lineNum">    2237 </span>                : 
<span class="lineNum">    2238 </span><span class="lineNoCov">              0 :         if (!parsed-&gt;tz_abbr) {</span>
<span class="lineNum">    2239 </span><span class="lineNoCov">              0 :                 parsed-&gt;tz_abbr = now-&gt;tz_abbr ? strdup(now-&gt;tz_abbr) : NULL;</span>
<span class="lineNum">    2240 </span>                :         }
<span class="lineNum">    2241 </span><span class="lineNoCov">              0 :         if (!parsed-&gt;tz_info) {</span>
<span class="lineNum">    2242 </span><span class="lineNoCov">              0 :                 parsed-&gt;tz_info = now-&gt;tz_info ? (!(options &amp; TIMELIB_NO_CLONE) ? timelib_tzinfo_clone(now-&gt;tz_info) : now-&gt;tz_info) : NULL;</span>
<span class="lineNum">    2243 </span>                :         }
<span class="lineNum">    2244 </span><span class="lineNoCov">              0 :         if (parsed-&gt;zone_type == 0 &amp;&amp; now-&gt;zone_type != 0) {</span>
<span class="lineNum">    2245 </span><span class="lineNoCov">              0 :                 parsed-&gt;zone_type = now-&gt;zone_type;</span>
<span class="lineNum">    2246 </span>                : /*              parsed-&gt;tz_abbr = now-&gt;tz_abbr ? strdup(now-&gt;tz_abbr) : NULL;
<span class="lineNum">    2247 </span>                :                 parsed-&gt;tz_info = now-&gt;tz_info ? timelib_tzinfo_clone(now-&gt;tz_info) : NULL;
<span class="lineNum">    2248 </span><span class="lineNoCov">              0 : */              parsed-&gt;is_localtime = 1;</span>
<span class="lineNum">    2249 </span>                :         }
<span class="lineNum">    2250 </span>                : /*      timelib_dump_date(parsed, 2);
<span class="lineNum">    2251 </span>                :         timelib_dump_date(now, 2);
<span class="lineNum">    2252 </span>                : */
<a name="2253"><span class="lineNum">    2253 </span><span class="lineNoCov">              0 : }</span></a>
<span class="lineNum">    2254 </span>                : 
<span class="lineNum">    2255 </span><span class="lineNoCov">              0 : char *timelib_timezone_id_from_abbr(const char *abbr, long gmtoffset, int isdst)</span>
<span class="lineNum">    2256 </span>                : {
<span class="lineNum">    2257 </span>                :         const timelib_tz_lookup_table *tp;
<span class="lineNum">    2258 </span>                : 
<span class="lineNum">    2259 </span><span class="lineNoCov">              0 :         tp = zone_search(abbr, gmtoffset, isdst);</span>
<span class="lineNum">    2260 </span><span class="lineNoCov">              0 :         if (tp) {</span>
<span class="lineNum">    2261 </span><span class="lineNoCov">              0 :                 return (tp-&gt;full_tz_name);</span>
<span class="lineNum">    2262 </span>                :         } else {
<span class="lineNum">    2263 </span><span class="lineNoCov">              0 :                 return NULL;</span>
<span class="lineNum">    2264 </span>                :         }
<a name="2265"><span class="lineNum">    2265 </span>                : }</a>
<span class="lineNum">    2266 </span>                : 
<span class="lineNum">    2267 </span><span class="lineNoCov">              0 : const timelib_tz_lookup_table *timelib_timezone_abbreviations_list(void)</span>
<span class="lineNum">    2268 </span>                : {
<span class="lineNum">    2269 </span><span class="lineNoCov">              0 :         return timelib_timezone_lookup;</span>
<span class="lineNum">    2270 </span>                : }
<span class="lineNum">    2271 </span>                : 
<span class="lineNum">    2272 </span>                : #ifdef DEBUG_PARSER_STUB
<span class="lineNum">    2273 </span>                : int main(void)
<span class="lineNum">    2274 </span>                : {
<span class="lineNum">    2275 </span>                :         timelib_time time = timelib_strtotime(&quot;May 12&quot;);
<span class="lineNum">    2276 </span>                : 
<span class="lineNum">    2277 </span>                :         printf (&quot;%04d-%02d-%02d %02d:%02d:%02d.%-5d %+04d %1d&quot;,
<span class="lineNum">    2278 </span>                :                 time.y, time.m, time.d, time.h, time.i, time.s, time.f, time.z, time.dst);
<span class="lineNum">    2279 </span>                :         if (time.have_relative) {
<span class="lineNum">    2280 </span>                :                 printf (&quot;%3dY %3dM %3dD / %3dH %3dM %3dS&quot;, 
<span class="lineNum">    2281 </span>                :                         time.relative.y, time.relative.m, time.relative.d, time.relative.h, time.relative.i, time.relative.s);
<span class="lineNum">    2282 </span>                :         }
<span class="lineNum">    2283 </span>                :         if (time.have_weekday_relative) {
<span class="lineNum">    2284 </span>                :                 printf (&quot; / %d&quot;, time.relative.weekday);
<span class="lineNum">    2285 </span>                :         }
<span class="lineNum">    2286 </span>                :         if (time.have_weeknr_day) {
<span class="lineNum">    2287 </span>                :                 printf(&quot; / %dW%d&quot;, time.relative.weeknr_day.weeknr, time.relative.weeknr_day.dayofweek);
<span class="lineNum">    2288 </span>                :         }
<span class="lineNum">    2289 </span>                :         return 0;                               
<span class="lineNum">    2290 </span>                : }
<span class="lineNum">    2291 </span>                : #endif
<span class="lineNum">    2292 </span>                : 
<span class="lineNum">    2293 </span>                : /*
<span class="lineNum">    2294 </span>                :  * vim: syntax=c
<span class="lineNum">    2295 </span>                :  */
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
  <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
  <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.7</a></td></tr>
  </table>
  <br>

</body>
</html>
