<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <title>LCOV - PHP Code Coverage - Zend/zend_hash.c</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
        <tr>
          <td width="5%"></td>
          <td width="10%" class="headerItem">Current view:</td>
          <td width="35%" class="headerValue"><a href="../index.html">directory</a> - <a href="index.html">Zend</a> - zend_hash.c (source / <a href="zend_hash.c.func.html">functions</a>)</td>
          <td width="10%"></td>
          <td width="10%" class="headerCovTableHead">Found</td>
          <td width="10%" class="headerCovTableHead">Hit</td>
          <td width="15%" class="headerCovTableHead">Coverage</td>
          <td width="5%"></td>
        </tr>
        <tr>
          <td></td>
          <td class="headerItem">Test:</td>
          <td class="headerValue">PHP Code Coverage</td>
          <td class="headerItem">Lines:</td>
          <td class="headerCovTableEntry">745</td>
          <td class="headerCovTableEntry">472</td>
          <td class="headerCovTableEntryHi">63.4 %</td>
        </tr>
        <tr>
          <td></td>
          <td class="headerItem">Date:</td>
          <td class="headerValue">2012-06-19</td>
          <td class="headerItem">Functions:</td>
          <td class="headerCovTableEntry">46</td>
          <td class="headerCovTableEntry">36</td>
          <td class="headerCovTableEntryMed">78.3 %</td>
        </tr>
        <tr>
          <td></td>
          <td class="headerItem">Colors:</td>
          <td class="headerValueLeg" colspan=5>
            <span class="coverLegendNoCov">not hit</span>
            <span class="coverLegendCov">hit</span>
          </td>
        </tr>
                <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td><pre class="source">
<a name="1"><span class="lineNum">       1 </span>                : /*</a>
<span class="lineNum">       2 </span>                :    +----------------------------------------------------------------------+
<span class="lineNum">       3 </span>                :    | Zend Engine                                                          |
<span class="lineNum">       4 </span>                :    +----------------------------------------------------------------------+
<span class="lineNum">       5 </span>                :    | Copyright (c) 1998-2012 Zend Technologies Ltd. (http://www.zend.com) |
<span class="lineNum">       6 </span>                :    +----------------------------------------------------------------------+
<span class="lineNum">       7 </span>                :    | This source file is subject to version 2.00 of the Zend license,     |
<span class="lineNum">       8 </span>                :    | that is bundled with this package in the file LICENSE, and is        | 
<span class="lineNum">       9 </span>                :    | available through the world-wide-web at the following url:           |
<span class="lineNum">      10 </span>                :    | http://www.zend.com/license/2_00.txt.                                |
<span class="lineNum">      11 </span>                :    | If you did not receive a copy of the Zend license and are unable to  |
<span class="lineNum">      12 </span>                :    | obtain it through the world-wide-web, please send a note to          |
<span class="lineNum">      13 </span>                :    | license@zend.com so we can mail you a copy immediately.              |
<span class="lineNum">      14 </span>                :    +----------------------------------------------------------------------+
<span class="lineNum">      15 </span>                :    | Authors: Andi Gutmans &lt;andi@zend.com&gt;                                |
<span class="lineNum">      16 </span>                :    |          Zeev Suraski &lt;zeev@zend.com&gt;                                |
<span class="lineNum">      17 </span>                :    +----------------------------------------------------------------------+
<span class="lineNum">      18 </span>                : */
<span class="lineNum">      19 </span>                : 
<span class="lineNum">      20 </span>                : /* $Id$ */
<span class="lineNum">      21 </span>                : 
<span class="lineNum">      22 </span>                : #include &quot;zend.h&quot;
<span class="lineNum">      23 </span>                : #include &quot;zend_globals.h&quot;
<span class="lineNum">      24 </span>                : 
<span class="lineNum">      25 </span>                : #define CONNECT_TO_BUCKET_DLLIST(element, list_head)            \
<span class="lineNum">      26 </span>                :         (element)-&gt;pNext = (list_head);                                                      \
<span class="lineNum">      27 </span>                :         (element)-&gt;pLast = NULL;                                                             \
<span class="lineNum">      28 </span>                :         if ((element)-&gt;pNext) {                                                                      \
<span class="lineNum">      29 </span>                :                 (element)-&gt;pNext-&gt;pLast = (element);                              \
<span class="lineNum">      30 </span>                :         }
<span class="lineNum">      31 </span>                : 
<span class="lineNum">      32 </span>                : #define CONNECT_TO_GLOBAL_DLLIST(element, ht)                           \
<span class="lineNum">      33 </span>                :         (element)-&gt;pListLast = (ht)-&gt;pListTail;                                   \
<span class="lineNum">      34 </span>                :         (ht)-&gt;pListTail = (element);                                                 \
<span class="lineNum">      35 </span>                :         (element)-&gt;pListNext = NULL;                                                 \
<span class="lineNum">      36 </span>                :         if ((element)-&gt;pListLast != NULL) {                                          \
<span class="lineNum">      37 </span>                :                 (element)-&gt;pListLast-&gt;pListNext = (element);              \
<span class="lineNum">      38 </span>                :         }                                                                                                               \
<span class="lineNum">      39 </span>                :         if (!(ht)-&gt;pListHead) {                                                                      \
<span class="lineNum">      40 </span>                :                 (ht)-&gt;pListHead = (element);                                         \
<span class="lineNum">      41 </span>                :         }                                                                                                               \
<span class="lineNum">      42 </span>                :         if ((ht)-&gt;pInternalPointer == NULL) {                                        \
<span class="lineNum">      43 </span>                :                 (ht)-&gt;pInternalPointer = (element);                                  \
<span class="lineNum">      44 </span>                :         }
<span class="lineNum">      45 </span>                : 
<span class="lineNum">      46 </span>                : #if ZEND_DEBUG
<span class="lineNum">      47 </span>                : #define HT_OK                           0
<span class="lineNum">      48 </span>                : #define HT_IS_DESTROYING        1
<span class="lineNum">      49 </span>                : #define HT_DESTROYED            2
<span class="lineNum">      50 </span>                : #define HT_CLEANING                     3
<span class="lineNum">      51 </span>                : 
<span class="lineNum">      52 </span>                : static void _zend_is_inconsistent(const HashTable *ht, const char *file, int line)
<span class="lineNum">      53 </span>                : {
<span class="lineNum">      54 </span>                :         if (ht-&gt;inconsistent==HT_OK) {
<span class="lineNum">      55 </span>                :                 return;
<span class="lineNum">      56 </span>                :         }
<span class="lineNum">      57 </span>                :         switch (ht-&gt;inconsistent) {
<span class="lineNum">      58 </span>                :                 case HT_IS_DESTROYING:
<span class="lineNum">      59 </span>                :                         zend_output_debug_string(1, &quot;%s(%d) : ht=%p is being destroyed&quot;, file, line, ht);
<span class="lineNum">      60 </span>                :                         break;
<span class="lineNum">      61 </span>                :                 case HT_DESTROYED:
<span class="lineNum">      62 </span>                :                         zend_output_debug_string(1, &quot;%s(%d) : ht=%p is already destroyed&quot;, file, line, ht);
<span class="lineNum">      63 </span>                :                         break;
<span class="lineNum">      64 </span>                :                 case HT_CLEANING:
<span class="lineNum">      65 </span>                :                         zend_output_debug_string(1, &quot;%s(%d) : ht=%p is being cleaned&quot;, file, line, ht);
<span class="lineNum">      66 </span>                :                         break;
<span class="lineNum">      67 </span>                :                 default:
<span class="lineNum">      68 </span>                :                         zend_output_debug_string(1, &quot;%s(%d) : ht=%p is inconsistent&quot;, file, line, ht);
<span class="lineNum">      69 </span>                :                         break;
<span class="lineNum">      70 </span>                :         }
<span class="lineNum">      71 </span>                :         zend_bailout();
<span class="lineNum">      72 </span>                : }
<span class="lineNum">      73 </span>                : #define IS_CONSISTENT(a) _zend_is_inconsistent(a, __FILE__, __LINE__);
<span class="lineNum">      74 </span>                : #define SET_INCONSISTENT(n) ht-&gt;inconsistent = n;
<span class="lineNum">      75 </span>                : #else
<span class="lineNum">      76 </span>                : #define IS_CONSISTENT(a)
<span class="lineNum">      77 </span>                : #define SET_INCONSISTENT(n)
<span class="lineNum">      78 </span>                : #endif
<span class="lineNum">      79 </span>                : 
<span class="lineNum">      80 </span>                : #define HASH_PROTECT_RECURSION(ht)                                                                                                              \
<span class="lineNum">      81 </span>                :         if ((ht)-&gt;bApplyProtection) {                                                                                                                \
<span class="lineNum">      82 </span>                :                 if ((ht)-&gt;nApplyCount++ &gt;= 3) {                                                                                                   \
<span class="lineNum">      83 </span>                :                         zend_error(E_ERROR, &quot;Nesting level too deep - recursive dependency?&quot;);                \
<span class="lineNum">      84 </span>                :                 }                                                                                                                                                               \
<span class="lineNum">      85 </span>                :         }
<span class="lineNum">      86 </span>                : 
<span class="lineNum">      87 </span>                : 
<span class="lineNum">      88 </span>                : #define HASH_UNPROTECT_RECURSION(ht)                                                                                                    \
<span class="lineNum">      89 </span>                :         if ((ht)-&gt;bApplyProtection) {                                                                                                                \
<span class="lineNum">      90 </span>                :                 (ht)-&gt;nApplyCount--;                                                                                                                 \
<span class="lineNum">      91 </span>                :         }
<span class="lineNum">      92 </span>                : 
<span class="lineNum">      93 </span>                : 
<span class="lineNum">      94 </span>                : #define ZEND_HASH_IF_FULL_DO_RESIZE(ht)                         \
<span class="lineNum">      95 </span>                :         if ((ht)-&gt;nNumOfElements &gt; (ht)-&gt;nTableSize) { \
<span class="lineNum">      96 </span>                :                 zend_hash_do_resize(ht);                                        \
<span class="lineNum">      97 </span>                :         }
<span class="lineNum">      98 </span>                : 
<a name="99"><span class="lineNum">      99 </span>                : static int zend_hash_do_resize(HashTable *ht);</a>
<span class="lineNum">     100 </span>                : 
<span class="lineNum">     101 </span><span class="lineCov">          30683 : ZEND_API ulong zend_hash_func(const char *arKey, uint nKeyLength)</span>
<span class="lineNum">     102 </span>                : {
<span class="lineNum">     103 </span><span class="lineCov">          30683 :         return zend_inline_hash_func(arKey, nKeyLength);</span>
<span class="lineNum">     104 </span>                : }
<span class="lineNum">     105 </span>                : 
<span class="lineNum">     106 </span>                : 
<span class="lineNum">     107 </span>                : #define UPDATE_DATA(ht, p, pData, nDataSize)                                                                                    \
<span class="lineNum">     108 </span>                :         if (nDataSize == sizeof(void*)) {                                                                                                       \
<span class="lineNum">     109 </span>                :                 if ((p)-&gt;pData != &amp;(p)-&gt;pDataPtr) {                                                                                           \
<span class="lineNum">     110 </span>                :                         pefree_rel((p)-&gt;pData, (ht)-&gt;persistent);                                                                 \
<span class="lineNum">     111 </span>                :                 }                                                                                                                                                               \
<span class="lineNum">     112 </span>                :                 memcpy(&amp;(p)-&gt;pDataPtr, pData, sizeof(void *));                                                                   \
<span class="lineNum">     113 </span>                :                 (p)-&gt;pData = &amp;(p)-&gt;pDataPtr;                                                                                                  \
<span class="lineNum">     114 </span>                :         } else {                                                                                                                                                        \
<span class="lineNum">     115 </span>                :                 if ((p)-&gt;pData == &amp;(p)-&gt;pDataPtr) {                                                                                           \
<span class="lineNum">     116 </span>                :                         (p)-&gt;pData = (void *) pemalloc_rel(nDataSize, (ht)-&gt;persistent);                  \
<span class="lineNum">     117 </span>                :                         (p)-&gt;pDataPtr=NULL;                                                                                                                  \
<span class="lineNum">     118 </span>                :                 } else {                                                                                                                                                \
<span class="lineNum">     119 </span>                :                         (p)-&gt;pData = (void *) perealloc_rel((p)-&gt;pData, nDataSize, (ht)-&gt;persistent);  \
<span class="lineNum">     120 </span>                :                         /* (p)-&gt;pDataPtr is already NULL so no need to initialize it */                              \
<span class="lineNum">     121 </span>                :                 }                                                                                                                                                               \
<span class="lineNum">     122 </span>                :                 memcpy((p)-&gt;pData, pData, nDataSize);                                                                                        \
<span class="lineNum">     123 </span>                :         }
<span class="lineNum">     124 </span>                : 
<span class="lineNum">     125 </span>                : #define INIT_DATA(ht, p, pData, nDataSize);                                                             \
<span class="lineNum">     126 </span>                :         if (nDataSize == sizeof(void*)) {                                                                       \
<span class="lineNum">     127 </span>                :                 memcpy(&amp;(p)-&gt;pDataPtr, pData, sizeof(void *));                                   \
<span class="lineNum">     128 </span>                :                 (p)-&gt;pData = &amp;(p)-&gt;pDataPtr;                                                                  \
<span class="lineNum">     129 </span>                :         } else {                                                                                                                        \
<span class="lineNum">     130 </span>                :                 (p)-&gt;pData = (void *) pemalloc_rel(nDataSize, (ht)-&gt;persistent);\
<span class="lineNum">     131 </span>                :                 if (!(p)-&gt;pData) {                                                                                           \
<span class="lineNum">     132 </span>                :                         pefree_rel(p, (ht)-&gt;persistent);                                                     \
<span class="lineNum">     133 </span>                :                         return FAILURE;                                                                                         \
<span class="lineNum">     134 </span>                :                 }                                                                                                                               \
<span class="lineNum">     135 </span>                :                 memcpy((p)-&gt;pData, pData, nDataSize);                                                        \
<span class="lineNum">     136 </span>                :                 (p)-&gt;pDataPtr=NULL;                                                                                          \
<span class="lineNum">     137 </span>                :         }
<span class="lineNum">     138 </span>                : 
<span class="lineNum">     139 </span>                : #define CHECK_INIT(ht) do {                                                                                             \
<span class="lineNum">     140 </span>                :         if (UNEXPECTED((ht)-&gt;nTableMask == 0)) {                                                             \
<span class="lineNum">     141 </span>                :                 (ht)-&gt;arBuckets = (Bucket **) pecalloc((ht)-&gt;nTableSize, sizeof(Bucket *), (ht)-&gt;persistent);  \
<span class="lineNum">     142 </span>                :                 (ht)-&gt;nTableMask = (ht)-&gt;nTableSize - 1;                                          \
<span class="lineNum">     143 </span>                :         }                                                                                                                                       \
<span class="lineNum">     144 </span>                : } while (0)
<span class="lineNum">     145 </span>                :  
<a name="146"><span class="lineNum">     146 </span>                : static const Bucket *uninitialized_bucket = NULL;</a>
<span class="lineNum">     147 </span>                : 
<span class="lineNum">     148 </span><span class="lineCov">          30822 : ZEND_API int _zend_hash_init(HashTable *ht, uint nSize, hash_func_t pHashFunction, dtor_func_t pDestructor, zend_bool persistent ZEND_FILE_LINE_DC)</span>
<span class="lineNum">     149 </span>                : {
<span class="lineNum">     150 </span><span class="lineCov">          30822 :         uint i = 3;</span>
<span class="lineNum">     151 </span>                : 
<span class="lineNum">     152 </span>                :         SET_INCONSISTENT(HT_OK);
<span class="lineNum">     153 </span>                : 
<span class="lineNum">     154 </span><span class="lineCov">          30822 :         if (nSize &gt;= 0x80000000) {</span>
<span class="lineNum">     155 </span>                :                 /* prevent overflow */
<span class="lineNum">     156 </span><span class="lineNoCov">              0 :                 ht-&gt;nTableSize = 0x80000000;</span>
<span class="lineNum">     157 </span>                :         } else {
<span class="lineNum">     158 </span><span class="lineCov">          63009 :                 while ((1U &lt;&lt; i) &lt; nSize) {</span>
<span class="lineNum">     159 </span><span class="lineCov">           1365 :                         i++;</span>
<span class="lineNum">     160 </span>                :                 }
<span class="lineNum">     161 </span><span class="lineCov">          30822 :                 ht-&gt;nTableSize = 1 &lt;&lt; i;</span>
<span class="lineNum">     162 </span>                :         }
<span class="lineNum">     163 </span>                : 
<span class="lineNum">     164 </span><span class="lineCov">          30822 :         ht-&gt;nTableMask = 0;  /* 0 means that ht-&gt;arBuckets is uninitialized */</span>
<span class="lineNum">     165 </span><span class="lineCov">          30822 :         ht-&gt;pDestructor = pDestructor;</span>
<span class="lineNum">     166 </span><span class="lineCov">          30822 :         ht-&gt;arBuckets = (Bucket**)&amp;uninitialized_bucket;</span>
<span class="lineNum">     167 </span><span class="lineCov">          30822 :         ht-&gt;pListHead = NULL;</span>
<span class="lineNum">     168 </span><span class="lineCov">          30822 :         ht-&gt;pListTail = NULL;</span>
<span class="lineNum">     169 </span><span class="lineCov">          30822 :         ht-&gt;nNumOfElements = 0;</span>
<span class="lineNum">     170 </span><span class="lineCov">          30822 :         ht-&gt;nNextFreeElement = 0;</span>
<span class="lineNum">     171 </span><span class="lineCov">          30822 :         ht-&gt;pInternalPointer = NULL;</span>
<span class="lineNum">     172 </span><span class="lineCov">          30822 :         ht-&gt;persistent = persistent;</span>
<span class="lineNum">     173 </span><span class="lineCov">          30822 :         ht-&gt;nApplyCount = 0;</span>
<span class="lineNum">     174 </span><span class="lineCov">          30822 :         ht-&gt;bApplyProtection = 1;</span>
<span class="lineNum">     175 </span><span class="lineCov">          30822 :         return SUCCESS;</span>
<span class="lineNum">     176 </span>                : }
<a name="177"><span class="lineNum">     177 </span>                : </a>
<span class="lineNum">     178 </span>                : 
<span class="lineNum">     179 </span><span class="lineCov">          16086 : ZEND_API int _zend_hash_init_ex(HashTable *ht, uint nSize, hash_func_t pHashFunction, dtor_func_t pDestructor, zend_bool persistent, zend_bool bApplyProtection ZEND_FILE_LINE_DC)</span>
<span class="lineNum">     180 </span>                : {
<span class="lineNum">     181 </span><span class="lineCov">          16086 :         int retval = _zend_hash_init(ht, nSize, pHashFunction, pDestructor, persistent ZEND_FILE_LINE_CC);</span>
<span class="lineNum">     182 </span>                : 
<span class="lineNum">     183 </span><span class="lineCov">          16086 :         ht-&gt;bApplyProtection = bApplyProtection;</span>
<span class="lineNum">     184 </span><span class="lineCov">          16086 :         return retval;</span>
<span class="lineNum">     185 </span>                : }
<a name="186"><span class="lineNum">     186 </span>                : </a>
<span class="lineNum">     187 </span>                : 
<span class="lineNum">     188 </span><span class="lineNoCov">              0 : ZEND_API void zend_hash_set_apply_protection(HashTable *ht, zend_bool bApplyProtection)</span>
<span class="lineNum">     189 </span>                : {
<span class="lineNum">     190 </span><span class="lineNoCov">              0 :         ht-&gt;bApplyProtection = bApplyProtection;</span>
<span class="lineNum">     191 </span><span class="lineNoCov">              0 : }</span>
<span class="lineNum">     192 </span>                : 
<a name="193"><span class="lineNum">     193 </span>                : </a>
<span class="lineNum">     194 </span>                : 
<span class="lineNum">     195 </span><span class="lineCov">          25825 : ZEND_API int _zend_hash_add_or_update(HashTable *ht, const char *arKey, uint nKeyLength, void *pData, uint nDataSize, void **pDest, int flag ZEND_FILE_LINE_DC)</span>
<span class="lineNum">     196 </span>                : {
<span class="lineNum">     197 </span>                :         ulong h;
<span class="lineNum">     198 </span>                :         uint nIndex;
<span class="lineNum">     199 </span>                :         Bucket *p;
<span class="lineNum">     200 </span>                : #ifdef ZEND_SIGNALS
<span class="lineNum">     201 </span>                :         TSRMLS_FETCH();
<span class="lineNum">     202 </span>                : #endif
<span class="lineNum">     203 </span>                : 
<span class="lineNum">     204 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">     205 </span>                : 
<span class="lineNum">     206 </span><span class="lineCov">          25825 :         if (nKeyLength &lt;= 0) {</span>
<span class="lineNum">     207 </span>                : #if ZEND_DEBUG
<span class="lineNum">     208 </span>                :                 ZEND_PUTS(&quot;zend_hash_update: Can't put in empty key\n&quot;);
<span class="lineNum">     209 </span>                : #endif
<span class="lineNum">     210 </span><span class="lineNoCov">              0 :                 return FAILURE;</span>
<span class="lineNum">     211 </span>                :         }
<span class="lineNum">     212 </span>                : 
<span class="lineNum">     213 </span><span class="lineCov">          25825 :         CHECK_INIT(ht);</span>
<span class="lineNum">     214 </span>                : 
<span class="lineNum">     215 </span><span class="lineCov">          25825 :         h = zend_inline_hash_func(arKey, nKeyLength);</span>
<span class="lineNum">     216 </span><span class="lineCov">          25825 :         nIndex = h &amp; ht-&gt;nTableMask;</span>
<span class="lineNum">     217 </span>                : 
<span class="lineNum">     218 </span><span class="lineCov">          25825 :         p = ht-&gt;arBuckets[nIndex];</span>
<span class="lineNum">     219 </span><span class="lineCov">          58676 :         while (p != NULL) {</span>
<span class="lineNum">     220 </span><span class="lineCov">          19192 :                 if (p-&gt;arKey == arKey ||</span>
<span class="lineNum">     221 </span><span class="lineCov">          10881 :                         ((p-&gt;h == h) &amp;&amp; (p-&gt;nKeyLength == nKeyLength) &amp;&amp; !memcmp(p-&gt;arKey, arKey, nKeyLength))) {</span>
<span class="lineNum">     222 </span><span class="lineCov">           1285 :                                 if (flag &amp; HASH_ADD) {</span>
<span class="lineNum">     223 </span><span class="lineCov">             45 :                                         return FAILURE;</span>
<span class="lineNum">     224 </span>                :                                 }
<span class="lineNum">     225 </span><span class="lineCov">           1240 :                                 HANDLE_BLOCK_INTERRUPTIONS();</span>
<span class="lineNum">     226 </span>                : #if ZEND_DEBUG
<span class="lineNum">     227 </span>                :                                 if (p-&gt;pData == pData) {
<span class="lineNum">     228 </span>                :                                         ZEND_PUTS(&quot;Fatal error in zend_hash_update: p-&gt;pData == pData\n&quot;);
<span class="lineNum">     229 </span>                :                                         HANDLE_UNBLOCK_INTERRUPTIONS();
<span class="lineNum">     230 </span>                :                                         return FAILURE;
<span class="lineNum">     231 </span>                :                                 }
<span class="lineNum">     232 </span>                : #endif
<span class="lineNum">     233 </span><span class="lineCov">           1240 :                                 if (ht-&gt;pDestructor) {</span>
<span class="lineNum">     234 </span><span class="lineCov">           1240 :                                         ht-&gt;pDestructor(p-&gt;pData);</span>
<span class="lineNum">     235 </span>                :                                 }
<span class="lineNum">     236 </span><span class="lineCov">           1240 :                                 UPDATE_DATA(ht, p, pData, nDataSize);</span>
<span class="lineNum">     237 </span><span class="lineCov">           1240 :                                 if (pDest) {</span>
<span class="lineNum">     238 </span><span class="lineCov">           1224 :                                         *pDest = p-&gt;pData;</span>
<span class="lineNum">     239 </span>                :                                 }
<span class="lineNum">     240 </span><span class="lineCov">           1240 :                                 HANDLE_UNBLOCK_INTERRUPTIONS();</span>
<span class="lineNum">     241 </span><span class="lineCov">           1240 :                                 return SUCCESS;</span>
<span class="lineNum">     242 </span>                :                 }
<span class="lineNum">     243 </span><span class="lineCov">           7026 :                 p = p-&gt;pNext;</span>
<span class="lineNum">     244 </span>                :         }
<span class="lineNum">     245 </span>                :         
<span class="lineNum">     246 </span><span class="lineCov">          24793 :         if (IS_INTERNED(arKey)) {</span>
<span class="lineNum">     247 </span><span class="lineCov">            253 :                 p = (Bucket *) pemalloc(sizeof(Bucket), ht-&gt;persistent);</span>
<span class="lineNum">     248 </span><span class="lineCov">            253 :                 if (!p) {</span>
<span class="lineNum">     249 </span><span class="lineNoCov">              0 :                         return FAILURE;</span>
<span class="lineNum">     250 </span>                :                 }
<span class="lineNum">     251 </span><span class="lineCov">            253 :                 p-&gt;arKey = arKey;</span>
<span class="lineNum">     252 </span>                :         } else {
<span class="lineNum">     253 </span><span class="lineCov">          24287 :                 p = (Bucket *) pemalloc(sizeof(Bucket) + nKeyLength, ht-&gt;persistent);</span>
<span class="lineNum">     254 </span><span class="lineCov">          24287 :                 if (!p) {</span>
<span class="lineNum">     255 </span><span class="lineNoCov">              0 :                         return FAILURE;</span>
<span class="lineNum">     256 </span>                :                 }
<span class="lineNum">     257 </span><span class="lineCov">          24287 :                 p-&gt;arKey = (const char*)(p + 1);</span>
<span class="lineNum">     258 </span><span class="lineCov">          24287 :                 memcpy((char*)p-&gt;arKey, arKey, nKeyLength);</span>
<span class="lineNum">     259 </span>                :         }
<span class="lineNum">     260 </span><span class="lineCov">          24540 :         p-&gt;nKeyLength = nKeyLength;</span>
<span class="lineNum">     261 </span><span class="lineCov">          24540 :         INIT_DATA(ht, p, pData, nDataSize);</span>
<span class="lineNum">     262 </span><span class="lineCov">          24540 :         p-&gt;h = h;</span>
<span class="lineNum">     263 </span><span class="lineCov">          24540 :         CONNECT_TO_BUCKET_DLLIST(p, ht-&gt;arBuckets[nIndex]);</span>
<span class="lineNum">     264 </span><span class="lineCov">          24540 :         if (pDest) {</span>
<span class="lineNum">     265 </span><span class="lineCov">           8824 :                 *pDest = p-&gt;pData;</span>
<span class="lineNum">     266 </span>                :         }
<span class="lineNum">     267 </span>                : 
<span class="lineNum">     268 </span><span class="lineCov">          24540 :         HANDLE_BLOCK_INTERRUPTIONS();</span>
<span class="lineNum">     269 </span><span class="lineCov">          24540 :         CONNECT_TO_GLOBAL_DLLIST(p, ht);</span>
<span class="lineNum">     270 </span><span class="lineCov">          24540 :         ht-&gt;arBuckets[nIndex] = p;</span>
<span class="lineNum">     271 </span><span class="lineCov">          24540 :         HANDLE_UNBLOCK_INTERRUPTIONS();</span>
<span class="lineNum">     272 </span>                : 
<span class="lineNum">     273 </span><span class="lineCov">          24540 :         ht-&gt;nNumOfElements++;</span>
<span class="lineNum">     274 </span><span class="lineCov">          24540 :         ZEND_HASH_IF_FULL_DO_RESIZE(ht);                /* If the Hash table is full, resize it */</span>
<span class="lineNum">     275 </span><span class="lineCov">          24540 :         return SUCCESS;</span>
<a name="276"><span class="lineNum">     276 </span>                : }</a>
<span class="lineNum">     277 </span>                : 
<span class="lineNum">     278 </span><span class="lineCov">         157199 : ZEND_API int _zend_hash_quick_add_or_update(HashTable *ht, const char *arKey, uint nKeyLength, ulong h, void *pData, uint nDataSize, void **pDest, int flag ZEND_FILE_LINE_DC)</span>
<span class="lineNum">     279 </span>                : {
<span class="lineNum">     280 </span>                :         uint nIndex;
<span class="lineNum">     281 </span>                :         Bucket *p;
<span class="lineNum">     282 </span>                : #ifdef ZEND_SIGNALS
<span class="lineNum">     283 </span>                :         TSRMLS_FETCH();
<span class="lineNum">     284 </span>                : #endif
<span class="lineNum">     285 </span>                : 
<span class="lineNum">     286 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">     287 </span>                : 
<span class="lineNum">     288 </span><span class="lineCov">         157199 :         if (nKeyLength == 0) {</span>
<span class="lineNum">     289 </span><span class="lineNoCov">              0 :                 return zend_hash_index_update(ht, h, pData, nDataSize, pDest);</span>
<span class="lineNum">     290 </span>                :         }
<span class="lineNum">     291 </span>                : 
<span class="lineNum">     292 </span><span class="lineCov">         157199 :         CHECK_INIT(ht);</span>
<span class="lineNum">     293 </span><span class="lineCov">         157199 :         nIndex = h &amp; ht-&gt;nTableMask;</span>
<span class="lineNum">     294 </span>                :         
<span class="lineNum">     295 </span><span class="lineCov">         157199 :         p = ht-&gt;arBuckets[nIndex];</span>
<span class="lineNum">     296 </span><span class="lineCov">         405248 :         while (p != NULL) {</span>
<span class="lineNum">     297 </span><span class="lineCov">         181729 :                 if (p-&gt;arKey == arKey ||</span>
<span class="lineNum">     298 </span><span class="lineCov">          90850 :                         ((p-&gt;h == h) &amp;&amp; (p-&gt;nKeyLength == nKeyLength) &amp;&amp; !memcmp(p-&gt;arKey, arKey, nKeyLength))) {</span>
<span class="lineNum">     299 </span><span class="lineCov">             29 :                                 if (flag &amp; HASH_ADD) {</span>
<span class="lineNum">     300 </span><span class="lineCov">             23 :                                         return FAILURE;</span>
<span class="lineNum">     301 </span>                :                                 }
<span class="lineNum">     302 </span><span class="lineCov">              6 :                                 HANDLE_BLOCK_INTERRUPTIONS();</span>
<span class="lineNum">     303 </span>                : #if ZEND_DEBUG
<span class="lineNum">     304 </span>                :                                 if (p-&gt;pData == pData) {
<span class="lineNum">     305 </span>                :                                         ZEND_PUTS(&quot;Fatal error in zend_hash_update: p-&gt;pData == pData\n&quot;);
<span class="lineNum">     306 </span>                :                                         HANDLE_UNBLOCK_INTERRUPTIONS();
<span class="lineNum">     307 </span>                :                                         return FAILURE;
<span class="lineNum">     308 </span>                :                                 }
<span class="lineNum">     309 </span>                : #endif
<span class="lineNum">     310 </span><span class="lineCov">              6 :                                 if (ht-&gt;pDestructor) {</span>
<span class="lineNum">     311 </span><span class="lineCov">              6 :                                         ht-&gt;pDestructor(p-&gt;pData);</span>
<span class="lineNum">     312 </span>                :                                 }
<span class="lineNum">     313 </span><span class="lineCov">              6 :                                 UPDATE_DATA(ht, p, pData, nDataSize);</span>
<span class="lineNum">     314 </span><span class="lineCov">              6 :                                 if (pDest) {</span>
<span class="lineNum">     315 </span><span class="lineCov">              6 :                                         *pDest = p-&gt;pData;</span>
<span class="lineNum">     316 </span>                :                                 }
<span class="lineNum">     317 </span><span class="lineCov">              6 :                                 HANDLE_UNBLOCK_INTERRUPTIONS();</span>
<span class="lineNum">     318 </span><span class="lineCov">              6 :                                 return SUCCESS;</span>
<span class="lineNum">     319 </span>                :                 }
<span class="lineNum">     320 </span><span class="lineCov">          90850 :                 p = p-&gt;pNext;</span>
<span class="lineNum">     321 </span>                :         }
<span class="lineNum">     322 </span>                :         
<span class="lineNum">     323 </span><span class="lineCov">         270976 :         if (IS_INTERNED(arKey)) {</span>
<span class="lineNum">     324 </span><span class="lineCov">         113806 :                 p = (Bucket *) pemalloc(sizeof(Bucket), ht-&gt;persistent);</span>
<span class="lineNum">     325 </span><span class="lineCov">         113806 :                 if (!p) {</span>
<span class="lineNum">     326 </span><span class="lineNoCov">              0 :                         return FAILURE;</span>
<span class="lineNum">     327 </span>                :                 }
<span class="lineNum">     328 </span><span class="lineCov">         113806 :                 p-&gt;arKey = arKey;</span>
<span class="lineNum">     329 </span>                :         } else {
<span class="lineNum">     330 </span><span class="lineCov">          43364 :                 p = (Bucket *) pemalloc(sizeof(Bucket) + nKeyLength, ht-&gt;persistent);</span>
<span class="lineNum">     331 </span><span class="lineCov">          43364 :                 if (!p) {</span>
<span class="lineNum">     332 </span><span class="lineNoCov">              0 :                         return FAILURE;</span>
<span class="lineNum">     333 </span>                :                 }
<span class="lineNum">     334 </span><span class="lineCov">          43364 :                 p-&gt;arKey = (const char*)(p + 1);</span>
<span class="lineNum">     335 </span><span class="lineCov">          43364 :                 memcpy((char*)p-&gt;arKey, arKey, nKeyLength);</span>
<span class="lineNum">     336 </span>                :         }
<span class="lineNum">     337 </span>                : 
<span class="lineNum">     338 </span><span class="lineCov">         157170 :         p-&gt;nKeyLength = nKeyLength;</span>
<span class="lineNum">     339 </span><span class="lineCov">         157170 :         INIT_DATA(ht, p, pData, nDataSize);</span>
<span class="lineNum">     340 </span><span class="lineCov">         157170 :         p-&gt;h = h;</span>
<span class="lineNum">     341 </span>                :         
<span class="lineNum">     342 </span><span class="lineCov">         157170 :         CONNECT_TO_BUCKET_DLLIST(p, ht-&gt;arBuckets[nIndex]);</span>
<span class="lineNum">     343 </span>                : 
<span class="lineNum">     344 </span><span class="lineCov">         157170 :         if (pDest) {</span>
<span class="lineNum">     345 </span><span class="lineCov">         127241 :                 *pDest = p-&gt;pData;</span>
<span class="lineNum">     346 </span>                :         }
<span class="lineNum">     347 </span>                : 
<span class="lineNum">     348 </span><span class="lineCov">         157170 :         HANDLE_BLOCK_INTERRUPTIONS();</span>
<span class="lineNum">     349 </span><span class="lineCov">         157170 :         ht-&gt;arBuckets[nIndex] = p;</span>
<span class="lineNum">     350 </span><span class="lineCov">         157170 :         CONNECT_TO_GLOBAL_DLLIST(p, ht);</span>
<span class="lineNum">     351 </span><span class="lineCov">         157170 :         HANDLE_UNBLOCK_INTERRUPTIONS();</span>
<span class="lineNum">     352 </span>                : 
<span class="lineNum">     353 </span><span class="lineCov">         157170 :         ht-&gt;nNumOfElements++;</span>
<span class="lineNum">     354 </span><span class="lineCov">         157170 :         ZEND_HASH_IF_FULL_DO_RESIZE(ht);                /* If the Hash table is full, resize it */</span>
<span class="lineNum">     355 </span><span class="lineCov">         157170 :         return SUCCESS;</span>
<span class="lineNum">     356 </span>                : }
<a name="357"><span class="lineNum">     357 </span>                : </a>
<span class="lineNum">     358 </span>                : 
<span class="lineNum">     359 </span><span class="lineNoCov">              0 : ZEND_API int zend_hash_add_empty_element(HashTable *ht, const char *arKey, uint nKeyLength)</span>
<span class="lineNum">     360 </span>                : {
<span class="lineNum">     361 </span><span class="lineNoCov">              0 :         void *dummy = (void *) 1;</span>
<span class="lineNum">     362 </span>                : 
<span class="lineNum">     363 </span><span class="lineNoCov">              0 :         return zend_hash_add(ht, arKey, nKeyLength, &amp;dummy, sizeof(void *), NULL);</span>
<span class="lineNum">     364 </span>                : }
<a name="365"><span class="lineNum">     365 </span>                : </a>
<span class="lineNum">     366 </span>                : 
<span class="lineNum">     367 </span><span class="lineCov">           9704 : ZEND_API int _zend_hash_index_update_or_next_insert(HashTable *ht, ulong h, void *pData, uint nDataSize, void **pDest, int flag ZEND_FILE_LINE_DC)</span>
<span class="lineNum">     368 </span>                : {
<span class="lineNum">     369 </span>                :         uint nIndex;
<span class="lineNum">     370 </span>                :         Bucket *p;
<span class="lineNum">     371 </span>                : #ifdef ZEND_SIGNALS
<span class="lineNum">     372 </span>                :         TSRMLS_FETCH();
<span class="lineNum">     373 </span>                : #endif
<span class="lineNum">     374 </span>                : 
<span class="lineNum">     375 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">     376 </span><span class="lineCov">           9704 :         CHECK_INIT(ht);</span>
<span class="lineNum">     377 </span>                : 
<span class="lineNum">     378 </span><span class="lineCov">           9704 :         if (flag &amp; HASH_NEXT_INSERT) {</span>
<span class="lineNum">     379 </span><span class="lineCov">           5721 :                 h = ht-&gt;nNextFreeElement;</span>
<span class="lineNum">     380 </span>                :         }
<span class="lineNum">     381 </span><span class="lineCov">           9704 :         nIndex = h &amp; ht-&gt;nTableMask;</span>
<span class="lineNum">     382 </span>                : 
<span class="lineNum">     383 </span><span class="lineCov">           9704 :         p = ht-&gt;arBuckets[nIndex];</span>
<span class="lineNum">     384 </span><span class="lineCov">          19616 :         while (p != NULL) {</span>
<span class="lineNum">     385 </span><span class="lineCov">            208 :                 if ((p-&gt;nKeyLength == 0) &amp;&amp; (p-&gt;h == h)) {</span>
<span class="lineNum">     386 </span><span class="lineNoCov">              0 :                         if (flag &amp; HASH_NEXT_INSERT || flag &amp; HASH_ADD) {</span>
<span class="lineNum">     387 </span><span class="lineNoCov">              0 :                                 return FAILURE;</span>
<span class="lineNum">     388 </span>                :                         }
<span class="lineNum">     389 </span><span class="lineNoCov">              0 :                         HANDLE_BLOCK_INTERRUPTIONS();</span>
<span class="lineNum">     390 </span>                : #if ZEND_DEBUG
<span class="lineNum">     391 </span>                :                         if (p-&gt;pData == pData) {
<span class="lineNum">     392 </span>                :                                 ZEND_PUTS(&quot;Fatal error in zend_hash_index_update: p-&gt;pData == pData\n&quot;);
<span class="lineNum">     393 </span>                :                                 HANDLE_UNBLOCK_INTERRUPTIONS();
<span class="lineNum">     394 </span>                :                                 return FAILURE;
<span class="lineNum">     395 </span>                :                         }
<span class="lineNum">     396 </span>                : #endif
<span class="lineNum">     397 </span><span class="lineNoCov">              0 :                         if (ht-&gt;pDestructor) {</span>
<span class="lineNum">     398 </span><span class="lineNoCov">              0 :                                 ht-&gt;pDestructor(p-&gt;pData);</span>
<span class="lineNum">     399 </span>                :                         }
<span class="lineNum">     400 </span><span class="lineNoCov">              0 :                         UPDATE_DATA(ht, p, pData, nDataSize);</span>
<span class="lineNum">     401 </span><span class="lineNoCov">              0 :                         HANDLE_UNBLOCK_INTERRUPTIONS();</span>
<span class="lineNum">     402 </span><span class="lineNoCov">              0 :                         if ((long)h &gt;= (long)ht-&gt;nNextFreeElement) {</span>
<span class="lineNum">     403 </span><span class="lineNoCov">              0 :                                 ht-&gt;nNextFreeElement = h &lt; LONG_MAX ? h + 1 : LONG_MAX;</span>
<span class="lineNum">     404 </span>                :                         }
<span class="lineNum">     405 </span><span class="lineNoCov">              0 :                         if (pDest) {</span>
<span class="lineNum">     406 </span><span class="lineNoCov">              0 :                                 *pDest = p-&gt;pData;</span>
<span class="lineNum">     407 </span>                :                         }
<span class="lineNum">     408 </span><span class="lineNoCov">              0 :                         return SUCCESS;</span>
<span class="lineNum">     409 </span>                :                 }
<span class="lineNum">     410 </span><span class="lineCov">            208 :                 p = p-&gt;pNext;</span>
<span class="lineNum">     411 </span>                :         }
<span class="lineNum">     412 </span><span class="lineCov">           9704 :         p = (Bucket *) pemalloc_rel(sizeof(Bucket), ht-&gt;persistent);</span>
<span class="lineNum">     413 </span><span class="lineCov">           9704 :         if (!p) {</span>
<span class="lineNum">     414 </span><span class="lineNoCov">              0 :                 return FAILURE;</span>
<span class="lineNum">     415 </span>                :         }
<span class="lineNum">     416 </span><span class="lineCov">           9704 :         p-&gt;arKey = NULL;</span>
<span class="lineNum">     417 </span><span class="lineCov">           9704 :         p-&gt;nKeyLength = 0; /* Numeric indices are marked by making the nKeyLength == 0 */</span>
<span class="lineNum">     418 </span><span class="lineCov">           9704 :         p-&gt;h = h;</span>
<span class="lineNum">     419 </span><span class="lineCov">           9704 :         INIT_DATA(ht, p, pData, nDataSize);</span>
<span class="lineNum">     420 </span><span class="lineCov">           9704 :         if (pDest) {</span>
<span class="lineNum">     421 </span><span class="lineCov">           3276 :                 *pDest = p-&gt;pData;</span>
<span class="lineNum">     422 </span>                :         }
<span class="lineNum">     423 </span>                : 
<span class="lineNum">     424 </span><span class="lineCov">           9704 :         CONNECT_TO_BUCKET_DLLIST(p, ht-&gt;arBuckets[nIndex]);</span>
<span class="lineNum">     425 </span>                : 
<span class="lineNum">     426 </span><span class="lineCov">           9704 :         HANDLE_BLOCK_INTERRUPTIONS();</span>
<span class="lineNum">     427 </span><span class="lineCov">           9704 :         ht-&gt;arBuckets[nIndex] = p;</span>
<span class="lineNum">     428 </span><span class="lineCov">           9704 :         CONNECT_TO_GLOBAL_DLLIST(p, ht);</span>
<span class="lineNum">     429 </span><span class="lineCov">           9704 :         HANDLE_UNBLOCK_INTERRUPTIONS();</span>
<span class="lineNum">     430 </span>                : 
<span class="lineNum">     431 </span><span class="lineCov">           9704 :         if ((long)h &gt;= (long)ht-&gt;nNextFreeElement) {</span>
<span class="lineNum">     432 </span><span class="lineCov">           9697 :                 ht-&gt;nNextFreeElement = h &lt; LONG_MAX ? h + 1 : LONG_MAX;</span>
<span class="lineNum">     433 </span>                :         }
<span class="lineNum">     434 </span><span class="lineCov">           9704 :         ht-&gt;nNumOfElements++;</span>
<span class="lineNum">     435 </span><span class="lineCov">           9704 :         ZEND_HASH_IF_FULL_DO_RESIZE(ht);</span>
<span class="lineNum">     436 </span><span class="lineCov">           9704 :         return SUCCESS;</span>
<span class="lineNum">     437 </span>                : }
<a name="438"><span class="lineNum">     438 </span>                : </a>
<span class="lineNum">     439 </span>                : 
<span class="lineNum">     440 </span><span class="lineCov">           6711 : static int zend_hash_do_resize(HashTable *ht)</span>
<span class="lineNum">     441 </span>                : {
<span class="lineNum">     442 </span>                :         Bucket **t;
<span class="lineNum">     443 </span>                : #ifdef ZEND_SIGNALS
<span class="lineNum">     444 </span>                :         TSRMLS_FETCH();
<span class="lineNum">     445 </span>                : #endif
<span class="lineNum">     446 </span>                : 
<span class="lineNum">     447 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">     448 </span>                : 
<span class="lineNum">     449 </span><span class="lineCov">           6711 :         if ((ht-&gt;nTableSize &lt;&lt; 1) &gt; 0) {    /* Let's double the table size */</span>
<span class="lineNum">     450 </span><span class="lineCov">           6711 :                 t = (Bucket **) perealloc_recoverable(ht-&gt;arBuckets, (ht-&gt;nTableSize &lt;&lt; 1) * sizeof(Bucket *), ht-&gt;persistent);</span>
<span class="lineNum">     451 </span><span class="lineCov">           6711 :                 if (t) {</span>
<span class="lineNum">     452 </span><span class="lineCov">           6711 :                         HANDLE_BLOCK_INTERRUPTIONS();</span>
<span class="lineNum">     453 </span><span class="lineCov">           6711 :                         ht-&gt;arBuckets = t;</span>
<span class="lineNum">     454 </span><span class="lineCov">           6711 :                         ht-&gt;nTableSize = (ht-&gt;nTableSize &lt;&lt; 1);</span>
<span class="lineNum">     455 </span><span class="lineCov">           6711 :                         ht-&gt;nTableMask = ht-&gt;nTableSize - 1;</span>
<span class="lineNum">     456 </span><span class="lineCov">           6711 :                         zend_hash_rehash(ht);</span>
<span class="lineNum">     457 </span><span class="lineCov">           6711 :                         HANDLE_UNBLOCK_INTERRUPTIONS();</span>
<span class="lineNum">     458 </span><span class="lineCov">           6711 :                         return SUCCESS;</span>
<span class="lineNum">     459 </span>                :                 }
<span class="lineNum">     460 </span><span class="lineNoCov">              0 :                 return FAILURE;</span>
<span class="lineNum">     461 </span>                :         }
<span class="lineNum">     462 </span><span class="lineNoCov">              0 :         return SUCCESS;</span>
<a name="463"><span class="lineNum">     463 </span>                : }</a>
<span class="lineNum">     464 </span>                : 
<span class="lineNum">     465 </span><span class="lineCov">           7097 : ZEND_API int zend_hash_rehash(HashTable *ht)</span>
<span class="lineNum">     466 </span>                : {
<span class="lineNum">     467 </span>                :         Bucket *p;
<span class="lineNum">     468 </span>                :         uint nIndex;
<span class="lineNum">     469 </span>                : 
<span class="lineNum">     470 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">     471 </span><span class="lineCov">           7097 :         if (UNEXPECTED(ht-&gt;nNumOfElements == 0)) {</span>
<span class="lineNum">     472 </span><span class="lineNoCov">              0 :                 return SUCCESS;</span>
<span class="lineNum">     473 </span>                :         }
<span class="lineNum">     474 </span>                : 
<span class="lineNum">     475 </span><span class="lineCov">           7097 :         memset(ht-&gt;arBuckets, 0, ht-&gt;nTableSize * sizeof(Bucket *));</span>
<span class="lineNum">     476 </span><span class="lineCov">           7097 :         p = ht-&gt;pListHead;</span>
<span class="lineNum">     477 </span><span class="lineCov">         270388 :         while (p != NULL) {</span>
<span class="lineNum">     478 </span><span class="lineCov">         256194 :                 nIndex = p-&gt;h &amp; ht-&gt;nTableMask;</span>
<span class="lineNum">     479 </span><span class="lineCov">         256194 :                 CONNECT_TO_BUCKET_DLLIST(p, ht-&gt;arBuckets[nIndex]);</span>
<span class="lineNum">     480 </span><span class="lineCov">         256194 :                 ht-&gt;arBuckets[nIndex] = p;</span>
<span class="lineNum">     481 </span><span class="lineCov">         256194 :                 p = p-&gt;pListNext;</span>
<span class="lineNum">     482 </span>                :         }
<span class="lineNum">     483 </span><span class="lineCov">           7097 :         return SUCCESS;</span>
<a name="484"><span class="lineNum">     484 </span>                : }</a>
<span class="lineNum">     485 </span>                : 
<span class="lineNum">     486 </span><span class="lineCov">          32737 : ZEND_API int zend_hash_del_key_or_index(HashTable *ht, const char *arKey, uint nKeyLength, ulong h, int flag)</span>
<span class="lineNum">     487 </span>                : {
<span class="lineNum">     488 </span>                :         uint nIndex;
<span class="lineNum">     489 </span>                :         Bucket *p;
<span class="lineNum">     490 </span>                : #ifdef ZEND_SIGNALS
<span class="lineNum">     491 </span>                :         TSRMLS_FETCH();
<span class="lineNum">     492 </span>                : #endif
<span class="lineNum">     493 </span>                : 
<span class="lineNum">     494 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">     495 </span>                : 
<span class="lineNum">     496 </span><span class="lineCov">          32737 :         if (flag == HASH_DEL_KEY) {</span>
<span class="lineNum">     497 </span><span class="lineCov">          31973 :                 h = zend_inline_hash_func(arKey, nKeyLength);</span>
<span class="lineNum">     498 </span>                :         }
<span class="lineNum">     499 </span><span class="lineCov">          32737 :         nIndex = h &amp; ht-&gt;nTableMask;</span>
<span class="lineNum">     500 </span>                : 
<span class="lineNum">     501 </span><span class="lineCov">          32737 :         p = ht-&gt;arBuckets[nIndex];</span>
<span class="lineNum">     502 </span><span class="lineCov">          71908 :         while (p != NULL) {</span>
<span class="lineNum">     503 </span><span class="lineCov">         136740 :                 if ((p-&gt;h == h) </span>
<span class="lineNum">     504 </span><span class="lineCov">          32732 :                          &amp;&amp; (p-&gt;nKeyLength == nKeyLength)</span>
<span class="lineNum">     505 </span><span class="lineCov">          32732 :                          &amp;&amp; ((p-&gt;nKeyLength == 0) /* Numeric index (short circuits the memcmp() check) */</span>
<span class="lineNum">     506 </span><span class="lineCov">          32110 :                                  || !memcmp(p-&gt;arKey, arKey, nKeyLength))) { /* String index */</span>
<span class="lineNum">     507 </span><span class="lineCov">          32732 :                         HANDLE_BLOCK_INTERRUPTIONS();</span>
<span class="lineNum">     508 </span><span class="lineCov">          32732 :                         if (p == ht-&gt;arBuckets[nIndex]) {</span>
<span class="lineNum">     509 </span><span class="lineCov">          27164 :                                 ht-&gt;arBuckets[nIndex] = p-&gt;pNext;</span>
<span class="lineNum">     510 </span>                :                         } else {
<span class="lineNum">     511 </span><span class="lineCov">           5568 :                                 p-&gt;pLast-&gt;pNext = p-&gt;pNext;</span>
<span class="lineNum">     512 </span>                :                         }
<span class="lineNum">     513 </span><span class="lineCov">          32732 :                         if (p-&gt;pNext) {</span>
<span class="lineNum">     514 </span><span class="lineCov">           3289 :                                 p-&gt;pNext-&gt;pLast = p-&gt;pLast;</span>
<span class="lineNum">     515 </span>                :                         }
<span class="lineNum">     516 </span><span class="lineCov">          32732 :                         if (p-&gt;pListLast != NULL) {</span>
<span class="lineNum">     517 </span><span class="lineCov">          29660 :                                 p-&gt;pListLast-&gt;pListNext = p-&gt;pListNext;</span>
<span class="lineNum">     518 </span>                :                         } else { 
<span class="lineNum">     519 </span>                :                                 /* Deleting the head of the list */
<span class="lineNum">     520 </span><span class="lineCov">           3072 :                                 ht-&gt;pListHead = p-&gt;pListNext;</span>
<span class="lineNum">     521 </span>                :                         }
<span class="lineNum">     522 </span><span class="lineCov">          32732 :                         if (p-&gt;pListNext != NULL) {</span>
<span class="lineNum">     523 </span><span class="lineCov">          32017 :                                 p-&gt;pListNext-&gt;pListLast = p-&gt;pListLast;</span>
<span class="lineNum">     524 </span>                :                         } else {
<span class="lineNum">     525 </span><span class="lineCov">            715 :                                 ht-&gt;pListTail = p-&gt;pListLast;</span>
<span class="lineNum">     526 </span>                :                         }
<span class="lineNum">     527 </span><span class="lineCov">          32732 :                         if (ht-&gt;pInternalPointer == p) {</span>
<span class="lineNum">     528 </span><span class="lineCov">           3072 :                                 ht-&gt;pInternalPointer = p-&gt;pListNext;</span>
<span class="lineNum">     529 </span>                :                         }
<span class="lineNum">     530 </span><span class="lineCov">          32732 :                         if (ht-&gt;pDestructor) {</span>
<span class="lineNum">     531 </span><span class="lineCov">          32252 :                                 ht-&gt;pDestructor(p-&gt;pData);</span>
<span class="lineNum">     532 </span>                :                         }
<span class="lineNum">     533 </span><span class="lineCov">          32732 :                         if (p-&gt;pData != &amp;p-&gt;pDataPtr) {</span>
<span class="lineNum">     534 </span><span class="lineCov">          32251 :                                 pefree(p-&gt;pData, ht-&gt;persistent);</span>
<span class="lineNum">     535 </span>                :                         }
<span class="lineNum">     536 </span><span class="lineCov">          32732 :                         pefree(p, ht-&gt;persistent);</span>
<span class="lineNum">     537 </span><span class="lineCov">          32732 :                         HANDLE_UNBLOCK_INTERRUPTIONS();</span>
<span class="lineNum">     538 </span><span class="lineCov">          32732 :                         ht-&gt;nNumOfElements--;</span>
<span class="lineNum">     539 </span><span class="lineCov">          32732 :                         return SUCCESS;</span>
<span class="lineNum">     540 </span>                :                 }
<span class="lineNum">     541 </span><span class="lineCov">           6434 :                 p = p-&gt;pNext;</span>
<span class="lineNum">     542 </span>                :         }
<span class="lineNum">     543 </span><span class="lineCov">              5 :         return FAILURE;</span>
<span class="lineNum">     544 </span>                : }
<a name="545"><span class="lineNum">     545 </span>                : </a>
<span class="lineNum">     546 </span>                : 
<span class="lineNum">     547 </span><span class="lineCov">          30579 : ZEND_API void zend_hash_destroy(HashTable *ht)</span>
<span class="lineNum">     548 </span>                : {
<span class="lineNum">     549 </span>                :         Bucket *p, *q;
<span class="lineNum">     550 </span>                : 
<span class="lineNum">     551 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">     552 </span>                : 
<span class="lineNum">     553 </span>                :         SET_INCONSISTENT(HT_IS_DESTROYING);
<span class="lineNum">     554 </span>                : 
<span class="lineNum">     555 </span><span class="lineCov">          30579 :         p = ht-&gt;pListHead;</span>
<span class="lineNum">     556 </span><span class="lineCov">         209274 :         while (p != NULL) {</span>
<span class="lineNum">     557 </span><span class="lineCov">         148116 :                 q = p;</span>
<span class="lineNum">     558 </span><span class="lineCov">         148116 :                 p = p-&gt;pListNext;</span>
<span class="lineNum">     559 </span><span class="lineCov">         148116 :                 if (ht-&gt;pDestructor) {</span>
<span class="lineNum">     560 </span><span class="lineCov">         146188 :                         ht-&gt;pDestructor(q-&gt;pData);</span>
<span class="lineNum">     561 </span>                :                 }
<span class="lineNum">     562 </span><span class="lineCov">         148116 :                 if (q-&gt;pData != &amp;q-&gt;pDataPtr) {</span>
<span class="lineNum">     563 </span><span class="lineCov">         105532 :                         pefree(q-&gt;pData, ht-&gt;persistent);</span>
<span class="lineNum">     564 </span>                :                 }
<span class="lineNum">     565 </span><span class="lineCov">         148116 :                 pefree(q, ht-&gt;persistent);</span>
<span class="lineNum">     566 </span>                :         }
<span class="lineNum">     567 </span><span class="lineCov">          30579 :         if (ht-&gt;nTableMask) {</span>
<span class="lineNum">     568 </span><span class="lineCov">          19498 :                 pefree(ht-&gt;arBuckets, ht-&gt;persistent);</span>
<span class="lineNum">     569 </span>                :         }
<span class="lineNum">     570 </span>                : 
<span class="lineNum">     571 </span>                :         SET_INCONSISTENT(HT_DESTROYED);
<span class="lineNum">     572 </span><span class="lineCov">          30579 : }</span>
<a name="573"><span class="lineNum">     573 </span>                : </a>
<span class="lineNum">     574 </span>                : 
<span class="lineNum">     575 </span><span class="lineCov">             96 : ZEND_API void zend_hash_clean(HashTable *ht)</span>
<span class="lineNum">     576 </span>                : {
<span class="lineNum">     577 </span>                :         Bucket *p, *q;
<span class="lineNum">     578 </span>                : 
<span class="lineNum">     579 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">     580 </span>                : 
<span class="lineNum">     581 </span><span class="lineCov">             96 :         p = ht-&gt;pListHead;</span>
<span class="lineNum">     582 </span>                : 
<span class="lineNum">     583 </span><span class="lineCov">             96 :         if (ht-&gt;nTableMask) {</span>
<span class="lineNum">     584 </span><span class="lineCov">             96 :                 memset(ht-&gt;arBuckets, 0, ht-&gt;nTableSize*sizeof(Bucket *));</span>
<span class="lineNum">     585 </span>                :         }
<span class="lineNum">     586 </span><span class="lineCov">             96 :         ht-&gt;pListHead = NULL;</span>
<span class="lineNum">     587 </span><span class="lineCov">             96 :         ht-&gt;pListTail = NULL;</span>
<span class="lineNum">     588 </span><span class="lineCov">             96 :         ht-&gt;nNumOfElements = 0;</span>
<span class="lineNum">     589 </span><span class="lineCov">             96 :         ht-&gt;nNextFreeElement = 0;</span>
<span class="lineNum">     590 </span><span class="lineCov">             96 :         ht-&gt;pInternalPointer = NULL;</span>
<span class="lineNum">     591 </span>                : 
<span class="lineNum">     592 </span><span class="lineCov">           4118 :         while (p != NULL) {</span>
<span class="lineNum">     593 </span><span class="lineCov">           3926 :                 q = p;</span>
<span class="lineNum">     594 </span><span class="lineCov">           3926 :                 p = p-&gt;pListNext;</span>
<span class="lineNum">     595 </span><span class="lineCov">           3926 :                 if (ht-&gt;pDestructor) {</span>
<span class="lineNum">     596 </span><span class="lineCov">           3926 :                         ht-&gt;pDestructor(q-&gt;pData);</span>
<span class="lineNum">     597 </span>                :                 }
<span class="lineNum">     598 </span><span class="lineCov">           3926 :                 if (q-&gt;pData != &amp;q-&gt;pDataPtr) {</span>
<span class="lineNum">     599 </span><span class="lineNoCov">              0 :                         pefree(q-&gt;pData, ht-&gt;persistent);</span>
<span class="lineNum">     600 </span>                :                 }
<span class="lineNum">     601 </span><span class="lineCov">           3926 :                 pefree(q, ht-&gt;persistent);</span>
<span class="lineNum">     602 </span>                :         }
<span class="lineNum">     603 </span><span class="lineCov">             96 : }</span>
<span class="lineNum">     604 </span>                : 
<span class="lineNum">     605 </span>                : /* This function is used by the various apply() functions.
<span class="lineNum">     606 </span>                :  * It deletes the passed bucket, and returns the address of the
<span class="lineNum">     607 </span>                :  * next bucket.  The hash *may* be altered during that time, the
<a name="608"><span class="lineNum">     608 </span>                :  * returned value will still be valid.</a>
<span class="lineNum">     609 </span>                :  */
<span class="lineNum">     610 </span><span class="lineCov">           6636 : static Bucket *zend_hash_apply_deleter(HashTable *ht, Bucket *p)</span>
<span class="lineNum">     611 </span>                : {
<span class="lineNum">     612 </span>                :         Bucket *retval;
<span class="lineNum">     613 </span>                : #ifdef ZEND_SIGNALS
<span class="lineNum">     614 </span>                :         TSRMLS_FETCH();
<span class="lineNum">     615 </span>                : #endif
<span class="lineNum">     616 </span>                : 
<span class="lineNum">     617 </span><span class="lineCov">           6636 :         HANDLE_BLOCK_INTERRUPTIONS();</span>
<span class="lineNum">     618 </span><span class="lineCov">           6636 :         if (p-&gt;pLast) {</span>
<span class="lineNum">     619 </span><span class="lineCov">           1009 :                 p-&gt;pLast-&gt;pNext = p-&gt;pNext;</span>
<span class="lineNum">     620 </span>                :         } else {
<span class="lineNum">     621 </span>                :                 uint nIndex;
<span class="lineNum">     622 </span>                : 
<span class="lineNum">     623 </span><span class="lineCov">           5627 :                 nIndex = p-&gt;h &amp; ht-&gt;nTableMask;</span>
<span class="lineNum">     624 </span><span class="lineCov">           5627 :                 ht-&gt;arBuckets[nIndex] = p-&gt;pNext;</span>
<span class="lineNum">     625 </span>                :         }
<span class="lineNum">     626 </span><span class="lineCov">           6636 :         if (p-&gt;pNext) {</span>
<span class="lineNum">     627 </span><span class="lineCov">            771 :                 p-&gt;pNext-&gt;pLast = p-&gt;pLast;</span>
<span class="lineNum">     628 </span>                :         } else {
<span class="lineNum">     629 </span>                :                 /* Nothing to do as this list doesn't have a tail */
<span class="lineNum">     630 </span>                :         }
<span class="lineNum">     631 </span>                : 
<span class="lineNum">     632 </span><span class="lineCov">           6636 :         if (p-&gt;pListLast != NULL) {</span>
<span class="lineNum">     633 </span><span class="lineCov">           2507 :                 p-&gt;pListLast-&gt;pListNext = p-&gt;pListNext;</span>
<span class="lineNum">     634 </span>                :         } else { 
<span class="lineNum">     635 </span>                :                 /* Deleting the head of the list */
<span class="lineNum">     636 </span><span class="lineCov">           4129 :                 ht-&gt;pListHead = p-&gt;pListNext;</span>
<span class="lineNum">     637 </span>                :         }
<span class="lineNum">     638 </span><span class="lineCov">           6636 :         if (p-&gt;pListNext != NULL) {</span>
<span class="lineNum">     639 </span><span class="lineCov">           5241 :                 p-&gt;pListNext-&gt;pListLast = p-&gt;pListLast;</span>
<span class="lineNum">     640 </span>                :         } else {
<span class="lineNum">     641 </span><span class="lineCov">           1395 :                 ht-&gt;pListTail = p-&gt;pListLast;</span>
<span class="lineNum">     642 </span>                :         }
<span class="lineNum">     643 </span><span class="lineCov">           6636 :         if (ht-&gt;pInternalPointer == p) {</span>
<span class="lineNum">     644 </span><span class="lineCov">           4129 :                 ht-&gt;pInternalPointer = p-&gt;pListNext;</span>
<span class="lineNum">     645 </span>                :         }
<span class="lineNum">     646 </span><span class="lineCov">           6636 :         ht-&gt;nNumOfElements--;</span>
<span class="lineNum">     647 </span><span class="lineCov">           6636 :         HANDLE_UNBLOCK_INTERRUPTIONS();</span>
<span class="lineNum">     648 </span>                : 
<span class="lineNum">     649 </span><span class="lineCov">           6636 :         if (ht-&gt;pDestructor) {</span>
<span class="lineNum">     650 </span><span class="lineCov">           1208 :                 ht-&gt;pDestructor(p-&gt;pData);</span>
<span class="lineNum">     651 </span>                :         }
<span class="lineNum">     652 </span><span class="lineCov">           6636 :         if (p-&gt;pData != &amp;p-&gt;pDataPtr) {</span>
<span class="lineNum">     653 </span><span class="lineCov">           6068 :                 pefree(p-&gt;pData, ht-&gt;persistent);</span>
<span class="lineNum">     654 </span>                :         }
<span class="lineNum">     655 </span><span class="lineCov">           6636 :         retval = p-&gt;pListNext;</span>
<span class="lineNum">     656 </span><span class="lineCov">           6636 :         pefree(p, ht-&gt;persistent);</span>
<span class="lineNum">     657 </span>                : 
<span class="lineNum">     658 </span><span class="lineCov">           6636 :         return retval;</span>
<span class="lineNum">     659 </span>                : }
<a name="660"><span class="lineNum">     660 </span>                : </a>
<span class="lineNum">     661 </span>                : 
<span class="lineNum">     662 </span><span class="lineNoCov">              0 : ZEND_API void zend_hash_graceful_destroy(HashTable *ht)</span>
<span class="lineNum">     663 </span>                : {
<span class="lineNum">     664 </span>                :         Bucket *p;
<span class="lineNum">     665 </span>                : 
<span class="lineNum">     666 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">     667 </span>                : 
<span class="lineNum">     668 </span><span class="lineNoCov">              0 :         p = ht-&gt;pListHead;</span>
<span class="lineNum">     669 </span><span class="lineNoCov">              0 :         while (p != NULL) {</span>
<span class="lineNum">     670 </span><span class="lineNoCov">              0 :                 p = zend_hash_apply_deleter(ht, p);</span>
<span class="lineNum">     671 </span>                :         }
<span class="lineNum">     672 </span><span class="lineNoCov">              0 :         if (ht-&gt;nTableMask) {</span>
<span class="lineNum">     673 </span><span class="lineNoCov">              0 :                 pefree(ht-&gt;arBuckets, ht-&gt;persistent);</span>
<span class="lineNum">     674 </span>                :         }
<span class="lineNum">     675 </span>                : 
<span class="lineNum">     676 </span>                :         SET_INCONSISTENT(HT_DESTROYED);
<a name="677"><span class="lineNum">     677 </span><span class="lineNoCov">              0 : }</span></a>
<span class="lineNum">     678 </span>                : 
<span class="lineNum">     679 </span><span class="lineCov">            192 : ZEND_API void zend_hash_graceful_reverse_destroy(HashTable *ht)</span>
<span class="lineNum">     680 </span>                : {
<span class="lineNum">     681 </span>                :         Bucket *p;
<span class="lineNum">     682 </span>                : 
<span class="lineNum">     683 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">     684 </span>                : 
<span class="lineNum">     685 </span><span class="lineCov">            192 :         p = ht-&gt;pListTail;</span>
<span class="lineNum">     686 </span><span class="lineCov">           1293 :         while (p != NULL) {</span>
<span class="lineNum">     687 </span><span class="lineCov">            909 :                 zend_hash_apply_deleter(ht, p);</span>
<span class="lineNum">     688 </span><span class="lineCov">            909 :                 p = ht-&gt;pListTail;</span>
<span class="lineNum">     689 </span>                :         }
<span class="lineNum">     690 </span>                : 
<span class="lineNum">     691 </span><span class="lineCov">            192 :         if (ht-&gt;nTableMask) {</span>
<span class="lineNum">     692 </span><span class="lineCov">            184 :                 pefree(ht-&gt;arBuckets, ht-&gt;persistent);</span>
<span class="lineNum">     693 </span>                :         }
<span class="lineNum">     694 </span>                : 
<span class="lineNum">     695 </span>                :         SET_INCONSISTENT(HT_DESTROYED);
<span class="lineNum">     696 </span><span class="lineCov">            192 : }</span>
<span class="lineNum">     697 </span>                : 
<span class="lineNum">     698 </span>                : /* This is used to recurse elements and selectively delete certain entries 
<span class="lineNum">     699 </span>                :  * from a hashtable. apply_func() receives the data and decides if the entry 
<span class="lineNum">     700 </span>                :  * should be deleted or recursion should be stopped. The following three 
<span class="lineNum">     701 </span>                :  * return codes are possible:
<span class="lineNum">     702 </span>                :  * ZEND_HASH_APPLY_KEEP   - continue
<span class="lineNum">     703 </span>                :  * ZEND_HASH_APPLY_STOP   - stop iteration
<span class="lineNum">     704 </span>                :  * ZEND_HASH_APPLY_REMOVE - delete the element, combineable with the former
<a name="705"><span class="lineNum">     705 </span>                :  */</a>
<span class="lineNum">     706 </span>                : 
<span class="lineNum">     707 </span><span class="lineCov">            146 : ZEND_API void zend_hash_apply(HashTable *ht, apply_func_t apply_func TSRMLS_DC)</span>
<span class="lineNum">     708 </span>                : {
<span class="lineNum">     709 </span>                :         Bucket *p;
<span class="lineNum">     710 </span>                : 
<span class="lineNum">     711 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">     712 </span>                : 
<span class="lineNum">     713 </span><span class="lineCov">            146 :         HASH_PROTECT_RECURSION(ht);</span>
<span class="lineNum">     714 </span><span class="lineCov">            146 :         p = ht-&gt;pListHead;</span>
<span class="lineNum">     715 </span><span class="lineCov">           1126 :         while (p != NULL) {</span>
<span class="lineNum">     716 </span><span class="lineCov">            834 :                 int result = apply_func(p-&gt;pData TSRMLS_CC);</span>
<span class="lineNum">     717 </span>                :                 
<span class="lineNum">     718 </span><span class="lineCov">            834 :                 if (result &amp; ZEND_HASH_APPLY_REMOVE) {</span>
<span class="lineNum">     719 </span><span class="lineCov">              4 :                         p = zend_hash_apply_deleter(ht, p);</span>
<span class="lineNum">     720 </span>                :                 } else {
<span class="lineNum">     721 </span><span class="lineCov">            830 :                         p = p-&gt;pListNext;</span>
<span class="lineNum">     722 </span>                :                 }
<span class="lineNum">     723 </span><span class="lineCov">            834 :                 if (result &amp; ZEND_HASH_APPLY_STOP) {</span>
<span class="lineNum">     724 </span><span class="lineNoCov">              0 :                         break;</span>
<span class="lineNum">     725 </span>                :                 }
<span class="lineNum">     726 </span>                :         }
<span class="lineNum">     727 </span><span class="lineCov">            146 :         HASH_UNPROTECT_RECURSION(ht);</span>
<span class="lineNum">     728 </span><span class="lineCov">            146 : }</span>
<a name="729"><span class="lineNum">     729 </span>                : </a>
<span class="lineNum">     730 </span>                : 
<span class="lineNum">     731 </span><span class="lineCov">            456 : ZEND_API void zend_hash_apply_with_argument(HashTable *ht, apply_func_arg_t apply_func, void *argument TSRMLS_DC)</span>
<span class="lineNum">     732 </span>                : {
<span class="lineNum">     733 </span>                :         Bucket *p;
<span class="lineNum">     734 </span>                : 
<span class="lineNum">     735 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">     736 </span>                : 
<span class="lineNum">     737 </span><span class="lineCov">            456 :         HASH_PROTECT_RECURSION(ht);</span>
<span class="lineNum">     738 </span><span class="lineCov">            456 :         p = ht-&gt;pListHead;</span>
<span class="lineNum">     739 </span><span class="lineCov">          24146 :         while (p != NULL) {</span>
<span class="lineNum">     740 </span><span class="lineCov">          23234 :                 int result = apply_func(p-&gt;pData, argument TSRMLS_CC);</span>
<span class="lineNum">     741 </span>                :                 
<span class="lineNum">     742 </span><span class="lineCov">          23234 :                 if (result &amp; ZEND_HASH_APPLY_REMOVE) {</span>
<span class="lineNum">     743 </span><span class="lineCov">           5424 :                         p = zend_hash_apply_deleter(ht, p);</span>
<span class="lineNum">     744 </span>                :                 } else {
<span class="lineNum">     745 </span><span class="lineCov">          17810 :                         p = p-&gt;pListNext;</span>
<span class="lineNum">     746 </span>                :                 }
<span class="lineNum">     747 </span><span class="lineCov">          23234 :                 if (result &amp; ZEND_HASH_APPLY_STOP) {</span>
<span class="lineNum">     748 </span><span class="lineNoCov">              0 :                         break;</span>
<span class="lineNum">     749 </span>                :                 }
<span class="lineNum">     750 </span>                :         }
<span class="lineNum">     751 </span><span class="lineCov">            456 :         HASH_UNPROTECT_RECURSION(ht);</span>
<span class="lineNum">     752 </span><span class="lineCov">            456 : }</span>
<a name="753"><span class="lineNum">     753 </span>                : </a>
<span class="lineNum">     754 </span>                : 
<span class="lineNum">     755 </span><span class="lineCov">           2458 : ZEND_API void zend_hash_apply_with_arguments(HashTable *ht TSRMLS_DC, apply_func_args_t apply_func, int num_args, ...)</span>
<span class="lineNum">     756 </span>                : {
<span class="lineNum">     757 </span>                :         Bucket *p;
<span class="lineNum">     758 </span>                :         va_list args;
<span class="lineNum">     759 </span>                :         zend_hash_key hash_key;
<span class="lineNum">     760 </span>                : 
<span class="lineNum">     761 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">     762 </span>                : 
<span class="lineNum">     763 </span><span class="lineCov">           2458 :         HASH_PROTECT_RECURSION(ht);</span>
<span class="lineNum">     764 </span>                : 
<span class="lineNum">     765 </span><span class="lineCov">           2458 :         p = ht-&gt;pListHead;</span>
<span class="lineNum">     766 </span><span class="lineCov">           7888 :         while (p != NULL) {</span>
<span class="lineNum">     767 </span>                :                 int result;
<span class="lineNum">     768 </span><span class="lineCov">           2973 :                 va_start(args, num_args);</span>
<span class="lineNum">     769 </span><span class="lineCov">           2973 :                 hash_key.arKey = p-&gt;arKey;</span>
<span class="lineNum">     770 </span><span class="lineCov">           2973 :                 hash_key.nKeyLength = p-&gt;nKeyLength;</span>
<span class="lineNum">     771 </span><span class="lineCov">           2973 :                 hash_key.h = p-&gt;h;</span>
<span class="lineNum">     772 </span><span class="lineCov">           2973 :                 result = apply_func(p-&gt;pData TSRMLS_CC, num_args, args, &amp;hash_key);</span>
<span class="lineNum">     773 </span>                : 
<span class="lineNum">     774 </span><span class="lineCov">           2973 :                 if (result &amp; ZEND_HASH_APPLY_REMOVE) {</span>
<span class="lineNum">     775 </span><span class="lineNoCov">              0 :                         p = zend_hash_apply_deleter(ht, p);</span>
<span class="lineNum">     776 </span>                :                 } else {
<span class="lineNum">     777 </span><span class="lineCov">           2973 :                         p = p-&gt;pListNext;</span>
<span class="lineNum">     778 </span>                :                 }
<span class="lineNum">     779 </span><span class="lineCov">           2973 :                 if (result &amp; ZEND_HASH_APPLY_STOP) {</span>
<span class="lineNum">     780 </span><span class="lineCov">              1 :                         va_end(args);</span>
<span class="lineNum">     781 </span><span class="lineCov">              1 :                         break;</span>
<span class="lineNum">     782 </span>                :                 }
<span class="lineNum">     783 </span><span class="lineCov">           2972 :                 va_end(args);</span>
<span class="lineNum">     784 </span>                :         }
<span class="lineNum">     785 </span>                : 
<span class="lineNum">     786 </span><span class="lineCov">           2458 :         HASH_UNPROTECT_RECURSION(ht);</span>
<span class="lineNum">     787 </span><span class="lineCov">           2458 : }</span>
<a name="788"><span class="lineNum">     788 </span>                : </a>
<span class="lineNum">     789 </span>                : 
<span class="lineNum">     790 </span><span class="lineCov">            325 : ZEND_API void zend_hash_reverse_apply(HashTable *ht, apply_func_t apply_func TSRMLS_DC)</span>
<span class="lineNum">     791 </span>                : {
<span class="lineNum">     792 </span>                :         Bucket *p, *q;
<span class="lineNum">     793 </span>                : 
<span class="lineNum">     794 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">     795 </span>                : 
<span class="lineNum">     796 </span><span class="lineCov">            325 :         HASH_PROTECT_RECURSION(ht);</span>
<span class="lineNum">     797 </span><span class="lineCov">            325 :         p = ht-&gt;pListTail;</span>
<span class="lineNum">     798 </span><span class="lineCov">           1773 :         while (p != NULL) {</span>
<span class="lineNum">     799 </span><span class="lineCov">           1363 :                 int result = apply_func(p-&gt;pData TSRMLS_CC);</span>
<span class="lineNum">     800 </span>                : 
<span class="lineNum">     801 </span><span class="lineCov">           1363 :                 q = p;</span>
<span class="lineNum">     802 </span><span class="lineCov">           1363 :                 p = p-&gt;pListLast;</span>
<span class="lineNum">     803 </span><span class="lineCov">           1363 :                 if (result &amp; ZEND_HASH_APPLY_REMOVE) {</span>
<span class="lineNum">     804 </span><span class="lineCov">            299 :                         zend_hash_apply_deleter(ht, q);</span>
<span class="lineNum">     805 </span>                :                 }
<span class="lineNum">     806 </span><span class="lineCov">           1363 :                 if (result &amp; ZEND_HASH_APPLY_STOP) {</span>
<span class="lineNum">     807 </span><span class="lineCov">            240 :                         break;</span>
<span class="lineNum">     808 </span>                :                 }
<span class="lineNum">     809 </span>                :         }
<span class="lineNum">     810 </span><span class="lineCov">            325 :         HASH_UNPROTECT_RECURSION(ht);</span>
<span class="lineNum">     811 </span><span class="lineCov">            325 : }</span>
<a name="812"><span class="lineNum">     812 </span>                : </a>
<span class="lineNum">     813 </span>                : 
<span class="lineNum">     814 </span><span class="lineCov">           2545 : ZEND_API void zend_hash_copy(HashTable *target, HashTable *source, copy_ctor_func_t pCopyConstructor, void *tmp, uint size)</span>
<span class="lineNum">     815 </span>                : {
<span class="lineNum">     816 </span>                :         Bucket *p;
<span class="lineNum">     817 </span>                :         void *new_entry;
<span class="lineNum">     818 </span>                :         zend_bool setTargetPointer;
<span class="lineNum">     819 </span>                : 
<span class="lineNum">     820 </span>                :         IS_CONSISTENT(source);
<span class="lineNum">     821 </span>                :         IS_CONSISTENT(target);
<span class="lineNum">     822 </span>                : 
<span class="lineNum">     823 </span><span class="lineCov">           2545 :         setTargetPointer = !target-&gt;pInternalPointer;</span>
<span class="lineNum">     824 </span><span class="lineCov">           2545 :         p = source-&gt;pListHead;</span>
<span class="lineNum">     825 </span><span class="lineCov">          14950 :         while (p) {</span>
<span class="lineNum">     826 </span><span class="lineCov">           9860 :                 if (setTargetPointer &amp;&amp; source-&gt;pInternalPointer == p) {</span>
<span class="lineNum">     827 </span><span class="lineCov">           2544 :                         target-&gt;pInternalPointer = NULL;</span>
<span class="lineNum">     828 </span>                :                 }
<span class="lineNum">     829 </span><span class="lineCov">           9860 :                 if (p-&gt;nKeyLength) {</span>
<span class="lineNum">     830 </span><span class="lineCov">           7070 :                         zend_hash_quick_update(target, p-&gt;arKey, p-&gt;nKeyLength, p-&gt;h, p-&gt;pData, size, &amp;new_entry);</span>
<span class="lineNum">     831 </span>                :                 } else {
<span class="lineNum">     832 </span><span class="lineCov">           2790 :                         zend_hash_index_update(target, p-&gt;h, p-&gt;pData, size, &amp;new_entry);</span>
<span class="lineNum">     833 </span>                :                 }
<span class="lineNum">     834 </span><span class="lineCov">           9860 :                 if (pCopyConstructor) {</span>
<span class="lineNum">     835 </span><span class="lineCov">           9860 :                         pCopyConstructor(new_entry);</span>
<span class="lineNum">     836 </span>                :                 }
<span class="lineNum">     837 </span><span class="lineCov">           9860 :                 p = p-&gt;pListNext;</span>
<span class="lineNum">     838 </span>                :         }
<span class="lineNum">     839 </span><span class="lineCov">           2545 :         if (!target-&gt;pInternalPointer) {</span>
<span class="lineNum">     840 </span><span class="lineCov">              1 :                 target-&gt;pInternalPointer = target-&gt;pListHead;</span>
<span class="lineNum">     841 </span>                :         }
<span class="lineNum">     842 </span><span class="lineCov">           2545 : }</span>
<a name="843"><span class="lineNum">     843 </span>                : </a>
<span class="lineNum">     844 </span>                : 
<span class="lineNum">     845 </span><span class="lineCov">           2443 : ZEND_API void _zend_hash_merge(HashTable *target, HashTable *source, copy_ctor_func_t pCopyConstructor, void *tmp, uint size, int overwrite ZEND_FILE_LINE_DC)</span>
<span class="lineNum">     846 </span>                : {
<span class="lineNum">     847 </span>                :         Bucket *p;
<span class="lineNum">     848 </span>                :         void *t;
<span class="lineNum">     849 </span><span class="lineCov">           2443 :         int mode = (overwrite?HASH_UPDATE:HASH_ADD);</span>
<span class="lineNum">     850 </span>                : 
<span class="lineNum">     851 </span>                :         IS_CONSISTENT(source);
<span class="lineNum">     852 </span>                :         IS_CONSISTENT(target);
<span class="lineNum">     853 </span>                : 
<span class="lineNum">     854 </span><span class="lineCov">           2443 :         p = source-&gt;pListHead;</span>
<span class="lineNum">     855 </span><span class="lineCov">           7699 :         while (p) {</span>
<span class="lineNum">     856 </span><span class="lineCov">           2813 :                 if (p-&gt;nKeyLength&gt;0) {</span>
<span class="lineNum">     857 </span><span class="lineCov">           2813 :                         if (_zend_hash_quick_add_or_update(target, p-&gt;arKey, p-&gt;nKeyLength, p-&gt;h, p-&gt;pData, size, &amp;t, mode ZEND_FILE_LINE_RELAY_CC)==SUCCESS &amp;&amp; pCopyConstructor) {</span>
<span class="lineNum">     858 </span><span class="lineCov">           2813 :                                 pCopyConstructor(t);</span>
<span class="lineNum">     859 </span>                :                         }
<span class="lineNum">     860 </span>                :                 } else {
<span class="lineNum">     861 </span><span class="lineNoCov">              0 :                         if ((mode==HASH_UPDATE || !zend_hash_index_exists(target, p-&gt;h)) &amp;&amp; zend_hash_index_update(target, p-&gt;h, p-&gt;pData, size, &amp;t)==SUCCESS &amp;&amp; pCopyConstructor) {</span>
<span class="lineNum">     862 </span><span class="lineNoCov">              0 :                                 pCopyConstructor(t);</span>
<span class="lineNum">     863 </span>                :                         }
<span class="lineNum">     864 </span>                :                 }
<span class="lineNum">     865 </span><span class="lineCov">           2813 :                 p = p-&gt;pListNext;</span>
<span class="lineNum">     866 </span>                :         }
<span class="lineNum">     867 </span><span class="lineCov">           2443 :         target-&gt;pInternalPointer = target-&gt;pListHead;</span>
<span class="lineNum">     868 </span><span class="lineCov">           2443 : }</span>
<a name="869"><span class="lineNum">     869 </span>                : </a>
<span class="lineNum">     870 </span>                : 
<span class="lineNum">     871 </span><span class="lineCov">          55567 : static zend_bool zend_hash_replace_checker_wrapper(HashTable *target, void *source_data, Bucket *p, void *pParam, merge_checker_func_t merge_checker_func)</span>
<span class="lineNum">     872 </span>                : {
<span class="lineNum">     873 </span>                :         zend_hash_key hash_key;
<span class="lineNum">     874 </span>                : 
<span class="lineNum">     875 </span><span class="lineCov">          55567 :         hash_key.arKey = p-&gt;arKey;</span>
<span class="lineNum">     876 </span><span class="lineCov">          55567 :         hash_key.nKeyLength = p-&gt;nKeyLength;</span>
<span class="lineNum">     877 </span><span class="lineCov">          55567 :         hash_key.h = p-&gt;h;</span>
<span class="lineNum">     878 </span><span class="lineCov">          55567 :         return merge_checker_func(target, source_data, &amp;hash_key, pParam);</span>
<span class="lineNum">     879 </span>                : }
<a name="880"><span class="lineNum">     880 </span>                : </a>
<span class="lineNum">     881 </span>                : 
<span class="lineNum">     882 </span><span class="lineCov">           9604 : ZEND_API void zend_hash_merge_ex(HashTable *target, HashTable *source, copy_ctor_func_t pCopyConstructor, uint size, merge_checker_func_t pMergeSource, void *pParam)</span>
<span class="lineNum">     883 </span>                : {
<span class="lineNum">     884 </span>                :         Bucket *p;
<span class="lineNum">     885 </span>                :         void *t;
<span class="lineNum">     886 </span>                : 
<span class="lineNum">     887 </span>                :         IS_CONSISTENT(source);
<span class="lineNum">     888 </span>                :         IS_CONSISTENT(target);
<span class="lineNum">     889 </span>                : 
<span class="lineNum">     890 </span><span class="lineCov">           9604 :         p = source-&gt;pListHead;</span>
<span class="lineNum">     891 </span><span class="lineCov">          74775 :         while (p) {</span>
<span class="lineNum">     892 </span><span class="lineCov">          55567 :                 if (zend_hash_replace_checker_wrapper(target, p-&gt;pData, p, pParam, pMergeSource)) {</span>
<span class="lineNum">     893 </span><span class="lineCov">          39529 :                         if (zend_hash_quick_update(target, p-&gt;arKey, p-&gt;nKeyLength, p-&gt;h, p-&gt;pData, size, &amp;t)==SUCCESS &amp;&amp; pCopyConstructor) {</span>
<span class="lineNum">     894 </span><span class="lineCov">          39529 :                                 pCopyConstructor(t);</span>
<span class="lineNum">     895 </span>                :                         }
<span class="lineNum">     896 </span>                :                 }
<span class="lineNum">     897 </span><span class="lineCov">          55567 :                 p = p-&gt;pListNext;</span>
<span class="lineNum">     898 </span>                :         }
<span class="lineNum">     899 </span><span class="lineCov">           9604 :         target-&gt;pInternalPointer = target-&gt;pListHead;</span>
<span class="lineNum">     900 </span><span class="lineCov">           9604 : }</span>
<a name="901"><span class="lineNum">     901 </span>                : </a>
<span class="lineNum">     902 </span>                : 
<span class="lineNum">     903 </span><span class="lineCov">           8830 : ZEND_API ulong zend_get_hash_value(const char *arKey, uint nKeyLength)</span>
<span class="lineNum">     904 </span>                : {
<span class="lineNum">     905 </span><span class="lineCov">           8830 :         return zend_inline_hash_func(arKey, nKeyLength);</span>
<span class="lineNum">     906 </span>                : }
<span class="lineNum">     907 </span>                : 
<span class="lineNum">     908 </span>                : 
<span class="lineNum">     909 </span>                : /* Returns SUCCESS if found and FAILURE if not. The pointer to the
<span class="lineNum">     910 </span>                :  * data is returned in pData. The reason is that there's no reason
<a name="911"><span class="lineNum">     911 </span>                :  * someone using the hash table might not want to have NULL data</a>
<span class="lineNum">     912 </span>                :  */
<span class="lineNum">     913 </span><span class="lineCov">          22471 : ZEND_API int zend_hash_find(const HashTable *ht, const char *arKey, uint nKeyLength, void **pData)</span>
<span class="lineNum">     914 </span>                : {
<span class="lineNum">     915 </span>                :         ulong h;
<span class="lineNum">     916 </span>                :         uint nIndex;
<span class="lineNum">     917 </span>                :         Bucket *p;
<span class="lineNum">     918 </span>                : 
<span class="lineNum">     919 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">     920 </span>                : 
<span class="lineNum">     921 </span><span class="lineCov">          22471 :         h = zend_inline_hash_func(arKey, nKeyLength);</span>
<span class="lineNum">     922 </span><span class="lineCov">          22471 :         nIndex = h &amp; ht-&gt;nTableMask;</span>
<span class="lineNum">     923 </span>                : 
<span class="lineNum">     924 </span><span class="lineCov">          22471 :         p = ht-&gt;arBuckets[nIndex];</span>
<span class="lineNum">     925 </span><span class="lineCov">          53235 :         while (p != NULL) {</span>
<span class="lineNum">     926 </span><span class="lineCov">          56838 :                 if (p-&gt;arKey == arKey ||</span>
<span class="lineNum">     927 </span><span class="lineCov">          36787 :                         ((p-&gt;h == h) &amp;&amp; (p-&gt;nKeyLength == nKeyLength) &amp;&amp; !memcmp(p-&gt;arKey, arKey, nKeyLength))) {</span>
<span class="lineNum">     928 </span><span class="lineCov">          11758 :                                 *pData = p-&gt;pData;</span>
<span class="lineNum">     929 </span><span class="lineCov">          11758 :                                 return SUCCESS;</span>
<span class="lineNum">     930 </span>                :                 }
<span class="lineNum">     931 </span><span class="lineCov">           8293 :                 p = p-&gt;pNext;</span>
<span class="lineNum">     932 </span>                :         }
<span class="lineNum">     933 </span><span class="lineCov">          10713 :         return FAILURE;</span>
<span class="lineNum">     934 </span>                : }
<a name="935"><span class="lineNum">     935 </span>                : </a>
<span class="lineNum">     936 </span>                : 
<span class="lineNum">     937 </span><span class="lineCov">          84484 : ZEND_API int zend_hash_quick_find(const HashTable *ht, const char *arKey, uint nKeyLength, ulong h, void **pData)</span>
<span class="lineNum">     938 </span>                : {
<span class="lineNum">     939 </span>                :         uint nIndex;
<span class="lineNum">     940 </span>                :         Bucket *p;
<span class="lineNum">     941 </span>                : 
<span class="lineNum">     942 </span><span class="lineCov">          84484 :         if (nKeyLength==0) {</span>
<span class="lineNum">     943 </span><span class="lineNoCov">              0 :                 return zend_hash_index_find(ht, h, pData);</span>
<span class="lineNum">     944 </span>                :         }
<span class="lineNum">     945 </span>                : 
<span class="lineNum">     946 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">     947 </span>                : 
<span class="lineNum">     948 </span><span class="lineCov">          84484 :         nIndex = h &amp; ht-&gt;nTableMask;</span>
<span class="lineNum">     949 </span>                : 
<span class="lineNum">     950 </span><span class="lineCov">          84484 :         p = ht-&gt;arBuckets[nIndex];</span>
<span class="lineNum">     951 </span><span class="lineCov">         210180 :         while (p != NULL) {</span>
<span class="lineNum">     952 </span><span class="lineCov">         139426 :                 if (p-&gt;arKey == arKey ||</span>
<span class="lineNum">     953 </span><span class="lineCov">          69229 :                         ((p-&gt;h == h) &amp;&amp; (p-&gt;nKeyLength == nKeyLength) &amp;&amp; !memcmp(p-&gt;arKey, arKey, nKeyLength))) {</span>
<span class="lineNum">     954 </span><span class="lineCov">          28985 :                                 *pData = p-&gt;pData;</span>
<span class="lineNum">     955 </span><span class="lineCov">          28985 :                                 return SUCCESS;</span>
<span class="lineNum">     956 </span>                :                 }
<span class="lineNum">     957 </span><span class="lineCov">          41212 :                 p = p-&gt;pNext;</span>
<span class="lineNum">     958 </span>                :         }
<span class="lineNum">     959 </span><span class="lineCov">          55499 :         return FAILURE;</span>
<span class="lineNum">     960 </span>                : }
<a name="961"><span class="lineNum">     961 </span>                : </a>
<span class="lineNum">     962 </span>                : 
<span class="lineNum">     963 </span><span class="lineCov">            911 : ZEND_API int zend_hash_exists(const HashTable *ht, const char *arKey, uint nKeyLength)</span>
<span class="lineNum">     964 </span>                : {
<span class="lineNum">     965 </span>                :         ulong h;
<span class="lineNum">     966 </span>                :         uint nIndex;
<span class="lineNum">     967 </span>                :         Bucket *p;
<span class="lineNum">     968 </span>                : 
<span class="lineNum">     969 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">     970 </span>                : 
<span class="lineNum">     971 </span><span class="lineCov">            911 :         h = zend_inline_hash_func(arKey, nKeyLength);</span>
<span class="lineNum">     972 </span><span class="lineCov">            911 :         nIndex = h &amp; ht-&gt;nTableMask;</span>
<span class="lineNum">     973 </span>                : 
<span class="lineNum">     974 </span><span class="lineCov">            911 :         p = ht-&gt;arBuckets[nIndex];</span>
<span class="lineNum">     975 </span><span class="lineCov">           2238 :         while (p != NULL) {</span>
<span class="lineNum">     976 </span><span class="lineCov">            872 :                 if (p-&gt;arKey == arKey ||</span>
<span class="lineNum">     977 </span><span class="lineCov">            446 :                         ((p-&gt;h == h) &amp;&amp; (p-&gt;nKeyLength == nKeyLength) &amp;&amp; !memcmp(p-&gt;arKey, arKey, nKeyLength))) {</span>
<span class="lineNum">     978 </span><span class="lineCov">             10 :                                 return 1;</span>
<span class="lineNum">     979 </span>                :                 }
<span class="lineNum">     980 </span><span class="lineCov">            416 :                 p = p-&gt;pNext;</span>
<span class="lineNum">     981 </span>                :         }
<span class="lineNum">     982 </span><span class="lineCov">            901 :         return 0;</span>
<span class="lineNum">     983 </span>                : }
<a name="984"><span class="lineNum">     984 </span>                : </a>
<span class="lineNum">     985 </span>                : 
<span class="lineNum">     986 </span><span class="lineNoCov">              0 : ZEND_API int zend_hash_quick_exists(const HashTable *ht, const char *arKey, uint nKeyLength, ulong h)</span>
<span class="lineNum">     987 </span>                : {
<span class="lineNum">     988 </span>                :         uint nIndex;
<span class="lineNum">     989 </span>                :         Bucket *p;
<span class="lineNum">     990 </span>                : 
<span class="lineNum">     991 </span><span class="lineNoCov">              0 :         if (nKeyLength==0) {</span>
<span class="lineNum">     992 </span><span class="lineNoCov">              0 :                 return zend_hash_index_exists(ht, h);</span>
<span class="lineNum">     993 </span>                :         }
<span class="lineNum">     994 </span>                : 
<span class="lineNum">     995 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">     996 </span>                : 
<span class="lineNum">     997 </span><span class="lineNoCov">              0 :         nIndex = h &amp; ht-&gt;nTableMask;</span>
<span class="lineNum">     998 </span>                : 
<span class="lineNum">     999 </span><span class="lineNoCov">              0 :         p = ht-&gt;arBuckets[nIndex];</span>
<span class="lineNum">    1000 </span><span class="lineNoCov">              0 :         while (p != NULL) {</span>
<span class="lineNum">    1001 </span><span class="lineNoCov">              0 :                 if (p-&gt;arKey == arKey ||</span>
<span class="lineNum">    1002 </span><span class="lineNoCov">              0 :                         ((p-&gt;h == h) &amp;&amp; (p-&gt;nKeyLength == nKeyLength) &amp;&amp; !memcmp(p-&gt;arKey, arKey, nKeyLength))) {</span>
<span class="lineNum">    1003 </span><span class="lineNoCov">              0 :                                 return 1;</span>
<span class="lineNum">    1004 </span>                :                 }
<span class="lineNum">    1005 </span><span class="lineNoCov">              0 :                 p = p-&gt;pNext;</span>
<span class="lineNum">    1006 </span>                :         }
<span class="lineNum">    1007 </span><span class="lineNoCov">              0 :         return 0;</span>
<span class="lineNum">    1008 </span>                : 
<span class="lineNum">    1009 </span>                : }
<a name="1010"><span class="lineNum">    1010 </span>                : </a>
<span class="lineNum">    1011 </span>                : 
<span class="lineNum">    1012 </span><span class="lineCov">          24541 : ZEND_API int zend_hash_index_find(const HashTable *ht, ulong h, void **pData)</span>
<span class="lineNum">    1013 </span>                : {
<span class="lineNum">    1014 </span>                :         uint nIndex;
<span class="lineNum">    1015 </span>                :         Bucket *p;
<span class="lineNum">    1016 </span>                : 
<span class="lineNum">    1017 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">    1018 </span>                : 
<span class="lineNum">    1019 </span><span class="lineCov">          24541 :         nIndex = h &amp; ht-&gt;nTableMask;</span>
<span class="lineNum">    1020 </span>                : 
<span class="lineNum">    1021 </span><span class="lineCov">          24541 :         p = ht-&gt;arBuckets[nIndex];</span>
<span class="lineNum">    1022 </span><span class="lineCov">          49417 :         while (p != NULL) {</span>
<span class="lineNum">    1023 </span><span class="lineCov">          23658 :                 if ((p-&gt;h == h) &amp;&amp; (p-&gt;nKeyLength == 0)) {</span>
<span class="lineNum">    1024 </span><span class="lineCov">          23323 :                         *pData = p-&gt;pData;</span>
<span class="lineNum">    1025 </span><span class="lineCov">          23323 :                         return SUCCESS;</span>
<span class="lineNum">    1026 </span>                :                 }
<span class="lineNum">    1027 </span><span class="lineCov">            335 :                 p = p-&gt;pNext;</span>
<span class="lineNum">    1028 </span>                :         }
<span class="lineNum">    1029 </span><span class="lineCov">           1218 :         return FAILURE;</span>
<span class="lineNum">    1030 </span>                : }
<a name="1031"><span class="lineNum">    1031 </span>                : </a>
<span class="lineNum">    1032 </span>                : 
<span class="lineNum">    1033 </span><span class="lineNoCov">              0 : ZEND_API int zend_hash_index_exists(const HashTable *ht, ulong h)</span>
<span class="lineNum">    1034 </span>                : {
<span class="lineNum">    1035 </span>                :         uint nIndex;
<span class="lineNum">    1036 </span>                :         Bucket *p;
<span class="lineNum">    1037 </span>                : 
<span class="lineNum">    1038 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">    1039 </span>                : 
<span class="lineNum">    1040 </span><span class="lineNoCov">              0 :         nIndex = h &amp; ht-&gt;nTableMask;</span>
<span class="lineNum">    1041 </span>                : 
<span class="lineNum">    1042 </span><span class="lineNoCov">              0 :         p = ht-&gt;arBuckets[nIndex];</span>
<span class="lineNum">    1043 </span><span class="lineNoCov">              0 :         while (p != NULL) {</span>
<span class="lineNum">    1044 </span><span class="lineNoCov">              0 :                 if ((p-&gt;h == h) &amp;&amp; (p-&gt;nKeyLength == 0)) {</span>
<span class="lineNum">    1045 </span><span class="lineNoCov">              0 :                         return 1;</span>
<span class="lineNum">    1046 </span>                :                 }
<span class="lineNum">    1047 </span><span class="lineNoCov">              0 :                 p = p-&gt;pNext;</span>
<span class="lineNum">    1048 </span>                :         }
<span class="lineNum">    1049 </span><span class="lineNoCov">              0 :         return 0;</span>
<span class="lineNum">    1050 </span>                : }
<a name="1051"><span class="lineNum">    1051 </span>                : </a>
<span class="lineNum">    1052 </span>                : 
<span class="lineNum">    1053 </span><span class="lineCov">          10475 : ZEND_API int zend_hash_num_elements(const HashTable *ht)</span>
<span class="lineNum">    1054 </span>                : {
<span class="lineNum">    1055 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">    1056 </span>                : 
<span class="lineNum">    1057 </span><span class="lineCov">          10475 :         return ht-&gt;nNumOfElements;</span>
<span class="lineNum">    1058 </span>                : }
<a name="1059"><span class="lineNum">    1059 </span>                : </a>
<span class="lineNum">    1060 </span>                : 
<span class="lineNum">    1061 </span><span class="lineCov">           3842 : ZEND_API int zend_hash_get_pointer(const HashTable *ht, HashPointer *ptr)</span>
<span class="lineNum">    1062 </span>                : {
<span class="lineNum">    1063 </span><span class="lineCov">           3842 :         ptr-&gt;pos = ht-&gt;pInternalPointer;</span>
<span class="lineNum">    1064 </span><span class="lineCov">           3842 :         if (ht-&gt;pInternalPointer) {</span>
<span class="lineNum">    1065 </span><span class="lineCov">           3687 :                 ptr-&gt;h = ht-&gt;pInternalPointer-&gt;h;</span>
<span class="lineNum">    1066 </span><span class="lineCov">           3687 :                 return 1;</span>
<span class="lineNum">    1067 </span>                :         } else {
<span class="lineNum">    1068 </span><span class="lineCov">            155 :                 ptr-&gt;h = 0;</span>
<span class="lineNum">    1069 </span><span class="lineCov">            155 :                 return 0;</span>
<span class="lineNum">    1070 </span>                :         }
<a name="1071"><span class="lineNum">    1071 </span>                : }</a>
<span class="lineNum">    1072 </span>                : 
<span class="lineNum">    1073 </span><span class="lineCov">           3841 : ZEND_API int zend_hash_set_pointer(HashTable *ht, const HashPointer *ptr)</span>
<span class="lineNum">    1074 </span>                : {
<span class="lineNum">    1075 </span><span class="lineCov">           3841 :         if (ptr-&gt;pos == NULL) {</span>
<span class="lineNum">    1076 </span><span class="lineCov">            154 :                 ht-&gt;pInternalPointer = NULL;</span>
<span class="lineNum">    1077 </span><span class="lineCov">           3687 :         } else if (ht-&gt;pInternalPointer != ptr-&gt;pos) {</span>
<span class="lineNum">    1078 </span>                :                 Bucket *p;
<span class="lineNum">    1079 </span>                : 
<span class="lineNum">    1080 </span>                :                 IS_CONSISTENT(ht);
<span class="lineNum">    1081 </span><span class="lineNoCov">              0 :                 p = ht-&gt;arBuckets[ptr-&gt;h &amp; ht-&gt;nTableMask];</span>
<span class="lineNum">    1082 </span><span class="lineNoCov">              0 :                 while (p != NULL) {</span>
<span class="lineNum">    1083 </span><span class="lineNoCov">              0 :                         if (p == ptr-&gt;pos) {</span>
<span class="lineNum">    1084 </span><span class="lineNoCov">              0 :                                 ht-&gt;pInternalPointer = p;</span>
<span class="lineNum">    1085 </span><span class="lineNoCov">              0 :                                 return 1;</span>
<span class="lineNum">    1086 </span>                :                         }
<span class="lineNum">    1087 </span><span class="lineNoCov">              0 :                         p = p-&gt;pNext;</span>
<span class="lineNum">    1088 </span>                :                 }
<span class="lineNum">    1089 </span><span class="lineNoCov">              0 :                 return 0;</span>
<span class="lineNum">    1090 </span>                :         }
<span class="lineNum">    1091 </span><span class="lineCov">           3841 :         return 1;</span>
<a name="1092"><span class="lineNum">    1092 </span>                : }</a>
<span class="lineNum">    1093 </span>                : 
<span class="lineNum">    1094 </span><span class="lineCov">           4388 : ZEND_API void zend_hash_internal_pointer_reset_ex(HashTable *ht, HashPosition *pos)</span>
<span class="lineNum">    1095 </span>                : {
<span class="lineNum">    1096 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">    1097 </span>                : 
<span class="lineNum">    1098 </span><span class="lineCov">           4388 :         if (pos)</span>
<span class="lineNum">    1099 </span><span class="lineCov">            996 :                 *pos = ht-&gt;pListHead;</span>
<span class="lineNum">    1100 </span>                :         else
<span class="lineNum">    1101 </span><span class="lineCov">           3392 :                 ht-&gt;pInternalPointer = ht-&gt;pListHead;</span>
<span class="lineNum">    1102 </span><span class="lineCov">           4388 : }</span>
<span class="lineNum">    1103 </span>                : 
<span class="lineNum">    1104 </span>                : 
<span class="lineNum">    1105 </span>                : /* This function will be extremely optimized by remembering 
<a name="1106"><span class="lineNum">    1106 </span>                :  * the end of the list</a>
<span class="lineNum">    1107 </span>                :  */
<span class="lineNum">    1108 </span><span class="lineNoCov">              0 : ZEND_API void zend_hash_internal_pointer_end_ex(HashTable *ht, HashPosition *pos)</span>
<span class="lineNum">    1109 </span>                : {
<span class="lineNum">    1110 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">    1111 </span>                : 
<span class="lineNum">    1112 </span><span class="lineNoCov">              0 :         if (pos)</span>
<span class="lineNum">    1113 </span><span class="lineNoCov">              0 :                 *pos = ht-&gt;pListTail;</span>
<span class="lineNum">    1114 </span>                :         else
<span class="lineNum">    1115 </span><span class="lineNoCov">              0 :                 ht-&gt;pInternalPointer = ht-&gt;pListTail;</span>
<span class="lineNum">    1116 </span><span class="lineNoCov">              0 : }</span>
<a name="1117"><span class="lineNum">    1117 </span>                : </a>
<span class="lineNum">    1118 </span>                : 
<span class="lineNum">    1119 </span><span class="lineCov">          21011 : ZEND_API int zend_hash_move_forward_ex(HashTable *ht, HashPosition *pos)</span>
<span class="lineNum">    1120 </span>                : {
<span class="lineNum">    1121 </span><span class="lineCov">          21011 :         HashPosition *current = pos ? pos : &amp;ht-&gt;pInternalPointer;</span>
<span class="lineNum">    1122 </span>                : 
<span class="lineNum">    1123 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">    1124 </span>                : 
<span class="lineNum">    1125 </span><span class="lineCov">          21011 :         if (*current) {</span>
<span class="lineNum">    1126 </span><span class="lineCov">          21011 :                 *current = (*current)-&gt;pListNext;</span>
<span class="lineNum">    1127 </span><span class="lineCov">          21011 :                 return SUCCESS;</span>
<span class="lineNum">    1128 </span>                :         } else
<span class="lineNum">    1129 </span><span class="lineNoCov">              0 :                 return FAILURE;</span>
<a name="1130"><span class="lineNum">    1130 </span>                : }</a>
<span class="lineNum">    1131 </span>                : 
<span class="lineNum">    1132 </span><span class="lineNoCov">              0 : ZEND_API int zend_hash_move_backwards_ex(HashTable *ht, HashPosition *pos)</span>
<span class="lineNum">    1133 </span>                : {
<span class="lineNum">    1134 </span><span class="lineNoCov">              0 :         HashPosition *current = pos ? pos : &amp;ht-&gt;pInternalPointer;</span>
<span class="lineNum">    1135 </span>                : 
<span class="lineNum">    1136 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">    1137 </span>                : 
<span class="lineNum">    1138 </span><span class="lineNoCov">              0 :         if (*current) {</span>
<span class="lineNum">    1139 </span><span class="lineNoCov">              0 :                 *current = (*current)-&gt;pListLast;</span>
<span class="lineNum">    1140 </span><span class="lineNoCov">              0 :                 return SUCCESS;</span>
<span class="lineNum">    1141 </span>                :         } else
<span class="lineNum">    1142 </span><span class="lineNoCov">              0 :                 return FAILURE;</span>
<span class="lineNum">    1143 </span>                : }
<span class="lineNum">    1144 </span>                : 
<a name="1145"><span class="lineNum">    1145 </span>                : </a>
<span class="lineNum">    1146 </span>                : /* This function should be made binary safe  */
<span class="lineNum">    1147 </span><span class="lineCov">           5950 : ZEND_API int zend_hash_get_current_key_ex(const HashTable *ht, char **str_index, uint *str_length, ulong *num_index, zend_bool duplicate, HashPosition *pos)</span>
<span class="lineNum">    1148 </span>                : {
<span class="lineNum">    1149 </span>                :         Bucket *p;
<span class="lineNum">    1150 </span>                : 
<span class="lineNum">    1151 </span><span class="lineCov">           5950 :         p = pos ? (*pos) : ht-&gt;pInternalPointer;</span>
<span class="lineNum">    1152 </span>                : 
<span class="lineNum">    1153 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">    1154 </span>                : 
<span class="lineNum">    1155 </span><span class="lineCov">           5950 :         if (p) {</span>
<span class="lineNum">    1156 </span><span class="lineCov">           5946 :                 if (p-&gt;nKeyLength) {</span>
<span class="lineNum">    1157 </span><span class="lineCov">           5161 :                         if (duplicate) {</span>
<span class="lineNum">    1158 </span><span class="lineCov">           2515 :                                 *str_index = estrndup(p-&gt;arKey, p-&gt;nKeyLength - 1);</span>
<span class="lineNum">    1159 </span>                :                         } else {
<span class="lineNum">    1160 </span><span class="lineCov">           2646 :                                 *str_index = (char*)p-&gt;arKey;</span>
<span class="lineNum">    1161 </span>                :                         }
<span class="lineNum">    1162 </span><span class="lineCov">           5161 :                         if (str_length) {</span>
<span class="lineNum">    1163 </span><span class="lineCov">           5161 :                                 *str_length = p-&gt;nKeyLength;</span>
<span class="lineNum">    1164 </span>                :                         }
<span class="lineNum">    1165 </span><span class="lineCov">           5161 :                         return HASH_KEY_IS_STRING;</span>
<span class="lineNum">    1166 </span>                :                 } else {
<span class="lineNum">    1167 </span><span class="lineCov">            785 :                         *num_index = p-&gt;h;</span>
<span class="lineNum">    1168 </span><span class="lineCov">            785 :                         return HASH_KEY_IS_LONG;</span>
<span class="lineNum">    1169 </span>                :                 }
<span class="lineNum">    1170 </span>                :         }
<span class="lineNum">    1171 </span><span class="lineCov">              4 :         return HASH_KEY_NON_EXISTANT;</span>
<span class="lineNum">    1172 </span>                : }
<a name="1173"><span class="lineNum">    1173 </span>                : </a>
<span class="lineNum">    1174 </span>                : 
<span class="lineNum">    1175 </span><span class="lineCov">            891 : ZEND_API int zend_hash_get_current_key_type_ex(HashTable *ht, HashPosition *pos)</span>
<span class="lineNum">    1176 </span>                : {
<span class="lineNum">    1177 </span>                :         Bucket *p;
<span class="lineNum">    1178 </span>                : 
<span class="lineNum">    1179 </span><span class="lineCov">            891 :         p = pos ? (*pos) : ht-&gt;pInternalPointer;</span>
<span class="lineNum">    1180 </span>                : 
<span class="lineNum">    1181 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">    1182 </span>                : 
<span class="lineNum">    1183 </span><span class="lineCov">            891 :         if (p) {</span>
<span class="lineNum">    1184 </span><span class="lineCov">            707 :                 if (p-&gt;nKeyLength) {</span>
<span class="lineNum">    1185 </span><span class="lineCov">             91 :                         return HASH_KEY_IS_STRING;</span>
<span class="lineNum">    1186 </span>                :                 } else {
<span class="lineNum">    1187 </span><span class="lineCov">            616 :                         return HASH_KEY_IS_LONG;</span>
<span class="lineNum">    1188 </span>                :                 }
<span class="lineNum">    1189 </span>                :         }
<span class="lineNum">    1190 </span><span class="lineCov">            184 :         return HASH_KEY_NON_EXISTANT;</span>
<span class="lineNum">    1191 </span>                : }
<a name="1192"><span class="lineNum">    1192 </span>                : </a>
<span class="lineNum">    1193 </span>                : 
<span class="lineNum">    1194 </span><span class="lineCov">          25034 : ZEND_API int zend_hash_get_current_data_ex(HashTable *ht, void **pData, HashPosition *pos)</span>
<span class="lineNum">    1195 </span>                : {
<span class="lineNum">    1196 </span>                :         Bucket *p;
<span class="lineNum">    1197 </span>                : 
<span class="lineNum">    1198 </span><span class="lineCov">          25034 :         p = pos ? (*pos) : ht-&gt;pInternalPointer;</span>
<span class="lineNum">    1199 </span>                : 
<span class="lineNum">    1200 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">    1201 </span>                : 
<span class="lineNum">    1202 </span><span class="lineCov">          25034 :         if (p) {</span>
<span class="lineNum">    1203 </span><span class="lineCov">          21382 :                 *pData = p-&gt;pData;</span>
<span class="lineNum">    1204 </span><span class="lineCov">          21382 :                 return SUCCESS;</span>
<span class="lineNum">    1205 </span>                :         } else {
<span class="lineNum">    1206 </span><span class="lineCov">           3652 :                 return FAILURE;</span>
<span class="lineNum">    1207 </span>                :         }
<span class="lineNum">    1208 </span>                : }
<span class="lineNum">    1209 </span>                : 
<span class="lineNum">    1210 </span>                : /* This function changes key of current element without changing elements'
<a name="1211"><span class="lineNum">    1211 </span>                :  * order. If element with target key already exists, it will be deleted first.</a>
<span class="lineNum">    1212 </span>                :  */
<span class="lineNum">    1213 </span><span class="lineNoCov">              0 : ZEND_API int zend_hash_update_current_key_ex(HashTable *ht, int key_type, const char *str_index, uint str_length, ulong num_index, int mode, HashPosition *pos)</span>
<span class="lineNum">    1214 </span>                : {
<span class="lineNum">    1215 </span>                :         Bucket *p, *q;
<span class="lineNum">    1216 </span>                :         ulong h;
<span class="lineNum">    1217 </span>                : #ifdef ZEND_SIGNALS
<span class="lineNum">    1218 </span>                :         TSRMLS_FETCH();
<span class="lineNum">    1219 </span>                : #endif
<span class="lineNum">    1220 </span>                : 
<span class="lineNum">    1221 </span><span class="lineNoCov">              0 :         p = pos ? (*pos) : ht-&gt;pInternalPointer;</span>
<span class="lineNum">    1222 </span>                : 
<span class="lineNum">    1223 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">    1224 </span>                : 
<span class="lineNum">    1225 </span><span class="lineNoCov">              0 :         if (p) {</span>
<span class="lineNum">    1226 </span><span class="lineNoCov">              0 :                 if (key_type == HASH_KEY_IS_LONG) {</span>
<span class="lineNum">    1227 </span><span class="lineNoCov">              0 :                         str_length = 0;</span>
<span class="lineNum">    1228 </span><span class="lineNoCov">              0 :                         if (!p-&gt;nKeyLength &amp;&amp; p-&gt;h == num_index) {</span>
<span class="lineNum">    1229 </span><span class="lineNoCov">              0 :                                 return SUCCESS;</span>
<span class="lineNum">    1230 </span>                :                         }
<span class="lineNum">    1231 </span>                : 
<span class="lineNum">    1232 </span><span class="lineNoCov">              0 :                         q = ht-&gt;arBuckets[num_index &amp; ht-&gt;nTableMask];</span>
<span class="lineNum">    1233 </span><span class="lineNoCov">              0 :                         while (q != NULL) {</span>
<span class="lineNum">    1234 </span><span class="lineNoCov">              0 :                                 if (!q-&gt;nKeyLength &amp;&amp; q-&gt;h == num_index) {</span>
<span class="lineNum">    1235 </span><span class="lineNoCov">              0 :                                         break;</span>
<span class="lineNum">    1236 </span>                :                                 }
<span class="lineNum">    1237 </span><span class="lineNoCov">              0 :                                 q = q-&gt;pNext;</span>
<span class="lineNum">    1238 </span>                :                         }
<span class="lineNum">    1239 </span><span class="lineNoCov">              0 :                 } else if (key_type == HASH_KEY_IS_STRING) {</span>
<span class="lineNum">    1240 </span><span class="lineNoCov">              0 :                         if (IS_INTERNED(str_index)) {</span>
<span class="lineNum">    1241 </span><span class="lineNoCov">              0 :                                 h = INTERNED_HASH(str_index);</span>
<span class="lineNum">    1242 </span>                :                         } else {
<span class="lineNum">    1243 </span><span class="lineNoCov">              0 :                                 h = zend_inline_hash_func(str_index, str_length);</span>
<span class="lineNum">    1244 </span>                :                         }
<span class="lineNum">    1245 </span>                : 
<span class="lineNum">    1246 </span><span class="lineNoCov">              0 :                         if (p-&gt;arKey == str_index ||</span>
<span class="lineNum">    1247 </span><span class="lineNoCov">              0 :                             (p-&gt;nKeyLength == str_length &amp;&amp;</span>
<span class="lineNum">    1248 </span><span class="lineNoCov">              0 :                              p-&gt;h == h &amp;&amp;</span>
<span class="lineNum">    1249 </span><span class="lineNoCov">              0 :                              memcmp(p-&gt;arKey, str_index, str_length) == 0)) {</span>
<span class="lineNum">    1250 </span><span class="lineNoCov">              0 :                                 return SUCCESS;</span>
<span class="lineNum">    1251 </span>                :                         }
<span class="lineNum">    1252 </span>                : 
<span class="lineNum">    1253 </span><span class="lineNoCov">              0 :                         q = ht-&gt;arBuckets[h &amp; ht-&gt;nTableMask];</span>
<span class="lineNum">    1254 </span>                : 
<span class="lineNum">    1255 </span><span class="lineNoCov">              0 :                         while (q != NULL) {</span>
<span class="lineNum">    1256 </span><span class="lineNoCov">              0 :                                 if (q-&gt;arKey == str_index ||</span>
<span class="lineNum">    1257 </span><span class="lineNoCov">              0 :                                     (q-&gt;h == h &amp;&amp; q-&gt;nKeyLength == str_length &amp;&amp;</span>
<span class="lineNum">    1258 </span><span class="lineNoCov">              0 :                                      memcmp(q-&gt;arKey, str_index, str_length) == 0)) {</span>
<span class="lineNum">    1259 </span>                :                                         break;
<span class="lineNum">    1260 </span>                :                                 }
<span class="lineNum">    1261 </span><span class="lineNoCov">              0 :                                 q = q-&gt;pNext;</span>
<span class="lineNum">    1262 </span>                :                         }
<span class="lineNum">    1263 </span>                :                 } else {
<span class="lineNum">    1264 </span><span class="lineNoCov">              0 :                         return FAILURE;</span>
<span class="lineNum">    1265 </span>                :                 }
<span class="lineNum">    1266 </span>                : 
<span class="lineNum">    1267 </span><span class="lineNoCov">              0 :                 HANDLE_BLOCK_INTERRUPTIONS();</span>
<span class="lineNum">    1268 </span>                : 
<span class="lineNum">    1269 </span><span class="lineNoCov">              0 :                 if (q) {</span>
<span class="lineNum">    1270 </span><span class="lineNoCov">              0 :                         if (mode != HASH_UPDATE_KEY_ANYWAY) {</span>
<span class="lineNum">    1271 </span><span class="lineNoCov">              0 :                                 Bucket *r = p-&gt;pListLast;</span>
<span class="lineNum">    1272 </span><span class="lineNoCov">              0 :                                 int found = HASH_UPDATE_KEY_IF_BEFORE;</span>
<span class="lineNum">    1273 </span>                : 
<span class="lineNum">    1274 </span><span class="lineNoCov">              0 :                                 while (r) {</span>
<span class="lineNum">    1275 </span><span class="lineNoCov">              0 :                                         if (r == q) {</span>
<span class="lineNum">    1276 </span><span class="lineNoCov">              0 :                                                 found = HASH_UPDATE_KEY_IF_AFTER;</span>
<span class="lineNum">    1277 </span><span class="lineNoCov">              0 :                                                 break;</span>
<span class="lineNum">    1278 </span>                :                                         }
<span class="lineNum">    1279 </span><span class="lineNoCov">              0 :                                         r = r-&gt;pListLast;</span>
<span class="lineNum">    1280 </span>                :                                 }
<span class="lineNum">    1281 </span><span class="lineNoCov">              0 :                                 if (mode &amp; found) {</span>
<span class="lineNum">    1282 </span>                :                                         /* delete current bucket */
<span class="lineNum">    1283 </span><span class="lineNoCov">              0 :                                         if (p == ht-&gt;arBuckets[p-&gt;h &amp; ht-&gt;nTableMask]) {</span>
<span class="lineNum">    1284 </span><span class="lineNoCov">              0 :                                                 ht-&gt;arBuckets[p-&gt;h &amp; ht-&gt;nTableMask] = p-&gt;pNext;</span>
<span class="lineNum">    1285 </span>                :                                         } else {
<span class="lineNum">    1286 </span><span class="lineNoCov">              0 :                                                 p-&gt;pLast-&gt;pNext = p-&gt;pNext;</span>
<span class="lineNum">    1287 </span>                :                                         }
<span class="lineNum">    1288 </span><span class="lineNoCov">              0 :                                         if (p-&gt;pNext) {</span>
<span class="lineNum">    1289 </span><span class="lineNoCov">              0 :                                                 p-&gt;pNext-&gt;pLast = p-&gt;pLast;</span>
<span class="lineNum">    1290 </span>                :                                         }
<span class="lineNum">    1291 </span><span class="lineNoCov">              0 :                                         if (p-&gt;pListLast != NULL) {</span>
<span class="lineNum">    1292 </span><span class="lineNoCov">              0 :                                                 p-&gt;pListLast-&gt;pListNext = p-&gt;pListNext;</span>
<span class="lineNum">    1293 </span>                :                                         } else {
<span class="lineNum">    1294 </span>                :                                                 /* Deleting the head of the list */
<span class="lineNum">    1295 </span><span class="lineNoCov">              0 :                                                 ht-&gt;pListHead = p-&gt;pListNext;</span>
<span class="lineNum">    1296 </span>                :                                         }
<span class="lineNum">    1297 </span><span class="lineNoCov">              0 :                                         if (p-&gt;pListNext != NULL) {</span>
<span class="lineNum">    1298 </span><span class="lineNoCov">              0 :                                                 p-&gt;pListNext-&gt;pListLast = p-&gt;pListLast;</span>
<span class="lineNum">    1299 </span>                :                                         } else {
<span class="lineNum">    1300 </span><span class="lineNoCov">              0 :                                                 ht-&gt;pListTail = p-&gt;pListLast;</span>
<span class="lineNum">    1301 </span>                :                                         }
<span class="lineNum">    1302 </span><span class="lineNoCov">              0 :                                         if (ht-&gt;pInternalPointer == p) {</span>
<span class="lineNum">    1303 </span><span class="lineNoCov">              0 :                                                 ht-&gt;pInternalPointer = p-&gt;pListNext;</span>
<span class="lineNum">    1304 </span>                :                                         }
<span class="lineNum">    1305 </span><span class="lineNoCov">              0 :                                         if (ht-&gt;pDestructor) {</span>
<span class="lineNum">    1306 </span><span class="lineNoCov">              0 :                                                 ht-&gt;pDestructor(p-&gt;pData);</span>
<span class="lineNum">    1307 </span>                :                                         }
<span class="lineNum">    1308 </span><span class="lineNoCov">              0 :                                         if (p-&gt;pData != &amp;p-&gt;pDataPtr) {</span>
<span class="lineNum">    1309 </span><span class="lineNoCov">              0 :                                                 pefree(p-&gt;pData, ht-&gt;persistent);</span>
<span class="lineNum">    1310 </span>                :                                         }
<span class="lineNum">    1311 </span><span class="lineNoCov">              0 :                                         pefree(p, ht-&gt;persistent);</span>
<span class="lineNum">    1312 </span><span class="lineNoCov">              0 :                                         ht-&gt;nNumOfElements--;</span>
<span class="lineNum">    1313 </span><span class="lineNoCov">              0 :                                         HANDLE_UNBLOCK_INTERRUPTIONS();</span>
<span class="lineNum">    1314 </span><span class="lineNoCov">              0 :                                         return FAILURE;</span>
<span class="lineNum">    1315 </span>                :                                 }
<span class="lineNum">    1316 </span>                :                         }
<span class="lineNum">    1317 </span>                :                         /* delete another bucket with the same key */
<span class="lineNum">    1318 </span><span class="lineNoCov">              0 :                         if (q == ht-&gt;arBuckets[q-&gt;h &amp; ht-&gt;nTableMask]) {</span>
<span class="lineNum">    1319 </span><span class="lineNoCov">              0 :                                 ht-&gt;arBuckets[q-&gt;h &amp; ht-&gt;nTableMask] = q-&gt;pNext;</span>
<span class="lineNum">    1320 </span>                :                         } else {
<span class="lineNum">    1321 </span><span class="lineNoCov">              0 :                                 q-&gt;pLast-&gt;pNext = q-&gt;pNext;</span>
<span class="lineNum">    1322 </span>                :                         }
<span class="lineNum">    1323 </span><span class="lineNoCov">              0 :                         if (q-&gt;pNext) {</span>
<span class="lineNum">    1324 </span><span class="lineNoCov">              0 :                                 q-&gt;pNext-&gt;pLast = q-&gt;pLast;</span>
<span class="lineNum">    1325 </span>                :                         }
<span class="lineNum">    1326 </span><span class="lineNoCov">              0 :                         if (q-&gt;pListLast != NULL) {</span>
<span class="lineNum">    1327 </span><span class="lineNoCov">              0 :                                 q-&gt;pListLast-&gt;pListNext = q-&gt;pListNext;</span>
<span class="lineNum">    1328 </span>                :                         } else {
<span class="lineNum">    1329 </span>                :                                 /* Deleting the head of the list */
<span class="lineNum">    1330 </span><span class="lineNoCov">              0 :                                 ht-&gt;pListHead = q-&gt;pListNext;</span>
<span class="lineNum">    1331 </span>                :                         }
<span class="lineNum">    1332 </span><span class="lineNoCov">              0 :                         if (q-&gt;pListNext != NULL) {</span>
<span class="lineNum">    1333 </span><span class="lineNoCov">              0 :                                 q-&gt;pListNext-&gt;pListLast = q-&gt;pListLast;</span>
<span class="lineNum">    1334 </span>                :                         } else {
<span class="lineNum">    1335 </span><span class="lineNoCov">              0 :                                 ht-&gt;pListTail = q-&gt;pListLast;</span>
<span class="lineNum">    1336 </span>                :                         }
<span class="lineNum">    1337 </span><span class="lineNoCov">              0 :                         if (ht-&gt;pInternalPointer == q) {</span>
<span class="lineNum">    1338 </span><span class="lineNoCov">              0 :                                 ht-&gt;pInternalPointer = q-&gt;pListNext;</span>
<span class="lineNum">    1339 </span>                :                         }
<span class="lineNum">    1340 </span><span class="lineNoCov">              0 :                         if (ht-&gt;pDestructor) {</span>
<span class="lineNum">    1341 </span><span class="lineNoCov">              0 :                                 ht-&gt;pDestructor(q-&gt;pData);</span>
<span class="lineNum">    1342 </span>                :                         }
<span class="lineNum">    1343 </span><span class="lineNoCov">              0 :                         if (q-&gt;pData != &amp;q-&gt;pDataPtr) {</span>
<span class="lineNum">    1344 </span><span class="lineNoCov">              0 :                                 pefree(q-&gt;pData, ht-&gt;persistent);</span>
<span class="lineNum">    1345 </span>                :                         }
<span class="lineNum">    1346 </span><span class="lineNoCov">              0 :                         pefree(q, ht-&gt;persistent);</span>
<span class="lineNum">    1347 </span><span class="lineNoCov">              0 :                         ht-&gt;nNumOfElements--;</span>
<span class="lineNum">    1348 </span>                :                 }
<span class="lineNum">    1349 </span>                : 
<span class="lineNum">    1350 </span><span class="lineNoCov">              0 :                 if (p-&gt;pNext) {</span>
<span class="lineNum">    1351 </span><span class="lineNoCov">              0 :                         p-&gt;pNext-&gt;pLast = p-&gt;pLast;</span>
<span class="lineNum">    1352 </span>                :                 }
<span class="lineNum">    1353 </span><span class="lineNoCov">              0 :                 if (p-&gt;pLast) {</span>
<span class="lineNum">    1354 </span><span class="lineNoCov">              0 :                         p-&gt;pLast-&gt;pNext = p-&gt;pNext;</span>
<span class="lineNum">    1355 </span>                :                 } else {
<span class="lineNum">    1356 </span><span class="lineNoCov">              0 :                         ht-&gt;arBuckets[p-&gt;h &amp; ht-&gt;nTableMask] = p-&gt;pNext;</span>
<span class="lineNum">    1357 </span>                :                 }
<span class="lineNum">    1358 </span>                : 
<span class="lineNum">    1359 </span><span class="lineNoCov">              0 :                 if ((IS_INTERNED(p-&gt;arKey) != IS_INTERNED(str_index)) ||</span>
<span class="lineNum">    1360 </span><span class="lineNoCov">              0 :                     (!IS_INTERNED(p-&gt;arKey) &amp;&amp; p-&gt;nKeyLength != str_length)) {</span>
<span class="lineNum">    1361 </span>                :                         Bucket *q;
<span class="lineNum">    1362 </span>                : 
<span class="lineNum">    1363 </span><span class="lineNoCov">              0 :                         if (IS_INTERNED(str_index)) {</span>
<span class="lineNum">    1364 </span><span class="lineNoCov">              0 :                                 q = (Bucket *) pemalloc(sizeof(Bucket), ht-&gt;persistent);</span>
<span class="lineNum">    1365 </span>                :                         } else {
<span class="lineNum">    1366 </span><span class="lineNoCov">              0 :                                 q = (Bucket *) pemalloc(sizeof(Bucket) + str_length, ht-&gt;persistent);</span>
<span class="lineNum">    1367 </span>                :                         }
<span class="lineNum">    1368 </span>                : 
<span class="lineNum">    1369 </span><span class="lineNoCov">              0 :                         q-&gt;nKeyLength = str_length;</span>
<span class="lineNum">    1370 </span><span class="lineNoCov">              0 :                         if (p-&gt;pData == &amp;p-&gt;pDataPtr) {</span>
<span class="lineNum">    1371 </span><span class="lineNoCov">              0 :                                 q-&gt;pData = &amp;q-&gt;pDataPtr;</span>
<span class="lineNum">    1372 </span>                :                         } else {
<span class="lineNum">    1373 </span><span class="lineNoCov">              0 :                                 q-&gt;pData = p-&gt;pData;</span>
<span class="lineNum">    1374 </span>                :                         }
<span class="lineNum">    1375 </span><span class="lineNoCov">              0 :                         q-&gt;pDataPtr = p-&gt;pDataPtr;</span>
<span class="lineNum">    1376 </span><span class="lineNoCov">              0 :                         q-&gt;pListNext = p-&gt;pListNext;</span>
<span class="lineNum">    1377 </span><span class="lineNoCov">              0 :                         q-&gt;pListLast = p-&gt;pListLast;</span>
<span class="lineNum">    1378 </span><span class="lineNoCov">              0 :                         if (q-&gt;pListNext) {</span>
<span class="lineNum">    1379 </span><span class="lineNoCov">              0 :                                 p-&gt;pListNext-&gt;pListLast = q;</span>
<span class="lineNum">    1380 </span>                :                         } else {
<span class="lineNum">    1381 </span><span class="lineNoCov">              0 :                                 ht-&gt;pListTail = q;</span>
<span class="lineNum">    1382 </span>                :                         }
<span class="lineNum">    1383 </span><span class="lineNoCov">              0 :                         if (q-&gt;pListLast) {</span>
<span class="lineNum">    1384 </span><span class="lineNoCov">              0 :                                 p-&gt;pListLast-&gt;pListNext = q;</span>
<span class="lineNum">    1385 </span>                :                         } else {
<span class="lineNum">    1386 </span><span class="lineNoCov">              0 :                                 ht-&gt;pListHead = q;</span>
<span class="lineNum">    1387 </span>                :                         }
<span class="lineNum">    1388 </span><span class="lineNoCov">              0 :                         if (ht-&gt;pInternalPointer == p) {</span>
<span class="lineNum">    1389 </span><span class="lineNoCov">              0 :                                 ht-&gt;pInternalPointer = q;</span>
<span class="lineNum">    1390 </span>                :                         }
<span class="lineNum">    1391 </span><span class="lineNoCov">              0 :                         if (pos) {</span>
<span class="lineNum">    1392 </span><span class="lineNoCov">              0 :                                 *pos = q;</span>
<span class="lineNum">    1393 </span>                :                         }
<span class="lineNum">    1394 </span><span class="lineNoCov">              0 :                         pefree(p, ht-&gt;persistent);</span>
<span class="lineNum">    1395 </span><span class="lineNoCov">              0 :                         p = q;</span>
<span class="lineNum">    1396 </span>                :                 }
<span class="lineNum">    1397 </span>                : 
<span class="lineNum">    1398 </span><span class="lineNoCov">              0 :                 if (key_type == HASH_KEY_IS_LONG) {</span>
<span class="lineNum">    1399 </span><span class="lineNoCov">              0 :                         p-&gt;h = num_index;</span>
<span class="lineNum">    1400 </span>                :                 } else {
<span class="lineNum">    1401 </span><span class="lineNoCov">              0 :                         p-&gt;h = h;</span>
<span class="lineNum">    1402 </span><span class="lineNoCov">              0 :                         p-&gt;nKeyLength = str_length;</span>
<span class="lineNum">    1403 </span><span class="lineNoCov">              0 :                         if (IS_INTERNED(str_index)) {</span>
<span class="lineNum">    1404 </span><span class="lineNoCov">              0 :                                 p-&gt;arKey = str_index;</span>
<span class="lineNum">    1405 </span>                :                         } else {
<span class="lineNum">    1406 </span><span class="lineNoCov">              0 :                                 p-&gt;arKey = (const char*)(p+1);</span>
<span class="lineNum">    1407 </span><span class="lineNoCov">              0 :                                 memcpy((char*)p-&gt;arKey, str_index, str_length);</span>
<span class="lineNum">    1408 </span>                :                         }
<span class="lineNum">    1409 </span>                :                 }
<span class="lineNum">    1410 </span>                : 
<span class="lineNum">    1411 </span><span class="lineNoCov">              0 :                 CONNECT_TO_BUCKET_DLLIST(p, ht-&gt;arBuckets[p-&gt;h &amp; ht-&gt;nTableMask]);</span>
<span class="lineNum">    1412 </span><span class="lineNoCov">              0 :                 ht-&gt;arBuckets[p-&gt;h &amp; ht-&gt;nTableMask] = p;</span>
<span class="lineNum">    1413 </span><span class="lineNoCov">              0 :                 HANDLE_UNBLOCK_INTERRUPTIONS();</span>
<span class="lineNum">    1414 </span>                : 
<span class="lineNum">    1415 </span><span class="lineNoCov">              0 :                 return SUCCESS;</span>
<span class="lineNum">    1416 </span>                :         } else {
<span class="lineNum">    1417 </span><span class="lineNoCov">              0 :                 return FAILURE;</span>
<span class="lineNum">    1418 </span>                :         }
<a name="1419"><span class="lineNum">    1419 </span>                : }</a>
<span class="lineNum">    1420 </span>                : 
<span class="lineNum">    1421 </span><span class="lineCov">             49 : ZEND_API int zend_hash_sort(HashTable *ht, sort_func_t sort_func,</span>
<span class="lineNum">    1422 </span>                :                                                         compare_func_t compar, int renumber TSRMLS_DC)
<span class="lineNum">    1423 </span>                : {
<span class="lineNum">    1424 </span>                :         Bucket **arTmp;
<span class="lineNum">    1425 </span>                :         Bucket *p;
<span class="lineNum">    1426 </span>                :         int i, j;
<span class="lineNum">    1427 </span>                : 
<span class="lineNum">    1428 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">    1429 </span>                : 
<span class="lineNum">    1430 </span><span class="lineCov">             49 :         if (!(ht-&gt;nNumOfElements&gt;1) &amp;&amp; !(renumber &amp;&amp; ht-&gt;nNumOfElements&gt;0)) { /* Doesn't require sorting */</span>
<span class="lineNum">    1431 </span><span class="lineNoCov">              0 :                 return SUCCESS;</span>
<span class="lineNum">    1432 </span>                :         }
<span class="lineNum">    1433 </span><span class="lineCov">             49 :         arTmp = (Bucket **) pemalloc(ht-&gt;nNumOfElements * sizeof(Bucket *), ht-&gt;persistent);</span>
<span class="lineNum">    1434 </span><span class="lineCov">             49 :         if (!arTmp) {</span>
<span class="lineNum">    1435 </span><span class="lineNoCov">              0 :                 return FAILURE;</span>
<span class="lineNum">    1436 </span>                :         }
<span class="lineNum">    1437 </span><span class="lineCov">             49 :         p = ht-&gt;pListHead;</span>
<span class="lineNum">    1438 </span><span class="lineCov">             49 :         i = 0;</span>
<span class="lineNum">    1439 </span><span class="lineCov">            524 :         while (p) {</span>
<span class="lineNum">    1440 </span><span class="lineCov">            426 :                 arTmp[i] = p;</span>
<span class="lineNum">    1441 </span><span class="lineCov">            426 :                 p = p-&gt;pListNext;</span>
<span class="lineNum">    1442 </span><span class="lineCov">            426 :                 i++;</span>
<span class="lineNum">    1443 </span>                :         }
<span class="lineNum">    1444 </span>                : 
<span class="lineNum">    1445 </span><span class="lineCov">             49 :         (*sort_func)((void *) arTmp, i, sizeof(Bucket *), compar TSRMLS_CC);</span>
<span class="lineNum">    1446 </span>                : 
<span class="lineNum">    1447 </span><span class="lineCov">             49 :         HANDLE_BLOCK_INTERRUPTIONS();</span>
<span class="lineNum">    1448 </span><span class="lineCov">             49 :         ht-&gt;pListHead = arTmp[0];</span>
<span class="lineNum">    1449 </span><span class="lineCov">             49 :         ht-&gt;pListTail = NULL;</span>
<span class="lineNum">    1450 </span><span class="lineCov">             49 :         ht-&gt;pInternalPointer = ht-&gt;pListHead;</span>
<span class="lineNum">    1451 </span>                : 
<span class="lineNum">    1452 </span><span class="lineCov">             49 :         arTmp[0]-&gt;pListLast = NULL;</span>
<span class="lineNum">    1453 </span><span class="lineCov">             49 :         if (i &gt; 1) {</span>
<span class="lineNum">    1454 </span><span class="lineCov">             49 :                 arTmp[0]-&gt;pListNext = arTmp[1];</span>
<span class="lineNum">    1455 </span><span class="lineCov">            377 :                 for (j = 1; j &lt; i-1; j++) {</span>
<span class="lineNum">    1456 </span><span class="lineCov">            328 :                         arTmp[j]-&gt;pListLast = arTmp[j-1];</span>
<span class="lineNum">    1457 </span><span class="lineCov">            328 :                         arTmp[j]-&gt;pListNext = arTmp[j+1];</span>
<span class="lineNum">    1458 </span>                :                 }
<span class="lineNum">    1459 </span><span class="lineCov">             49 :                 arTmp[j]-&gt;pListLast = arTmp[j-1];</span>
<span class="lineNum">    1460 </span><span class="lineCov">             49 :                 arTmp[j]-&gt;pListNext = NULL;</span>
<span class="lineNum">    1461 </span>                :         } else {
<span class="lineNum">    1462 </span><span class="lineNoCov">              0 :                 arTmp[0]-&gt;pListNext = NULL;</span>
<span class="lineNum">    1463 </span>                :         }
<span class="lineNum">    1464 </span><span class="lineCov">             49 :         ht-&gt;pListTail = arTmp[i-1];</span>
<span class="lineNum">    1465 </span>                : 
<span class="lineNum">    1466 </span><span class="lineCov">             49 :         pefree(arTmp, ht-&gt;persistent);</span>
<span class="lineNum">    1467 </span><span class="lineCov">             49 :         HANDLE_UNBLOCK_INTERRUPTIONS();</span>
<span class="lineNum">    1468 </span>                : 
<span class="lineNum">    1469 </span><span class="lineCov">             49 :         if (renumber) {</span>
<span class="lineNum">    1470 </span><span class="lineCov">              1 :                 p = ht-&gt;pListHead;</span>
<span class="lineNum">    1471 </span><span class="lineCov">              1 :                 i=0;</span>
<span class="lineNum">    1472 </span><span class="lineCov">             44 :                 while (p != NULL) {</span>
<span class="lineNum">    1473 </span><span class="lineCov">             42 :                         p-&gt;nKeyLength = 0;</span>
<span class="lineNum">    1474 </span><span class="lineCov">             42 :                         p-&gt;h = i++;</span>
<span class="lineNum">    1475 </span><span class="lineCov">             42 :                         p = p-&gt;pListNext;</span>
<span class="lineNum">    1476 </span>                :                 }
<span class="lineNum">    1477 </span><span class="lineCov">              1 :                 ht-&gt;nNextFreeElement = i;</span>
<span class="lineNum">    1478 </span><span class="lineCov">              1 :                 zend_hash_rehash(ht);</span>
<span class="lineNum">    1479 </span>                :         }
<span class="lineNum">    1480 </span><span class="lineCov">             49 :         return SUCCESS;</span>
<span class="lineNum">    1481 </span>                : }
<a name="1482"><span class="lineNum">    1482 </span>                : </a>
<span class="lineNum">    1483 </span>                : 
<span class="lineNum">    1484 </span><span class="lineNoCov">              0 : ZEND_API int zend_hash_compare(HashTable *ht1, HashTable *ht2, compare_func_t compar, zend_bool ordered TSRMLS_DC)</span>
<span class="lineNum">    1485 </span>                : {
<span class="lineNum">    1486 </span><span class="lineNoCov">              0 :         Bucket *p1, *p2 = NULL;</span>
<span class="lineNum">    1487 </span>                :         int result;
<span class="lineNum">    1488 </span>                :         void *pData2;
<span class="lineNum">    1489 </span>                : 
<span class="lineNum">    1490 </span>                :         IS_CONSISTENT(ht1);
<span class="lineNum">    1491 </span>                :         IS_CONSISTENT(ht2);
<span class="lineNum">    1492 </span>                : 
<span class="lineNum">    1493 </span><span class="lineNoCov">              0 :         HASH_PROTECT_RECURSION(ht1); </span>
<span class="lineNum">    1494 </span><span class="lineNoCov">              0 :         HASH_PROTECT_RECURSION(ht2); </span>
<span class="lineNum">    1495 </span>                : 
<span class="lineNum">    1496 </span><span class="lineNoCov">              0 :         result = ht1-&gt;nNumOfElements - ht2-&gt;nNumOfElements;</span>
<span class="lineNum">    1497 </span><span class="lineNoCov">              0 :         if (result!=0) {</span>
<span class="lineNum">    1498 </span><span class="lineNoCov">              0 :                 HASH_UNPROTECT_RECURSION(ht1); </span>
<span class="lineNum">    1499 </span><span class="lineNoCov">              0 :                 HASH_UNPROTECT_RECURSION(ht2); </span>
<span class="lineNum">    1500 </span><span class="lineNoCov">              0 :                 return result;</span>
<span class="lineNum">    1501 </span>                :         }
<span class="lineNum">    1502 </span>                : 
<span class="lineNum">    1503 </span><span class="lineNoCov">              0 :         p1 = ht1-&gt;pListHead;</span>
<span class="lineNum">    1504 </span><span class="lineNoCov">              0 :         if (ordered) {</span>
<span class="lineNum">    1505 </span><span class="lineNoCov">              0 :                 p2 = ht2-&gt;pListHead;</span>
<span class="lineNum">    1506 </span>                :         }
<span class="lineNum">    1507 </span>                : 
<span class="lineNum">    1508 </span><span class="lineNoCov">              0 :         while (p1) {</span>
<span class="lineNum">    1509 </span><span class="lineNoCov">              0 :                 if (ordered &amp;&amp; !p2) {</span>
<span class="lineNum">    1510 </span><span class="lineNoCov">              0 :                         HASH_UNPROTECT_RECURSION(ht1); </span>
<span class="lineNum">    1511 </span><span class="lineNoCov">              0 :                         HASH_UNPROTECT_RECURSION(ht2); </span>
<span class="lineNum">    1512 </span><span class="lineNoCov">              0 :                         return 1; /* That's not supposed to happen */</span>
<span class="lineNum">    1513 </span>                :                 }
<span class="lineNum">    1514 </span><span class="lineNoCov">              0 :                 if (ordered) {</span>
<span class="lineNum">    1515 </span><span class="lineNoCov">              0 :                         if (p1-&gt;nKeyLength==0 &amp;&amp; p2-&gt;nKeyLength==0) { /* numeric indices */</span>
<span class="lineNum">    1516 </span><span class="lineNoCov">              0 :                                 result = p1-&gt;h - p2-&gt;h;</span>
<span class="lineNum">    1517 </span><span class="lineNoCov">              0 :                                 if (result!=0) {</span>
<span class="lineNum">    1518 </span><span class="lineNoCov">              0 :                                         HASH_UNPROTECT_RECURSION(ht1); </span>
<span class="lineNum">    1519 </span><span class="lineNoCov">              0 :                                         HASH_UNPROTECT_RECURSION(ht2); </span>
<span class="lineNum">    1520 </span><span class="lineNoCov">              0 :                                         return result;</span>
<span class="lineNum">    1521 </span>                :                                 }
<span class="lineNum">    1522 </span>                :                         } else { /* string indices */
<span class="lineNum">    1523 </span><span class="lineNoCov">              0 :                                 result = p1-&gt;nKeyLength - p2-&gt;nKeyLength;</span>
<span class="lineNum">    1524 </span><span class="lineNoCov">              0 :                                 if (result!=0) {</span>
<span class="lineNum">    1525 </span><span class="lineNoCov">              0 :                                         HASH_UNPROTECT_RECURSION(ht1); </span>
<span class="lineNum">    1526 </span><span class="lineNoCov">              0 :                                         HASH_UNPROTECT_RECURSION(ht2); </span>
<span class="lineNum">    1527 </span><span class="lineNoCov">              0 :                                         return result;</span>
<span class="lineNum">    1528 </span>                :                                 }
<span class="lineNum">    1529 </span><span class="lineNoCov">              0 :                                 result = memcmp(p1-&gt;arKey, p2-&gt;arKey, p1-&gt;nKeyLength);</span>
<span class="lineNum">    1530 </span><span class="lineNoCov">              0 :                                 if (result!=0) {</span>
<span class="lineNum">    1531 </span><span class="lineNoCov">              0 :                                         HASH_UNPROTECT_RECURSION(ht1); </span>
<span class="lineNum">    1532 </span><span class="lineNoCov">              0 :                                         HASH_UNPROTECT_RECURSION(ht2); </span>
<span class="lineNum">    1533 </span><span class="lineNoCov">              0 :                                         return result;</span>
<span class="lineNum">    1534 </span>                :                                 }
<span class="lineNum">    1535 </span>                :                         }
<span class="lineNum">    1536 </span><span class="lineNoCov">              0 :                         pData2 = p2-&gt;pData;</span>
<span class="lineNum">    1537 </span>                :                 } else {
<span class="lineNum">    1538 </span><span class="lineNoCov">              0 :                         if (p1-&gt;nKeyLength==0) { /* numeric index */</span>
<span class="lineNum">    1539 </span><span class="lineNoCov">              0 :                                 if (zend_hash_index_find(ht2, p1-&gt;h, &amp;pData2)==FAILURE) {</span>
<span class="lineNum">    1540 </span><span class="lineNoCov">              0 :                                         HASH_UNPROTECT_RECURSION(ht1); </span>
<span class="lineNum">    1541 </span><span class="lineNoCov">              0 :                                         HASH_UNPROTECT_RECURSION(ht2); </span>
<span class="lineNum">    1542 </span><span class="lineNoCov">              0 :                                         return 1;</span>
<span class="lineNum">    1543 </span>                :                                 }
<span class="lineNum">    1544 </span>                :                         } else { /* string index */
<span class="lineNum">    1545 </span><span class="lineNoCov">              0 :                                 if (zend_hash_quick_find(ht2, p1-&gt;arKey, p1-&gt;nKeyLength, p1-&gt;h, &amp;pData2)==FAILURE) {</span>
<span class="lineNum">    1546 </span><span class="lineNoCov">              0 :                                         HASH_UNPROTECT_RECURSION(ht1); </span>
<span class="lineNum">    1547 </span><span class="lineNoCov">              0 :                                         HASH_UNPROTECT_RECURSION(ht2); </span>
<span class="lineNum">    1548 </span><span class="lineNoCov">              0 :                                         return 1;</span>
<span class="lineNum">    1549 </span>                :                                 }
<span class="lineNum">    1550 </span>                :                         }
<span class="lineNum">    1551 </span>                :                 }
<span class="lineNum">    1552 </span><span class="lineNoCov">              0 :                 result = compar(p1-&gt;pData, pData2 TSRMLS_CC);</span>
<span class="lineNum">    1553 </span><span class="lineNoCov">              0 :                 if (result!=0) {</span>
<span class="lineNum">    1554 </span><span class="lineNoCov">              0 :                         HASH_UNPROTECT_RECURSION(ht1); </span>
<span class="lineNum">    1555 </span><span class="lineNoCov">              0 :                         HASH_UNPROTECT_RECURSION(ht2); </span>
<span class="lineNum">    1556 </span><span class="lineNoCov">              0 :                         return result;</span>
<span class="lineNum">    1557 </span>                :                 }
<span class="lineNum">    1558 </span><span class="lineNoCov">              0 :                 p1 = p1-&gt;pListNext;</span>
<span class="lineNum">    1559 </span><span class="lineNoCov">              0 :                 if (ordered) {</span>
<span class="lineNum">    1560 </span><span class="lineNoCov">              0 :                         p2 = p2-&gt;pListNext;</span>
<span class="lineNum">    1561 </span>                :                 }
<span class="lineNum">    1562 </span>                :         }
<span class="lineNum">    1563 </span>                :         
<span class="lineNum">    1564 </span><span class="lineNoCov">              0 :         HASH_UNPROTECT_RECURSION(ht1); </span>
<span class="lineNum">    1565 </span><span class="lineNoCov">              0 :         HASH_UNPROTECT_RECURSION(ht2); </span>
<span class="lineNum">    1566 </span><span class="lineNoCov">              0 :         return 0;</span>
<span class="lineNum">    1567 </span>                : }
<a name="1568"><span class="lineNum">    1568 </span>                : </a>
<span class="lineNum">    1569 </span>                : 
<span class="lineNum">    1570 </span><span class="lineNoCov">              0 : ZEND_API int zend_hash_minmax(const HashTable *ht, compare_func_t compar, int flag, void **pData TSRMLS_DC)</span>
<span class="lineNum">    1571 </span>                : {
<span class="lineNum">    1572 </span>                :         Bucket *p, *res;
<span class="lineNum">    1573 </span>                : 
<span class="lineNum">    1574 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">    1575 </span>                : 
<span class="lineNum">    1576 </span><span class="lineNoCov">              0 :         if (ht-&gt;nNumOfElements == 0 ) {</span>
<span class="lineNum">    1577 </span><span class="lineNoCov">              0 :                 *pData=NULL;</span>
<span class="lineNum">    1578 </span><span class="lineNoCov">              0 :                 return FAILURE;</span>
<span class="lineNum">    1579 </span>                :         }
<span class="lineNum">    1580 </span>                : 
<span class="lineNum">    1581 </span><span class="lineNoCov">              0 :         res = p = ht-&gt;pListHead;</span>
<span class="lineNum">    1582 </span><span class="lineNoCov">              0 :         while ((p = p-&gt;pListNext)) {</span>
<span class="lineNum">    1583 </span><span class="lineNoCov">              0 :                 if (flag) {</span>
<span class="lineNum">    1584 </span><span class="lineNoCov">              0 :                         if (compar(&amp;res, &amp;p TSRMLS_CC) &lt; 0) { /* max */</span>
<span class="lineNum">    1585 </span><span class="lineNoCov">              0 :                                 res = p;</span>
<span class="lineNum">    1586 </span>                :                         }
<span class="lineNum">    1587 </span>                :                 } else {
<span class="lineNum">    1588 </span><span class="lineNoCov">              0 :                         if (compar(&amp;res, &amp;p TSRMLS_CC) &gt; 0) { /* min */</span>
<span class="lineNum">    1589 </span><span class="lineNoCov">              0 :                                 res = p;</span>
<span class="lineNum">    1590 </span>                :                         }
<span class="lineNum">    1591 </span>                :                 }
<span class="lineNum">    1592 </span>                :         }
<span class="lineNum">    1593 </span><span class="lineNoCov">              0 :         *pData = res-&gt;pData;</span>
<span class="lineNum">    1594 </span><span class="lineNoCov">              0 :         return SUCCESS;</span>
<a name="1595"><span class="lineNum">    1595 </span>                : }</a>
<span class="lineNum">    1596 </span>                : 
<span class="lineNum">    1597 </span><span class="lineCov">            627 : ZEND_API ulong zend_hash_next_free_element(const HashTable *ht)</span>
<span class="lineNum">    1598 </span>                : {
<span class="lineNum">    1599 </span>                :         IS_CONSISTENT(ht);
<span class="lineNum">    1600 </span>                : 
<span class="lineNum">    1601 </span><span class="lineCov">            627 :         return ht-&gt;nNextFreeElement;</span>
<span class="lineNum">    1602 </span>                : 
<span class="lineNum">    1603 </span>                : }
<span class="lineNum">    1604 </span>                : 
<span class="lineNum">    1605 </span>                : 
<span class="lineNum">    1606 </span>                : #if ZEND_DEBUG
<span class="lineNum">    1607 </span>                : void zend_hash_display_pListTail(const HashTable *ht)
<span class="lineNum">    1608 </span>                : {
<span class="lineNum">    1609 </span>                :         Bucket *p;
<span class="lineNum">    1610 </span>                : 
<span class="lineNum">    1611 </span>                :         p = ht-&gt;pListTail;
<span class="lineNum">    1612 </span>                :         while (p != NULL) {
<span class="lineNum">    1613 </span>                :                 zend_output_debug_string(0, &quot;pListTail has key %s\n&quot;, p-&gt;arKey);
<span class="lineNum">    1614 </span>                :                 p = p-&gt;pListLast;
<span class="lineNum">    1615 </span>                :         }
<span class="lineNum">    1616 </span>                : }
<span class="lineNum">    1617 </span>                : 
<span class="lineNum">    1618 </span>                : void zend_hash_display(const HashTable *ht)
<span class="lineNum">    1619 </span>                : {
<span class="lineNum">    1620 </span>                :         Bucket *p;
<span class="lineNum">    1621 </span>                :         uint i;
<span class="lineNum">    1622 </span>                : 
<span class="lineNum">    1623 </span>                :         if (UNEXPECTED(ht-&gt;nNumOfElements == 0)) {
<span class="lineNum">    1624 </span>                :                 zend_output_debug_string(0, &quot;The hash is empty&quot;);
<span class="lineNum">    1625 </span>                :                 return;
<span class="lineNum">    1626 </span>                :         }
<span class="lineNum">    1627 </span>                :         for (i = 0; i &lt; ht-&gt;nTableSize; i++) {
<span class="lineNum">    1628 </span>                :                 p = ht-&gt;arBuckets[i];
<span class="lineNum">    1629 </span>                :                 while (p != NULL) {
<span class="lineNum">    1630 </span>                :                         zend_output_debug_string(0, &quot;%s &lt;==&gt; 0x%lX\n&quot;, p-&gt;arKey, p-&gt;h);
<span class="lineNum">    1631 </span>                :                         p = p-&gt;pNext;
<span class="lineNum">    1632 </span>                :                 }
<span class="lineNum">    1633 </span>                :         }
<span class="lineNum">    1634 </span>                : 
<span class="lineNum">    1635 </span>                :         p = ht-&gt;pListTail;
<span class="lineNum">    1636 </span>                :         while (p != NULL) {
<span class="lineNum">    1637 </span>                :                 zend_output_debug_string(0, &quot;%s &lt;==&gt; 0x%lX\n&quot;, p-&gt;arKey, p-&gt;h);
<span class="lineNum">    1638 </span>                :                 p = p-&gt;pListLast;
<span class="lineNum">    1639 </span>                :         }
<span class="lineNum">    1640 </span>                : }
<span class="lineNum">    1641 </span>                : #endif
<span class="lineNum">    1642 </span>                : 
<span class="lineNum">    1643 </span>                : /*
<span class="lineNum">    1644 </span>                :  * Local variables:
<span class="lineNum">    1645 </span>                :  * tab-width: 4
<span class="lineNum">    1646 </span>                :  * c-basic-offset: 4
<span class="lineNum">    1647 </span>                :  * indent-tabs-mode: t
<span class="lineNum">    1648 </span>                :  * End:
<span class="lineNum">    1649 </span>                :  */
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
  <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.7</a></td></tr>
  </table>
  <br>

</body>
</html>
